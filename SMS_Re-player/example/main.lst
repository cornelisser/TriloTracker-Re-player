Sjasm Z80 Assembler v0.42b8 - www.xl2s.tk             [2021.04.04 - 15:30:33]

main.asm
Errors: 0

       1   00:0000                      	defpage	0,0x4000, 0x8000		; page 0 contains main code + far call routines
       2   00:0000                      
       3   00:0000                      ; -----------------------------
       4   00:0000                      ; TT-replayer example
       5   00:0000                      ; 
       6   00:0000                      ; This example plays compiled PSG+SCC songs
       7   00:0000                      ; ------------------------------
       8   00:0000                      
       9   00:0000                      ;	include	".\code\variables.asm"
      10   00:0000                      
      11   00:0000  (00)                	page 0
      12   00:4000                      	code page 0
      13   00:4000                      	
      14   00:4000                      	org	04000h
      15   00:4000  41 42               	db	041h,042h
      16   00:4002  10 40               	dw	initmain
      17   00:4004                      	dz 	'TTDEMO'
      17   00:4004  54 54 44 45 4D 4F 00 
      18   00:400B  00 (5)              	ds	5
      19   00:4010                      		
      20   00:4010                      initmain:
      21   00:4010                      
      22   00:4010                      ;	ei
      23   00:4010                      ;	halt
      24   00:4010  F3                  	di
      25   00:4011                      		
      26   00:4011                      ;; set pages and subslot
      27   00:4011                      ;;
      28   00:4011  CD 38 01            	call    0x138
      29   00:4014  0F                  	rrca
      30   00:4015  0F                  	rrca
      31   00:4016  E6 03               	and     0x03
      32   00:4018  4F                  	ld      c,a
      33   00:4019  06 00               	ld      b,0
      34   00:401B  21 C1 FC            	ld      hl,0xfcc1
      35   00:401E  09                  	add     hl,bc
      36   00:401F  B6                  	or      (hl)
      37   00:4020  47                  	ld      b,a
      38   00:4021  23                  	inc     hl
      39   00:4022  23                  	inc     hl
      40   00:4023  23                  	inc     hl
      41   00:4024  23                  	inc     hl
      42   00:4025  7E                  	ld      a,(hl)
      43   00:4026  E6 0C               	and     0x0c
      44   00:4028  B0                  	or      b
      45   00:4029                          
      46   00:4029  26 80               	ld      h,0x80
      47   00:402B  CD 24 00            	call    0x24        
      48   00:402E                      	
      49   00:402E                      	;clear RAM (first kb only)
      50   00:402E  01 00 04            	ld	bc,1024
      51   00:4031  21 00 C0            	ld	hl,0xc000
      52   00:4034  11 01 C0            	ld	de,0xc001
      53   00:4037                      
      54   00:4037  36 00               	ld	(hl),0
      55   00:4039  ED B0               	ldir	
      56   00:403B                      
      57   00:403B                      	;--- place replayer on hook
      58   00:403B  3E C3               	ld	a,0xc3
      59   00:403D  21 D2 40            	ld	hl,isr
      60   00:4040  32 9A FD            	ld	(0xFD9A),a
      61   00:4043  22 9B FD            	ld	(0xFD9B),hl	
      62   00:4046                      	
      63   00:4046                      	
      64   00:4046                      	;--- Set speed equalization
      65   00:4046  3A E8 FF            	ld	a,($FFE8)	; get mirror of VDP reg# 9
      66   00:4049  E6 02               	and	2
      67   00:404B  CA 50 40            	jp	z,99f
      68   00:404E  3E FF               	ld	a,-1
      69   00:4050                      99:
      70   00:4050  3C                  	inc	a			; 1 = 60hz
      71   00:4051  32 2F C0            	ld	(equalization_freq),a
      72   00:4054  32 30 C0            	ld	(equalization_cnt),a
      73   00:4057                      	
      74   00:4057                      	;--- Init screen
      75   00:4057  CD A4 42            	call 	init_vdp
      76   00:405A  FB                  	ei
      77   00:405B  76                  	halt
      78   00:405C  F3                  	di
      79   00:405D  CD EA 45            	call	init_font		; set the new font
      80   00:4060                      	
      81   00:4060                      	;--- initialise replayer
      82   00:4060  CD 02 46            	call	replay_init
      83   00:4063                      ;	call	ttsfx_init
      84   00:4063  3E 01               	ld	a,1
      85   00:4065  32 2F C0            	ld	(equalization_freq),a
      86   00:4068  32 30 C0            	ld	(equalization_cnt),a	
      87   00:406B                      	;--- initialise demo song
      88   00:406B  21 25 56            	ld	hl,demo_song
      89   00:406E  CD 73 46            	call	replay_loadsong
      90   00:4071                      	
      91   00:4071                      	;--- initialise sfx pointers
      92   00:4071                      	
      93   00:4071                      	
      94   00:4071  CD 0C 41            	call	clear_debug
      95   00:4074                      	
      96   00:4074  FB                  	ei
      97   00:4075                      	
      98   00:4075  CD F0 42            	call	clear_screen
      99   00:4078  21 56 01            	ld	hl,80*4+22
     100   00:407B  11 2F 5B            	ld	de,TEXT_Title
     101   00:407E  CD 37 43            	call	draw_label
     102   00:4081  21 04 02            	ld	hl,80*6+36
     103   00:4084  11 54 5B            	ld	de,TEXT_Step
     104   00:4087  CD 37 43            	call	draw_label
     105   00:408A  21 84 02            	ld	hl,80*8+4
     106   00:408D  11 5A 5B            	ld	de,TEXT_Header_Data
     107   00:4090  CD 37 43            	call	draw_label	
     108   00:4093                      	
     109   00:4093  21 A6 02            	ld	hl,80*8+38
     110   00:4096  11 72 5B            	ld	de,TEXT_Register_Header
     111   00:4099  CD 37 43            	call	draw_label		
     112   00:409C                      
     113   00:409C  21 48 04            	ld 	hl,80*13+56
     114   00:409F  11 95 5B            	ld	de,TEXT_Register_Drum
     115   00:40A2  CD 37 43            	call	draw_label	
     116   00:40A5                      
     117   00:40A5  21 A4 05            	ld 	hl,80*18+4
     118   00:40A8  11 A6 5B            	ld	de,TEXT_Legend_Data
     119   00:40AB  CD 37 43            	call	draw_label	
     120   00:40AE                      
     121   00:40AE                      
     122   00:40AE                      	
     123   00:40AE  AF                  	xor	a
     124   00:40AF  32 FB C4            	ld	(pattern),a
     125   00:40B2                      
     126   00:40B2                      ;	call	replay_pause
     127   00:40B2                      ;	ld	bc,$0001
     128   00:40B2                      ;	call	ttsfx_start
     129   00:40B2                      	
     130   00:40B2                      infinite:
     131   00:40B2  76                  	halt	
     132   00:40B3                      ;	call	register_debug
     133   00:40B3                      
     134   00:40B3                      	
     135   00:40B3                      ;	ld	a,$f0 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     136   00:40B3                      ;	out	(0x99),a
     137   00:40B3                      ;	ld	a,7+128
     138   00:40B3                      ;	out	(0x99),a	
     139   00:40B3                      
     140   00:40B3                      
     141   00:40B3                      	
     142   00:40B3                      ;	ld	a,$f3 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     143   00:40B3                      ;	out	(0x99),a
     144   00:40B3                      ;	ld	a,7+128
     145   00:40B3                      ;	out	(0x99),a
     146   00:40B3                      	
     147   00:40B3                      ;	ld	a,$f0
     148   00:40B3                      ;	out	(0x99),a
     149   00:40B3                      ;	ld	a,7+128
     150   00:40B3                      ;	out	(0x99),a	
     151   00:40B3                      	;--- display debug info
     152   00:40B3  CD 1A 41            	call	debuginfo	
     153   00:40B6  CD 90 41            	call	register_debug
     154   00:40B9  CD 65 41            	call	step_debug
     155   00:40BC                      	
     156   00:40BC                      	
     157   00:40BC                      	
     158   00:40BC                      	
     159   00:40BC                      	;---- Test for space
     160   00:40BC  AF                  	xor	a
     161   00:40BD  CD D8 00            	call	$00D8
     162   00:40C0  A7                  	and	a
     163   00:40C1  CA B2 40            	jp	z,infinite
     164   00:40C4                      
     165   00:40C4                      ;	call	replay_pause
     166   00:40C4  01 01 00            	ld	bc,$0001
     167   00:40C7                      ;	call	ttsfx_start
     168   00:40C7                      ;	ld	a,0
     169   00:40C7                      ;	call	replay_set_SCC_balance
     170   00:40C7                      ;	ld	de,-2
     171   00:40C7                      ;	call	replay_transpose	
     172   00:40C7                      ;	ld	a,32
     173   00:40C7                      ;	call	replay_fade_out
     174   00:40C7                      ;	call	replay_pause
     175   00:40C7                      	; wait_key_release
     176   00:40C7                      99:	
     177   00:40C7  AF                  	xor	a
     178   00:40C8  CD D8 00            	call	$00D8
     179   00:40CB  A7                  	and	a
     180   00:40CC  C2 C7 40            	jp	nz,99b
     181   00:40CF                      	
     182   00:40CF  C3 B2 40            	jp	infinite
     183   00:40D2                      
     184   00:40D2                      	
     185   00:40D2                      	
     186   00:40D2                      isr:
     187   00:40D2  DB 99               	in	a,(0x99)
     188   00:40D4  CD F6 40            	call	write_debug
     189   00:40D7  3E FC               	ld	a,$fc ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     190   00:40D9  D3 99               	out	(0x99),a
     191   00:40DB  3E 87               	ld	a,7+128
     192   00:40DD  D3 99               	out	(0x99),a	
     193   00:40DF  CD 55 50            	call	replay_route		; first outout data
     194   00:40E2  3E F4               	ld	a,$f4 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     195   00:40E4  D3 99               	out	(0x99),a
     196   00:40E6  3E 87               	ld	a,7+128
     197   00:40E8  D3 99               	out	(0x99),a		
     198   00:40EA  CD 21 47            	call	replay_play			; calculate next output
     199   00:40ED  3E F0               	ld	a,$f0 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     200   00:40EF  D3 99               	out	(0x99),a
     201   00:40F1  3E 87               	ld	a,7+128
     202   00:40F3  D3 99               	out	(0x99),a	
     203   00:40F5                      ;	call	ttsfx_play
     204   00:40F5                      
     205   00:40F5                      
     206   00:40F5                      
     207   00:40F5  C9                  	ret
     208   00:40F6                      	
     209   00:40F6                      write_debug:
     210   00:40F6  21 D0 22            	ld 	hl,_PNT+(80*9)
     211   00:40F9  CD B2 45            	call	set_vdpwrite	
     212   00:40FC                      
     213   00:40FC  21 53 C2            	ld 	hl,debug_pnt
     214   00:40FF  3E 08               	ld	a,8
     215   00:4101  0E 98               	ld	c,$98
     216   00:4103                      _wd_loop:
     217   00:4103  06 50               	ld	b,80
     218   00:4105  ED B3               	otir
     219   00:4107                      	
     220   00:4107  3D                  	dec	a
     221   00:4108  C2 03 41            	jp	nz,_wd_loop
     222   00:410B                      
     223   00:410B  C9                  	ret
     224   00:410C                      	
     225   00:410C                      clear_debug:
     226   00:410C  21 53 C2            	ld	hl,debug_pnt
     227   00:410F  11 54 C2            	ld	de,debug_pnt+1
     228   00:4112  36 20               	ld	(hl),32
     229   00:4114  01 7F 02            	ld	bc,(8*80)-1
     230   00:4117  ED B0               	ldir
     231   00:4119  C9                  	ret
     232   00:411A                      
     233   00:411A                      debuginfo:
     234   00:411A                      ;	ld	bc,40
     235   00:411A                      ;	call	clear_TEXT
     236   00:411A                      	
     237   00:411A  06 08               	ld	b,8
     238   00:411C  DD 21 43 C0         	ld	ix,TRACK_Chan1+17
     239   00:4120  11 57 C2            	ld	de,debug_pnt+4
     240   00:4123                      .loop	
     241   00:4123  C5                  	push	bc
     242   00:4124  D5                  	push	de
     243   00:4125                      	
     244   00:4125  3E 09               	ld	a,9
     245   00:4127  90                  	sub	b
     246   00:4128  CD A5 43            	call	draw_decimal
     247   00:412B  13                  	inc	de
     248   00:412C  DD 7E F6            	ld	a,(ix+TRACK_Note)
     249   00:412F  CD 95 43            	call	draw_hex2
     250   00:4132  13                  	inc 	de
     251   00:4133  DD 7E EF            	ld	a,(ix+TRACK_Instrument)
     252   00:4136  CD 95 43            	call	draw_hex2
     253   00:4139  13                  	inc 	de
     254   00:413A  DD 7E F8            	ld	a,(ix+TRACK_Voice)
     255   00:413D  CD 95 43            	call	draw_hex2
     256   00:4140  13                  	inc 	de	
     257   00:4141  DD 7E F7            	ld	a,(ix+TRACK_Volume)
     258   00:4144  CD 95 43            	call	draw_hex2
     259   00:4147  13                  	inc 	de
     260   00:4148  DD 7E F0            	ld	a,(ix+TRACK_Command)
     261   00:414B  CD 95 43            	call	draw_hex2	
     262   00:414E  13                  	inc 	de
     263   00:414F                      
     264   00:414F  EB                  	ex	de,hl
     265   00:4150  DD 46 F9            	ld	b,(ix+TRACK_Flags)
     266   00:4153  CD 39 42            	call 	debug_flags
     267   00:4156                      
     268   00:4156                      
     269   00:4156                      	; next line
     270   00:4156  E1                  	pop	hl
     271   00:4157  11 50 00            	ld	de,80
     272   00:415A  19                  	add	hl,de
     273   00:415B  EB                  	ex	de,hl
     274   00:415C                      	
     275   00:415C                      
     276   00:415C                      	;--- Next track
     277   00:415C  01 27 00            	ld	bc,TRACK_REC_SIZE
     278   00:415F  DD 09               	add	ix,bc
     279   00:4161                      	
     280   00:4161  C1                  	pop	bc
     281   00:4162  10 BF               	djnz	.loop
     282   00:4164  C9                  	ret
     283   00:4165                      
     284   00:4165                      step_debug:
     285   00:4165  01 07 00            	ld	bc,7
     286   00:4168  CD 2D 42            	call	clear_TEXT
     287   00:416B  2A 1D C0            	ld	hl,(replay_orderpointer)
     288   00:416E  11 2C 56            	ld	de,demo_song+7
     289   00:4171  AF                  	xor 	a
     290   00:4172  ED 52               	sbc	hl,de
     291   00:4174  29                  	add	hl,hl		;X2
     292   00:4175  29                  	add	hl,hl		;X4	
     293   00:4176  29                  	add	hl,hl		;X8
     294   00:4177  29                  	add	hl,hl		;X16
     295   00:4178  7C                  	ld	a,h
     296   00:4179  3D                  	dec	a
     297   00:417A  21 4F C2            	ld	hl,debug_pointer1
     298   00:417D  77                  	ld	(hl),a
     299   00:417E  11 D3 C4            	ld	de,TEXT_Chan
     300   00:4181  CD BC 43            	call	draw_decimal3
     301   00:4184                      	
     302   00:4184  21 09 02            	ld	hl,80*6+41
     303   00:4187  11 D3 C4            	ld	de,TEXT_Chan
     304   00:418A  06 03               	ld	b,3
     305   00:418C  CD 4B 43            	call	draw_label_fast
     306   00:418F  C9                  	ret
     307   00:4190                      	
     308   00:4190                      
     309   00:4190                      register_debug:
     310   00:4190                      ;	ld	bc,7
     311   00:4190                      ;	call	clear_TEXT
     312   00:4190  21 F1 41            	ld	hl,REG_list
     313   00:4193                      	
     314   00:4193                      	;	DRAW PSG Tone vol	
     315   00:4193  FD 2E 03            	ld	iyl,3
     316   00:4196  11 82 C2            	ld 	de,debug_pnt+47
     317   00:4199                      ;	ld	(debug_pointer1),bc
     318   00:4199  CD CA 41            	call	register_debug_loop
     319   00:419C                      
     320   00:419C                      	;	DRAW PSG Noise and mixer	
     321   00:419C  FD 2E 01            	ld	iyl,1
     322   00:419F  11 8B C2            	ld 	de,debug_pnt+56
     323   00:41A2                      ;	ld	(debug_pointer1),bc
     324   00:41A2  CD CA 41            	call	register_debug_loop	
     325   00:41A5                      	
     326   00:41A5                      	;	DRAW PSG Envelop + shape
     327   00:41A5  FD 2E 01            	ld	iyl,1
     328   00:41A8  11 94 C2            	ld 	de,debug_pnt+65
     329   00:41AB                      ;	ld	(debug_pointer1),bc
     330   00:41AB  CD CA 41            	call	register_debug_loop		
     331   00:41AE                      
     332   00:41AE                      	;	DRAW FM Tone Vol	
     333   00:41AE  FD 2E 06            	ld	iyl,6
     334   00:41B1  11 19 C3            	ld 	de,debug_pnt+(80*2)+38
     335   00:41B4                      ;	ld	(debug_pointer1),bc
     336   00:41B4  CD CA 41            	call	register_debug_loop
     337   00:41B7                      	
     338   00:41B7                      	
     339   00:41B7                      	;	DRAW FM Drum macro + percusion
     340   00:41B7  FD 2E 01            	ld	iyl,1
     341   00:41BA  11 1B C4            	ld 	de,debug_pnt+(80*5)+56
     342   00:41BD                      ;	ld	(debug_pointer1),bc
     343   00:41BD  CD CA 41            	call	register_debug_loop
     344   00:41C0                      
     345   00:41C0                      	;	DRAW FM Drum tone + vol
     346   00:41C0  FD 2E 03            	ld	iyl,3
     347   00:41C3  11 24 C4            	ld 	de,debug_pnt+(80*5)+65
     348   00:41C6                      ;	ld	(debug_pointer1),bc
     349   00:41C6  CD CA 41            	call	register_debug_loop
     350   00:41C9                      	
     351   00:41C9  C9                  	ret
     352   00:41CA                      
     353   00:41CA                      register_debug_loop:
     354   00:41CA  D5                  	push 	de
     355   00:41CB                      ;	ld	de,TEXT_Chan
     356   00:41CB  4E                  	ld	c,(hl)
     357   00:41CC  23                  	inc	hl
     358   00:41CD  46                  	ld	b,(hl)
     359   00:41CE  23                  	inc	hl
     360   00:41CF                      	
     361   00:41CF  03                  	inc	bc
     362   00:41D0  0A                  	ld	a,(bc)
     363   00:41D1  0B                  	dec	bc
     364   00:41D2  CD 95 43            	call	draw_hex2		; tone
     365   00:41D5  0A                  	ld	a,(bc)
     366   00:41D6  CD 95 43            	call	draw_hex2
     367   00:41D9                      	
     368   00:41D9  13                  	inc 	de	
     369   00:41DA                      	
     370   00:41DA  4E                  	ld	c,(hl)
     371   00:41DB  23                  	inc	hl
     372   00:41DC  46                  	ld	b,(hl)
     373   00:41DD  23                  	inc	hl	
     374   00:41DE                      	
     375   00:41DE  0A                  	ld	a,(bc)
     376   00:41DF  CD 95 43            	call	draw_hex2		; vol
     377   00:41E2                      	
     378   00:41E2                      	;-- next line
     379   00:41E2  D1                  	pop 	de
     380   00:41E3  3E 50               	ld	a,80
     381   00:41E5  83                  	add	a,e
     382   00:41E6  5F                  	ld	e,a
     383   00:41E7  D2 EB 41            	jp	nc,99f
     384   00:41EA  14                  	inc	d
     385   00:41EB                      99:	
     386   00:41EB  FD 2D               	dec	iyl
     387   00:41ED  C2 CA 41            	jp	nz,register_debug_loop
     388   00:41F0  C9                  	ret
     389   00:41F1                      
     390   00:41F1                      REG_list:
     391   00:41F1  6A C1 72 C1         	dw	PSG_regToneA,PSG_regVOLA
     392   00:41F5  6C C1 73 C1         	dw	PSG_regToneB,PSG_regVOLB
     393   00:41F9  6E C1 74 C1         	dw	PSG_regToneC,PSG_regVOLC
     394   00:41FD  70 C1 71 C1         	dw	PSG_regNOISE,PSG_regMIXER
     395   00:4201  00 00 00 00         	dw	0,0;PSG_regEnvL,PSG_regEnvShape 	
     396   00:4205  78 C1 7C C1         	dw	FM_regToneA,FM_regVOLA 
     397   00:4209  7E C1 82 C1         	dw	FM_regToneB,FM_regVOLB 
     398   00:420D  84 C1 88 C1         	dw	FM_regToneC,FM_regVOLC 
     399   00:4211  8A C1 8E C1         	dw	FM_regToneD,FM_regVOLD 
     400   00:4215  90 C1 94 C1         	dw	FM_regToneE,FM_regVOLE 
     401   00:4219  96 C1 9A C1         	dw	FM_regToneF,FM_regVOLF 
     402   00:421D  BA C1 AE C1         	dw	FM_DRUM_MACRO,FM_DRUM
     403   00:4221  B0 C1 B2 C1         	dw	FM_freqreg1,FM_volreg1
     404   00:4225  B3 C1 B5 C1         	dw	FM_freqreg2,FM_volreg2	
     405   00:4229  B6 C1 B8 C1         	dw	FM_freqreg3,FM_volreg3	
     406   00:422D                      
     407   00:422D                      
     408   00:422D                      
     409   00:422D                      
     410   00:422D                      ; input BC length to clear
     411   00:422D                      clear_TEXT:
     412   00:422D  0B                  	dec	bc
     413   00:422E  21 D3 C4            	ld	hl,TEXT_Chan
     414   00:4231  11 D4 C4            	ld	de,TEXT_Chan+1
     415   00:4234  36 20               	ld	(hl),' '
     416   00:4236  ED B0               	ldir
     417   00:4238  C9                  	ret
     418   00:4239                      
     419   00:4239                      debug_flags:
     420   00:4239  CB 78               	bit	7,b
     421   00:423B  CA 43 42            	jp	z,1f
     422   00:423E  36 46               	ld	(hl),'F'
     423   00:4240  C3 45 42            	jp	2f
     424   00:4243                      1:
     425   00:4243  36 50               	ld	(hl),'P'
     426   00:4245                      	
     427   00:4245                      2:
     428   00:4245  23                  	inc	hl
     429   00:4246  CB 70               	bit	6,b
     430   00:4248  CA 50 42            	jp	z,1f
     431   00:424B  36 56               	ld	(hl),'V'
     432   00:424D  C3 52 42            	jp	2f
     433   00:4250                      1:
     434   00:4250  36 20               	ld	(hl),' '
     435   00:4252                      	
     436   00:4252                      2:	
     437   00:4252  23                  	inc	hl
     438   00:4253  CB 68               	bit	5,b
     439   00:4255  CA 5D 42            	jp	z,1f
     440   00:4258  36 53               	ld	(hl),'S'
     441   00:425A  C3 5F 42            	jp	2f
     442   00:425D                      1:
     443   00:425D  36 20               	ld	(hl),' '
     444   00:425F                      	
     445   00:425F                      2:	
     446   00:425F  23                  	inc	hl
     447   00:4260  CB 60               	bit	4,b
     448   00:4262  C2 6A 42            	jp	nz,1f
     449   00:4265  36 4B               	ld	(hl),'K'
     450   00:4267  C3 6C 42            	jp	2f
     451   00:426A                      1:
     452   00:426A  36 20               	ld	(hl),' '
     453   00:426C                      	
     454   00:426C                      2:	
     455   00:426C  23                  	inc	hl
     456   00:426D  CB 58               	bit	3,b
     457   00:426F  CA 77 42            	jp	z,1f
     458   00:4272  36 43               	ld	(hl),'C'
     459   00:4274  C3 79 42            	jp	2f
     460   00:4277                      1:
     461   00:4277  36 20               	ld	(hl),' '
     462   00:4279                      	
     463   00:4279                      2:	
     464   00:4279  23                  	inc	hl
     465   00:427A  CB 50               	bit	2,b
     466   00:427C  CA 84 42            	jp	z,1f
     467   00:427F  36 45               	ld	(hl),'E'
     468   00:4281  C3 86 42            	jp	2f
     469   00:4284                      1:
     470   00:4284  36 20               	ld	(hl),' '
     471   00:4286                      	
     472   00:4286                      2:	
     473   00:4286  23                  	inc	hl	
     474   00:4287  CB 48               	bit	1,b
     475   00:4289  CA 91 42            	jp	z,1f
     476   00:428C  36 41               	ld	(hl),'A'
     477   00:428E  C3 93 42            	jp	2f
     478   00:4291                      1:
     479   00:4291  36 20               	ld	(hl),' '
     480   00:4293                      	
     481   00:4293                      2:	
     482   00:4293  23                  	inc	hl	
     483   00:4294  CB 40               	bit	0,b
     484   00:4296  CA 9E 42            	jp	z,1f
     485   00:4299  36 4E               	ld	(hl),'N'
     486   00:429B  C3 A0 42            	jp	2f
     487   00:429E                      1:
     488   00:429E  36 20               	ld	(hl),' '
     489   00:42A0                      	
     490   00:42A0                      2:	
     491   00:42A0  23                  	inc	hl		
     492   00:42A1  EB                  	ex	de,hl
     493   00:42A2                      
     494   00:42A2  13                  	inc 	de
     495   00:42A3  C9                  	ret
     496   00:42A4                      
     497   00:42A4                      
     498   00:42A4                      
     499   00:42A4                      
     500   00:42A4                      	
     501   00:42A4                      	; --- init_vdp
     502   00:42A4                      	; 
     503   00:42A4                      	; Initial init of the vdp
     504   00:42A4                      init_vdp:
     505   00:42A4                      
     506   00:42A4  3E 04               	ld	a,00000100b ; Reg#0 [ 0 ][DG ][IE2][IE1][M5 ][M4 ][M3 ][ 0 ]
     507   00:42A6  D3 99               	out	(0x99),a
     508   00:42A8  3E 80               	ld	a,0+128
     509   00:42AA  D3 99               	out	(0x99),a
     510   00:42AC                      
     511   00:42AC  3E 70               	ld	a,01110000b ; Reg#1 [ 0 ][BL ][IE0][M1 ][M2 ][ 0 ][SIZ][MAG]
     512   00:42AE                      
     513   00:42AE  D3 99               	out	(0x99),a
     514   00:42B0  3E 81               	ld	a,1+128
     515   00:42B2  D3 99               	out	(0x99),a	
     516   00:42B4                      
     517   00:42B4  3E 0B               	ld	a,00001011b ; REG#2[ 0 ][A16][A15][A14][A13][A12][ 1 ][ 1 ]  - Pattern layout table
     518   00:42B6                      
     519   00:42B6  D3 99               	out	(0x99),a
     520   00:42B8  3E 82               	ld	a,2+128
     521   00:42BA  D3 99               	out	(0x99),a	
     522   00:42BC                      
     523   00:42BC  3E AF               	ld	a,10101111b ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     524   00:42BE                      
     525   00:42BE  D3 99               	out	(0x99),a
     526   00:42C0  3E 83               	ld	a,3+128
     527   00:42C2  D3 99               	out	(0x99),a	
     528   00:42C4                      	
     529   00:42C4  3E 12               	ld	a,00010010b ; Reg#4 [ 0 ][ 0 ][A16][A15][A14][A13][A12][A11]  - Pattern generator table
     530   00:42C6                      
     531   00:42C6  D3 99               	out	(0x99),a
     532   00:42C8  3E 84               	ld	a,4+128
     533   00:42CA  D3 99               	out	(0x99),a	
     534   00:42CC                      	
     535   00:42CC  3A E8 FF            	ld	a,($FFE8)
     536   00:42CF  F6 80               	or	10000000b ; Reg#9 [LN ][ 0 ][S1 ][S0 ][IL ][EO ][NT ][DC ]
     537   00:42D1  D3 99               	out	(0x99),a
     538   00:42D3  3E 89               	ld	a,9+128
     539   00:42D5  D3 99               	out	(0x99),a	
     540   00:42D7                      
     541   00:42D7                      
     542   00:42D7  3E F0               	ld	a,$f0
     543   00:42D9  D3 99               	out	(0x99),a
     544   00:42DB  3E 87               	ld	a,7+128
     545   00:42DD  D3 99               	out	(0x99),a
     546   00:42DF  3E E1               	ld	a,$e1
     547   00:42E1  D3 99               	out	(0x99),a
     548   00:42E3  3E 8C               	ld	a,12+128
     549   00:42E5  D3 99               	out	(0x99),a
     550   00:42E7  3E F0               	ld	a,0xF0	;reg#13
     551   00:42E9  D3 99               	out	(0x99),a
     552   00:42EB  3E 8D               	ld	a,13+128
     553   00:42ED  D3 99               	out	(0x99),a		
     554   00:42EF                      	
     555   00:42EF                      	
     556   00:42EF                      
     557   00:42EF  C9                  	ret		
     558   00:42F0                      	include	".\screen.asm"
       1.  00:42F0  (00:0082)           _UPLEFT			equ	130
       2.  00:42F0  (00:0081)           _HORIZONTAL			equ	129
       3.  00:42F0  (00:0083)           _UPRIGHT			equ	131
       4.  00:42F0  (00:0080)           _VERTICAL			equ	128
       5.  00:42F0  (00:0087)           _VERTICAL_SMALL		equ	135
       6.  00:42F0  (00:0086)           _VERTICAL_DOUBLE		equ	134
       7.  00:42F0  (00:008B)           _VERTICAL_STEP		equ	139
       8.  00:42F0  (00:00B0)           _ARROWLEFT			equ	176
       9.  00:42F0  (00:00B1)           _ARROWRIGHT			equ	177
      10.  00:42F0  (00:00AE)           _LOOPSIGN			equ	174
      11.  00:42F0  (00:00F1)           _TONE_OFF_SIGN		equ	241
      12.  00:42F0  (00:00F2)           _TONE_ON_SIGN		equ	242
      13.  00:42F0  (00:00F3)           _NOISE_OFF_SIGN		equ	243
      14.  00:42F0  (00:00F4)           _NOISE_ON_SIGN		equ	244
      15.  00:42F0  (00:00F5)           _ENV_OFF_SIGN		equ	245
      16.  00:42F0  (00:00F6)           _ENV_ON_SIGN		equ	246
      17.  00:42F0  (00:00BF)           _CMD_SIGN			equ	6*32-1
      18.  00:42F0  (00:00FE)           _CURSOR			equ	254
      19.  00:42F0                      
      20.  00:42F0  (00:00FC)           MOUSE_CHR			equ 	252
      21.  00:42F0                      
      22.  00:42F0  (00:2000)           _PNT		equ	0x2000		; pnt
      23.  00:42F0  (00:2A00)           _CNT		equ	0x2a00		; cnt
      24.  00:42F0                      
      25.  00:42F0                      
      26.  00:42F0                      
      27.  00:42F0                      ; ==========================================================	
      28.  00:42F0                      	; --- clear_window
      29.  00:42F0                      	; 
      30.  00:42F0                      	; Clears the current screen (pnt and cnt)
      31.  00:42F0                      	;
      32.  00:42F0                      ; ==========================================================	
      33.  00:42F0                      clear_screen:
      34.  00:42F0  21 00 20            	ld 	hl,_PNT
      35.  00:42F3  CD B2 45            	call	set_vdpwrite	
      36.  00:42F6                      
      37.  00:42F6  1E 1B               	ld	e,27
      38.  00:42F8  3E 20               	ld	a,32
      39.  00:42FA  F3                  	di
      40.  00:42FB                      0:	;-- main loop
      41.  00:42FB  01 98 50            	ld	bc,0x5098
      42.  00:42FE                      1:	;--- sub loop
      43.  00:42FE  ED 79               		out	(c),a
      44.  00:4300  10 FC               		djnz 	1b
      45.  00:4302                      	; -- end sub loop
      46.  00:4302  1D                  	dec	e
      47.  00:4303  20 F6               	jr	nz,0b
      48.  00:4305                      	; -- end main loop	
      49.  00:4305                      
      50.  00:4305                      clear_cnt:
      51.  00:4305  21 00 2A            	ld 	hl,_CNT
      52.  00:4308  CD B2 45            	call	set_vdpwrite	
      53.  00:430B                      	
      54.  00:430B  1E 1B               	ld	e,27
      55.  00:430D  3E 00               	ld	a,0
      56.  00:430F  F3                  	di
      57.  00:4310                      0:	;-- main loop
      58.  00:4310  01 98 0A            	ld	bc,0x0a98
      59.  00:4313                      1:	;--- sub loop
      60.  00:4313  ED 79               		out	(c),a
      61.  00:4315  10 FC               		djnz 	1b
      62.  00:4317                      	; -- end sub loop
      63.  00:4317  1D                  	dec	e
      64.  00:4318  20 F6               	jr	nz,0b
      65.  00:431A                      	; -- end main loop	
      66.  00:431A                      	
      67.  00:431A  FB                  	ei
      68.  00:431B  C9                  	ret
      69.  00:431C                      
      70.  00:431C                      ; ==========================================================	
      71.  00:431C                      	; --- clear_files
      72.  00:431C                      	; 
      73.  00:431C                      	; Clears the files area in the file dialog 
      74.  00:431C                      	;
      75.  00:431C                      ; ==========================================================	
      76.  00:431C                      clear_files:
      77.  00:431C                      
      78.  00:431C  06 14               	ld	b,20
      79.  00:431E  21 E0 21            	ld	hl,_PNT+(80*6)
      80.  00:4321                      
      81.  00:4321  C5                  0:	push	bc
      82.  00:4322  E5                  	push	hl
      83.  00:4323  CD B2 45            	call	set_vdpwrite	
      84.  00:4326                      
      85.  00:4326  06 38               	ld	b,56
      86.  00:4328  3E 20               	ld	a,32
      87.  00:432A                      
      88.  00:432A                      1:	;--- sub loop
      89.  00:432A  D3 98               		out	(0x98),a
      90.  00:432C  10 FC               		djnz 	1b
      91.  00:432E                      	; -- end sub loop
      92.  00:432E  E1                  	pop	hl
      93.  00:432F  01 50 00            	ld	bc,80
      94.  00:4332  09                  	add	hl,bc
      95.  00:4333                      	
      96.  00:4333  C1                  	pop	bc
      97.  00:4334  10 EB               	djnz	0b
      98.  00:4336                      
      99.  00:4336  C9                  	ret	
     100.  00:4337                      
     101.  00:4337                      
     102.  00:4337                      
     103.  00:4337                      
     104.  00:4337                      ; ==========================================================	
     105.  00:4337                      	; --- draw_label
     106.  00:4337                      	; 
     107.  00:4337                      	; Draw box 
     108.  00:4337                      	; HL = position in PNT (relative)
     109.  00:4337                      	; DE = pointer to the label text
     110.  00:4337                      ; ==========================================================
     111.  00:4337                      draw_label:
     112.  00:4337  F3                  	di
     113.  00:4338                      ;	ld	a,$f3 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     114.  00:4338                      ;	out	(0x99),a
     115.  00:4338                      ;	ld	a,7+128
     116.  00:4338                      ;	out	(0x99),a	
     117.  00:4338                      
     118.  00:4338                      	
     119.  00:4338  01 00 20            	ld 	bc,_PNT
     120.  00:433B  09                  	add	hl,bc
     121.  00:433C  CD B2 45            	call	set_vdpwrite			
     122.  00:433F                      	
     123.  00:433F                      draw_label_loop:
     124.  00:433F  1A                  	ld	a,(de)
     125.  00:4340  FE 00               	cp	0
     126.  00:4342  28 05               	jr.	z,draw_label_end	
     127.  00:4344  D3 98               	out	(0x98),a
     128.  00:4346                      	
     129.  00:4346  13                  	inc	de
     130.  00:4347  18 F6               	jr.	draw_label_loop
     131.  00:4349                      	
     132.  00:4349                      draw_label_end:
     133.  00:4349                      ;	ld	a,$f0 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     134.  00:4349                      ;	out	(0x99),a
     135.  00:4349                      ;	ld	a,7+128
     136.  00:4349                      ;	out	(0x99),a	
     137.  00:4349  FB                  	ei
     138.  00:434A  C9                  	ret
     139.  00:434B                      
     140.  00:434B                      ; ==========================================================	
     141.  00:434B                      	; --- draw_label_fast
     142.  00:434B                      	; 
     143.  00:434B                      	; Draw box 
     144.  00:434B                      	; HL = position in PNT (relative)
     145.  00:434B                      	; DE = pointer to the label text
     146.  00:434B                      	; BC = number of bytes to copy to vram
     147.  00:434B                      ; ==========================================================
     148.  00:434B                      draw_label_fast:
     149.  00:434B  F3                  	di
     150.  00:434C                      ;	ld	a,$f5 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     151.  00:434C                      ;	out	(0x99),a
     152.  00:434C                      ;	ld	a,7+128
     153.  00:434C                      ;	out	(0x99),a		
     154.  00:434C                      	
     155.  00:434C  C5                  	push	bc
     156.  00:434D  01 00 20            	ld 	bc,_PNT
     157.  00:4350  09                  	add	hl,bc	
     158.  00:4351  CD B2 45            	call	set_vdpwrite	
     159.  00:4354                      			
     160.  00:4354  EB                  	ex	de,hl
     161.  00:4355  C1                  	pop	bc
     162.  00:4356  0E 98               	ld	c,0x98
     163.  00:4358                      	
     164.  00:4358  ED B3               	otir
     165.  00:435A                      		
     166.  00:435A                      		
     167.  00:435A                      ;	ld	a,$f0 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     168.  00:435A                      ;	out	(0x99),a
     169.  00:435A                      ;	ld	a,7+128
     170.  00:435A                      ;	out	(0x99),a			
     171.  00:435A  FB                  	ei
     172.  00:435B                      	
     173.  00:435B  C9                  	ret
     174.  00:435C                      
     175.  00:435C                      ; ==========================================================	
     176.  00:435C                      	; --- draw_fake_hex_sp
     177.  00:435C                      	; 
     178.  00:435C                      	; Prints the value at an address as 1 digit decimal value 
     179.  00:435C                      	; But value 0 is printed as '.'
     180.  00:435C                      	; Values can be larger than F
     181.  00:435C                      	; A = the value
     182.  00:435C                      	; DE = position (relative) to put the value in PNT
     183.  00:435C                      	; 
     184.  00:435C                      ; ==========================================================
     185.  00:435C                      draw_fake_hex_sp:
     186.  00:435C  A7                  	and	a
     187.  00:435D  20 05               	jr.	nz,0f
     188.  00:435F  3E 2E               	ld	a,'.'
     189.  00:4361  12                  	ld	(de),a
     190.  00:4362  13                  	inc	de
     191.  00:4363  C9                  	ret
     192.  00:4364                      0:	
     193.  00:4364  FE 0A               	cp	10
     194.  00:4366  30 05               	jr.	nc,1f
     195.  00:4368  C6 30               	add	48
     196.  00:436A  12                  	ld	(de),a
     197.  00:436B  13                  	inc	de
     198.  00:436C  C9                  	ret
     199.  00:436D                      1:
     200.  00:436D  C6 37               	add 	55
     201.  00:436F  12                  	ld	(de),a
     202.  00:4370  13                  	inc	de	
     203.  00:4371  C9                  	ret
     204.  00:4372                      	
     205.  00:4372                      ; ==========================================================	
     206.  00:4372                      	; --- draw_fake_hex_sp_small
     207.  00:4372                      	; 
     208.  00:4372                      	; Prints the value at an address as 1 digit decimal value 
     209.  00:4372                      	; But value 0 is printed as '.'
     210.  00:4372                      	; Values can be larger than F
     211.  00:4372                      	; A = the value
     212.  00:4372                      	; DE = position (relative) to put the value in PNT
     213.  00:4372                      	; 
     214.  00:4372                      ; ==========================================================
     215.  00:4372                      draw_fake_hex_sp_small:
     216.  00:4372  A7                  	and	a
     217.  00:4373  20 05               	jr.	nz,0f
     218.  00:4375  3E 2E               	ld	a,'.'
     219.  00:4377  12                  	ld	(de),a
     220.  00:4378  13                  	inc	de
     221.  00:4379  C9                  	ret
     222.  00:437A                      0:	
     223.  00:437A  12                  	ld	(de),a
     224.  00:437B  13                  	inc	de	
     225.  00:437C  C9                  	ret
     226.  00:437D                      	
     227.  00:437D                      	
     228.  00:437D                      	
     229.  00:437D                      ; ==========================================================	
     230.  00:437D                      	; --- draw_hex_sp
     231.  00:437D                      	; 
     232.  00:437D                      	; Prints the value at an address as 1 digit decimal value 
     233.  00:437D                      	; But value 0 is printed as '.'
     234.  00:437D                      	; A = the value
     235.  00:437D                      	; DE = position (relative) to put the value in PNT
     236.  00:437D                      	; 
     237.  00:437D                      ; ==========================================================
     238.  00:437D                      ;draw_hex_sp:
     239.  00:437D                      ;	and	a
     240.  00:437D                      ;	jr.	nz,draw_hex
     241.  00:437D                      ;	ld	a,"."
     242.  00:437D                      ;	ld	(de),a
     243.  00:437D                      ;	inc	de
     244.  00:437D                      ;	ret
     245.  00:437D                      
     246.  00:437D                      ; ==========================================================	
     247.  00:437D                      	; --- draw_hex_sp_small
     248.  00:437D                      	; 
     249.  00:437D                      	; Prints the value at an address as 1 digit decimal value 
     250.  00:437D                      	; But value 0 is printed as '.'
     251.  00:437D                      	; A = the value
     252.  00:437D                      	; DE = position (relative) to put the value in PNT
     253.  00:437D                      	; 
     254.  00:437D                      ; ==========================================================
     255.  00:437D                      draw_hex_sp_small:
     256.  00:437D  A7                  	and	a
     257.  00:437E  20 10               	jr.	nz,draw_hex_small
     258.  00:4380  3E 2E               	ld	a,"."
     259.  00:4382  12                  	ld	(de),a
     260.  00:4383  13                  	inc	de
     261.  00:4384  C9                  	ret
     262.  00:4385                      
     263.  00:4385                      ; ==========================================================	
     264.  00:4385                      	; --- draw_hex2_cmd
     265.  00:4385                      	; 
     266.  00:4385                      	; Prints the value at an address as 2 digit decimal value 
     267.  00:4385                      	; A =  the value
     268.  00:4385                      	; DE = position (relative) to put the value in PNT
     269.  00:4385                      	; 
     270.  00:4385                      	; Changes: AF
     271.  00:4385                      ; ==========================================================
     272.  00:4385                      ;draw_hex2_cmd:
     273.  00:4385                      ;	push	af
     274.  00:4385                      ;	and	0xf0
     275.  00:4385                      ;	rrca
     276.  00:4385                      ;	rrca
     277.  00:4385                      ;	rrca
     278.  00:4385                      ;	rrca	
     279.  00:4385                      ;	call	draw_hex_small
     280.  00:4385                      ;	pop	af
     281.  00:4385                      ;	call	draw_hex_small
     282.  00:4385                      ;	ret
     283.  00:4385                      
     284.  00:4385                      
     285.  00:4385                      ; ==========================================================	
     286.  00:4385                      	; --- draw_hex
     287.  00:4385                      	; 
     288.  00:4385                      	; Prints the value at an address as 1 digit decimal value 
     289.  00:4385                      	; A = the value
     290.  00:4385                      	; DE = position (relative) to put the value in PNT
     291.  00:4385                      	; 
     292.  00:4385                      ; ==========================================================
     293.  00:4385                      draw_hex:
     294.  00:4385  E6 0F               	and	0x0f
     295.  00:4387                      draw_fakehex:	
     296.  00:4387  C6 90               	add	a,0x90
     297.  00:4389  27                  	daa
     298.  00:438A  CE 40               	adc	a,0x40
     299.  00:438C  27                  	daa
     300.  00:438D  12                  	ld	(de),a
     301.  00:438E  13                  	inc	de
     302.  00:438F  C9                  	ret
     303.  00:4390                      	
     304.  00:4390                      	
     305.  00:4390                      ; ==========================================================	
     306.  00:4390                      	; --- draw_hex_small
     307.  00:4390                      	; 
     308.  00:4390                      	; Prints the value at an address as 1 digit decimal value 
     309.  00:4390                      	; A = the value
     310.  00:4390                      	; DE = position (relative) to put the value in PNT
     311.  00:4390                      	; 
     312.  00:4390                      ; ==========================================================
     313.  00:4390                      draw_hex_small:
     314.  00:4390  E6 0F               	and	0x0f
     315.  00:4392  12                  	ld	(de),a
     316.  00:4393  13                  	inc	de
     317.  00:4394  C9                  	ret	
     318.  00:4395                      	
     319.  00:4395                      	
     320.  00:4395                      ; ==========================================================	
     321.  00:4395                      	; --- draw_hex2
     322.  00:4395                      	; 
     323.  00:4395                      	; Prints the value at an address as 2 digit decimal value 
     324.  00:4395                      	; A =  the value
     325.  00:4395                      	; DE = position (relative) to put the value in PNT
     326.  00:4395                      	; 
     327.  00:4395                      	; Changes: AF
     328.  00:4395                      ; ==========================================================
     329.  00:4395                      draw_hex2:
     330.  00:4395  F5                  	push	af
     331.  00:4396  E6 F0               	and	0xf0
     332.  00:4398  0F                  	rrca
     333.  00:4399  0F                  	rrca
     334.  00:439A  0F                  	rrca
     335.  00:439B  0F                  	rrca	
     336.  00:439C  CD 85 43            	call	draw_hex
     337.  00:439F  F1                  	pop	af
     338.  00:43A0  CD 85 43            	call	draw_hex
     339.  00:43A3  C9                  	ret
     340.  00:43A4                      	
     341.  00:43A4                      	
     342.  00:43A4                      	
     343.  00:43A4                      	
     344.  00:43A4                      
     345.  00:43A4                      ; ==========================================================	
     346.  00:43A4                      ; --- conv_decimal
     347.  00:43A4                      ; 
     348.  00:43A4                      ; converts the value at HL into a 2 digit decimal at DE 
     349.  00:43A4                      ; HL = position of the value
     350.  00:43A4                      ; DE = postion  to put the 2 digit value value 
     351.  00:43A4                      ; 
     352.  00:43A4                      ; ==========================================================	
     353.  00:43A4                      
     354.  00:43A4                      conv_decimal:
     355.  00:43A4                      
     356.  00:43A4  7E                  	ld	a,(hl)
     357.  00:43A5                      draw_decimal:
     358.  00:43A5  EB                  	ex	de,hl
     359.  00:43A6                      ;	ld	hl,_dd_tmpstring
     360.  00:43A6                      	
     361.  00:43A6  06 F6               1:	ld	b,-10
     362.  00:43A8  CD B2 43            	call	_dd_Num1
     363.  00:43AB  06 FF               	ld	b,-1
     364.  00:43AD  CD B2 43            	call	_dd_Num1
     365.  00:43B0                      
     366.  00:43B0  EB                  	ex	de,hl
     367.  00:43B1                      ;	ld	hl,_dd_tmpstring
     368.  00:43B1                      
     369.  00:43B1  C9                  	ret	
     370.  00:43B2                      _dd_Num1:	
     371.  00:43B2  0E 2F               	ld	c,"0"-1
     372.  00:43B4                      _dd_Num2:	
     373.  00:43B4  0C                  	inc	c
     374.  00:43B5  80                  	add	a,b
     375.  00:43B6  38 FC               	jr	c,_dd_Num2
     376.  00:43B8  98                  	sbc	a,b
     377.  00:43B9  71                  	ld	(hl),c
     378.  00:43BA  23                  	inc	hl
     379.  00:43BB  C9                  	ret 
     380.  00:43BC                      
     381.  00:43BC                      draw_decimal3:
     382.  00:43BC  EB                  	ex	de,hl
     383.  00:43BD  06 9C               	ld	b,-100
     384.  00:43BF  CD B2 43            	call	_dd_Num1
     385.  00:43C2  18 E2               	jr.	1b
     386.  00:43C4                      	
     387.  00:43C4                      	
     388.  00:43C4                      ;_dd_tmpstring:		
     389.  00:43C4                      ;	db	"XX",0		; temporary + delimiter
     390.  00:43C4                      
     391.  00:43C4                      ; ==========================================================	
     392.  00:43C4                      	; --- draw_box
     393.  00:43C4                      	; 
     394.  00:43C4                      	; Draw box 
     395.  00:43C4                      	; HL = position in PNT (relative)
     396.  00:43C4                      	; D = width
     397.  00:43C4                      	; E = height
     398.  00:43C4                      ; ==========================================================
     399.  00:43C4                      draw_box:
     400.  00:43C4  F3                  	di
     401.  00:43C5                      
     402.  00:43C5  01 00 20            	ld 	bc,_PNT
     403.  00:43C8  09                  	add	hl,bc
     404.  00:43C9  CD B2 45            	call	set_vdpwrite		
     405.  00:43CC                      	
     406.  00:43CC  3E 82               	ld	a,_UPLEFT		; upperleft corner
     407.  00:43CE                      
     408.  00:43CE                      draw_box_loop1:
     409.  00:43CE  42                  	ld	b,d	
     410.  00:43CF                      draw_box_loop0:
     411.  00:43CF                      
     412.  00:43CF                      	; change on last pos
     413.  00:43CF  05                  	dec	b
     414.  00:43D0  20 10               	jr.	nz,1f
     415.  00:43D2  FE 81               	cp	_HORIZONTAL
     416.  00:43D4  20 04               	jr.	nz,0f
     417.  00:43D6  3E 83               	ld	a,_UPRIGHT
     418.  00:43D8  18 08               	jr.	1f
     419.  00:43DA                      0:
     420.  00:43DA  FE 20               	cp	32
     421.  00:43DC  20 04               	jr.	nz,1f
     422.  00:43DE  3E 80               	ld	a,_VERTICAL
     423.  00:43E0  18 00               	jr.	1f
     424.  00:43E2                      	
     425.  00:43E2                      1:
     426.  00:43E2  04                  	inc	b	
     427.  00:43E3                      
     428.  00:43E3                      
     429.  00:43E3                      
     430.  00:43E3  D3 98               	out	(0x98),a
     431.  00:43E5                      	
     432.  00:43E5                      	; changed on pos > 1
     433.  00:43E5  FE 82               	cp	_UPLEFT		; if is upleftcorner thern	
     434.  00:43E7  20 04               	jr.	nz,0f
     435.  00:43E9  3E 81               	ld	a,_HORIZONTAL
     436.  00:43EB  18 08               	jr.	1f
     437.  00:43ED                      0:	
     438.  00:43ED  FE 80               	cp	_VERTICAL	; if is vertical line then space
     439.  00:43EF  20 04               	jr.	nz,0f
     440.  00:43F1  3E 20               	ld	a,32			; space	
     441.  00:43F3  18 00               	jr.	1f
     442.  00:43F5                      0:
     443.  00:43F5                      1:
     444.  00:43F5                      
     445.  00:43F5  10 D8               	djnz	draw_box_loop0
     446.  00:43F7                      
     447.  00:43F7                      
     448.  00:43F7                      	;loop lines
     449.  00:43F7  1D                  	dec	e
     450.  00:43F8  28 0E               	jr.	z,draw_box_end
     451.  00:43FA                      	
     452.  00:43FA  01 50 00            	ld	bc,80
     453.  00:43FD  09                  	add	hl,bc
     454.  00:43FE  01 00 20            	ld 	bc,_PNT
     455.  00:4401  CD B2 45            	call	set_vdpwrite
     456.  00:4404  3E 80               	ld	a,_VERTICAL			
     457.  00:4406  18 C6               	jr.	draw_box_loop1
     458.  00:4408                      
     459.  00:4408                      
     460.  00:4408                      draw_box_end:
     461.  00:4408  FB                  	ei
     462.  00:4409  C9                  	ret
     463.  00:440A                      
     464.  00:440A                      
     465.  00:440A                      
     466.  00:440A                      
     467.  00:440A                      ; ==========================================================	
     468.  00:440A                      	; --- draw_colorbox
     469.  00:440A                      	; 
     470.  00:440A                      	; Draw box 
     471.  00:440A                      	; H = x pos
     472.  00:440A                      	; L = y pos
     473.  00:440A                      	; D = width
     474.  00:440A                      	; E = height
     475.  00:440A                      ; ==========================================================
     476.  00:440A                      draw_colorbox:
     477.  00:440A                      	; --- get maskleft
     478.  00:440A  7C                  	ld	a,h
     479.  00:440B  E6 07               	and	0x07
     480.  00:440D  A7                  	and	a
     481.  00:440E  20 04               	jr.	nz,0f
     482.  00:4410  3E FF               	ld	a,255
     483.  00:4412  18 07               	jr.	1f
     484.  00:4414                      0:	
     485.  00:4414  47                  	ld	b,a
     486.  00:4415  3E FF               	ld	a,255
     487.  00:4417                      	
     488.  00:4417                      _dc_maskleft_loop:
     489.  00:4417  CB 3F               		srl	a
     490.  00:4419  10 FC               		djnz	_dc_maskleft_loop
     491.  00:441B  32 00 00            1:	ld	(cb_maskleft),a
     492.  00:441E                      
     493.  00:441E                      	; --- get maskright (7-(x+(w-1)) & 0x07)	
     494.  00:441E  7A                  	ld	a,d
     495.  00:441F  3D                  	dec	a
     496.  00:4420  84                  	add	h
     497.  00:4421  E6 07               	and	0x07
     498.  00:4423  FE 07               	cp	7
     499.  00:4425  20 04               	jr.	nz,0f
     500.  00:4427  3E 00               	ld	a,0
     501.  00:4429  18 0B               	jr.	1f
     502.  00:442B  47                  0:	ld	b,a
     503.  00:442C  3E 07               	ld	a,7
     504.  00:442E  90                  	sub	b
     505.  00:442F                      
     506.  00:442F                      
     507.  00:442F  47                  	ld	b,a
     508.  00:4430  3E FF               	ld	a,255	
     509.  00:4432                      	
     510.  00:4432                      _dc_maskright_loop:
     511.  00:4432  CB 27               		sla	a
     512.  00:4434  10 FC               		djnz	_dc_maskright_loop
     513.  00:4436  32 01 00            1:	ld	(cb_maskright),a
     514.  00:4439                      	
     515.  00:4439                      	; --- calculate the full cnt bytes to copy
     516.  00:4439  7C                  	ld	a,h
     517.  00:443A  E6 F8               	and	0xf8
     518.  00:443C  47                  	ld	b,a		; store in b the full bytes
     519.  00:443D  7C                  	ld	a,h
     520.  00:443E  82                  	add	d
     521.  00:443F  E6 F8               	and	0xf8
     522.  00:4441  90                  	sub	b
     523.  00:4442  CB 3F CB 3F CB 3F   [3]	srl	a		; divide by 8
     524.  00:4448  3D                  	dec	a		; 255 is begin and end in same byte
     525.  00:4449                      				; 0 is no full bytes to copy
     526.  00:4449                      				; >0 full bytes to copy inbetween masks
     527.  00:4449  32 02 00            	ld	(cb_fullbytes),a	
     528.  00:444C                      
     529.  00:444C                      	; --- Calculate start address
     530.  00:444C  4C                  	ld	c,h		; x in c
     531.  00:444D  45                  	ld	b,l		; y in b
     532.  00:444E  21 00 2A            	ld	hl,_CNT
     533.  00:4451  78                  	ld	a,b
     534.  00:4452  A7                  	and	a
     535.  00:4453  28 09               	jr.	z,0f
     536.  00:4455                      
     537.  00:4455                      _dc_start_loop:
     538.  00:4455  7D                  	ld	a,l
     539.  00:4456  C6 0A               	add	10		; every line adds 10 bytes to the addres
     540.  00:4458  6F                  	ld	l,a
     541.  00:4459  30 01               	jr.	nc,1f
     542.  00:445B  24                  	inc	h
     543.  00:445C                      1:
     544.  00:445C  10 F7               	djnz	_dc_start_loop	
     545.  00:445E                      0:
     546.  00:445E  79                  	ld	a,c		; add the x pos.
     547.  00:445F  E6 F8               	and	0xf8
     548.  00:4461  CB 3F CB 3F CB 3F   [3]	srl	a	
     549.  00:4467  85                  	add	l
     550.  00:4468  6F                  	ld	l,a
     551.  00:4469  30 01               	jr.	nc,1f
     552.  00:446B  24                  	inc	h
     553.  00:446C                      1:
     554.  00:446C                      	; now we have start addres in the cnt in HL
     555.  00:446C  4B                  	ld	c,e	; # lines to plot
     556.  00:446D                      	
     557.  00:446D                      	; --- get way to copy
     558.  00:446D  3A 02 00            	ld	a,(cb_fullbytes)
     559.  00:4470  FE FF               	cp	255
     560.  00:4472  28 46               	jr.	z,_cp_clip_copy
     561.  00:4474                      	
     562.  00:4474                      	; --- 'normal' copy
     563.  00:4474                      _cb_copyloop_main:	
     564.  00:4474  E5                  	push	hl
     565.  00:4475  CD CF 45            	call	set_vdpread
     566.  00:4478  DB 98               	in	a,(0x98)
     567.  00:447A  47                  	ld	b,a
     568.  00:447B  3A 00 00            	ld	a,(cb_maskleft)
     569.  00:447E  B0                  	or	b
     570.  00:447F  47                  	ld	b,a
     571.  00:4480                      	
     572.  00:4480  E1                  	pop	hl
     573.  00:4481  E5                  	push	hl
     574.  00:4482  CD B2 45            	call	set_vdpwrite
     575.  00:4485                      	
     576.  00:4485  78                  	ld	a,b
     577.  00:4486  D3 98               	out	(0x98),a
     578.  00:4488  3A 02 00            	ld	a,(cb_fullbytes)
     579.  00:448B  A7                  	and	a
     580.  00:448C  47                  	ld	b,a
     581.  00:448D  E1                  	pop	hl
     582.  00:448E  E5                  	push	hl
     583.  00:448F  23                  	inc	hl
     584.  00:4490  28 0B               	jr.	z,0f
     585.  00:4492                      
     586.  00:4492  85                  	add	a,l
     587.  00:4493  6F                  	ld	l,a
     588.  00:4494  30 01               	jr.	nc,9f
     589.  00:4496  24                  	inc	h
     590.  00:4497                      9:
     591.  00:4497  3E FF               	ld	a,255
     592.  00:4499                      _cb_copyloop:
     593.  00:4499  D3 98               	out	(0x98),a
     594.  00:449B  10 FC               	djnz	_cb_copyloop
     595.  00:449D                      0:	
     596.  00:449D  54                  	ld	d,h
     597.  00:449E  5D                  	ld	e,l
     598.  00:449F  CD CF 45            	call	set_vdpread
     599.  00:44A2  DB 98               	in	a,(0x98)
     600.  00:44A4  47                  	ld	b,a
     601.  00:44A5  3A 01 00            	ld	a,(cb_maskright)
     602.  00:44A8  B0                  	or	b
     603.  00:44A9  47                  	ld	b,a
     604.  00:44AA                      	
     605.  00:44AA  EB                  	ex	de,hl	
     606.  00:44AB  CD B2 45            	call	set_vdpwrite
     607.  00:44AE  78                  	ld	a,b	
     608.  00:44AF  D3 98               	out	(0x98),a
     609.  00:44B1                      	
     610.  00:44B1  E1                  	pop 	hl
     611.  00:44B2  11 0A 00            	ld	de,10
     612.  00:44B5  19                  	add	hl,de
     613.  00:44B6                      	
     614.  00:44B6  0D                  	dec	c
     615.  00:44B7  20 BB               	jr.	nz,_cb_copyloop_main
     616.  00:44B9                      	
     617.  00:44B9  C9                  	ret
     618.  00:44BA                      	
     619.  00:44BA                      
     620.  00:44BA                      _cp_clip_copy:
     621.  00:44BA  E5                  	push	hl
     622.  00:44BB                      
     623.  00:44BB  3A 00 00            	ld	a,(cb_maskleft)
     624.  00:44BE  47                  	ld	b,a
     625.  00:44BF  3A 01 00            	ld	a,(cb_maskright)
     626.  00:44C2  A0                  	and	b
     627.  00:44C3  47                  	ld	b,a
     628.  00:44C4                      
     629.  00:44C4  CD CF 45            	call	set_vdpread
     630.  00:44C7  DB 98               	in	a,(0x98)
     631.  00:44C9                      
     632.  00:44C9  B0                  	or	b
     633.  00:44CA  47                  	ld	b,a
     634.  00:44CB                      	
     635.  00:44CB  E1                  	pop	hl
     636.  00:44CC  E5                  	push	hl
     637.  00:44CD  CD B2 45            	call	set_vdpwrite
     638.  00:44D0                      	
     639.  00:44D0  78                  	ld	a,b
     640.  00:44D1  D3 98               	out	(0x98),a	
     641.  00:44D3                      
     642.  00:44D3  E1                  	pop 	hl
     643.  00:44D4  11 0A 00            	ld	de,10
     644.  00:44D7  19                  	add	hl,de
     645.  00:44D8                      	
     646.  00:44D8  0D                  	dec	c
     647.  00:44D9  20 DF               	jr.	nz,_cp_clip_copy	
     648.  00:44DB                      	
     649.  00:44DB  C9                  	ret
     650.  00:44DC                      
     651.  00:44DC                      ; ==========================================================	
     652.  00:44DC                      	; --- erase_colorbox
     653.  00:44DC                      	; 
     654.  00:44DC                      	; Draw box 
     655.  00:44DC                      	; H = x pos
     656.  00:44DC                      	; L = y pos
     657.  00:44DC                      	; D = width
     658.  00:44DC                      	; E = height
     659.  00:44DC                      ; ==========================================================
     660.  00:44DC                      erase_colorbox:
     661.  00:44DC                      	; --- get maskleft
     662.  00:44DC  7C                  	ld	a,h
     663.  00:44DD  E6 07               	and	0x07
     664.  00:44DF  A7                  	and	a
     665.  00:44E0  20 04               	jr.	nz,0f
     666.  00:44E2  3E FF               	ld	a,255
     667.  00:44E4  18 07               	jr.	1f
     668.  00:44E6                      0:	
     669.  00:44E6  47                  	ld	b,a
     670.  00:44E7  3E FF               	ld	a,255
     671.  00:44E9                      	
     672.  00:44E9                      _ecb_maskleft_loop:
     673.  00:44E9  CB 3F               		srl	a
     674.  00:44EB  10 FC               		djnz	_ecb_maskleft_loop
     675.  00:44ED                      1:	
     676.  00:44ED  EE FF               	xor	255
     677.  00:44EF  32 00 00            	ld	(cb_maskleft),a
     678.  00:44F2                      
     679.  00:44F2                      	; --- get maskright (7-(x+(w-1)) & 0x07)	
     680.  00:44F2  7A                  	ld	a,d
     681.  00:44F3  3D                  	dec	a
     682.  00:44F4  84                  	add	h
     683.  00:44F5  E6 07               	and	0x07
     684.  00:44F7  FE 07               	cp	7
     685.  00:44F9  20 04               	jr.	nz,0f
     686.  00:44FB  3E 00               	ld	a,0
     687.  00:44FD  18 0B               	jr.	1f
     688.  00:44FF  47                  0:	ld	b,a
     689.  00:4500  3E 07               	ld	a,7
     690.  00:4502  90                  	sub	b
     691.  00:4503                      
     692.  00:4503                      
     693.  00:4503  47                  	ld	b,a
     694.  00:4504  3E FF               	ld	a,255	
     695.  00:4506                      	
     696.  00:4506                      _ecb_maskright_loop:
     697.  00:4506  CB 27               		sla	a
     698.  00:4508  10 FC               		djnz	_ecb_maskright_loop
     699.  00:450A                      1:	
     700.  00:450A  EE FF               	xor	255
     701.  00:450C  32 01 00            	ld	(cb_maskright),a
     702.  00:450F                      	
     703.  00:450F                      	; --- calculate the full cnt bytes to copy
     704.  00:450F  7C                  	ld	a,h
     705.  00:4510  E6 F8               	and	0xf8
     706.  00:4512  47                  	ld	b,a		; store in b the full bytes
     707.  00:4513  7C                  	ld	a,h
     708.  00:4514  82                  	add	d
     709.  00:4515  E6 F8               	and	0xf8
     710.  00:4517  90                  	sub	b
     711.  00:4518  CB 3F CB 3F CB 3F   [3]	srl	a		; divide by 8
     712.  00:451E  3D                  	dec	a		; 255 is begin and end in same byte
     713.  00:451F                      				; 0 is no full bytes to copy
     714.  00:451F                      				; >0 full bytes to copy inbetween masks
     715.  00:451F  32 02 00            	ld	(cb_fullbytes),a	
     716.  00:4522                      
     717.  00:4522                      	; --- Calculate start address
     718.  00:4522  4C                  	ld	c,h		; x in c
     719.  00:4523  45                  	ld	b,l		; y in b
     720.  00:4524  21 00 2A            	ld	hl,_CNT
     721.  00:4527  78                  	ld	a,b
     722.  00:4528  A7                  	and	a
     723.  00:4529  28 09               	jr.	z,0f
     724.  00:452B                      
     725.  00:452B                      _ecb_start_loop:
     726.  00:452B  7D                  	ld	a,l
     727.  00:452C  C6 0A               	add	10		; every line adds 10 bytes to the addres
     728.  00:452E  6F                  	ld	l,a
     729.  00:452F  30 01               	jr.	nc,1f
     730.  00:4531  24                  	inc	h
     731.  00:4532                      1:
     732.  00:4532  10 F7               	djnz	_ecb_start_loop	
     733.  00:4534                      0:
     734.  00:4534  79                  	ld	a,c		; add the x pos.
     735.  00:4535  E6 F8               	and	0xf8
     736.  00:4537  CB 3F CB 3F CB 3F   [3]	srl	a	
     737.  00:453D  85                  	add	l
     738.  00:453E  6F                  	ld	l,a
     739.  00:453F  30 01               	jr.	nc,1f
     740.  00:4541  24                  	inc	h
     741.  00:4542                      1:
     742.  00:4542                      	; now we have start addres in the cnt in HL
     743.  00:4542  4B                  	ld	c,e	; # lines to plot
     744.  00:4543                      	
     745.  00:4543                      	; --- get way to copy
     746.  00:4543  3A 02 00            	ld	a,(cb_fullbytes)
     747.  00:4546  FE FF               	cp	255
     748.  00:4548  28 46               	jr.	z,_ecb_clip_copy
     749.  00:454A                      	
     750.  00:454A                      	; --- 'normal' copy
     751.  00:454A                      _ecb_copyloop_main:	
     752.  00:454A  E5                  	push	hl
     753.  00:454B  CD CF 45            	call	set_vdpread
     754.  00:454E  DB 98               	in	a,(0x98)
     755.  00:4550  47                  	ld	b,a
     756.  00:4551  3A 00 00            	ld	a,(cb_maskleft)
     757.  00:4554  A0                  	and	b
     758.  00:4555  47                  	ld	b,a
     759.  00:4556                      	
     760.  00:4556  E1                  	pop	hl
     761.  00:4557  E5                  	push	hl
     762.  00:4558  CD B2 45            	call	set_vdpwrite
     763.  00:455B                      	
     764.  00:455B  78                  	ld	a,b
     765.  00:455C  D3 98               	out	(0x98),a
     766.  00:455E  3A 02 00            	ld	a,(cb_fullbytes)
     767.  00:4561  A7                  	and	a
     768.  00:4562  47                  	ld	b,a
     769.  00:4563  E1                  	pop	hl
     770.  00:4564  E5                  	push	hl
     771.  00:4565  23                  	inc	hl
     772.  00:4566  28 0B               	jr.	z,0f
     773.  00:4568                      
     774.  00:4568  85                  	add	a,l
     775.  00:4569  6F                  	ld	l,a
     776.  00:456A  30 01               	jr.	nc,9f
     777.  00:456C  24                  	inc	h
     778.  00:456D                      9:
     779.  00:456D  3E 00               	ld	a,0
     780.  00:456F                      _ecb_copyloop:
     781.  00:456F  D3 98               	out	(0x98),a
     782.  00:4571  10 FC               	djnz	_ecb_copyloop
     783.  00:4573                      0:	
     784.  00:4573  54                  	ld	d,h
     785.  00:4574  5D                  	ld	e,l
     786.  00:4575  CD CF 45            	call	set_vdpread
     787.  00:4578  DB 98               	in	a,(0x98)
     788.  00:457A  47                  	ld	b,a
     789.  00:457B  3A 01 00            	ld	a,(cb_maskright)
     790.  00:457E  A0                  	and	b
     791.  00:457F  47                  	ld	b,a
     792.  00:4580                      	
     793.  00:4580  EB                  	ex	de,hl	
     794.  00:4581  CD B2 45            	call	set_vdpwrite
     795.  00:4584  78                  	ld	a,b	
     796.  00:4585  D3 98               	out	(0x98),a
     797.  00:4587                      	
     798.  00:4587  E1                  	pop 	hl
     799.  00:4588  11 0A 00            	ld	de,10
     800.  00:458B  19                  	add	hl,de
     801.  00:458C                      	
     802.  00:458C  0D                  	dec	c
     803.  00:458D  20 BB               	jr.	nz,_ecb_copyloop_main
     804.  00:458F                      	
     805.  00:458F  C9                  	ret
     806.  00:4590                      	
     807.  00:4590                      
     808.  00:4590                      _ecb_clip_copy:
     809.  00:4590  E5                  	push	hl
     810.  00:4591                      
     811.  00:4591  3A 00 00            	ld	a,(cb_maskleft)
     812.  00:4594  47                  	ld	b,a
     813.  00:4595  3A 01 00            	ld	a,(cb_maskright)
     814.  00:4598  B0                  	or	b
     815.  00:4599  47                  	ld	b,a
     816.  00:459A                      
     817.  00:459A  CD CF 45            	call	set_vdpread
     818.  00:459D  DB 98               	in	a,(0x98)
     819.  00:459F                      
     820.  00:459F  A0                  	and	b
     821.  00:45A0  47                  	ld	b,a
     822.  00:45A1                      	
     823.  00:45A1  E1                  	pop	hl
     824.  00:45A2  E5                  	push	hl
     825.  00:45A3  CD B2 45            	call	set_vdpwrite
     826.  00:45A6                      	
     827.  00:45A6  78                  	ld	a,b
     828.  00:45A7  D3 98               	out	(0x98),a	
     829.  00:45A9                      
     830.  00:45A9  E1                  	pop 	hl
     831.  00:45AA  11 0A 00            	ld	de,10
     832.  00:45AD  19                  	add	hl,de
     833.  00:45AE                      	
     834.  00:45AE  0D                  	dec	c
     835.  00:45AF  20 DF               	jr.	nz,_ecb_clip_copy	
     836.  00:45B1                      	
     837.  00:45B1  C9                  	ret
     838.  00:45B2                      
     839.  00:45B2                      	; --- set_vdpwrite
     840.  00:45B2                      	; sets up the vdp address in HL to write to
     841.  00:45B2                      	; enables ISR and changes a
     842.  00:45B2                      
     843.  00:45B2                      set_vdpwrite:
     844.  00:45B2  AF                  	xor	a
     845.  00:45B3  CB 04               	rlc	h
     846.  00:45B5  17                  	rla
     847.  00:45B6  CB 04               	rlc	h
     848.  00:45B8  17                  	rla
     849.  00:45B9  CB 3C               	srl	h
     850.  00:45BB  CB 3C               	srl	h
     851.  00:45BD  F3                  	di
     852.  00:45BE  D3 99               	out	(#99),a
     853.  00:45C0  3E 8E               	ld	a,14+128
     854.  00:45C2  D3 99               	out	(#99),a
     855.  00:45C4  7D                  	ld	a,l
     856.  00:45C5  00                  	nop
     857.  00:45C6  D3 99               	out	(#99),a
     858.  00:45C8  7C                  	ld	a,h
     859.  00:45C9  F6 40               	or	64
     860.  00:45CB  FB                  	ei
     861.  00:45CC  D3 99               	out	(#99),a
     862.  00:45CE  C9                  	ret
     863.  00:45CF                      
     864.  00:45CF                      
     865.  00:45CF                      	; --- set_vdpwrite
     866.  00:45CF                      	; sets up the vdp address in HL to write to
     867.  00:45CF                      	; enables ISR and changes a
     868.  00:45CF                      
     869.  00:45CF                      set_vdpread:
     870.  00:45CF  AF                  	xor	a
     871.  00:45D0  CB 04               	rlc	h
     872.  00:45D2  17                  	rla
     873.  00:45D3  CB 04               	rlc	h
     874.  00:45D5  17                  	rla
     875.  00:45D6  CB 3C               	srl	h
     876.  00:45D8  CB 3C               	srl	h
     877.  00:45DA  F3                  	di
     878.  00:45DB  D3 99               	out	(#99),a
     879.  00:45DD  3E 8E               	ld	a,14+128
     880.  00:45DF  D3 99               	out	(#99),a
     881.  00:45E1  7D                  	ld	a,l
     882.  00:45E2  00                  	nop
     883.  00:45E3  D3 99               	out	(#99),a
     884.  00:45E5  7C                  	ld	a,h
     885.  00:45E6  D3 99               	out	(#99),a
     886.  00:45E8  FB                  	ei
     887.  00:45E9  C9                  	ret
     888.  00:45EA                      
     889.  00:45EA                      
     890.  00:45EA                      ; --- Colorbox function variables
     891.  00:45EA  (00:0000)           cb_maskleft:	#1
     892.  00:45EA  (00:0001)           cb_maskright:	#1
     893.  00:45EA  (00:0002)           cb_fullbytes:	#1
     894.  00:45EA  (00:0003)           cb_status:		#1
     895.  00:45EA                      
     896.  00:45EA                      
     897.  00:45EA                      	; --- init_font
     898.  00:45EA                      	;
     899.  00:45EA                      	; Init the font in the PGT.
     900.  00:45EA                      
     901.  00:45EA                      init_font:
     902.  00:45EA                      
     903.  00:45EA  F3                  	di
     904.  00:45EB                      	; relocate the PGT (old is at 0x1000)
     905.  00:45EB                      	; new is at 0x9000
     906.  00:45EB                      ;	ld	a,00010010b
     907.  00:45EB                      ;	out	(0x99),a
     908.  00:45EB                      ;	ld	a,128+4	
     909.  00:45EB                      ;	out	(0x99),a
     910.  00:45EB                      
     911.  00:45EB  21 00 90            	ld	hl,0x9000
     912.  00:45EE  CD B2 45            	call	set_vdpwrite
     913.  00:45F1                      	
     914.  00:45F1  F3                  	di
     915.  00:45F2  3E 08               	ld a,8		; loop 8 times
     916.  00:45F4  0E 98               	ld c,0x98
     917.  00:45F6                      
     918.  00:45F6  21 E0 5B            	ld hl,font_data
     919.  00:45F9                      
     920.  00:45F9                      _fontloop:
     921.  00:45F9  06 FF               		ld b,255		; subloop 255 times
     922.  00:45FB  ED B3               		otir
     923.  00:45FD  3D                  	dec a
     924.  00:45FE  20 F9               	jr. nz,_fontloop
     925.  00:4600                      	
     926.  00:4600  FB                  	ei
     927.  00:4601  C9                  	ret
     559   00:4602                      	include	"..\code\ttreplaySMS.asm"
       1.  00:4602                      ;=================================
       2.  00:4602                      ; TriloTracker Re-player SMS
       3.  00:4602                      ; 
       4.  00:4602                      ; Functions:
       5.  00:4602                      ; 	replay_init
       6.  00:4602                      ;	replay_pause
       7.  00:4602                      ;	replay_fade_out
       8.  00:4602                      ;================================
       9.  00:4602  (00:007C)           FM_WRITE:	equ	0x7c	; port to set fm reg nr.
      10.  00:4602  (00:007D)           FM_DATA:	equ	0x7d	; port to set fm data for reg	
      11.  00:4602                      ;===============================
      12.  00:4602  (00:0060)           _REL:		equ	96	; = release
      13.  00:4602  (00:0061)           _SUS:		equ	97	; = sustain
      14.  00:4602  (00:0062)           _VOL:		equ	98	; = volume 1
      15.  00:4602  (00:0071)           _INS:		equ	113	; = instrument 1
      16.  00:4602  (00:0090)           _CMD:		equ	144	; = effect 0
      17.  00:4602  (00:00B8)           _SPC:		equ	184	; = special commands
      18.  00:4602  (00:00BF)           _EOT:		equ	191	; = end of track
      19.  00:4602  (00:00C0)           _WAIT:	equ	192	; = wait 1
      20.  00:4602                      
      21.  00:4602                      	
      22.  00:4602                      ;===========================================================
      23.  00:4602                      ; ---	replay_init
      24.  00:4602                      ; Initialize re-player data
      25.  00:4602                      ; Only call this on start-up
      26.  00:4602                      ; Input: none
      27.  00:4602                      ;===========================================================
      28.  00:4602                      replay_init:
      29.  00:4602  3E 07               	ld	a,7
      30.  00:4604  CD 57 46            	call	replay_set_FM_balance
      31.  00:4607  3E 07               	ld	a,7
      32.  00:4609  CD 5E 46            	call	replay_set_PSG_balance
      33.  00:460C                      
      34.  00:460C  AF                  	xor	a
      35.  00:460D  32 22 C0            	ld	(replay_mode),a	
      36.  00:4610  32 30 C0            	ld	(equalization_cnt),a
      37.  00:4613  32 31 C0            	ld	(equalization_flag),a	
      38.  00:4616  32 2F C0            	ld	(equalization_freq),a
      39.  00:4619  3C                  	inc	a
      40.  00:461A  32 23 C0            	ld	(replay_chan_setup),a	
      41.  00:461D                      	
      42.  00:461D  C9                  	ret
      43.  00:461E                      
      44.  00:461E                      ;===========================================================
      45.  00:461E                      ; ---	replay_pause
      46.  00:461E                      ; Stop/Restart music playback
      47.  00:461E                      ; 
      48.  00:461E                      ; Input: none
      49.  00:461E                      ;===========================================================
      50.  00:461E                      replay_pause:
      51.  00:461E  3A 22 C0            	ld	a,(replay_mode)
      52.  00:4621  A7                  	and	a
      53.  00:4622  CA 2B 46            	jp	z,_r_pause_disable
      54.  00:4625                      _r_pause_enable:
      55.  00:4625                      	;-- re-enable music decoding and processing
      56.  00:4625  3E 01               	ld	a,1
      57.  00:4627  32 22 C0            	ld	(replay_mode),a
      58.  00:462A  C9                  	ret
      59.  00:462B                      	
      60.  00:462B                      _r_pause_disable:
      61.  00:462B                      	;-- stop decoding and processing music data
      62.  00:462B  AF                  	xor	a
      63.  00:462C  32 22 C0            	ld	(replay_mode),a	
      64.  00:462F  32 AE C1            	ld	(FM_DRUM),a
      65.  00:4632                      	;--- Silence the SN7 PSG
      66.  00:4632  32 72 C1            	ld	(PSG_regVOLA),a
      67.  00:4635  32 73 C1            	ld	(PSG_regVOLB),a
      68.  00:4638  32 74 C1            	ld	(PSG_regVOLC),a
      69.  00:463B  32 75 C1            	ld	(PSG_regVOLN),a
      70.  00:463E                      	; release key on all FM channels
      71.  00:463E  06 09               	ld	b,9
      72.  00:4640  21 79 C1            	ld	hl,FM_Registers+1
      73.  00:4643  11 06 00            	ld	de,6
      74.  00:4646  AF                  	xor	a
      75.  00:4647                      _r_pause_loop:
      76.  00:4647  77                  	ld	(hl),a
      77.  00:4648  19                  	add	hl,de
      78.  00:4649  10 FC               	djnz	_r_pause_loop
      79.  00:464B  C9                  	ret	
      80.  00:464C                      	
      81.  00:464C                      
      82.  00:464C                      ;===========================================================
      83.  00:464C                      ; ---	replay_fade_out
      84.  00:464C                      ; Fade out the music. 
      85.  00:464C                      ; Once the sound is silence the replayer is paused.
      86.  00:464C                      ;
      87.  00:464C                      ; in: [A] fade speed (1 - 255)
      88.  00:464C                      ;===========================================================	
      89.  00:464C                      replay_fade_out:
      90.  00:464C  32 25 C0            	ld	(replay_fade),a
      91.  00:464F  32 26 C0            	ld	(replay_fade_timer),a
      92.  00:4652  AF                  	xor	a
      93.  00:4653  32 27 C0            	ld	(replay_fade_vol),a
      94.  00:4656  C9                  	ret
      95.  00:4657                      
      96.  00:4657                      
      97.  00:4657                      	
      98.  00:4657                      ;===========================================================
      99.  00:4657                      ; ---	replay_set_FM_balance
     100.  00:4657                      ; Set the main volume for the SCC chip. This enables for
     101.  00:4657                      ; setting the balance between SCC en PSG as some MSX models 
     102.  00:4657                      ; default balance differs. 
     103.  00:4657                      ;
     104.  00:4657                      ; in: [A] master volume (0-7) 0=halve volume, 7=full volume. 
     105.  00:4657                      ;===========================================================	
     106.  00:4657                      replay_set_FM_balance:
     107.  00:4657  CD 65 46            	call	_getnewbalancebase
     108.  00:465A  22 05 C0            	ld	(replay_mainSCCvol),hl	
     109.  00:465D  C9                  	ret
     110.  00:465E                      	
     111.  00:465E                      ;===========================================================
     112.  00:465E                      ; ---	replay_set_PSG_balance
     113.  00:465E                      ; Set the main volume for the PSG chip. This enables for
     114.  00:465E                      ; setting the balance between SCC en PSG as some MSX models 
     115.  00:465E                      ; default balance differs. 
     116.  00:465E                      ;
     117.  00:465E                      ; in: [A] master volume (0-7) 0=halve volume, 7=full volume. 
     118.  00:465E                      ;===========================================================	
     119.  00:465E                      replay_set_PSG_balance:
     120.  00:465E  CD 65 46            	call	_getnewbalancebase
     121.  00:4661  22 03 C0            	ld	(replay_mainPSGvol),hl	
     122.  00:4664  C9                  	ret
     123.  00:4665                      	
     124.  00:4665                      _getnewbalancebase:
     125.  00:4665  07                  	rlca
     126.  00:4666  07                  	rlca
     127.  00:4667  07                  	rlca
     128.  00:4668  07                  	rlca
     129.  00:4669  21 A5 51            	ld	hl,_VOLUME_TABLE-128
     130.  00:466C  E6 F0               	and	$f0
     131.  00:466E  85                  	add	a,l
     132.  00:466F  6F                  	ld	l,a
     133.  00:4670  D0                  	ret nc
     134.  00:4671  24                  	inc	h
     135.  00:4672  C9                  	ret
     136.  00:4673                      	
     137.  00:4673                      	
     138.  00:4673                      	
     139.  00:4673                      ;===========================================================
     140.  00:4673                      ; ---	replay_loadsong
     141.  00:4673                      ; Initialize a song for playback
     142.  00:4673                      ; 
     143.  00:4673                      ; Input [HL] points to start song
     144.  00:4673                      ;===========================================================
     145.  00:4673                      replay_loadsong:
     146.  00:4673                      	;--- Get the start speed.
     147.  00:4673  7E                  	ld	a,(hl)	
     148.  00:4674  23                  	inc	hl
     149.  00:4675  32 1F C0            	ld	(replay_speed),a
     150.  00:4678                      
     151.  00:4678                      	;--- Set voice base, drum base, instrument base and track pointers
     152.  00:4678  11 07 C0            	ld 	de,replay_voicebase
     153.  00:467B  01 16 00            	ld	bc,22
     154.  00:467E  ED B0               	ldir
     155.  00:4680  22 1D C0            	ld	(replay_orderpointer),hl		; store pointer for next set
     156.  00:4683                      										; of track pointers
     157.  00:4683                      	;--- Initialize re-player variables.
     158.  00:4683  AF                  	xor	a
     159.  00:4684  32 20 C0            	ld	(replay_speed_subtimer),a
     160.  00:4687                      	
     161.  00:4687                      	;--- Erase channel data	in RAM
     162.  00:4687  01 37 01            	ld	bc,TRACK_REC_SIZE*8-1
     163.  00:468A  21 32 C0            	ld	hl,TRACK_Chan1
     164.  00:468D  11 33 C0            	ld	de,TRACK_Chan1+1
     165.  00:4690  77                  	ld	(hl),a
     166.  00:4691  ED B0               	ldir
     167.  00:4693                      	
     168.  00:4693  32 24 C0            	ld	(replay_arp_speed),a
     169.  00:4696  32 B9 C1            	ld	(FM_DRUM_LEN),a
     170.  00:4699  32 AE C1            	ld	(FM_DRUM),a	
     171.  00:469C                      	
     172.  00:469C  32 72 C1            	ld	(PSG_regVOLA),a
     173.  00:469F  32 73 C1            	ld	(PSG_regVOLB),a	
     174.  00:46A2  32 74 C1            	ld	(PSG_regVOLC),a
     175.  00:46A5  32 70 C1            	ld	(PSG_regNOISE),a
     176.  00:46A8                      
     177.  00:46A8                      ;	;--- Set the tone table base
     178.  00:46A8                      ;	ld	hl,TRACK_ToneTable_PSG
     179.  00:46A8                      ;	ld	(replay_tonetable_PSG),hl
     180.  00:46A8                      ;	ld	hl,TRACK_ToneTable_FM
     181.  00:46A8                      ;	ld	(replay_tonetable_FM),hl
     182.  00:46A8                      
     183.  00:46A8  3E 01               	ld	a,1
     184.  00:46AA  32 21 C0            	ld	(replay_speed_timer),a
     185.  00:46AD  32 56 C0            	ld	(TRACK_Chan1+17+TRACK_Delay),a	
     186.  00:46B0  32 7D C0            	ld	(TRACK_Chan2+17+TRACK_Delay),a		
     187.  00:46B3  32 A4 C0            	ld	(TRACK_Chan3+17+TRACK_Delay),a	
     188.  00:46B6  32 CB C0            	ld	(TRACK_Chan4+17+TRACK_Delay),a	
     189.  00:46B9  32 F2 C0            	ld	(TRACK_Chan5+17+TRACK_Delay),a		
     190.  00:46BC  32 19 C1            	ld	(TRACK_Chan6+17+TRACK_Delay),a		
     191.  00:46BF  32 40 C1            	ld	(TRACK_Chan7+17+TRACK_Delay),a		
     192.  00:46C2  32 67 C1            	ld	(TRACK_Chan8+17+TRACK_Delay),a	
     193.  00:46C5                      	
     194.  00:46C5  3E FE               	ld	a,254
     195.  00:46C7  32 32 C0            	ld	(TRACK_Chan1+17+TRACK_Instrument),a	
     196.  00:46CA  32 59 C0            	ld	(TRACK_Chan2+17+TRACK_Instrument),a		
     197.  00:46CD  32 80 C0            	ld	(TRACK_Chan3+17+TRACK_Instrument),a	
     198.  00:46D0  32 A7 C0            	ld	(TRACK_Chan4+17+TRACK_Instrument),a	
     199.  00:46D3  32 CE C0            	ld	(TRACK_Chan5+17+TRACK_Instrument),a		
     200.  00:46D6  32 F5 C0            	ld	(TRACK_Chan6+17+TRACK_Instrument),a		
     201.  00:46D9  32 1C C1            	ld	(TRACK_Chan7+17+TRACK_Instrument),a		
     202.  00:46DC  32 43 C1            	ld	(TRACK_Chan8+17+TRACK_Instrument),a	
     203.  00:46DF  32 BC C1            	ld	(FM_softvoice_req),a	
     204.  00:46E2  32 BD C1            	ld	(FM_softvoice_set),a
     205.  00:46E5                      
     206.  00:46E5  3E 10               	ld	a,16
     207.  00:46E7  32 89 C0            	ld	(TRACK_Chan3+17+TRACK_Voice),a
     208.  00:46EA  32 B0 C0            	ld	(TRACK_Chan4+17+TRACK_Voice),a
     209.  00:46ED  32 D7 C0            	ld	(TRACK_Chan5+17+TRACK_Voice),a
     210.  00:46F0  32 FE C0            	ld	(TRACK_Chan6+17+TRACK_Voice),a	
     211.  00:46F3  32 25 C1            	ld	(TRACK_Chan7+17+TRACK_Voice),a	
     212.  00:46F6  32 4C C1            	ld	(TRACK_Chan8+17+TRACK_Voice),a
     213.  00:46F9  3E 80               	ld	a,128
     214.  00:46FB  32 8A C0            	ld	(TRACK_Chan3+17+TRACK_Flags),a
     215.  00:46FE  32 B1 C0            	ld	(TRACK_Chan4+17+TRACK_Flags),a
     216.  00:4701  32 D8 C0            	ld	(TRACK_Chan5+17+TRACK_Flags),a
     217.  00:4704  32 FF C0            	ld	(TRACK_Chan6+17+TRACK_Flags),a	
     218.  00:4707  32 26 C1            	ld	(TRACK_Chan7+17+TRACK_Flags),a
     219.  00:470A  32 4D C1            	ld	(TRACK_Chan8+17+TRACK_Flags),a	
     220.  00:470D                      	
     221.  00:470D                      	;--- Check if there are 3 psg chans.
     222.  00:470D  3A 23 C0            	ld	a,(replay_chan_setup)
     223.  00:4710  A7                  	and	a
     224.  00:4711  CA 18 47            	jp	z,99f
     225.  00:4714  AF                  	xor 	a
     226.  00:4715  32 8A C0            	ld	(TRACK_Chan3+17+TRACK_Flags),a	
     227.  00:4718                      99:	
     228.  00:4718                      
     229.  00:4718  CD 55 50            	call	replay_route
     230.  00:471B                      	
     231.  00:471B                      	; end	is here
     232.  00:471B  3E 01               	ld	a,1
     233.  00:471D  32 22 C0            	ld	(replay_mode),a	
     234.  00:4720  C9                  	ret
     235.  00:4721                      
     236.  00:4721                      ;===========================================================
     237.  00:4721                      ; ---	replay_play
     238.  00:4721                      ; Decode music data and process instruments and effects. 
     239.  00:4721                      ; Music chip registers will be prepared for replay_route 
     240.  00:4721                      ;
     241.  00:4721                      ; Input none
     242.  00:4721                      ;===========================================================	
     243.  00:4721                      replay_play:
     244.  00:4721  3A 22 C0            	ld	a,(replay_mode)
     245.  00:4724  A7                  	and	a
     246.  00:4725  C8                  	ret	z		; replay mode = 0	; halted
     247.  00:4726                      				; replay mode = 1	; active
     248.  00:4726                      	
     249.  00:4726                      	;---- SPEED EQUALIZATION 
     250.  00:4726  3A 2F C0            	ld	a,(equalization_freq)		; 0 = 50Hz, otherwise 60Hz
     251.  00:4729  A7                  	and	a
     252.  00:472A  28 14               	jr.	z,.PAL               		; if PAL process at any interrupt;
     253.  00:472C                      
     254.  00:472C                      .NTSC:
     255.  00:472C  21 30 C0            	ld	hl,equalization_cnt  		; if NTSC call 5 times out of 6
     256.  00:472F  35                  	dec	(hl)
     257.  00:4730  20 0E               	jr.	nz,.PAL               		; skip music data processing one tic out of 6
     258.  00:4732                      
     259.  00:4732                      	;--- Reset timer and raise equalization flag
     260.  00:4732  3E 06               	ld	a,6
     261.  00:4734  77                  	ld	(hl),a						
     262.  00:4735  32 31 C0             	ld	(equalization_flag),a		
     263.  00:4738                      
     264.  00:4738  CD 6B 48            	call	process_data	
     265.  00:473B  AF                  	xor	a
     266.  00:473C  32 31 C0            	ld	(equalization_flag),a
     267.  00:473F  C9                  	ret
     268.  00:4740                      .PAL:                             
     269.  00:4740                      	;---- END SPEED EQUALIZATION	
     270.  00:4740                      
     271.  00:4740                      		
     272.  00:4740                      	;--- The speed timer
     273.  00:4740  21 21 C0            	ld	hl,replay_speed_timer
     274.  00:4743  35                  	dec	(hl)
     275.  00:4744                      
     276.  00:4744  C2 EB 49            	jp	nz,_replay_check_patternend	
     277.  00:4747                      		
     278.  00:4747                      	;--- Re-init Timer == 0
     279.  00:4747  AF                  	xor	a
     280.  00:4748  ED 4B 1F C0         	ld	bc,(replay_speed)		; [b]	sub-timer [c] speed
     281.  00:474C  CB 39               	srl	c				; bit	0 is halve speed step
     282.  00:474E  8F                  	adc	a,a
     283.  00:474F  A8                  	xor	b				; alternate	speed	to have halve speed.
     284.  00:4750  32 20 C0            	ld	(replay_speed_subtimer),a
     285.  00:4753  81                  	add	c
     286.  00:4754  32 21 C0            	ld	(replay_speed_timer),a
     287.  00:4757                      		
     288.  00:4757                      ;===========================================================
     289.  00:4757                      ; ---	replay_decodedata
     290.  00:4757                      ; Process the pattern data 
     291.  00:4757                      ;===========================================================
     292.  00:4757                      decode_data:
     293.  00:4757                      	;--- process the channels (tracks)
     294.  00:4757  21 25 53            	ld	hl,TRACK_ToneTable_PSG			; Set the PSG note table
     295.  00:475A  22 2D C0            	ld	(replay_tonetable),hl	
     296.  00:475D                      	
     297.  00:475D                      .decode1:	
     298.  00:475D  21 56 C0            	ld 	hl,TRACK_Chan1+17+TRACK_Delay
     299.  00:4760  35                  	dec	(hl)
     300.  00:4761  C2 7E 47            	jp	nz,.decode2
     301.  00:4764                      
     302.  00:4764  3A 3C C0            	ld	a,(TRACK_Chan1+17+TRACK_Flags)
     303.  00:4767  57                  	ld	d,a
     304.  00:4768  3A 39 C0            	ld	a,(TRACK_Chan1+17+TRACK_Note)	
     305.  00:476B  DD 21 43 C0         	ld	ix,TRACK_Chan1+17
     306.  00:476F  ED 4B 0D C0         	ld	bc,(TRACK_pointer1)
     307.  00:4773  CD 1D 4A            	call	decode_data_chan
     308.  00:4776  ED 43 0D C0         	ld	(TRACK_pointer1),bc
     309.  00:477A  7A                  	ld	a,d
     310.  00:477B  32 3C C0            	ld	(TRACK_Chan1+17+TRACK_Flags),a	
     311.  00:477E                      
     312.  00:477E                      .decode2:	
     313.  00:477E  21 7D C0            	ld 	hl,TRACK_Chan2+17+TRACK_Delay
     314.  00:4781  35                  	dec	(hl)
     315.  00:4782  C2 A5 47            	jp	nz,.decode3
     316.  00:4785                      
     317.  00:4785  3A 63 C0            	ld	a,(TRACK_Chan2+17+TRACK_Flags)
     318.  00:4788  57                  	ld	d,a
     319.  00:4789  3A 60 C0            	ld	a,(TRACK_Chan2+17+TRACK_Note)	
     320.  00:478C  DD 21 6A C0         	ld	ix,TRACK_Chan2+17
     321.  00:4790  ED 4B 0F C0         	ld	bc,(TRACK_pointer2)
     322.  00:4794  CD 1D 4A            	call	decode_data_chan
     323.  00:4797  ED 43 0F C0         	ld	(TRACK_pointer2),bc
     324.  00:479B  7A                  	ld	a,d				;'
     325.  00:479C  32 63 C0            	ld	(TRACK_Chan2+17+TRACK_Flags),a	
     326.  00:479F                      
     327.  00:479F                      	;--- Set FM Tone table
     328.  00:479F  21 E5 53            	ld	hl,TRACK_ToneTable_FM
     329.  00:47A2  22 2D C0            	ld	(replay_tonetable),hl
     330.  00:47A5                      
     331.  00:47A5                      
     332.  00:47A5                      .decode3:
     333.  00:47A5  21 A4 C0            	ld 	hl,TRACK_Chan3+17+TRACK_Delay
     334.  00:47A8  35                  	dec	(hl)
     335.  00:47A9  C2 C6 47            	jp	nz,.decode4
     336.  00:47AC                      
     337.  00:47AC  3A 8A C0            	ld	a,(TRACK_Chan3+17+TRACK_Flags)
     338.  00:47AF  57                  	ld	d,a		;'
     339.  00:47B0  3A 87 C0            	ld	a,(TRACK_Chan3+17+TRACK_Note)	
     340.  00:47B3  DD 21 91 C0         	ld	ix,TRACK_Chan3+17
     341.  00:47B7  ED 4B 11 C0         	ld	bc,(TRACK_pointer3)
     342.  00:47BB  CD 1D 4A            	call	decode_data_chan
     343.  00:47BE  ED 43 11 C0         	ld	(TRACK_pointer3),bc
     344.  00:47C2  7A                  	ld	a,d				;'
     345.  00:47C3  32 8A C0            	ld	(TRACK_Chan3+17+TRACK_Flags),a	
     346.  00:47C6                      
     347.  00:47C6                      .decode4:
     348.  00:47C6  21 CB C0            	ld 	hl,TRACK_Chan4+17+TRACK_Delay
     349.  00:47C9  35                  	dec	(hl)
     350.  00:47CA  C2 E7 47            	jp	nz,.decode5
     351.  00:47CD                      
     352.  00:47CD  3A B1 C0            	ld	a,(TRACK_Chan4+17+TRACK_Flags)
     353.  00:47D0  57                  	ld 	d,a		;'
     354.  00:47D1  3A AE C0            	ld	a,(TRACK_Chan4+17+TRACK_Note)	
     355.  00:47D4  DD 21 B8 C0         	ld	ix,TRACK_Chan4+17
     356.  00:47D8  ED 4B 13 C0         	ld	bc,(TRACK_pointer4)
     357.  00:47DC  CD 1D 4A            	call	decode_data_chan
     358.  00:47DF  ED 43 13 C0         	ld	(TRACK_pointer4),bc
     359.  00:47E3  7A                  	ld	a,d			;'
     360.  00:47E4  32 B1 C0            	ld	(TRACK_Chan4+17+TRACK_Flags),a	
     361.  00:47E7                      
     362.  00:47E7                      .decode5:
     363.  00:47E7  21 F2 C0            	ld 	hl,TRACK_Chan5+17+TRACK_Delay
     364.  00:47EA  35                  	dec	(hl)
     365.  00:47EB  C2 08 48            	jp	nz,.decode6
     366.  00:47EE                      
     367.  00:47EE  3A D8 C0            	ld	a,(TRACK_Chan5+17+TRACK_Flags)
     368.  00:47F1  57                  	ld	d,a		;'
     369.  00:47F2  3A D5 C0            	ld	a,(TRACK_Chan5+17+TRACK_Note)	
     370.  00:47F5  DD 21 DF C0         	ld	ix,TRACK_Chan5+17
     371.  00:47F9  ED 4B 15 C0         	ld	bc,(TRACK_pointer5)
     372.  00:47FD  CD 1D 4A            	call	decode_data_chan
     373.  00:4800  ED 43 15 C0         	ld	(TRACK_pointer5),bc
     374.  00:4804  7A                  	ld	a,d			;'
     375.  00:4805  32 D8 C0            	ld	(TRACK_Chan5+17+TRACK_Flags),a	
     376.  00:4808                      
     377.  00:4808                      .decode6:
     378.  00:4808  21 19 C1            	ld 	hl,TRACK_Chan6+17+TRACK_Delay
     379.  00:480B  35                  	dec	(hl)
     380.  00:480C  C2 29 48            	jp	nz,.decode7
     381.  00:480F                      
     382.  00:480F  3A FF C0            	ld	a,(TRACK_Chan6+17+TRACK_Flags)
     383.  00:4812  57                  	ld	d,a		;'
     384.  00:4813  3A FC C0            	ld	a,(TRACK_Chan6+17+TRACK_Note)	
     385.  00:4816  DD 21 06 C1         	ld	ix,TRACK_Chan6+17
     386.  00:481A  ED 4B 17 C0         	ld	bc,(TRACK_pointer6)
     387.  00:481E  CD 1D 4A            	call	decode_data_chan
     388.  00:4821  ED 43 17 C0         	ld	(TRACK_pointer6),bc
     389.  00:4825  7A                  	ld	a,d				;'
     390.  00:4826  32 FF C0            	ld	(TRACK_Chan6+17+TRACK_Flags),a	
     391.  00:4829                      
     392.  00:4829                      .decode7:
     393.  00:4829  21 40 C1            	ld 	hl,TRACK_Chan7+17+TRACK_Delay
     394.  00:482C  35                  	dec	(hl)
     395.  00:482D  C2 4A 48            	jp	nz,.decode8
     396.  00:4830                      
     397.  00:4830  3A 26 C1            	ld	a,(TRACK_Chan7+17+TRACK_Flags)
     398.  00:4833  57                  	ld	d,a		;'
     399.  00:4834  3A 23 C1            	ld	a,(TRACK_Chan7+17+TRACK_Note)	
     400.  00:4837  DD 21 2D C1         	ld	ix,TRACK_Chan7+17
     401.  00:483B  ED 4B 19 C0         	ld	bc,(TRACK_pointer7)
     402.  00:483F  CD 1D 4A            	call	decode_data_chan
     403.  00:4842  ED 43 19 C0         	ld	(TRACK_pointer7),bc
     404.  00:4846  7A                  	ld	a,d				;'
     405.  00:4847  32 26 C1            	ld	(TRACK_Chan7+17+TRACK_Flags),a	
     406.  00:484A                      
     407.  00:484A                      .decode8:
     408.  00:484A  21 67 C1            	ld 	hl,TRACK_Chan8+17+TRACK_Delay
     409.  00:484D  35                  	dec	(hl)
     410.  00:484E  C2 6B 48            	jp	nz,.decode_end
     411.  00:4851                      
     412.  00:4851  3A 4D C1            	ld	a,(TRACK_Chan8+17+TRACK_Flags)
     413.  00:4854  57                  	ld	d,a		;'
     414.  00:4855  3A 4A C1            	ld	a,(TRACK_Chan8+17+TRACK_Note)	
     415.  00:4858  DD 21 54 C1         	ld	ix,TRACK_Chan8+17
     416.  00:485C  ED 4B 1B C0         	ld	bc,(TRACK_pointer8)
     417.  00:4860  CD 1D 4A            	call	decode_data_chan
     418.  00:4863  ED 43 1B C0         	ld	(TRACK_pointer8),bc
     419.  00:4867  7A                  	ld	a,d				;'
     420.  00:4868  32 4D C1            	ld	(TRACK_Chan8+17+TRACK_Flags),a
     421.  00:486B                      		
     422.  00:486B                      .decode_end:
     423.  00:486B                      	; continue to process data
     424.  00:486B                      ;===========================================================
     425.  00:486B                      ; ---	replay_decodedata_NO
     426.  00:486B                      ; Process changes.
     427.  00:486B                      ; 
     428.  00:486B                      ; 
     429.  00:486B                      ;===========================================================
     430.  00:486B                      process_data:
     431.  00:486B  3E FA               	ld	a,$fa ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     432.  00:486D  D3 99               	out	(0x99),a
     433.  00:486F  3E 87               	ld	a,7+128
     434.  00:4871  D3 99               	out	(0x99),a	
     435.  00:4873                      
     436.  00:4873                      
     437.  00:4873                      
     438.  00:4873                      	; Set tone table
     439.  00:4873  21 25 53            	ld	hl,TRACK_ToneTable_PSG
     440.  00:4876  22 2D C0            	ld	(replay_tonetable),hl
     441.  00:4879                      
     442.  00:4879                      	;--- Initialize PSG Mixer and volume
     443.  00:4879  AF                  	xor	a
     444.  00:487A  32 BE C1            	ld	(FM_regMIXER),a
     445.  00:487D  32 75 C1            	ld	(PSG_regVOLN),a
     446.  00:4880  32 72 C1            	ld	(PSG_regVOLA),a
     447.  00:4883  32 73 C1            	ld	(PSG_regVOLB),a
     448.  00:4886  32 74 C1            	ld	(PSG_regVOLC),a
     449.  00:4889                      	
     450.  00:4889                      	;--- PSG balance
     451.  00:4889  2A 03 C0            	ld	hl,(replay_mainPSGvol)
     452.  00:488C  22 29 C0            	ld	(replay_mainvol),hl
     453.  00:488F                      	
     454.  00:488F                      	;--------------------
     455.  00:488F                      	;--- Process track 1
     456.  00:488F                      	;--------------------
     457.  00:488F  DD 21 43 C0         	ld	ix,TRACK_Chan1+17
     458.  00:4893  3A 3C C0            	ld	a,(TRACK_Chan1+17+TRACK_Flags)
     459.  00:4896  57                  	ld	d,a
     460.  00:4897  21 6A C1            	ld	hl,PSG_regToneA
     461.  00:489A  CD EA 4C            	call	process_data_chan
     462.  00:489D                      ;	ld	(PSG_regToneA),hl
     463.  00:489D  3A 9A C1            	ld	a,(FM_regVOLF)
     464.  00:48A0  32 72 C1            	ld	(PSG_regVOLA),a	
     465.  00:48A3                      
     466.  00:48A3                      	;--------------------
     467.  00:48A3                      	;--- Process track 2
     468.  00:48A3                      	;--------------------
     469.  00:48A3  DD 21 6A C0         	ld	ix,TRACK_Chan2+17
     470.  00:48A7  3A 63 C0            	ld	a,(TRACK_Chan2+17+TRACK_Flags)
     471.  00:48AA  57                  	ld	d,a
     472.  00:48AB  21 6C C1            	ld	hl,PSG_regToneB
     473.  00:48AE  CD EA 4C            	call	process_data_chan
     474.  00:48B1                      ;	ld	(PSG_regToneB),hl
     475.  00:48B1  3A 9A C1            	ld	a,(FM_regVOLF)
     476.  00:48B4  32 73 C1            	ld	(PSG_regVOLB),a	
     477.  00:48B7                      
     478.  00:48B7  3A 23 C0            	ld	a,(replay_chan_setup)
     479.  00:48BA  A7                  	and	a
     480.  00:48BB  CA F1 48            	jp	z,_rdd_2psg_6fm
     481.  00:48BE                      
     482.  00:48BE                      _rdd_3psg_5fm:
     483.  00:48BE                      	;--------------------
     484.  00:48BE                      	;--- Process track 3	
     485.  00:48BE                      	;--------------------
     486.  00:48BE  DD 21 91 C0         	ld	ix,TRACK_Chan3+17
     487.  00:48C2  3A 8A C0            	ld	a,(TRACK_Chan3+17+TRACK_Flags)
     488.  00:48C5  57                  	ld	d,a
     489.  00:48C6  21 6E C1            	ld	hl,PSG_regToneC
     490.  00:48C9  CD EA 4C            	call	process_data_chan
     491.  00:48CC                      ;	ld	(PSG_regToneC),hl
     492.  00:48CC  3A 9A C1            	ld	a,(FM_regVOLF)
     493.  00:48CF  32 74 C1            	ld	(PSG_regVOLC),a
     494.  00:48D2                      
     495.  00:48D2                      	;-- Convert mixer to AY
     496.  00:48D2  3A BE C1            	ld	a,(FM_regMIXER)		
     497.  00:48D5  CB 3F               	srl	a
     498.  00:48D7  CB 3F               	srl	a
     499.  00:48D9  EE 3F               	xor	0x3f
     500.  00:48DB  32 71 C1            	ld	(PSG_regMIXER),a
     501.  00:48DE  AF                  	xor	a
     502.  00:48DF  32 BE C1            	ld	(FM_regMIXER),a
     503.  00:48E2                      
     504.  00:48E2                      	; Set tone table
     505.  00:48E2  21 E5 53            	ld	hl,TRACK_ToneTable_FM
     506.  00:48E5  22 2D C0            	ld	(replay_tonetable),hl
     507.  00:48E8                      	;--- set SCC balance
     508.  00:48E8  2A 05 C0            	ld	hl,(replay_mainSCCvol)
     509.  00:48EB  22 29 C0            	ld	(replay_mainvol),hl
     510.  00:48EE                      	
     511.  00:48EE  C3 26 49            	jp	_rdd_cont
     512.  00:48F1                      	
     513.  00:48F1                      	
     514.  00:48F1                      _rdd_2psg_6fm:
     515.  00:48F1                      	;-- Convert mixer to AY
     516.  00:48F1  3A BE C1            	ld	a,(FM_regMIXER)		
     517.  00:48F4  CB 3F               	srl	a
     518.  00:48F6  CB 3F               	srl	a
     519.  00:48F8  CB 3F               	srl	a
     520.  00:48FA  EE 3F               	xor	0x3f
     521.  00:48FC  32 71 C1            	ld	(PSG_regMIXER),a
     522.  00:48FF                      
     523.  00:48FF                      	; Set tone table
     524.  00:48FF  21 E5 53            	ld	hl,TRACK_ToneTable_FM
     525.  00:4902  22 2D C0            	ld	(replay_tonetable),hl
     526.  00:4905                      	;--- set SCC balance
     527.  00:4905  2A 05 C0            	ld	hl,(replay_mainSCCvol)
     528.  00:4908  22 29 C0            	ld	(replay_mainvol),hl
     529.  00:490B                      
     530.  00:490B                      	;--------------------
     531.  00:490B                      	;--- Process track 3
     532.  00:490B                      	;--------------------
     533.  00:490B  DD 21 91 C0         	ld	ix,TRACK_Chan3+17
     534.  00:490F  3A 8A C0            	ld	a,(TRACK_Chan3+17+TRACK_Flags)
     535.  00:4912  57                  	ld	d,a
     536.  00:4913  21 78 C1            	ld	hl,FM_regToneA
     537.  00:4916  CD EA 4C            	call	process_data_chan
     538.  00:4919                      ;	ld	(FM_regToneA),hl
     539.  00:4919  3A 9A C1            	ld	a,(FM_regVOLF)
     540.  00:491C  57                  	ld	d,a
     541.  00:491D  3A 89 C0            	ld	a,(TRACK_Chan3+17+TRACK_Voice)
     542.  00:4920  E6 F0               	and	$f0
     543.  00:4922  B2                  	or	d
     544.  00:4923  32 7C C1            	ld	(FM_regVOLA),a	
     545.  00:4926                      
     546.  00:4926                      
     547.  00:4926                      _rdd_cont:
     548.  00:4926                      	;--------------------
     549.  00:4926                      	;--- Process track 4
     550.  00:4926                      	;--------------------
     551.  00:4926  DD 21 B8 C0         	ld	ix,TRACK_Chan4+17
     552.  00:492A  3A B1 C0            	ld	a,(TRACK_Chan4+17+TRACK_Flags)
     553.  00:492D  57                  	ld	d,a
     554.  00:492E  21 7E C1            	ld	hl,FM_regToneB
     555.  00:4931  CD EA 4C            	call	process_data_chan
     556.  00:4934                      ;	ld	(FM_regToneB),hl
     557.  00:4934  3A 9A C1            	ld	a,(FM_regVOLF)
     558.  00:4937  57                  	ld	d,a
     559.  00:4938  3A B0 C0            	ld	a,(TRACK_Chan4+17+TRACK_Voice)
     560.  00:493B  E6 F0               	and	$f0
     561.  00:493D  B2                  	or	d
     562.  00:493E  32 82 C1            	ld	(FM_regVOLB),a	
     563.  00:4941                      
     564.  00:4941                      	;--------------------
     565.  00:4941                      	;--- Process track 5
     566.  00:4941                      	;--------------------	
     567.  00:4941  DD 21 DF C0         	ld	ix,TRACK_Chan5+17
     568.  00:4945  3A D8 C0            	ld	a,(TRACK_Chan5+17+TRACK_Flags)
     569.  00:4948  57                  	ld	d,a
     570.  00:4949  21 84 C1            	ld	hl,FM_regToneC
     571.  00:494C  CD EA 4C            	call	process_data_chan
     572.  00:494F                      ;	ld	(FM_regToneC),hl
     573.  00:494F  3A 9A C1            	ld	a,(FM_regVOLF)
     574.  00:4952  57                  	ld	d,a
     575.  00:4953  3A D7 C0            	ld	a,(TRACK_Chan5+17+TRACK_Voice)
     576.  00:4956  E6 F0               	and	$f0
     577.  00:4958  B2                  	or	d
     578.  00:4959  32 88 C1            	ld	(FM_regVOLC),a	
     579.  00:495C                      
     580.  00:495C                      	;--------------------
     581.  00:495C                      	;--- Process track 6
     582.  00:495C                      	;--------------------
     583.  00:495C                      		
     584.  00:495C  DD 21 06 C1         	ld	ix,TRACK_Chan6+17
     585.  00:4960  3A FF C0            	ld	a,(TRACK_Chan6+17+TRACK_Flags)
     586.  00:4963  57                  	ld	d,a
     587.  00:4964  21 8A C1            	ld	hl,FM_regToneD
     588.  00:4967  CD EA 4C            	call	process_data_chan
     589.  00:496A                      ;	ld	(FM_regToneD),hl
     590.  00:496A  3A 9A C1            	ld	a,(FM_regVOLF)
     591.  00:496D  57                  	ld	d,a
     592.  00:496E  3A FE C0            	ld	a,(TRACK_Chan6+17+TRACK_Voice)
     593.  00:4971  E6 F0               	and	$f0
     594.  00:4973  B2                  	or	d
     595.  00:4974  32 8E C1            	ld	(FM_regVOLD),a	
     596.  00:4977                      
     597.  00:4977                      	;--------------------
     598.  00:4977                      	;--- Process track 7
     599.  00:4977                      	;--------------------
     600.  00:4977  DD 21 2D C1         	ld	ix,TRACK_Chan7+17
     601.  00:497B  3A 26 C1            	ld	a,(TRACK_Chan7+17+TRACK_Flags)
     602.  00:497E  57                  	ld	d,a
     603.  00:497F  21 90 C1            	ld	hl,FM_regToneE
     604.  00:4982  CD EA 4C            	call	process_data_chan
     605.  00:4985                      ;	ld	(FM_regToneE),hl
     606.  00:4985                      ;	ld	a,d
     607.  00:4985                      ;	ld	(TRACK_Chan7+17+TRACK_Flags),a	
     608.  00:4985  3A 9A C1            	ld	a,(FM_regVOLF)
     609.  00:4988  57                  	ld	d,a
     610.  00:4989  3A 25 C1            	ld	a,(TRACK_Chan7+17+TRACK_Voice)
     611.  00:498C  E6 F0               	and	$f0
     612.  00:498E  B2                  	or	d
     613.  00:498F  32 94 C1            	ld	(FM_regVOLE),a		
     614.  00:4992                      
     615.  00:4992                      	;--------------------
     616.  00:4992                      	;--- Process track 8
     617.  00:4992                      	;--------------------		
     618.  00:4992  DD 21 54 C1         	ld	ix,TRACK_Chan8+17
     619.  00:4996  3A 4D C1            	ld	a,(TRACK_Chan8+17+TRACK_Flags)
     620.  00:4999  57                  	ld	d,a
     621.  00:499A  CD EA 4C            	call	process_data_chan
     622.  00:499D  3A 9A C1            	ld	a,(FM_regVOLF)
     623.  00:49A0  57                  	ld	d,a
     624.  00:49A1  3A 89 C0            	ld	a,(TRACK_Chan3+17+TRACK_Voice)
     625.  00:49A4  E6 F0               	and	$f0
     626.  00:49A6  B2                  	or	d	
     627.  00:49A7  32 94 C1            	ld	(FM_regVOLE),a
     628.  00:49AA                      ;	ld	(FM_regToneF),hl
     629.  00:49AA                      	
     630.  00:49AA                      
     631.  00:49AA                      	;--------------------
     632.  00:49AA                      	; Fade out processing
     633.  00:49AA                      	;--------------------
     634.  00:49AA  3A 25 C0            	ld	a,(replay_fade)
     635.  00:49AD  A7                  	and	a
     636.  00:49AE  C8                  	ret	z	; if replay fade = 0 then no fade active
     637.  00:49AF                      	
     638.  00:49AF                      	; decrease fade timer
     639.  00:49AF  3A 26 C0            	ld	a,(replay_fade_timer)
     640.  00:49B2  3D                  	dec	a
     641.  00:49B3  C2 CC 49            	jp	nz,.no_new_step
     642.  00:49B6                      
     643.  00:49B6  3A 27 C0            	ld	a,(replay_fade_vol)
     644.  00:49B9  3C                  	inc	a
     645.  00:49BA  FE 10               	cp	16
     646.  00:49BC  DA C6 49            	jp	c,.cont_fadeing
     647.  00:49BF  AF                  	xor	a
     648.  00:49C0  32 25 C0            	ld	(replay_fade),a
     649.  00:49C3  C3 1E 46            	jp	replay_pause
     650.  00:49C6                      .cont_fadeing:	
     651.  00:49C6  32 27 C0            	ld	(replay_fade_vol),a
     652.  00:49C9  3A 25 C0            	ld	a,(replay_fade)
     653.  00:49CC                      .no_new_step:
     654.  00:49CC  32 26 C0            	ld	(replay_fade_timer),a
     655.  00:49CF                      
     656.  00:49CF  3A 27 C0            	ld	a,(replay_fade_vol)
     657.  00:49D2  4F                  	ld	c,a
     658.  00:49D3  06 03               	ld	b,3
     659.  00:49D5  21 72 C1            	ld	hl,PSG_regVOLA
     660.  00:49D8  CD E0 49            	call	.calc_vol
     661.  00:49DB  06 06               	ld	b,6
     662.  00:49DD  21 7C C1            	ld	hl,FM_regVOLA
     663.  00:49E0                      
     664.  00:49E0                      .calc_vol:	
     665.  00:49E0  7E                  	ld	a,(hl)
     666.  00:49E1  91                  	sub	c
     667.  00:49E2  D2 E6 49            	jp	nc,.no_carry
     668.  00:49E5  AF                  	xor	a
     669.  00:49E6                      .no_carry:	
     670.  00:49E6  77                  	ld	(hl),a
     671.  00:49E7  23                  	inc	hl
     672.  00:49E8  10 F6               	djnz	.calc_vol
     673.  00:49EA  C9                  	ret
     674.  00:49EB                      
     675.  00:49EB                      
     676.  00:49EB                      
     677.  00:49EB                      ;--------------------
     678.  00:49EB                      	
     679.  00:49EB                      	
     680.  00:49EB                      ;--------------------
     681.  00:49EB                      _replay_check_patternend:
     682.  00:49EB  3A 56 C0            	ld 	a,(TRACK_Chan1+17+TRACK_Delay)
     683.  00:49EE  3D                  	dec	a
     684.  00:49EF  C2 6B 48            	jp	nz,process_data
     685.  00:49F2                      	
     686.  00:49F2  2A 0D C0            	ld	hl,(TRACK_pointer1)
     687.  00:49F5  7E                  	ld	a,(hl)
     688.  00:49F6                      	
     689.  00:49F6                      	;--- check for end of pattern
     690.  00:49F6  FE BF               	cp	191	
     691.  00:49F8  C2 6B 48            	jp	nz,process_data
     692.  00:49FB                      
     693.  00:49FB                      	;--- Set track pointers to start
     694.  00:49FB  2A 1D C0            	ld	hl,(replay_orderpointer)
     695.  00:49FE  AF                  	xor	a
     696.  00:49FF  BE                  	cp	(hl)
     697.  00:4A00  C2 0F 4A            	jp	nz,.no_restart
     698.  00:4A03  23                  	inc	hl
     699.  00:4A04  BE                  	cp	(hl)
     700.  00:4A05  2B                  	dec	hl
     701.  00:4A06  C2 0F 4A            	jp	nz,.no_restart
     702.  00:4A09                      	;--- next is restart order
     703.  00:4A09  23                  	inc	hl
     704.  00:4A0A  23                  	inc	hl
     705.  00:4A0B  7E                  	ld	a,(hl)
     706.  00:4A0C  23                  	inc	hl
     707.  00:4A0D  66                  	ld	h,(hl)
     708.  00:4A0E  6F                  	ld	l,a
     709.  00:4A0F                      .no_restart:	
     710.  00:4A0F  11 0D C0            	ld	de,TRACK_pointer1
     711.  00:4A12  01 10 00            	ld	bc,16
     712.  00:4A15  ED B0               	ldir
     713.  00:4A17  22 1D C0            	ld	(replay_orderpointer),hl		; store pointer for next set
     714.  00:4A1A                      								; of strack pointers
     715.  00:4A1A  C3 6B 48            	jp	process_data
     716.  00:4A1D                      
     717.  00:4A1D                      
     718.  00:4A1D                      
     719.  00:4A1D                      
     720.  00:4A1D                      
     721.  00:4A1D                      
     722.  00:4A1D                      
     723.  00:4A1D                      
     724.  00:4A1D                      
     725.  00:4A1D                      
     726.  00:4A1D                      
     727.  00:4A1D                      
     728.  00:4A1D                      ;===========================================================
     729.  00:4A1D                      ; ---	decode_data_chan
     730.  00:4A1D                      ; Process the channel data
     731.  00:4A1D                      ; 
     732.  00:4A1D                      ; in BC is the pointer to the	data
     733.  00:4A1D                      ;    D contains flags.
     734.  00:4A1D                      ;===========================================================	
     735.  00:4A1D                      decode_data_chan:
     736.  00:4A1D                      	;--- initialize data
     737.  00:4A1D  DD 7E F6            	ld	a,(ix+TRACK_Note)
     738.  00:4A20  32 28 C0            	ld	(replay_previous_note),a
     739.  00:4A23                      
     740.  00:4A23                      	;=============
     741.  00:4A23                      	; Note 
     742.  00:4A23                      	;=============
     743.  00:4A23  0A                  	ld	a,(bc)
     744.  00:4A24  FE 60               	cp	_REL
     745.  00:4A26  DA 99 4A            	jp	c,_replay_decode_note
     746.  00:4A29  FE 61               	cp	_SUS
     747.  00:4A2B  DA A5 4A            	jp	c,_replay_decode_release
     748.  00:4A2E  CA B0 4A            	jp	z,_replay_decode_sustain
     749.  00:4A31                      _rdn2:
     750.  00:4A31  FE 71               	cp	_INS
     751.  00:4A33  DA F4 4A            	jp	c,_replay_decode_vol
     752.  00:4A36                      _rdv2:
     753.  00:4A36  FE 90               	cp	_CMD
     754.  00:4A38  DA BB 4A            	jp	c,_replay_decode_ins
     755.  00:4A3B                      _rdi2:
     756.  00:4A3B  FE BF               	cp	_EOT
     757.  00:4A3D  DA 09 4B            	jp	c,_replaydecode_cmd
     758.  00:4A40  C3 75 4A            	jp	_replay_decode_delay
     759.  00:4A43                      
     760.  00:4A43                      _rdn:
     761.  00:4A43  FE 62               	cp	_SUS+1		
     762.  00:4A45  DA 65 4A            	jp	c,_rd_delay
     763.  00:4A48  C3 31 4A            	jp	_rdn2
     764.  00:4A4B                      
     765.  00:4A4B                      _rdi:
     766.  00:4A4B  FE 90               	cp	_CMD
     767.  00:4A4D  DA 65 4A            	jp	c,_rd_delay
     768.  00:4A50  C3 3B 4A            	jp	_rdi2
     769.  00:4A53                      
     770.  00:4A53                      _rdv:
     771.  00:4A53  FE 71               	cp	_INS
     772.  00:4A55  DA 65 4A            	jp	c,_rd_delay
     773.  00:4A58  C3 36 4A            	jp	_rdv2
     774.  00:4A5B                      _rdc:
     775.  00:4A5B  03                  	inc	bc
     776.  00:4A5C                      _rdc_noinc:	
     777.  00:4A5C  0A                  	ld	a,(bc)
     778.  00:4A5D  FE BF               	cp	_EOT
     779.  00:4A5F  DA 65 4A            	jp	c,_rd_delay
     780.  00:4A62  C3 75 4A            	jp	_replay_decode_delay
     781.  00:4A65                      
     782.  00:4A65                      	;--- re-init previous delay
     783.  00:4A65                      _rd_delay:
     784.  00:4A65  DD 7E 14            	ld	a,(ix+TRACK_prevDelay)
     785.  00:4A68  DD 77 13            	ld	(ix+TRACK_Delay),a
     786.  00:4A6B  C3 81 4A            	jp	_replay_decode_trigger_porttone_check
     787.  00:4A6E                      
     788.  00:4A6E                      _rd_eot:
     789.  00:4A6E  3C                  	inc	a
     790.  00:4A6F  DD 77 13            	ld	(ix+TRACK_Delay),a
     791.  00:4A72  C3 81 4A            	jp	_replay_decode_trigger_porttone_check
     792.  00:4A75                      
     793.  00:4A75                      _replay_decode_delay:
     794.  00:4A75  D6 BF               	sub	_WAIT-1
     795.  00:4A77  CA 6E 4A            	jp	z,_rd_eot		; EOT found
     796.  00:4A7A  DD 77 13            	ld	(ix+TRACK_Delay),a
     797.  00:4A7D  DD 77 14            	ld	(ix+TRACK_prevDelay),a
     798.  00:4A80  03                  	inc	bc
     799.  00:4A81                      	
     800.  00:4A81                      _replay_decode_trigger_porttone_check:	
     801.  00:4A81                      	;--- Check cmd active and note trigger?
     802.  00:4A81  CB 42               	bit 	B_TRGNOT,d
     803.  00:4A83  C8                  	ret	z
     804.  00:4A84  CB 5A               	bit	B_TRGCMD,d
     805.  00:4A86  C8                  	ret	z
     806.  00:4A87                      	;--- Check for cmd3 or cmd5 (value 0 or 1) to continue
     807.  00:4A87  DD 7E F0            	ld	a,(ix+TRACK_Command)
     808.  00:4A8A  FE 02               	cp	2
     809.  00:4A8C  D0                  	ret	nc
     810.  00:4A8D                      	;-- trigger CMD
     811.  00:4A8D  CB 82               	res	B_TRGNOT,d
     812.  00:4A8F  3E 12               	ld	a,0010010b		;B_ACTNOT B_KEYON
     813.  00:4A91  B2                  	or	d
     814.  00:4A92  57                  	ld 	d,a
     815.  00:4A93  DD 7E 09            	ld	a,(ix+TRACK_cmd_3)
     816.  00:4A96  C3 98 4B            	jp	decode_cmd3_port_tone_new_note	
     817.  00:4A99                      	;ret
     818.  00:4A99                      
     819.  00:4A99                      _replay_decode_note:
     820.  00:4A99  DD 77 F6            	ld	(ix+TRACK_Note),a
     821.  00:4A9C  CB C2               	set 	B_TRGNOT,d
     822.  00:4A9E  CB E2               	set 	B_KEYON,d
     823.  00:4AA0                      
     824.  00:4AA0  03                  	inc	bc
     825.  00:4AA1  0A                  	ld	a,(bc)
     826.  00:4AA2  C3 43 4A            	jp	_rdn
     827.  00:4AA5                      	
     828.  00:4AA5                      
     829.  00:4AA5                      
     830.  00:4AA5                      _replay_decode_release:
     831.  00:4AA5  CB 8A               	res	B_ACTNOT,d				; reset note bit to	0
     832.  00:4AA7  CB AA               	res	B_SUST,d				; rest sustain
     833.  00:4AA9  CB A2               	res	B_KEYON,d				; reset Key on
     834.  00:4AAB                      
     835.  00:4AAB  03                  	inc	bc
     836.  00:4AAC  0A                  	ld	a,(bc)
     837.  00:4AAD  C3 43 4A            	jp	_rdn	
     838.  00:4AB0                      	
     839.  00:4AB0                      
     840.  00:4AB0                      
     841.  00:4AB0                      _replay_decode_sustain:
     842.  00:4AB0  CB 8A               	res	B_ACTNOT,d				; reset note bit to	0
     843.  00:4AB2  CB EA               	set	B_SUST,d				; rest sustain
     844.  00:4AB4  CB A2               	res	B_KEYON,d				; reset Key on
     845.  00:4AB6                      
     846.  00:4AB6  03                  	inc	bc
     847.  00:4AB7  0A                  	ld	a,(bc)
     848.  00:4AB8  C3 43 4A            	jp	_rdn
     849.  00:4ABB                      
     850.  00:4ABB                      
     851.  00:4ABB                      
     852.  00:4ABB                      _replay_decode_ins:
     853.  00:4ABB  D6 71               	sub	_INS
     854.  00:4ABD  DD BE EF            	cp	(ix+TRACK_Instrument)
     855.  00:4AC0  CA EF 4A            	jp	z,.skip_ins
     856.  00:4AC3                      	
     857.  00:4AC3                      	;--- instrument change found	
     858.  00:4AC3  DD 77 EF            	ld	(ix+TRACK_Instrument),a
     859.  00:4AC6                      
     860.  00:4AC6                      	;--- set instrument pointer
     861.  00:4AC6  87                  	add	a
     862.  00:4AC7  2A 0B C0            	ld	hl,(replay_insbase)
     863.  00:4ACA  85                  	add	a,l
     864.  00:4ACB  6F                  	ld	l,a
     865.  00:4ACC  D2 D0 4A            	jp	nc,.skip
     866.  00:4ACF  24                  	inc	h
     867.  00:4AD0                      .skip:
     868.  00:4AD0  7E                  	ld	a,(hl)
     869.  00:4AD1  23                  	inc	hl
     870.  00:4AD2  66                  	ld	h,(hl)
     871.  00:4AD3  6F                  	ld	l,a
     872.  00:4AD4                      
     873.  00:4AD4                      	;-- get voice
     874.  00:4AD4  7E                  	ld	a,(hl)
     875.  00:4AD5  23                  	inc	hl
     876.  00:4AD6                      		
     877.  00:4AD6                      	;--- Set the software voice (if needed)
     878.  00:4AD6  A7                  	and	a
     879.  00:4AD7  C2 E0 4A            	jp	nz,.skip_soft
     880.  00:4ADA                      	;--- software voice found
     881.  00:4ADA                      	
     882.  00:4ADA  7E                  	ld	a,(hl)		; value is the offset in the soft voice data (8bytes)
     883.  00:4ADB  23                  	inc	hl
     884.  00:4ADC  32 BC C1            	ld 	(FM_softvoice_req),a
     885.  00:4ADF  AF                  	xor 	a
     886.  00:4AE0                      
     887.  00:4AE0                      .skip_soft:
     888.  00:4AE0  DD 77 F8            	ld	(ix+TRACK_Voice),a
     889.  00:4AE3                      
     890.  00:4AE3                      	;--- Store the macro start
     891.  00:4AE3  DD 75 F1            	ld	(ix+TRACK_MacroPointer),l
     892.  00:4AE6  DD 74 F2            	ld	(ix+TRACK_MacroPointer+1),h	
     893.  00:4AE9                      	;--- Store the macro re-start
     894.  00:4AE9  DD 75 F3            	ld	(ix+TRACK_MacroStart),l
     895.  00:4AEC  DD 74 F4            	ld	(ix+TRACK_MacroStart+1),h
     896.  00:4AEF                      
     897.  00:4AEF                      .skip_ins:	
     898.  00:4AEF  03                  	inc	bc
     899.  00:4AF0  0A                  	ld	a,(bc)
     900.  00:4AF1  C3 4B 4A            	jp	_rdi
     901.  00:4AF4                      
     902.  00:4AF4                      
     903.  00:4AF4                      
     904.  00:4AF4                      _replay_decode_vol:
     905.  00:4AF4  D6 61               	sub	_VOL-1
     906.  00:4AF6  87                  	add	a
     907.  00:4AF7  87                  	add	a
     908.  00:4AF8  87                  	add	a
     909.  00:4AF9  87                  	add	a
     910.  00:4AFA                      	
     911.  00:4AFA                      	;--- Set new base	volume (high byte) but keep relative offset (low byte)
     912.  00:4AFA  5F                  	ld	e,a
     913.  00:4AFB  DD 7E F7            	ld	a,(ix+TRACK_Volume)
     914.  00:4AFE  E6 0F               	and	0xf
     915.  00:4B00  B3                  	or	e
     916.  00:4B01  DD 77 F7            	ld	(ix+TRACK_Volume),a
     917.  00:4B04                      
     918.  00:4B04  03                  	inc	bc
     919.  00:4B05  0A                  	ld	a,(bc)
     920.  00:4B06  C3 53 4A            	jp	_rdv
     921.  00:4B09                      
     922.  00:4B09                      
     923.  00:4B09                      
     924.  00:4B09                      _replaydecode_cmd:
     925.  00:4B09  D6 90               	sub	_CMD
     926.  00:4B0B                      	
     927.  00:4B0B                      	;[Debug]
     928.  00:4B0B  FE 17               	cp	23
     929.  00:4B0D  DA 12 4B            	jp	c,99f
     930.  00:4B10  F3                  	di
     931.  00:4B11  76                  	halt
     932.  00:4B12                      99:
     933.  00:4B12                      	;[Debug end]
     934.  00:4B12                      	
     935.  00:4B12  5F                  	ld	e,a				; store command for later
     936.  00:4B13  21 24 4B            	ld	hl,DECODE_CMDLIST
     937.  00:4B16  87                  	add	a,a
     938.  00:4B17  85                  	add	a,l
     939.  00:4B18  6F                  	ld	l,a
     940.  00:4B19  D2 1D 4B            	jp	nc,.skip
     941.  00:4B1C  24                  	inc	h
     942.  00:4B1D                      .skip:
     943.  00:4B1D  7E                  	ld	a,(hl)
     944.  00:4B1E  23                  	inc	hl
     945.  00:4B1F  66                  	ld	h,(hl)
     946.  00:4B20  6F                  	ld	l,a
     947.  00:4B21                      	
     948.  00:4B21  03                  	inc	bc
     949.  00:4B22  0A                  	ld	a,(bc)
     950.  00:4B23  E9                  	jp	(hl)
     951.  00:4B24                      
     952.  00:4B24                      
     953.  00:4B24                      DECODE_CMDLIST:
     954.  00:4B24                      	; Primary
     955.  00:4B24  7B 4B               	dw	decode_cmd3_port_tone
     956.  00:4B26  0C 4C               	dw	decode_cmd5_vibrato_port_tone
     957.  00:4B28  70 4B               	dw	decode_cmd2_port_down
     958.  00:4B2A  52 4B               	dw	decode_cmd0_arpeggio
     959.  00:4B2C  DC 4B               	dw	decode_cmd4_vibrato
     960.  00:4B2E  65 4B               	dw	decode_cmd1_port_up
     961.  00:4B30  23 4C               	dw	decode_cmd6_vibrato_vol	
     962.  00:4B32  23 4C               	dw	decode_cmd7_vol_slide
     963.  00:4B34  DC 4B               	dw	decode_cmd8_tremelo
     964.  00:4B36  33 4C               	dw	decode_cmd9_note_cut
     965.  00:4B38  3E 4C               	dw	decode_cmd10_note_delay
     966.  00:4B3A                      	; Secondary
     967.  00:4B3A  5C 4C               	dw	decode_cmd11_command_end
     968.  00:4B3C  61 4C               	dw	decode_cmd12_drum
     969.  00:4B3E  87 4C               	dw	decode_cmd13_arp_speed
     970.  00:4B40  8D 4C               	dw	decode_cmd14_fine_up
     971.  00:4B42  97 4C               	dw	decode_cmd15_fine_down
     972.  00:4B44  A2 4C               	dw	decode_cmd16_notelink
     973.  00:4B46  A9 4C               	dw	decode_cmd17_track_detune
     974.  00:4B48  C8 4C               	dw	decode_cmd18_trigger
     975.  00:4B4A  CE 4C               	dw	decode_cmd19_speed
     976.  00:4B4C                      	; SoundChip Specific
     977.  00:4B4C  E1 4C               	dw	decode_cmd20_tone_panning
     978.  00:4B4E  E4 4C               	dw	decode_cmd21_noise_panning
     979.  00:4B50  E7 4C               	dw	decode_cmd22_chan_setup	
     980.  00:4B52                      	
     981.  00:4B52                      
     982.  00:4B52                      decode_cmd0_arpeggio:
     983.  00:4B52                      	; in:	[A] contains the paramvalue
     984.  00:4B52                      	; 
     985.  00:4B52                      	; ! do not change	[BC] this is the data pointer
     986.  00:4B52                      	;--------------------------------------------------
     987.  00:4B52  DD 77 06            	ld	(ix+TRACK_cmd_0),a
     988.  00:4B55  DD 73 F0            	ld	(ix+TRACK_Command),e
     989.  00:4B58  CB DA               	set	B_TRGCMD,d
     990.  00:4B5A  DD 36 11 00         	ld	(ix+TRACK_Timer),0
     991.  00:4B5E  DD 36 12 02         	ld	(ix+TRACK_Step),2
     992.  00:4B62  C3 5B 4A            	jp	_rdc
     993.  00:4B65                      
     994.  00:4B65                      
     995.  00:4B65                      	
     996.  00:4B65                      decode_cmd1_port_up:
     997.  00:4B65                      	; in:	[A] contains the paramvalue
     998.  00:4B65                      	; 
     999.  00:4B65                      	; ! do not change	[BC] this is the data pointer
    1000.  00:4B65                      	;--------------------------------------------------
    1001.  00:4B65  DD 73 F0            	ld	(ix+TRACK_Command),e
    1002.  00:4B68  DD 77 07            	ld	(ix+TRACK_cmd_1),a
    1003.  00:4B6B  CB DA               	set	B_TRGCMD,d
    1004.  00:4B6D  C3 5B 4A            	jp	_rdc
    1005.  00:4B70                      	
    1006.  00:4B70                      	 
    1007.  00:4B70                      	 
    1008.  00:4B70                      decode_cmd2_port_down:
    1009.  00:4B70                      	; in:	[A] contains the paramvalue
    1010.  00:4B70                      	; 
    1011.  00:4B70                      	; ! do not change	[BC] this is the data pointer
    1012.  00:4B70                      	;--------------------------------------------------
    1013.  00:4B70  DD 73 F0            	ld	(ix+TRACK_Command),e
    1014.  00:4B73  DD 77 08            	ld	(ix+TRACK_cmd_2),a
    1015.  00:4B76  CB DA               	set	B_TRGCMD,d
    1016.  00:4B78  C3 5B 4A            	jp	_rdc
    1017.  00:4B7B                      
    1018.  00:4B7B                      
    1019.  00:4B7B                      decode_cmd3_port_tone:
    1020.  00:4B7B                      	; in:	[A] contains the param value
    1021.  00:4B7B                      	; 
    1022.  00:4B7B                      	; ! do not change	[BC] this is the data pointer
    1023.  00:4B7B                      	;--------------------------------------------------
    1024.  00:4B7B  DD 73 F0            	ld	(ix+TRACK_Command),e
    1025.  00:4B7E  CB DA               	set	B_TRGCMD,d
    1026.  00:4B80  CB CA               	set	B_ACTNOT,d
    1027.  00:4B82                      	
    1028.  00:4B82  DD 77 09            	ld	(ix+TRACK_cmd_3),a
    1029.  00:4B85  DD 36 11 02         	ld	(ix+TRACK_Timer),2
    1030.  00:4B89                      
    1031.  00:4B89                      ;decode_cmd3_port_tone_cont:
    1032.  00:4B89                      	;--- Check if we have a	note on the	same event
    1033.  00:4B89  CB 42               	bit	B_TRGNOT,d
    1034.  00:4B8B  CA 5B 4A            	jp	z,_rdc
    1035.  00:4B8E                      
    1036.  00:4B8E  CB E2               	set	B_KEYON,d
    1037.  00:4B90  CB 82               	res 	B_TRGNOT,d
    1038.  00:4B92                      	
    1039.  00:4B92  CD 98 4B            	call	decode_cmd3_port_tone_new_note
    1040.  00:4B95  C3 5B 4A            	jp	_rdc
    1041.  00:4B98                      	
    1042.  00:4B98                      decode_cmd3_port_tone_new_note:
    1043.  00:4B98                      	;-- remove deviation from parameter
    1044.  00:4B98  E6 7F               	and 	$7f
    1045.  00:4B9A  08                  	ex	af,af'		;'
    1046.  00:4B9B  D9                  	exx
    1047.  00:4B9C                      
    1048.  00:4B9C                      	;-- get the	previous note freq
    1049.  00:4B9C  3A 28 C0            	ld	a,(replay_previous_note)
    1050.  00:4B9F  87                  	add	a
    1051.  00:4BA0  2A 2D C0            	ld	hl,(replay_tonetable)
    1052.  00:4BA3  85                  	add	a,l
    1053.  00:4BA4  6F                  	ld	l,a
    1054.  00:4BA5  D2 A9 4B            	jp	nc,.skip
    1055.  00:4BA8  24                  	inc	h
    1056.  00:4BA9                      .skip:
    1057.  00:4BA9  5E                  	ld	e,(hl)
    1058.  00:4BAA  23                  	inc	hl
    1059.  00:4BAB  56                  	ld	d,(hl)
    1060.  00:4BAC                      
    1061.  00:4BAC                      	; add	the toneadd
    1062.  00:4BAC  DD 6E 00            	ld	l,(ix+TRACK_cmd_ToneSlideAdd)
    1063.  00:4BAF  DD 66 01            	ld	h,(ix+TRACK_cmd_ToneSlideAdd+1)
    1064.  00:4BB2                      
    1065.  00:4BB2  19                  	add	hl,de	
    1066.  00:4BB3  EB                  	ex	de,hl				; store current freq in	[de]
    1067.  00:4BB4                      	;--- get the current note freq
    1068.  00:4BB4  DD 7E F6            	ld	a,(ix+TRACK_Note)
    1069.  00:4BB7  87                  	add	a
    1070.  00:4BB8  2A 2D C0            	ld	hl,(replay_tonetable)	;TRACK_ToneTable
    1071.  00:4BBB  85                  	add	a,l
    1072.  00:4BBC  6F                  	ld	l,a
    1073.  00:4BBD  D2 C1 4B            	jp	nc,.skip2
    1074.  00:4BC0  24                  	inc	h
    1075.  00:4BC1                      .skip2:
    1076.  00:4BC1  7E                  	ld	a,(hl)
    1077.  00:4BC2  23                  	inc	hl
    1078.  00:4BC3  66                  	ld	h,(hl)
    1079.  00:4BC4  6F                  	ld	l,a				; destination freq in [hl]
    1080.  00:4BC5                      	
    1081.  00:4BC5                      	;--- Calculate the delta
    1082.  00:4BC5  AF                  	xor	a
    1083.  00:4BC6  EB                  	ex	de,hl
    1084.  00:4BC7  ED 52               	sbc	hl,de				; results in pos/neg delta
    1085.  00:4BC9                      	
    1086.  00:4BC9  DD 75 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),l
    1087.  00:4BCC  DD 74 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),h
    1088.  00:4BCF                      	
    1089.  00:4BCF                      	;--- re-apply deviation
    1090.  00:4BCF  08                  	ex	af,af'			;'
    1091.  00:4BD0  CB 7C               	bit	7,h
    1092.  00:4BD2  C2 D7 4B            	jp	nz,99f
    1093.  00:4BD5  F6 80               	or 	128
    1094.  00:4BD7                      99:
    1095.  00:4BD7  DD 77 09            	ld 	(ix+TRACK_cmd_3),a
    1096.  00:4BDA                      	
    1097.  00:4BDA  D9                  	exx					; restore flags in D
    1098.  00:4BDB  C9                  	ret
    1099.  00:4BDC                      	
    1100.  00:4BDC                      	
    1101.  00:4BDC                      decode_cmd8_tremelo:
    1102.  00:4BDC                      	; in:	[A] contains the paramvalue
    1103.  00:4BDC                      	; 
    1104.  00:4BDC                      	; ! do not change	[BC] this is the data pointer
    1105.  00:4BDC                      	;--------------------------------------------------
    1106.  00:4BDC                      decode_cmd4_vibrato:
    1107.  00:4BDC                      	; in:	[A] contains the paramvalue
    1108.  00:4BDC                      	; 
    1109.  00:4BDC                      	; ! do not change	[BC] this is the data pointer
    1110.  00:4BDC                      	;--------------------------------------------------
    1111.  00:4BDC                      	; Vibrato with speed x and depth y.	This command 
    1112.  00:4BDC                      	; will oscillate the frequency of the current note
    1113.  00:4BDC                      	; with a sine wave. 
    1114.  00:4BDC                      	;
    1115.  00:4BDC                      	; high 3 bits is depth (0-7) (direct offset in sinetable)
    1116.  00:4BDC                      	; low 5 bits is the speed. 1-16
    1117.  00:4BDC                      	;--- Init values
    1118.  00:4BDC  DD 73 F0            	ld	(ix+TRACK_Command),e
    1119.  00:4BDF  5F                  	ld	e,a
    1120.  00:4BE0                      	
    1121.  00:4BE0                      	;--- Set the speed
    1122.  00:4BE0  E6 0F               	and	$0f
    1123.  00:4BE2  CA ED 4B            	jp	z,.depth
    1124.  00:4BE5  DD 77 0C            	ld	(ix+TRACK_cmd_4_step),a	
    1125.  00:4BE8  ED 44               	neg	
    1126.  00:4BEA  DD 77 12            	ld	(ix+TRACK_Step),a	
    1127.  00:4BED                      	
    1128.  00:4BED                      .depth:
    1129.  00:4BED                      	;-- set the depth
    1130.  00:4BED  7B                  	ld	a,e
    1131.  00:4BEE  E6 F0               	and	$f0
    1132.  00:4BF0  CA 07 4C            	jp	z,.end		; set depth when 0 only when command was not active.
    1133.  00:4BF3                      
    1134.  00:4BF3                      ;	sub	16
    1135.  00:4BF3  21 95 54            	ld	hl,TRACK_Vibrato_sine-16
    1136.  00:4BF6  87                  	add	a,a
    1137.  00:4BF7  D2 FB 4B            	jp	nc,99f
    1138.  00:4BFA  24                  	inc	h
    1139.  00:4BFB                      99:	
    1140.  00:4BFB  85                  	add	a,l
    1141.  00:4BFC  6F                  	ld 	l,a
    1142.  00:4BFD  D2 01 4C            	jp	nc,99f
    1143.  00:4C00  24                  	inc	h
    1144.  00:4C01                      99:
    1145.  00:4C01  DD 75 0A            	ld	(ix+TRACK_cmd_4_depth),l
    1146.  00:4C04  DD 74 0B            	ld	(ix+TRACK_cmd_4_depth+1),h
    1147.  00:4C07                      	
    1148.  00:4C07                      .end:	
    1149.  00:4C07  CB DA               	set	B_TRGCMD,d
    1150.  00:4C09  C3 5B 4A            	jp	_rdc	
    1151.  00:4C0C                      
    1152.  00:4C0C                      
    1153.  00:4C0C                      decode_cmd5_vibrato_port_tone:
    1154.  00:4C0C                      	; in:	[A] contains the paramvalue
    1155.  00:4C0C                      	; 
    1156.  00:4C0C                      	; ! do not change	[BC] this is the data pointer
    1157.  00:4C0C                      	;--------------------------------------------------
    1158.  00:4C0C                      	; portTone	+ volumeslide
    1159.  00:4C0C                      	;--- Init values
    1160.  00:4C0C  DD 73 F0            	ld	(ix+TRACK_Command),e
    1161.  00:4C0F  DD 77 0E            	ld	(ix+TRACK_cmd_A),a
    1162.  00:4C12  CB DA               	set	B_TRGCMD,d
    1163.  00:4C14                      	
    1164.  00:4C14                      	;-- Check if new note
    1165.  00:4C14  CB 42               	bit	B_TRGNOT,d
    1166.  00:4C16  CA 5B 4A            	jp	z,_rdc
    1167.  00:4C19                      	
    1168.  00:4C19                      	;-- Set new port tone value
    1169.  00:4C19  CB E2               	set	B_KEYON,d
    1170.  00:4C1B  CB 82               	res	B_TRGNOT,d
    1171.  00:4C1D  DD 7E 09            	ld	a,(ix+TRACK_cmd_3)
    1172.  00:4C20  C3 98 4B            	jp	decode_cmd3_port_tone_new_note
    1173.  00:4C23                      	
    1174.  00:4C23                      	
    1175.  00:4C23                      	
    1176.  00:4C23                      decode_cmd6_vibrato_vol:
    1177.  00:4C23                      	; in:	[A] contains the paramvalue
    1178.  00:4C23                      	; 
    1179.  00:4C23                      	; ! do not change	[BC] this is the data pointer
    1180.  00:4C23                      	;--------------------------------------------------
    1181.  00:4C23                      decode_cmd7_vol_slide:
    1182.  00:4C23                      	; in:	[A] contains the paramvalue
    1183.  00:4C23                      	; 
    1184.  00:4C23                      	; ! do not change	[BC] this is the data pointer
    1185.  00:4C23                      	;--------------------------------------------------
    1186.  00:4C23  DD 73 F0            	ld	(ix+TRACK_Command),e	
    1187.  00:4C26  DD 77 0E            	ld	(ix+TRACK_cmd_A),a
    1188.  00:4C29  E6 7F               	and  	$7f
    1189.  00:4C2B  DD 77 11            	ld	(ix+TRACK_Timer),a
    1190.  00:4C2E  CB DA               	set	B_TRGCMD,d
    1191.  00:4C30  C3 5B 4A            	jp	_rdc
    1192.  00:4C33                      
    1193.  00:4C33                      
    1194.  00:4C33                      decode_cmd9_note_cut:
    1195.  00:4C33  CB DA               	set	B_TRGCMD,d
    1196.  00:4C35  DD 73 F0            	ld	(ix+TRACK_Command),e
    1197.  00:4C38  DD 77 11            	ld	(ix+TRACK_Timer),a		; set	the timer to param y
    1198.  00:4C3B  C3 5B 4A            	jp 	_rdc
    1199.  00:4C3E                      
    1200.  00:4C3E                      
    1201.  00:4C3E                      decode_cmd10_note_delay:
    1202.  00:4C3E  CB 42               	bit	B_TRGNOT,d		; is there a note	in this eventstep?
    1203.  00:4C40  CA 5B 4A            	jp	z,_rdc
    1204.  00:4C43                      
    1205.  00:4C43  CB DA               	set	B_TRGCMD,d					; command active
    1206.  00:4C45  CB 82               	res	B_TRGNOT,d					; reset any	trigger note
    1207.  00:4C47  DD 73 F0            	ld	(ix+TRACK_Command),e
    1208.  00:4C4A                      	
    1209.  00:4C4A  DD 77 11            	ld	(ix+TRACK_Timer),a			; set	the timer to param y
    1210.  00:4C4D  DD 7E F6            	ld	a,(ix+TRACK_Note)
    1211.  00:4C50  DD 77 10            	ld	(ix+TRACK_cmd_E),a			; store the	new note
    1212.  00:4C53  3A 28 C0            	ld	a,(replay_previous_note)
    1213.  00:4C56  DD 77 F6            	ld	(ix+TRACK_Note),a				; restore the old	note
    1214.  00:4C59  C3 5B 4A            	jp	_rdc	
    1215.  00:4C5C                      
    1216.  00:4C5C                      
    1217.  00:4C5C                      decode_cmd11_command_end:
    1218.  00:4C5C                      	; in:	[A] contains the paramvalue
    1219.  00:4C5C                      	; 
    1220.  00:4C5C                      	; ! do not change	[BC] this is the data pointer
    1221.  00:4C5C                      	;--------------------------------------------------
    1222.  00:4C5C  CB 9A               	res	B_TRGCMD,d
    1223.  00:4C5E  C3 5C 4A            	jp	_rdc_noinc
    1224.  00:4C61                      	
    1225.  00:4C61                      
    1226.  00:4C61                      decode_cmd12_drum:
    1227.  00:4C61  A7                  	and 	a		; drum reset not supported
    1228.  00:4C62  28 1F               	jr 	z,0f
    1229.  00:4C64                      	
    1230.  00:4C64                      	; Get the base addres of the drum list
    1231.  00:4C64  87                  	add 	a 
    1232.  00:4C65  2A 09 C0            	ld	hl,(replay_drumbase)
    1233.  00:4C68  85                  	add	a,l 
    1234.  00:4C69  6F                  	ld	l,a
    1235.  00:4C6A  D2 6E 4C            	jp	nc,99f
    1236.  00:4C6D  24                  	inc	h 
    1237.  00:4C6E                      99:
    1238.  00:4C6E  6F                  	ld	l,a
    1239.  00:4C6F                      	; Get the start of the drum macro
    1240.  00:4C6F  7E                  	ld	a,(hl)
    1241.  00:4C70  23                  	inc	hl
    1242.  00:4C71  66                  	ld	h,(hl)
    1243.  00:4C72  6F                  	ld	l,a
    1244.  00:4C73                      	
    1245.  00:4C73                      	; Store the length
    1246.  00:4C73  7E                  	ld	a,(hl)
    1247.  00:4C74  32 B9 C1            	ld	(FM_DRUM_LEN),a
    1248.  00:4C77  23                  	inc	hl
    1249.  00:4C78                      	; Store the address
    1250.  00:4C78  7D                  	ld	a,l
    1251.  00:4C79  32 BA C1            	ld 	(FM_DRUM_MACRO),a
    1252.  00:4C7C  7C                  	ld	a,h
    1253.  00:4C7D  32 BB C1            	ld	(FM_DRUM_MACRO+1),a
    1254.  00:4C80  C3 5B 4A            	jp	_rdc		
    1255.  00:4C83                      0:
    1256.  00:4C83  0B                  	dec	bc
    1257.  00:4C84  C3 5B 4A            	jp	_rdc		
    1258.  00:4C87                      	
    1259.  00:4C87                      
    1260.  00:4C87                      
    1261.  00:4C87                      decode_cmd13_arp_speed:
    1262.  00:4C87  32 24 C0            	ld	(replay_arp_speed),a		; store the halve not to add
    1263.  00:4C8A  C3 5B 4A            	jp	_rdc	
    1264.  00:4C8D                      	
    1265.  00:4C8D                      	
    1266.  00:4C8D                      
    1267.  00:4C8D                      decode_cmd14_fine_up:
    1268.  00:4C8D  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    1269.  00:4C90  AF                  	xor	a
    1270.  00:4C91  DD 77 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),a
    1271.  00:4C94  C3 5B 4A            	jp	_rdc
    1272.  00:4C97                      	
    1273.  00:4C97                      decode_cmd15_fine_down:
    1274.  00:4C97  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    1275.  00:4C9A  3E FF               	ld	a,$ff
    1276.  00:4C9C  DD 77 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),a
    1277.  00:4C9F  C3 5B 4A            	jp	_rdc
    1278.  00:4CA2                      
    1279.  00:4CA2                      
    1280.  00:4CA2                      decode_cmd16_notelink:
    1281.  00:4CA2  CB 82               	res	B_TRGNOT,d
    1282.  00:4CA4  CB E2               	set 	B_KEYON,d
    1283.  00:4CA6  C3 5C 4A            	jp	_rdc_noinc	
    1284.  00:4CA9                      
    1285.  00:4CA9                      decode_cmd17_track_detune:
    1286.  00:4CA9                      	; This command sets the	detune of the track.
    1287.  00:4CA9  5F                  	ld	e,a
    1288.  00:4CAA  E6 07               	and	0x07		; low	4 bits is value
    1289.  00:4CAC  CB 5B               	bit	3,e		; Center around 8
    1290.  00:4CAE  CA BE 4C            	jp	z,.pos
    1291.  00:4CB1  3C                  	inc	a
    1292.  00:4CB2  ED 44               	neg			; make correct value
    1293.  00:4CB4  DD 77 04            	ld	(ix+TRACK_cmd_detune),a
    1294.  00:4CB7  DD 36 05 FF         	ld	(ix+TRACK_cmd_detune+1),0xff
    1295.  00:4CBB                      
    1296.  00:4CBB  C3 5B 4A            	jp	_rdc	
    1297.  00:4CBE                      
    1298.  00:4CBE                      .pos:
    1299.  00:4CBE  DD 77 04            	ld	(ix+TRACK_cmd_detune),a
    1300.  00:4CC1  DD 36 05 00         	ld	(ix+TRACK_cmd_detune+1),0x00	
    1301.  00:4CC5                      
    1302.  00:4CC5  C3 5B 4A            	jp	_rdc	
    1303.  00:4CC8                      
    1304.  00:4CC8                      
    1305.  00:4CC8                      
    1306.  00:4CC8                      decode_cmd18_trigger:
    1307.  00:4CC8  32 02 C0            	ld	(replay_trigger),a
    1308.  00:4CCB  C3 5B 4A            	jp	_rdc		
    1309.  00:4CCE                      
    1310.  00:4CCE                      
    1311.  00:4CCE                      decode_cmd19_speed:
    1312.  00:4CCE  32 1F C0            	ld	(replay_speed),a
    1313.  00:4CD1                      	;--- Reset Timer == 0
    1314.  00:4CD1  CB 3F               	srl	a				; divide speed with 2
    1315.  00:4CD3  5F                  	ld	e,a
    1316.  00:4CD4  3E 00               	ld	a,0				
    1317.  00:4CD6  8F                  	adc	a				; store carry of shift as subtimer
    1318.  00:4CD7  32 20 C0            	ld	(replay_speed_subtimer),a
    1319.  00:4CDA  83                  	add	a,e
    1320.  00:4CDB  32 21 C0            	ld	(replay_speed_timer),a
    1321.  00:4CDE                      
    1322.  00:4CDE  C3 5B 4A            	jp	_rdc	
    1323.  00:4CE1                      	
    1324.  00:4CE1                      decode_cmd20_tone_panning:
    1325.  00:4CE1  C3 5B 4A            	jp	_rdc	
    1326.  00:4CE4                      
    1327.  00:4CE4                      decode_cmd21_noise_panning:
    1328.  00:4CE4  C3 5B 4A            	jp	_rdc
    1329.  00:4CE7                      
    1330.  00:4CE7                      decode_cmd22_chan_setup:
    1331.  00:4CE7  C3 5B 4A            	jp	_rdc
    1332.  00:4CEA                      
    1333.  00:4CEA                      
    1334.  00:4CEA                      
    1335.  00:4CEA                      ;===========================================================
    1336.  00:4CEA                      ; ---process_data_chan
    1337.  00:4CEA                      ; Process the cmd/instrument/note and vol data 
    1338.  00:4CEA                      ; 
    1339.  00:4CEA                      ; in HL is the current tone freq
    1340.  00:4CEA                      ; in D is TRACK_FLAGS  
    1341.  00:4CEA                      ;===========================================================
    1342.  00:4CEA                      process_data_chan:
    1343.  00:4CEA  E5                  	push	hl
    1344.  00:4CEB                      
    1345.  00:4CEB                      	;-- set the	mixer	right
    1346.  00:4CEB  21 BE C1            	ld	hl,FM_regMIXER   
    1347.  00:4CEE  CB 0E               	rrc	(hl)
    1348.  00:4CF0                      
    1349.  00:4CF0                      
    1350.  00:4CF0                      	;===== 
    1351.  00:4CF0                      	; Speed equalization check
    1352.  00:4CF0                      	;=====
    1353.  00:4CF0                      ;	ld	a,(equalization_flag)			; check for speed equalization
    1354.  00:4CF0                      ;	and	a
    1355.  00:4CF0                      ;	jp	nz,process_noNoteTrigger		; Only process instruments macro
    1356.  00:4CF0                      	
    1357.  00:4CF0                      	
    1358.  00:4CF0                      	;=====
    1359.  00:4CF0                      	; COMMAND
    1360.  00:4CF0                      	;=====
    1361.  00:4CF0  DD 36 0D 00         	ld	(ix+TRACK_cmd_NoteAdd),0			; Always reset note add
    1362.  00:4CF4                      	
    1363.  00:4CF4  CB 5A               	bit	B_TRGCMD,d	;(ix+TRACK_Flags)
    1364.  00:4CF6  CA 0B 4D            	jp	z,process_note
    1365.  00:4CF9                      
    1366.  00:4CF9  21 A8 4E            	ld	hl,PROCESS_CMDLIST
    1367.  00:4CFC  DD 7E F0            	ld	a,(ix+TRACK_Command)
    1368.  00:4CFF                      
    1369.  00:4CFF  87                  	add	a
    1370.  00:4D00  85                  	add	a,l
    1371.  00:4D01  6F                  	ld	l,a
    1372.  00:4D02  D2 06 4D            	jp	nc,.skip
    1373.  00:4D05  24                  	inc	h
    1374.  00:4D06                      .skip:
    1375.  00:4D06  7E                  	ld	a,(hl)
    1376.  00:4D07  23                  	inc	hl
    1377.  00:4D08  66                  	ld	h,(hl)
    1378.  00:4D09  6F                  	ld	l,a	
    1379.  00:4D0A  E9                  	jp	(hl)
    1380.  00:4D0B                      
    1381.  00:4D0B                      
    1382.  00:4D0B                      process_commandEND:
    1383.  00:4D0B                      process_note:
    1384.  00:4D0B                      
    1385.  00:4D0B                      	;=====
    1386.  00:4D0B                      	; NOTE
    1387.  00:4D0B                      	;=====
    1388.  00:4D0B                      	;--- Check if we need to trigger a new note
    1389.  00:4D0B  CB 42               	bit	B_TRGNOT,d	;(ix+TRACK_Flags)
    1390.  00:4D0D  CA 34 4D            	jp	z,process_noNoteTrigger
    1391.  00:4D10                      	
    1392.  00:4D10                      
    1393.  00:4D10                      process_triggerNote:	
    1394.  00:4D10                      	;--- get new Note
    1395.  00:4D10  CB 82               	res	B_TRGNOT,d		;(ix+TRACK_Flags)		; reset trigger note flag
    1396.  00:4D12  CB CA               	set	B_ACTNOT,d		;(ix+TRACK_Flags)		; set	note active	flag
    1397.  00:4D14                      
    1398.  00:4D14  DD 6E F3            	ld	l,(ix+TRACK_MacroStart)
    1399.  00:4D17  DD 66 F4            	ld	h,(ix+TRACK_MacroStart+1)
    1400.  00:4D1A                      	;--- Store the macro start	
    1401.  00:4D1A  DD 75 F1            	ld	(ix+TRACK_MacroPointer),l
    1402.  00:4D1D  DD 74 F2            	ld	(ix+TRACK_MacroPointer+1),h	
    1403.  00:4D20                      
    1404.  00:4D20  21 00 00            	ld	hl,0
    1405.  00:4D23  ED 73 00 C0         	ld	(_SP_Storage),sp
    1406.  00:4D27  DD F9               	ld	sp,ix
    1407.  00:4D29  F1                  	pop	af
    1408.  00:4D2A  F1                  	pop	af
    1409.  00:4D2B  E5                  	push	hl
    1410.  00:4D2C  E5                  	push	hl		
    1411.  00:4D2D  E5                  	push	hl
    1412.  00:4D2E  E5                  	push	hl
    1413.  00:4D2F  E5                  	push	hl
    1414.  00:4D30  ED 7B 00 C0         	ld	sp,(_SP_Storage)
    1415.  00:4D34                      
    1416.  00:4D34                      ;	ld	(ix+TRACK_ToneAdd),0
    1417.  00:4D34                      ;	ld	(ix+TRACK_ToneAdd+1),0
    1418.  00:4D34                      ;	ld	(ix+TRACK_VolumeAdd),0	
    1419.  00:4D34                      ;	ld	(ix+TRACK_cmd_ToneAdd),0
    1420.  00:4D34                      ;	ld	(ix+TRACK_cmd_ToneAdd+1),0
    1421.  00:4D34                      ;	ld	(ix+TRACK_cmd_VolumeAdd),0
    1422.  00:4D34                      ;	ld	(ix+TRACK_Noise),0
    1423.  00:4D34                      ;	ld	(ix+TRACK_cmd_ToneSlideAdd),0
    1424.  00:4D34                      ;	ld	(ix+TRACK_cmd_ToneSlideAdd+1),0
    1425.  00:4D34                      
    1426.  00:4D34                      process_noNoteTrigger:
    1427.  00:4D34                      	;Get note freq
    1428.  00:4D34                      ;	ld	a,(ix+TRACK_Note)
    1429.  00:4D34                      ;	add	a,(ix+TRACK_cmd_NoteAdd)
    1430.  00:4D34                      ;	add	a
    1431.  00:4D34                      ;	ex	af,af'			;'store the	note offset
    1432.  00:4D34                      
    1433.  00:4D34                      
    1434.  00:4D34                      	;==============
    1435.  00:4D34                      	; Macro instrument
    1436.  00:4D34                      	;==============
    1437.  00:4D34  CB 4A               	bit	B_ACTNOT,d			
    1438.  00:4D36  CA 95 4E            	jp	z,process_noNoteActive
    1439.  00:4D39                      	
    1440.  00:4D39                      	;--- Get the macro len and loop
    1441.  00:4D39  DD 6E F1            	ld	l,(ix+TRACK_MacroPointer)
    1442.  00:4D3C  DD 66 F2            	ld	h,(ix+TRACK_MacroPointer+1)
    1443.  00:4D3F                      
    1444.  00:4D3F  5E                  	ld	e,(hl)				; info byte
    1445.  00:4D40  23                  	inc	hl
    1446.  00:4D41  CB 5B               	bit	3,e					; Volume change
    1447.  00:4D43  C2 4C 4D            	jp	nz,_vol_change
    1448.  00:4D46  DD 7E FD            	ld	a,(ix+TRACK_VolumeAdd)
    1449.  00:4D49  C3 69 4D            	jp	_noVolumeChange
    1450.  00:4D4C                      	
    1451.  00:4D4C                      	;--- Volume change
    1452.  00:4D4C                      _vol_change:
    1453.  00:4D4C  7E                  	ld	a,(hl)
    1454.  00:4D4D  23                  	inc	hl
    1455.  00:4D4E                      	
    1456.  00:4D4E  CB 53               	bit	2,e
    1457.  00:4D50  CA 66 4D            	jp	z,_vol_base
    1458.  00:4D53                      _vol_rel:
    1459.  00:4D53  DD 86 FD            	add	 (ix+TRACK_VolumeAdd)
    1460.  00:4D56  FE 10               	cp	16
    1461.  00:4D58  DA 66 4D            	jp	c,_vol_base
    1462.  00:4D5B  FE 80               	cp	128
    1463.  00:4D5D  D2 65 4D            	jp	nc,.skip
    1464.  00:4D60  3E 0F               	ld	a,$0f
    1465.  00:4D62  C3 66 4D            	jp	_vol_base
    1466.  00:4D65                      .skip:	
    1467.  00:4D65  AF                  	xor	a
    1468.  00:4D66                      	
    1469.  00:4D66                      _vol_base:
    1470.  00:4D66  DD 77 FD            	ld	(ix+TRACK_VolumeAdd),a
    1471.  00:4D69                      
    1472.  00:4D69                      	;---- envelope check
    1473.  00:4D69                      	; is done here to be able to continue
    1474.  00:4D69                      	; macro volume values.
    1475.  00:4D69                      ;	bit	B_TRGENV,d		;'(IX+TRACK_Flags)
    1476.  00:4D69                      ;	jp	z,_noEnv		; if not set then normal volume calculation
    1477.  00:4D69                      ;	ld	a,16			; set volume to 16 == envelope
    1478.  00:4D69                      ;	ld	(FM_regVOLF),a
    1479.  00:4D69                      ;	jp	_noVolume	
    1480.  00:4D69                      	
    1481.  00:4D69                      _noVolumeChange:
    1482.  00:4D69  DD B6 F7            	or	(ix+TRACK_Volume)
    1483.  00:4D6C  4F                  	ld	c,a			; store volume add
    1484.  00:4D6D                      
    1485.  00:4D6D  DD 7E FF            	ld 	a,(ix+TRACK_cmd_VolumeAdd)
    1486.  00:4D70                      ;	rla				; shift to detect shift
    1487.  00:4D70                      ;	jp 	c,.sub_Vadd		
    1488.  00:4D70                      ;.add_Vadd:  
    1489.  00:4D70                      ;	add	a,c
    1490.  00:4D70                      ;	jp	nc,_Vadd
    1491.  00:4D70                      ;	ld	a,c
    1492.  00:4D70                      ;	or	0xf0
    1493.  00:4D70                      ;	jp	_Vadd	
    1494.  00:4D70                      ;.sub_Vadd:	
    1495.  00:4D70  47                  	ld	b,a
    1496.  00:4D71                      ;	xor	a
    1497.  00:4D71                      ;	sub 	b
    1498.  00:4D71                      ;	ld	b,a
    1499.  00:4D71  79                  	ld	a,c
    1500.  00:4D72  90                  	sub	a,b
    1501.  00:4D73  D2 79 4D            	jp 	nc,.skip2
    1502.  00:4D76  79                  	ld	a,c
    1503.  00:4D77  E6 0F                	and	0x0f
    1504.  00:4D79                      .skip2:
    1505.  00:4D79                      
    1506.  00:4D79                      	
    1507.  00:4D79                      	;-- next is _Vadd
    1508.  00:4D79                      _Vadd:
    1509.  00:4D79                      	;--- apply main volume balance
    1510.  00:4D79  ED 4B 29 C0         	ld	bc,(replay_mainvol)
    1511.  00:4D7D  81                  	add	a,c
    1512.  00:4D7E  4F                  	ld	c,a
    1513.  00:4D7F  D2 83 4D            	jp	nc,.skip
    1514.  00:4D82  04                  	inc	b
    1515.  00:4D83                      .skip:
    1516.  00:4D83  0A                  	ld	a,(bc)	
    1517.  00:4D84                      	; Test which CHIP.
    1518.  00:4D84  CB 7A               	bit	B_PSGFM,d		;(ix+TRACK_Flags)
    1519.  00:4D86  C2 8D 4D            	jp	nz,.skip2
    1520.  00:4D89  1F                  	rra
    1521.  00:4D8A  1F                  	rra
    1522.  00:4D8B  1F                  	rra
    1523.  00:4D8C  1F                  	rra
    1524.  00:4D8D                      .skip2:
    1525.  00:4D8D  E6 0F               	and	0x0f
    1526.  00:4D8F  32 9A C1            	ld	(FM_regVOLF),a
    1527.  00:4D92                      
    1528.  00:4D92                      _noVolume:
    1529.  00:4D92                      	;-------------------------------
    1530.  00:4D92                      	;
    1531.  00:4D92                      	; NOISE
    1532.  00:4D92                      	;
    1533.  00:4D92                      	;-------------------------------
    1534.  00:4D92  CB 7B               	bit 	7,e			; test if noise value
    1535.  00:4D94  CA A1 4D            	jp	z,_noNoise
    1536.  00:4D97                      
    1537.  00:4D97                      	;--- prevent FM and noise
    1538.  00:4D97  7E                  	ld	a,(hl)		; get the value	
    1539.  00:4D98  23                  	inc	hl	
    1540.  00:4D99                      	
    1541.  00:4D99  CB 7A               	bit	B_PSGFM,d		;(ix+TRACK_Flags)
    1542.  00:4D9B  C2 A1 4D            	jp	nz,_noNoise		; Noise and Link not at the same time
    1543.  00:4D9E                      	
    1544.  00:4D9E                      	;--- Set the mixer for noise
    1545.  00:4D9E                      ;	ld	a,(FM_regMIXER)
    1546.  00:4D9E                      ;	or	128
    1547.  00:4D9E                      ;	ld	(FM_regMIXER),a
    1548.  00:4D9E                      
    1549.  00:4D9E                      ;	bit	5,e
    1550.  00:4D9E                      ;	jp	z,_noLink
    1551.  00:4D9E                      ;	ld	a,(hl)	; get the deviation	
    1552.  00:4D9E                      ;	inc	hl
    1553.  00:4D9E                      ;	bit	6,e
    1554.  00:4D9E                      ;	jp	z,.skip
    1555.  00:4D9E                      ;	add	(ix+TRACK_Noise)
    1556.  00:4D9E                      ;.skip:	
    1557.  00:4D9E  32 70 C1            	ld	(PSG_regNOISE),a
    1558.  00:4DA1                      	
    1559.  00:4DA1                      	
    1560.  00:4DA1                      _noNoise:
    1561.  00:4DA1                      	;-------------------------------
    1562.  00:4DA1                      	;
    1563.  00:4DA1                      	; NOISE volume
    1564.  00:4DA1                      	;
    1565.  00:4DA1                      	;-------------------------------
    1566.  00:4DA1  CB 73               	bit 	6,e			; test if noise volume
    1567.  00:4DA3  CA C1 4D            	jp	z,_noNoiseVol
    1568.  00:4DA6                      	
    1569.  00:4DA6                      	;--- prevent FM and noise
    1570.  00:4DA6  7E                  	ld	a,(hl)		; get the volume	
    1571.  00:4DA7  23                  	inc	hl
    1572.  00:4DA8                      	
    1573.  00:4DA8  CB 7A               	bit	B_PSGFM,d		;(ix+TRACK_Flags)
    1574.  00:4DAA  C2 CF 4D            	jp	nz,_noLink		; Noise and Link not at the same time
    1575.  00:4DAD                      	
    1576.  00:4DAD  DD B6 F7            	or	(ix+TRACK_Volume)
    1577.  00:4DB0                      	;--- apply main volume balance
    1578.  00:4DB0  ED 4B 29 C0         	ld	bc,(replay_mainvol)
    1579.  00:4DB4  81                  	add	a,c
    1580.  00:4DB5  4F                  	ld	c,a
    1581.  00:4DB6  D2 BA 4D            	jp	nc,.skip
    1582.  00:4DB9  04                  	inc	b
    1583.  00:4DBA                      .skip:
    1584.  00:4DBA  0A                  	ld	a,(bc)
    1585.  00:4DBB  32 75 C1            	ld	(PSG_regVOLN),a
    1586.  00:4DBE  C3 CF 4D            	jp	_noLink
    1587.  00:4DC1                      
    1588.  00:4DC1                      
    1589.  00:4DC1                      _noNoiseVol
    1590.  00:4DC1                      	;-------------------------------
    1591.  00:4DC1                      	;
    1592.  00:4DC1                      	; VoiceLink
    1593.  00:4DC1                      	;
    1594.  00:4DC1                      	;-------------------------------
    1595.  00:4DC1  CB 4B               	bit 	1,e
    1596.  00:4DC3  CA CF 4D            	jp	z,_noLink
    1597.  00:4DC6                      
    1598.  00:4DC6  7E                  	ld	a,(hl)					; get the new hw voice	
    1599.  00:4DC7  23                  	inc	hl
    1600.  00:4DC8                      	
    1601.  00:4DC8  DD CB F9 F6         	set 	B_TRGVOI,(ix+TRACK_Flags)
    1602.  00:4DCC  DD 77 F8            	ld	(ix+TRACK_Voice),a			; set new voice to be loaded
    1603.  00:4DCF                      
    1604.  00:4DCF                      
    1605.  00:4DCF                      
    1606.  00:4DCF                      _noLink
    1607.  00:4DCF                      	;-------------------------------
    1608.  00:4DCF                      	;
    1609.  00:4DCF                      	; TONE 
    1610.  00:4DCF                      	;
    1611.  00:4DCF                      	;-------------------------------
    1612.  00:4DCF  DD 46 FB            	ld	b,(ix+TRACK_ToneAdd)	; get	the current	deviation	
    1613.  00:4DD2  DD 4E FC            	ld	c,(ix+TRACK_ToneAdd+1)
    1614.  00:4DD5                      
    1615.  00:4DD5  CB 63               	bit 	4,e
    1616.  00:4DD7  CA EC 4D            	jp	z,process_noToneAdd
    1617.  00:4DDA                      	
    1618.  00:4DDA  7E                  	ld	a,(hl)
    1619.  00:4DDB  23                  	inc	hl
    1620.  00:4DDC  81                  	add	c
    1621.  00:4DDD  4F                  	ld	c,a
    1622.  00:4DDE  DD 71 FC            	ld	(ix+TRACK_ToneAdd+1),c
    1623.  00:4DE1  D2 E5 4D            	jp	nc,.skip
    1624.  00:4DE4  04                  	inc	b
    1625.  00:4DE5                      .skip:
    1626.  00:4DE5  7E                  	ld	a,(hl)
    1627.  00:4DE6  23                  	inc	hl
    1628.  00:4DE7  80                  	add	b
    1629.  00:4DE8  47                  	ld	b,a
    1630.  00:4DE9  DD 70 FB            	ld	(ix+TRACK_ToneAdd),b
    1631.  00:4DEC                      	
    1632.  00:4DEC                      	
    1633.  00:4DEC                      process_noToneAdd:	
    1634.  00:4DEC                      	;---- check for macro end
    1635.  00:4DEC  CB 43               	bit	0,e		
    1636.  00:4DEE  CA F5 4D            	jp	z,.noend
    1637.  00:4DF1                      	
    1638.  00:4DF1  7E                  	ld	a,(hl)
    1639.  00:4DF2  23                  	inc	hl
    1640.  00:4DF3  66                  	ld	h,(hl)
    1641.  00:4DF4  6F                  	ld	l,a
    1642.  00:4DF5                      
    1643.  00:4DF5                      .noend:
    1644.  00:4DF5                      	;--- Set the mixer bit (T)
    1645.  00:4DF5  CB 6B               	bit	5,e		; do we have tone?
    1646.  00:4DF7  CA 02 4E            	jp	z,process_noToneBit
    1647.  00:4DFA                      
    1648.  00:4DFA                      	;-- enable tone output
    1649.  00:4DFA  3A BE C1            	ld	a,(FM_regMIXER)
    1650.  00:4DFD  F6 10               	or	16
    1651.  00:4DFF  32 BE C1            	ld	(FM_regMIXER),a
    1652.  00:4E02                      	
    1653.  00:4E02                      process_noToneBit:	
    1654.  00:4E02  DD 75 F1            	ld	(ix+TRACK_MacroPointer),l	;--- store pointer for next time
    1655.  00:4E05  DD 74 F2            	ld	(ix+TRACK_MacroPointer+1),h	
    1656.  00:4E08                      
    1657.  00:4E08                      	;-- Get current note
    1658.  00:4E08  DD 7E F6            	ld	a,(ix+TRACK_Note)
    1659.  00:4E0B  DD 86 0D            	add	a,(ix+TRACK_cmd_NoteAdd)
    1660.  00:4E0E  87                  	add	a
    1661.  00:4E0F                      
    1662.  00:4E0F  2A 2D C0            	ld	hl,(replay_tonetable)
    1663.  00:4E12  85                  	add	a,l
    1664.  00:4E13  6F                  	ld	l,a
    1665.  00:4E14  D2 18 4E            	jp	nc,.skip
    1666.  00:4E17  24                  	inc	h
    1667.  00:4E18                      .skip:
    1668.  00:4E18  7E                  	ld	a,(hl)	;--- Store the note tone value in hl
    1669.  00:4E19  23                  	inc	hl
    1670.  00:4E1A  66                  	ld	h,(hl)
    1671.  00:4E1B  6F                  	ld	l,a
    1672.  00:4E1C                      		
    1673.  00:4E1C  09                  	add	hl,bc		;--- Store tone deviation		
    1674.  00:4E1D                      
    1675.  00:4E1D  7A                  	ld	a,d
    1676.  00:4E1E  DD 72 F9            	ld	(ix+TRACK_Flags),d
    1677.  00:4E21                      	; set	the detune.
    1678.  00:4E21  ED 73 00 C0         	ld	(_SP_Storage),sp
    1679.  00:4E25  DD F9               	ld	sp,ix
    1680.  00:4E27  D1                  	pop	de		; cmd detune
    1681.  00:4E28  19                  	add	hl,de
    1682.  00:4E29  C1                  	pop	bc		; cmd toneadd
    1683.  00:4E2A  09                  	add	hl,bc
    1684.  00:4E2B  C1                  	pop	bc		; cmd tone slide add
    1685.  00:4E2C  09                  	add	hl,bc
    1686.  00:4E2D  ED 7B 00 C0         	ld	sp,(_SP_Storage)
    1687.  00:4E31                      
    1688.  00:4E31                      	;-----------------
    1689.  00:4E31                      	; FM Octave wrapper
    1690.  00:4E31                      	; enable slides over multiple octaves.
    1691.  00:4E31                      	; [DE] still contains tone slide add.
    1692.  00:4E31                      	;-----------------
    1693.  00:4E31  CB 7F               	bit	B_PSGFM,a			;(ix+TRACK_Flags)
    1694.  00:4E33  CA 85 4E            	jp	z,_wrap_skip		; skip wrapper for PSG
    1695.  00:4E36                      
    1696.  00:4E36  CB 44               	bit	0,h
    1697.  00:4E38  CA 62 4E            	jp	z,_wrap_lowcheck
    1698.  00:4E3B                      _wrap_highcheck:
    1699.  00:4E3B  7D                  	ld	a,l
    1700.  00:4E3C  FE 5A               	cp	$5a				; $5a is the strict limit
    1701.  00:4E3E  DA 85 4E            	jp	c,_wrap_skip		; stop if smaller	
    1702.  00:4E41                      	
    1703.  00:4E41  E5                  	push	hl
    1704.  00:4E42  D5                  	push	de
    1705.  00:4E43                      	
    1706.  00:4E43                      	;--- Set new tone value for same note 1 octave lower
    1707.  00:4E43  CB 3F               	srl	a
    1708.  00:4E45  CB 44               	bit 	0,h		; test 9th bit
    1709.  00:4E47  CA 4C 4E            	jp	z,99f
    1710.  00:4E4A  C6 80               	add	128
    1711.  00:4E4C                      99:
    1712.  00:4E4C  5F                  	ld	e,a
    1713.  00:4E4D                      ;	ld	d,0
    1714.  00:4E4D                      	;--- set octave higher
    1715.  00:4E4D  7C                  	ld	a,h
    1716.  00:4E4E  E6 FE               	and	$fe
    1717.  00:4E50  C6 02               	add	$02
    1718.  00:4E52                      ;	add	d		; merge with tone value
    1719.  00:4E52  57                  	ld	d,a
    1720.  00:4E53                      	;--- get difference between now and new
    1721.  00:4E53  EB                  	ex	de,hl
    1722.  00:4E54  AF                  	xor	a		; reset carry flag
    1723.  00:4E55  ED 52               	sbc	hl,de
    1724.  00:4E57                      	;--- add difference to current slide
    1725.  00:4E57  D1                  	pop	de		; restore slide
    1726.  00:4E58  19                  	add	hl,de
    1727.  00:4E59  DD 75 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),l
    1728.  00:4E5C  DD 74 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),h	
    1729.  00:4E5F  E1                  	pop	hl	
    1730.  00:4E60  18 23               	jr.	_wrap_skip
    1731.  00:4E62                      	
    1732.  00:4E62                      _wrap_lowcheck:
    1733.  00:4E62  7D                  	ld	a,l
    1734.  00:4E63  FE 3B               	cp	$3b		; $ad is the strict limit
    1735.  00:4E65  30 1E               	jr.	nc,_wrap_skip		; stop if smaller
    1736.  00:4E67                      
    1737.  00:4E67                      
    1738.  00:4E67  E5                  	push 	hl		; store freq
    1739.  00:4E68  D5                  	push	de		; store slide
    1740.  00:4E69                      	;--- set new tone value for same note (but octave lower)
    1741.  00:4E69  87                  	add	a,a		; multiply by 2 in de 
    1742.  00:4E6A  5F                  	ld	e,a
    1743.  00:4E6B  16 00               	ld	d,0
    1744.  00:4E6D  D2 71 4E            	jp	nc,99f
    1745.  00:4E70  14                  	inc	d	
    1746.  00:4E71                      99:
    1747.  00:4E71                      	;--- set octave higher
    1748.  00:4E71  7C                  	ld	a,h
    1749.  00:4E72  E6 FE               	and	$fe
    1750.  00:4E74  D6 02               	sub	$02
    1751.  00:4E76  82                  	add	d		; merge with tone value
    1752.  00:4E77  57                  	ld	d,a
    1753.  00:4E78                      	;--- get difference between now and new
    1754.  00:4E78  EB                  	ex	de,hl
    1755.  00:4E79  AF                  	xor	a		; reset carry flag
    1756.  00:4E7A  ED 52               	sbc	hl,de
    1757.  00:4E7C                      	;--- add difference to current slide
    1758.  00:4E7C  D1                  	pop	de		; restore slide
    1759.  00:4E7D  19                  	add	hl,de	
    1760.  00:4E7E                      	
    1761.  00:4E7E  DD 75 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),l
    1762.  00:4E81  DD 74 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),h	
    1763.  00:4E84  E1                  	pop	hl	
    1764.  00:4E85                      	
    1765.  00:4E85                      _wrap_skip:
    1766.  00:4E85                      	; replace the last pushed value on stack
    1767.  00:4E85  D1                  	pop	de
    1768.  00:4E86  EB                  	ex	de,hl
    1769.  00:4E87  73                  	ld	(hl),e
    1770.  00:4E88  23                  	inc	hl
    1771.  00:4E89  7A                  	ld	a,d	; reset key on and sustain
    1772.  00:4E8A  E6 0F               	and	$0f
    1773.  00:4E8C  57                  	ld	d,a
    1774.  00:4E8D  DD 7E F9            	ld	a,(ix+TRACK_Flags)	; Add the sustain and key bits.
    1775.  00:4E90  E6 30               	and	16+32	
    1776.  00:4E92  B2                  	or	d
    1777.  00:4E93  77                  	ld	(hl),a
    1778.  00:4E94  C9                  	ret
    1779.  00:4E95                      
    1780.  00:4E95                      	
    1781.  00:4E95                      process_noNoteActive:
    1782.  00:4E95  E1                  	pop	hl
    1783.  00:4E96                      	
    1784.  00:4E96                      	;-- for FM add key and sustain bits to tone
    1785.  00:4E96  23                  	inc	hl
    1786.  00:4E97  7A                  	ld	a,d
    1787.  00:4E98  E6 30               	and	16+32	; keep key and sustain flags
    1788.  00:4E9A  47                  	ld	b,a
    1789.  00:4E9B  7E                  	ld	a,(hl)
    1790.  00:4E9C  E6 0F               	and 	$0f
    1791.  00:4E9E  B0                  	or 	b
    1792.  00:4E9F  77                  	ld	(hl),a
    1793.  00:4EA0                      	
    1794.  00:4EA0                      	;-- Silence
    1795.  00:4EA0  AF                  	xor	a
    1796.  00:4EA1  32 9A C1            	ld	(FM_regVOLF),a
    1797.  00:4EA4  DD 72 F9            	ld	(ix+TRACK_Flags),d
    1798.  00:4EA7  C9                  	ret	
    1799.  00:4EA8                      
    1800.  00:4EA8                      PROCESS_CMDLIST:
    1801.  00:4EA8                      	; This list only contains the primary commands.
    1802.  00:4EA8  57 4F               	dw	process_cmd3_port_tone
    1803.  00:4EAA  FD 4F               	dw	process_cmd5_vibrato_port_tone
    1804.  00:4EAC  43 4F               	dw	process_cmd2_port_down		
    1805.  00:4EAE  BE 4E               	dw	process_cmd0_arpeggio			
    1806.  00:4EB0  BE 4F               	dw	process_cmd4_vibrato		
    1807.  00:4EB2  2F 4F               	dw	process_cmd1_port_up	
    1808.  00:4EB4  03 50               	dw	process_cmd6_vibrato_vol		
    1809.  00:4EB6  09 50               	dw	process_cmd7_vol_slide
    1810.  00:4EB8  98 4F               	dw	process_cmd8_tremelo
    1811.  00:4EBA  35 50               	dw	process_cmd9_note_cut		
    1812.  00:4EBC  42 50               	dw	process_cmd10_note_delay		
    1813.  00:4EBE                      
    1814.  00:4EBE                      			
    1815.  00:4EBE                      process_cmd0_arpeggio:
    1816.  00:4EBE  DD 7E 11            	ld	a,(ix+TRACK_Timer)
    1817.  00:4EC1  A7                  	and	a
    1818.  00:4EC2  CA E2 4E            	jp	z,.nextNote
    1819.  00:4EC5                      	
    1820.  00:4EC5  3D                  	dec	a
    1821.  00:4EC6  DD 77 11            	ld	(IX+TRACK_Timer),a
    1822.  00:4EC9  DD 7E 12            	ld	a,(ix+TRACK_Step)
    1823.  00:4ECC  A7                  	and	a
    1824.  00:4ECD  CA DB 4E            	jp	z,99f
    1825.  00:4ED0  DD 7E 06            	ld	a,(IX+TRACK_cmd_0)
    1826.  00:4ED3  E6 0F               	and	$0f
    1827.  00:4ED5  DD 77 0D            	ld	(ix+TRACK_cmd_NoteAdd),a	
    1828.  00:4ED8  C3 0B 4D            	jr.	process_commandEND
    1829.  00:4EDB                      99:
    1830.  00:4EDB  DD 36 0D 00         	ld	(ix+TRACK_cmd_NoteAdd),0	
    1831.  00:4EDF  C3 0B 4D            	jr.	process_commandEND
    1832.  00:4EE2                      	
    1833.  00:4EE2                      
    1834.  00:4EE2                      .nextNote:
    1835.  00:4EE2                      	; re-init the speed.
    1836.  00:4EE2  3A 24 C0            	ld	a,(replay_arp_speed)
    1837.  00:4EE5  DD 77 11            	ld	(IX+TRACK_Timer),a
    1838.  00:4EE8                      	
    1839.  00:4EE8  DD 7E 12            	ld	a,(ix+TRACK_Step)
    1840.  00:4EEB  A7                  	and	a
    1841.  00:4EEC  20 16               	jr.	nz,99f
    1842.  00:4EEE                      
    1843.  00:4EEE                      	;--- set x
    1844.  00:4EEE  DD 36 12 01         		ld	(ix+TRACK_Step),1
    1845.  00:4EF2  DD 7E 06            		ld	a,(ix+TRACK_cmd_0)
    1846.  00:4EF5  07                  		rlca
    1847.  00:4EF6  07                  		rlca
    1848.  00:4EF7  07                  		rlca
    1849.  00:4EF8  07                  		rlca		
    1850.  00:4EF9  DD 77 06            		ld	(ix+TRACK_cmd_0),a	
    1851.  00:4EFC  E6 0F               		and	$0f
    1852.  00:4EFE  DD 77 0D            		ld	(ix+TRACK_cmd_NoteAdd),a
    1853.  00:4F01  C3 0B 4D            		jr.	process_commandEND
    1854.  00:4F04                      	
    1855.  00:4F04                      99:
    1856.  00:4F04  3D                  	dec	a
    1857.  00:4F05  20 1D               	jr.	nz,99f
    1858.  00:4F07                      
    1859.  00:4F07                      	;--- set y
    1860.  00:4F07  DD 36 12 02         		ld	(ix+TRACK_Step),2
    1861.  00:4F0B  DD 7E 06            		ld	a,(ix+TRACK_cmd_0)
    1862.  00:4F0E  07                  		rlca
    1863.  00:4F0F  07                  		rlca
    1864.  00:4F10  07                  		rlca
    1865.  00:4F11  07                  		rlca		
    1866.  00:4F12  DD 77 06            		ld	(ix+TRACK_cmd_0),a			
    1867.  00:4F15  E6 0F               		and	0x0f
    1868.  00:4F17  C2 1E 4F            		jp	nz,0f
    1869.  00:4F1A                      		;--- if zero then skip this note and set step to start
    1870.  00:4F1A  DD 36 12 00         		ld	(ix+TRACK_Step),0
    1871.  00:4F1E                      0:		
    1872.  00:4F1E  DD 77 0D            		ld	(ix+TRACK_cmd_NoteAdd),a	
    1873.  00:4F21  C3 0B 4D            		jr.	process_commandEND
    1874.  00:4F24                      	
    1875.  00:4F24                      99:
    1876.  00:4F24                      	;--- set none
    1877.  00:4F24  DD 36 12 00         	ld	(ix+TRACK_Step),0
    1878.  00:4F28  DD 36 0D 00         	ld	(ix+TRACK_cmd_NoteAdd),0		
    1879.  00:4F2C  C3 0B 4D            	jr.	process_commandEND
    1880.  00:4F2F                      		
    1881.  00:4F2F                      
    1882.  00:4F2F                      	
    1883.  00:4F2F                      
    1884.  00:4F2F                      	
    1885.  00:4F2F                      process_cmd1_port_up:
    1886.  00:4F2F  DD 7E 07            	ld	a,(ix+TRACK_cmd_1)	
    1887.  00:4F32                      
    1888.  00:4F32  47                  	ld	b,a
    1889.  00:4F33  DD 7E 00            	ld	a,(ix+TRACK_cmd_ToneSlideAdd)
    1890.  00:4F36  90                  	sub	b
    1891.  00:4F37  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    1892.  00:4F3A  D2 0B 4D            	jp	nc,process_commandEND
    1893.  00:4F3D  DD 34 01            	inc	(ix+TRACK_cmd_ToneSlideAdd+1)
    1894.  00:4F40  C3 0B 4D            	jp	process_commandEND
    1895.  00:4F43                      
    1896.  00:4F43                      	
    1897.  00:4F43                      process_cmd2_port_down:	
    1898.  00:4F43  DD 7E 08            	ld	a,(ix+TRACK_cmd_2)
    1899.  00:4F46  47                  	ld	b,a
    1900.  00:4F47  DD 7E 00            	ld	a,(ix+TRACK_cmd_ToneSlideAdd)
    1901.  00:4F4A  80                  	add	b
    1902.  00:4F4B  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    1903.  00:4F4E  D2 0B 4D            	jp	nc,process_commandEND
    1904.  00:4F51  DD 35 01            	dec	(ix+TRACK_cmd_ToneSlideAdd+1)
    1905.  00:4F54  C3 0B 4D            	jp	process_commandEND
    1906.  00:4F57                      	
    1907.  00:4F57                      
    1908.  00:4F57                      process_cmd3_port_tone:
    1909.  00:4F57  DD 7E 09            	ld	a,(ix+TRACK_cmd_3)
    1910.  00:4F5A  DD 6E 00            	ld	l,(ix+TRACK_cmd_ToneSlideAdd)
    1911.  00:4F5D  DD 66 01            	ld	h,(ix+TRACK_cmd_ToneSlideAdd+1)
    1912.  00:4F60  CB 7C               	bit	7,h
    1913.  00:4F62  CA 78 4F            	jp	z,process_cmd3_sub
    1914.  00:4F65                      process_cmd3_add:
    1915.  00:4F65                      	;pos slide
    1916.  00:4F65  85                  	add	a,l
    1917.  00:4F66  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    1918.  00:4F69  D2 6D 4F            	jp	nc,.skip
    1919.  00:4F6C  24                  	inc	h					
    1920.  00:4F6D                      .skip:
    1921.  00:4F6D  CB 7C               	bit	7,h
    1922.  00:4F6F  CA 8D 4F            	jp	z,process_cmd3_stop			; delta turned pos ?
    1923.  00:4F72  DD 74 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),h
    1924.  00:4F75  C3 0B 4D            	jp	process_commandEND
    1925.  00:4F78                      process_cmd3_sub:
    1926.  00:4F78                      	;negative slide	
    1927.  00:4F78  E6 7F               	and	$7f
    1928.  00:4F7A  4F                  	ld	c,a
    1929.  00:4F7B  AF                  	xor	a
    1930.  00:4F7C  47                  	ld	b,a
    1931.  00:4F7D  ED 42               	sbc	hl,bc
    1932.  00:4F7F  CB 7C               	bit	7,h
    1933.  00:4F81  C2 8D 4F            	jp	nz,process_cmd3_stop			; delta turned neg ?
    1934.  00:4F84  DD 75 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),l
    1935.  00:4F87  DD 74 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),h
    1936.  00:4F8A  C3 0B 4D            	jp	process_commandEND
    1937.  00:4F8D                      process_cmd3_stop:	
    1938.  00:4F8D                      ;	res	B_TRGCMD,d		;(ix+TRACK_Flags)
    1939.  00:4F8D  DD 36 00 00         	ld	(ix+TRACK_cmd_ToneSlideAdd),0
    1940.  00:4F91  DD 36 01 00         	ld	(ix+TRACK_cmd_ToneSlideAdd+1),0	
    1941.  00:4F95  C3 0B 4D            	jp	process_commandEND
    1942.  00:4F98                      
    1943.  00:4F98                      
    1944.  00:4F98                      process_cmd8_tremelo:
    1945.  00:4F98                      	;=================================
    1946.  00:4F98                      	;
    1947.  00:4F98                      	; Tremelo	
    1948.  00:4F98                      	;
    1949.  00:4F98                      	;=================================	
    1950.  00:4F98  DD 6E 0A            	ld	l,(ix+TRACK_cmd_4_depth)
    1951.  00:4F9B  DD 66 0B            	ld	h,(ix+TRACK_cmd_4_depth+1)
    1952.  00:4F9E                      
    1953.  00:4F9E                      	;--- Get next step
    1954.  00:4F9E  DD 7E 12            	ld	a,(IX+TRACK_Step)
    1955.  00:4FA1  DD 86 0C            	add	(ix+TRACK_cmd_4_step)
    1956.  00:4FA4  E6 1F               	and	$1F			; max	32
    1957.  00:4FA6  DD 77 12            	ld	(ix+TRACK_Step),a
    1958.  00:4FA9                      
    1959.  00:4FA9  85                  	add	a,l
    1960.  00:4FAA  6F                  	ld	l,a
    1961.  00:4FAB  D2 AF 4F            	jp	nc,99f
    1962.  00:4FAE  24                  	inc	h
    1963.  00:4FAF                      99:
    1964.  00:4FAF  7E                  	ld	a,(hl)
    1965.  00:4FB0  CB 27               	sla	a
    1966.  00:4FB2  CB 27               	sla	a	
    1967.  00:4FB4  CB 27               	sla	a	
    1968.  00:4FB6  CB 27               	sla	a
    1969.  00:4FB8  DD 77 FF            	ld	(ix+TRACK_cmd_VolumeAdd),a
    1970.  00:4FBB  C3 0B 4D            	jp	process_commandEND	
    1971.  00:4FBE                      
    1972.  00:4FBE                      
    1973.  00:4FBE                      	;=================================
    1974.  00:4FBE                      	;
    1975.  00:4FBE                      	; Vibrato	
    1976.  00:4FBE                      	;
    1977.  00:4FBE                      	;=================================
    1978.  00:4FBE                      process_cmd4_vibrato:
    1979.  00:4FBE  DD 6E 0A            	ld	l,(ix+TRACK_cmd_4_depth)
    1980.  00:4FC1  DD 66 0B            	ld	h,(ix+TRACK_cmd_4_depth+1)
    1981.  00:4FC4                      
    1982.  00:4FC4                      	;--- Get next step
    1983.  00:4FC4  DD 7E 12            	ld	a,(IX+TRACK_Step)
    1984.  00:4FC7  DD 86 0C            	add	(ix+TRACK_cmd_4_step)
    1985.  00:4FCA  E6 3F               	and	$3F			; max	64
    1986.  00:4FCC  DD 77 12            	ld	(ix+TRACK_Step),a
    1987.  00:4FCF                      	
    1988.  00:4FCF  CB 6F               	bit	5,a			; step 32-63 the neg	
    1989.  00:4FD1  CA EC 4F            	jp	z,.pos	
    1990.  00:4FD4                      	
    1991.  00:4FD4                      .neg:
    1992.  00:4FD4  E6 1F               	and	$1f	; make it 32 steps again
    1993.  00:4FD6  85                  	add	a,l
    1994.  00:4FD7  6F                  	ld	l,a
    1995.  00:4FD8  D2 DC 4F            	jp	nc,99f
    1996.  00:4FDB  24                  	inc	h
    1997.  00:4FDC                      99:
    1998.  00:4FDC  7E                  	ld	a,(hl)
    1999.  00:4FDD  ED 44               	neg
    2000.  00:4FDF  CA F3 4F            	jp	z,.zero			; $ff00 gives strange result ;)	
    2001.  00:4FE2  DD 77 02            	ld	(ix+TRACK_cmd_ToneAdd),a
    2002.  00:4FE5  DD 36 03 FF         	ld	(ix+TRACK_cmd_ToneAdd+1),0xff
    2003.  00:4FE9  C3 0B 4D            	jp	process_commandEND	
    2004.  00:4FEC                      
    2005.  00:4FEC                      .pos:
    2006.  00:4FEC  85                  	add	a,l
    2007.  00:4FED  6F                  	ld	l,a
    2008.  00:4FEE  D2 F2 4F            	jp	nc,99f
    2009.  00:4FF1  24                  	inc	h
    2010.  00:4FF2                      99:
    2011.  00:4FF2  7E                  	ld	a,(hl)
    2012.  00:4FF3                      .zero:	
    2013.  00:4FF3  DD 77 02            	ld	(ix+TRACK_cmd_ToneAdd),a
    2014.  00:4FF6  DD 36 03 00         	ld	(ix+TRACK_cmd_ToneAdd+1),0
    2015.  00:4FFA  C3 0B 4D            	jp	process_commandEND	
    2016.  00:4FFD                      
    2017.  00:4FFD                      
    2018.  00:4FFD                      ;	ld	hl,(replay_vib_table)
    2019.  00:4FFD                      ;	;--- Get next step
    2020.  00:4FFD                      ;	ld	a,(IX+TRACK_Step)
    2021.  00:4FFD                      ;	add	(ix+TRACK_cmd_4_step)
    2022.  00:4FFD                      ;	and	$3F			; max	64
    2023.  00:4FFD                      ;	ld	(ix+TRACK_Step),a
    2024.  00:4FFD                      ;	
    2025.  00:4FFD                      ;	bit	5,a			; step 32-63 the neg	
    2026.  00:4FFD                      ;	jp	z,process_cmd4pos
    2027.  00:4FFD                      ;
    2028.  00:4FFD                      ;; neg	
    2029.  00:4FFD                      ;	and	$1f
    2030.  00:4FFD                      ;	add	a,l
    2031.  00:4FFD                      ;	ld	l,a
    2032.  00:4FFD                      ;	jp	nc,.skip
    2033.  00:4FFD                      ;	inc	h
    2034.  00:4FFD                      ;.skip:
    2035.  00:4FFD                      ;	ld	a,(hl)
    2036.  00:4FFD                      ;	;apply depth
    2037.  00:4FFD                      ;	ld	b,(ix+TRACK_cmd_4_depth)
    2038.  00:4FFD                      ;.loop:
    2039.  00:4FFD                      ;	srl	a
    2040.  00:4FFD                      ;	djnz	.loop
    2041.  00:4FFD                      ;;	and	$0f
    2042.  00:4FFD                      ;
    2043.  00:4FFD                      ;	neg
    2044.  00:4FFD                      ;	jp	z,process_cmd4_zero			; $ff00 gives strange result ;)	
    2045.  00:4FFD                      ;	ld	(ix+TRACK_cmd_ToneAdd),a
    2046.  00:4FFD                      ;	ld	(ix+TRACK_cmd_ToneAdd+1),0xff
    2047.  00:4FFD                      ;	jp	process_commandEND
    2048.  00:4FFD                      ;
    2049.  00:4FFD                      ;process_cmd4pos:	
    2050.  00:4FFD                      ;;	and	$1f
    2051.  00:4FFD                      ;	add	a,l
    2052.  00:4FFD                      ;	ld	l,a
    2053.  00:4FFD                      ;	jp	nc,.skip
    2054.  00:4FFD                      ;	inc	h
    2055.  00:4FFD                      ;.skip:
    2056.  00:4FFD                      ;	ld	a,(hl)
    2057.  00:4FFD                      ;	;apply depth
    2058.  00:4FFD                      ;	ld	b,(ix+TRACK_cmd_4_depth)
    2059.  00:4FFD                      ;.loop:
    2060.  00:4FFD                      ;	srl	a
    2061.  00:4FFD                      ;	djnz	.loop
    2062.  00:4FFD                      ;process_cmd4_zero:
    2063.  00:4FFD                      ;	ld	(ix+TRACK_cmd_ToneAdd),a
    2064.  00:4FFD                      ;	ld	(ix+TRACK_cmd_ToneAdd+1),0
    2065.  00:4FFD                      ;	jp	process_commandEND
    2066.  00:4FFD                      		
    2067.  00:4FFD                      	
    2068.  00:4FFD                      
    2069.  00:4FFD                      process_cmd5_vibrato_port_tone:
    2070.  00:4FFD  CD 0F 50            	call	process_cmdasub
    2071.  00:5000  C3 57 4F            	jp	process_cmd3_port_tone
    2072.  00:5003                      	
    2073.  00:5003                      process_cmd6_vibrato_vol:
    2074.  00:5003  CD 0F 50            	call	process_cmdasub
    2075.  00:5006  C3 BE 4F            	jp	process_cmd4_vibrato	
    2076.  00:5009                      
    2077.  00:5009                      process_cmd7_vol_slide:
    2078.  00:5009  CD 0F 50            	call	process_cmdasub
    2079.  00:500C  C3 0B 4D            	jp	process_commandEND
    2080.  00:500F                      
    2081.  00:500F                      
    2082.  00:500F                      process_cmdasub:
    2083.  00:500F  DD 35 11            	dec	(ix+TRACK_Timer)
    2084.  00:5012  C0                  	ret	nz
    2085.  00:5013                      		
    2086.  00:5013                      	; vol	slide
    2087.  00:5013  DD 7E 0E            	ld	a,(ix+TRACK_cmd_A)
    2088.  00:5016  4F                  	ld	c,a
    2089.  00:5017  E6 7F               	and	$7f
    2090.  00:5019  DD 77 11            	ld	(ix+TRACK_Timer),a
    2091.  00:501C                      
    2092.  00:501C  DD 7E F7            	ld	a,(ix+TRACK_Volume)
    2093.  00:501F  CB 79               	bit	7,c
    2094.  00:5021  CA 2C 50            	jp	z,process_cmda_inc
    2095.  00:5024                      process_cmda_dec:
    2096.  00:5024  A7                  	and	a
    2097.  00:5025  C8                  	ret	z
    2098.  00:5026  D6 10               	sub	$10
    2099.  00:5028  DD 77 F7            	ld	(ix+TRACK_Volume),a
    2100.  00:502B  C9                  	ret
    2101.  00:502C                      	
    2102.  00:502C                      process_cmda_inc:
    2103.  00:502C  FE F0               	cp	$f0
    2104.  00:502E  D0                  	ret	nc
    2105.  00:502F  C6 10               	add	$10	
    2106.  00:5031  DD 77 F7            	ld	(ix+TRACK_Volume),a
    2107.  00:5034  C9                  	ret
    2108.  00:5035                      
    2109.  00:5035                      
    2110.  00:5035                      
    2111.  00:5035                      process_cmd9_note_cut:
    2112.  00:5035  DD 35 11            	dec	(ix+TRACK_Timer)
    2113.  00:5038  C2 0B 4D            	jp	nz,process_commandEND
    2114.  00:503B                      	
    2115.  00:503B                      	; stop note
    2116.  00:503B  CB 9A               	res	B_TRGCMD,d	; set	note bit to	0
    2117.  00:503D  CB 8A               	res	B_ACTNOT,d
    2118.  00:503F  C3 0B 4D            	jp	process_commandEND		
    2119.  00:5042                      	
    2120.  00:5042                      process_cmd10_note_delay:
    2121.  00:5042                      	; note delay
    2122.  00:5042  DD 35 11            	dec	(ix+TRACK_Timer)
    2123.  00:5045  C2 0B 4D            	jp	nz,process_commandEND	; no delay yet
    2124.  00:5048                      
    2125.  00:5048                      	; trigger note
    2126.  00:5048  DD 7E 10            	ld	a,(ix+TRACK_cmd_E)		
    2127.  00:504B  DD 77 F6            	ld	(ix+TRACK_Note),a		; set	the note val
    2128.  00:504E  CB C2               	set	B_TRGNOT,d	;(ix+TRACK_Flags)		; set	trigger note flag
    2129.  00:5050  CB 9A               	res	B_TRGCMD,d	;(ix+TRACK_Flags)		; reset trigger cmd flag
    2130.  00:5052                      	
    2131.  00:5052  C3 0B 4D            	jp	process_commandEND	
    2132.  00:5055                      
    2133.  00:5055                      
    2134.  00:5055                      
    2135.  00:5055                      ;===========================================================
    2136.  00:5055                      ; ---replay_route
    2137.  00:5055                      ; Output the data	to the CHIP	registers
    2138.  00:5055                      ; 
    2139.  00:5055                      ; 
    2140.  00:5055                      ;===========================================================
    2141.  00:5055                      replay_route:
    2142.  00:5055                      ;---------------
    2143.  00:5055                      ; P S	G 
    2144.  00:5055                      ;---------------
    2145.  00:5055                      route_SN:
    2146.  00:5055                      ;	ld	a,(_CONFIG_PSGPORT)
    2147.  00:5055  0E 3F               	ld	c,$3f
    2148.  00:5057                      99:	
    2149.  00:5057                      	; vol chan 1
    2150.  00:5057  3A 72 C1            	ld	a,(PSG_regVOLA)
    2151.  00:505A  3C                  	inc	a
    2152.  00:505B  ED 44               	neg
    2153.  00:505D  E6 0F               	and	$0f
    2154.  00:505F  F6 90               	or	10010000b
    2155.  00:5061  ED 79               	out	(c),a	
    2156.  00:5063                      	
    2157.  00:5063                      	; vol chan 2
    2158.  00:5063  3A 73 C1            	ld	a,(PSG_regVOLB)
    2159.  00:5066  3C                  	inc	a
    2160.  00:5067  ED 44               	neg
    2161.  00:5069  E6 0F               	and	$0f
    2162.  00:506B  F6 B0               	or	10110000b
    2163.  00:506D  ED 79               	out	(c),a		
    2164.  00:506F                      		
    2165.  00:506F                      ;	;-- check if we need 3rd psg
    2166.  00:506F                      ;	ld	a,10110000b
    2167.  00:506F                      ;	cp	b
    2168.  00:506F                      ;	jp	z,99f
    2169.  00:506F                      		
    2170.  00:506F                      	; vol chan 3
    2171.  00:506F  3A 74 C1            	ld	a,(PSG_regVOLC)
    2172.  00:5072  3C                  	inc	a
    2173.  00:5073  ED 44               	neg
    2174.  00:5075  E6 0F               	and	$0f
    2175.  00:5077  F6 D0               	or	11010000b 
    2176.  00:5079  ED 79               	out	(c),a			
    2177.  00:507B                      
    2178.  00:507B                      ;99:	
    2179.  00:507B                      	;--- next reg
    2180.  00:507B                      	; vol noise
    2181.  00:507B  3A 75 C1            	ld	a,(PSG_regVOLN)
    2182.  00:507E  3C                  	inc	a
    2183.  00:507F  ED 44               	neg
    2184.  00:5081  E6 0F               	and	$0f
    2185.  00:5083  F6 F0               	or	11110000b
    2186.  00:5085                      
    2187.  00:5085  ED 79               	out	(c),a	
    2188.  00:5087                      
    2189.  00:5087                      	; noise chan 
    2190.  00:5087  21 76 C1            	ld	hl,PSG_regNOISEold
    2191.  00:508A  3A 70 C1            	ld	a,(PSG_regNOISE)
    2192.  00:508D  BE                  	cp	(hl)
    2193.  00:508E  CA 96 50            	jp	z,0f
    2194.  00:5091  77                  	ld	(hl),a
    2195.  00:5092  3E E0               	ld	a,11100000b
    2196.  00:5094                      	;or	11100000b
    2197.  00:5094  D3 3F               	out	($3f),a
    2198.  00:5096                      0:
    2199.  00:5096                      	; tone chan a
    2200.  00:5096  ED 4B 6A C1         	ld	bc,(PSG_regToneA)
    2201.  00:509A  79                  	ld	a,c
    2202.  00:509B  E6 0F               	and	$0f
    2203.  00:509D  F6 80               	or	10000000b
    2204.  00:509F  D3 3F               	out	($3f),a	
    2205.  00:50A1  CB 11               	rl	c
    2206.  00:50A3  CB 10               	rl	b
    2207.  00:50A5  CB 11               	rl	c
    2208.  00:50A7  CB 10               	rl	b
    2209.  00:50A9  CB 11               	rl	c
    2210.  00:50AB  CB 10               	rl	b
    2211.  00:50AD  CB 11               	rl	c
    2212.  00:50AF  CB 10               	rl	b
    2213.  00:50B1  3E 3F               	ld	a,00111111b
    2214.  00:50B3  A0                  	and	b
    2215.  00:50B4  D3 3F               	out	($3f),a		
    2216.  00:50B6                      	
    2217.  00:50B6                      	
    2218.  00:50B6                      	; tone chan b
    2219.  00:50B6  ED 4B 6C C1         	ld	bc,(PSG_regToneB)
    2220.  00:50BA  79                  	ld	a,c
    2221.  00:50BB  E6 0F               	and	$0f
    2222.  00:50BD  F6 A0               	or	10100000b
    2223.  00:50BF  D3 3F               	out	($3f),a	
    2224.  00:50C1  CB 11               	rl	c
    2225.  00:50C3  CB 10               	rl	b
    2226.  00:50C5  CB 11               	rl	c
    2227.  00:50C7  CB 10               	rl	b
    2228.  00:50C9  CB 11               	rl	c
    2229.  00:50CB  CB 10               	rl	b
    2230.  00:50CD  CB 11               	rl	c
    2231.  00:50CF  CB 10               	rl	b
    2232.  00:50D1  3E 3F               	ld	a,00111111b
    2233.  00:50D3  A0                  	and	b
    2234.  00:50D4  D3 3F               	out	($3f),a	
    2235.  00:50D6                      	
    2236.  00:50D6                      	; tone chan c
    2237.  00:50D6  ED 4B 6E C1         	ld	bc,(PSG_regToneC)
    2238.  00:50DA  79                  	ld	a,c
    2239.  00:50DB  E6 0F               	and	$0f
    2240.  00:50DD  F6 C0               	or	11000000b
    2241.  00:50DF  D3 3F               	out	($3f),a	
    2242.  00:50E1  CB 11               	rl	c
    2243.  00:50E3  CB 10               	rl	b
    2244.  00:50E5  CB 11               	rl	c
    2245.  00:50E7  CB 10               	rl	b
    2246.  00:50E9  CB 11               	rl	c
    2247.  00:50EB  CB 10               	rl	b
    2248.  00:50ED  CB 11               	rl	c
    2249.  00:50EF  CB 10               	rl	b
    2250.  00:50F1  3E 3F               	ld	a,00111111b
    2251.  00:50F3  A0                  	and	b
    2252.  00:50F4  D3 3F               	out	($3f),a	
    2253.  00:50F6                      
    2254.  00:50F6                      route_gg:
    2255.  00:50F6                      	;==== output the GG stereo panning
    2256.  00:50F6  3A 77 C1            	ld	a,(GG_panning)
    2257.  00:50F9                      ;	out	($06),a
    2258.  00:50F9                      
    2259.  00:50F9                      
    2260.  00:50F9                      
    2261.  00:50F9                      
    2262.  00:50F9                      
    2263.  00:50F9                      
    2264.  00:50F9                      ;	;--- Push values to AY HW
    2265.  00:50F9                      ;	ld	b,0
    2266.  00:50F9                      ;	ld	c,0xa0
    2267.  00:50F9                      ;	ld	hl,PSG_registers
    2268.  00:50F9                      ;_comp_loop:	
    2269.  00:50F9                      ;	out	(c),b
    2270.  00:50F9                      ;	ld	a,(hl)
    2271.  00:50F9                      ;	add	1
    2272.  00:50F9                      ;	out	(0xa1),a
    2273.  00:50F9                      ;	inc	hl
    2274.  00:50F9                      ;	ld	a,(hl)
    2275.  00:50F9                      ;	adc	a,0
    2276.  00:50F9                      ;	inc	b
    2277.  00:50F9                      ;	out	(c),b	
    2278.  00:50F9                      ;	inc	hl
    2279.  00:50F9                      ;	out	(0xa1),a	
    2280.  00:50F9                      ;	inc	b
    2281.  00:50F9                      ;	ld	a,6
    2282.  00:50F9                      ;	cp	b
    2283.  00:50F9                      ;	jp	nz,_comp_loop
    2284.  00:50F9                      ;	
    2285.  00:50F9                      ;	ld	a,b	
    2286.  00:50F9                      ;	
    2287.  00:50F9                      ;	
    2288.  00:50F9                      ;_ptPSG_loop:
    2289.  00:50F9                      ;	out	(c),a
    2290.  00:50F9                      ;	inc	c
    2291.  00:50F9                      ;	outi
    2292.  00:50F9                      ;	dec	c
    2293.  00:50F9                      ;	inc	a
    2294.  00:50F9                      ;	cp	13
    2295.  00:50F9                      ;	jr	nz,_ptPSG_loop
    2296.  00:50F9                      ;
    2297.  00:50F9                      ;	ld	b,a
    2298.  00:50F9                      ;	ld	a,(hl)
    2299.  00:50F9                      ;	and	a
    2300.  00:50F9                      ;	jp	z,_ptPSG_noEnv
    2301.  00:50F9                      ;	out	(c),b
    2302.  00:50F9                      ;	inc	c
    2303.  00:50F9                      ;	out 	(c),a
    2304.  00:50F9                      ;	ld	(hl),0	;reset the envwrite
    2305.  00:50F9                      ;	
    2306.  00:50F9                      ;	
    2307.  00:50F9                      ;_ptPSG_noEnv:
    2308.  00:50F9                      
    2309.  00:50F9                      
    2310.  00:50F9                      
    2311.  00:50F9                      
    2312.  00:50F9                      ;---------------
    2313.  00:50F9                      ; F M
    2314.  00:50F9                      ;---------------
    2315.  00:50F9                      route_FM:
    2316.  00:50F9                      	; Check if we need to load a software voice
    2317.  00:50F9  21 BC C1            	ld	hl,FM_softvoice_req
    2318.  00:50FC  7E                  	ld	a,(hl)
    2319.  00:50FD  23                  	inc	hl
    2320.  00:50FE  BE                  	cp	(hl)
    2321.  00:50FF  CA 06 51            	jp	z,.noVoice
    2322.  00:5102                      	
    2323.  00:5102  77                  	ld	(hl),a
    2324.  00:5103                      
    2325.  00:5103  CD 84 51            	call	load_softwarevoice
    2326.  00:5106                      	
    2327.  00:5106                      .noVoice:
    2328.  00:5106                      	;------------------------------------------
    2329.  00:5106                      	;---- Process Drum macro
    2330.  00:5106                      	;------------------------------------------
    2331.  00:5106                      	;call	_route_FM_drum_update
    2332.  00:5106                      	
    2333.  00:5106                      
    2334.  00:5106                      	;------------------------------------------
    2335.  00:5106                      	;---- Update the tone and drum registers
    2336.  00:5106                      	;------------------------------------------
    2337.  00:5106  21 78 C1            	ld 	hl,FM_Registers
    2338.  00:5109  11 79 C0            	ld	de,TRACK_Chan3+TRACK_Flags
    2339.  00:510C  3E 10               	ld	a,$10		; Register $10
    2340.  00:510E  06 09               	ld	b,9		; 6(tone)+3(drum) channels to update
    2341.  00:5110                      
    2342.  00:5110                      .channel_loop:	
    2343.  00:5110                      	; Tone low
    2344.  00:5110  CD 64 51            	call	_route_FM_reg16_update
    2345.  00:5113  2B                  	dec	hl
    2346.  00:5114  C6 10               	add	a,$10	; Register# $20
    2347.  00:5116                      
    2348.  00:5116  08                  	ex	af,af'
    2349.  00:5117                      
    2350.  00:5117  78                  	ld	a,b	;-- Only do this check for first 6 chans. Other are drum
    2351.  00:5118  FE 04               	cp	4
    2352.  00:511A  DA 33 51            	jp	c,0f
    2353.  00:511D                      
    2354.  00:511D                      	;-- Check if we need to toggle key to start a new note
    2355.  00:511D  1A                  	ld	a,(de)
    2356.  00:511E  CB 47               	bit	0,a
    2357.  00:5120  CA 2B 51            	jp	z,99f	; no notetrigger
    2358.  00:5123                      	
    2359.  00:5123  CB 87               	res	0,a		; reset trigger
    2360.  00:5125  12                  	ld	(de),a
    2361.  00:5126  CB 67               	bit	4,a
    2362.  00:5128  C4 75 51            	call	nz,_route_FM_keyOff_update
    2363.  00:512B                      99:
    2364.  00:512B  3E 27               	ld	a,TRACK_REC_SIZE
    2365.  00:512D  83                  	add	a,e
    2366.  00:512E  5F                  	ld	e,a
    2367.  00:512F  D2 33 51            	jp	nc,99f
    2368.  00:5132  14                  	inc	d
    2369.  00:5133                      99:	
    2370.  00:5133                      0:
    2371.  00:5133  08                  	ex	af,af'
    2372.  00:5134                      	
    2373.  00:5134                      	; Tone High + key & sustain
    2374.  00:5134  CD 64 51            	call	_route_FM_reg16_update
    2375.  00:5137  23                  	inc	hl
    2376.  00:5138  C6 10               	add	a,$10	; Register# $30
    2377.  00:513A                      	
    2378.  00:513A                      	; Volume + voice
    2379.  00:513A  CD 5F 51            	call	_route_FM_reg8_update
    2380.  00:513D  23                  	inc	hl
    2381.  00:513E  C6 E1               	add	a,-$1F	; Register# = channel + $10
    2382.  00:5140  10 CE               	djnz	.channel_loop
    2383.  00:5142  C9                  	ret
    2384.  00:5143                      
    2385.  00:5143                      _route_FM_drum_update:
    2386.  00:5143  3A AE C1            	ld	a,(FM_DRUM)
    2387.  00:5146  E6 1F               	and	00011111b		; erase bit 5
    2388.  00:5148  C8                  	ret	z			; no drums to play
    2389.  00:5149                      	
    2390.  00:5149  47                  	ld	b,a
    2391.  00:514A  3E 0E               	ld	a,0x0e
    2392.  00:514C                      	;-- load the new values
    2393.  00:514C  D3 7C               	out	(FM_WRITE),a	; Select rythm register
    2394.  00:514E                      	
    2395.  00:514E  78                  	ld	a,b			; 5 cycles
    2396.  00:514F  78                  	ld	a,b			; 5 cycles	; dummy code for delay
    2397.  00:5150  D3 7D               	out	(FM_DATA),a		
    2398.  00:5152                      
    2399.  00:5152  DD E5               	push	ix			; 17 cycles	dummy code to implement delay
    2400.  00:5154  DD E1               	pop	ix			; 17 cycles
    2401.  00:5156  ED 6F               	rld				; 20 cycles
    2402.  00:5158  ED 67               	rrd				; 20 cycles
    2403.  00:515A                      
    2404.  00:515A  F6 20               	or	100000b		; set the percussion bit
    2405.  00:515C  D3 7D               	out	(FM_DATA),a
    2406.  00:515E                      	
    2407.  00:515E  C9                  	ret
    2408.  00:515F                      	
    2409.  00:515F                      
    2410.  00:515F                      ;------- Writes safe to the FM chip
    2411.  00:515F                      ; in :
    2412.  00:515F                      ;	[a]	Register# to write
    2413.  00:515F                      ;	[HL]	point to register (previous value is next in RAM)
    2414.  00:515F                      ;
    2415.  00:515F                      ; out:
    2416.  00:515F                      ;	[HL] points to previous value
    2417.  00:515F                      ;	[A]	contains register# written
    2418.  00:515F                      ;-----------
    2419.  00:515F                      _route_FM_reg8_update:
    2420.  00:515F  08                  	ex	af,af'
    2421.  00:5160  7E                  	ld	a,(hl)
    2422.  00:5161  C3 67 51            	jp	_rfr_cont
    2423.  00:5164                      	
    2424.  00:5164                      	
    2425.  00:5164                      ;------- Writes safe to the FM chip
    2426.  00:5164                      ; in :
    2427.  00:5164                      ;	[a]	Register# to write
    2428.  00:5164                      ;	[HL]	point to register (previous value is next in RAM)
    2429.  00:5164                      ;
    2430.  00:5164                      ; out:
    2431.  00:5164                      ;	[HL] points to previous value
    2432.  00:5164                      ;	[A]	contains register# written
    2433.  00:5164                      ;-----------
    2434.  00:5164                      _route_FM_reg16_update:
    2435.  00:5164  08                  	ex	af,af'
    2436.  00:5165  7E                  	ld	a,(hl)
    2437.  00:5166  23                  	inc	hl
    2438.  00:5167                      _rfr_cont:
    2439.  00:5167  23                  	inc	hl
    2440.  00:5168  BE                  	cp	(hl)	
    2441.  00:5169  CA 73 51            	jp	z,99f		; no change in tone low value
    2442.  00:516C  08                  	ex	af,af'	
    2443.  00:516D  D3 7C               	out	(FM_WRITE),a
    2444.  00:516F  08                  	ex	af,af'
    2445.  00:5170  77                  	ld	(hl),a
    2446.  00:5171  D3 7D               	out	(FM_DATA),a	
    2447.  00:5173  08                  99:	ex	af,af'
    2448.  00:5174                      ;	dec	hl	
    2449.  00:5174  C9                  	ret
    2450.  00:5175                      	
    2451.  00:5175                      ;------- Writes a keyoff to the existing tone high register 
    2452.  00:5175                      ; in :
    2453.  00:5175                      ;	[A']	register# to write
    2454.  00:5175                      ;	[HL]	point to register (previous value is next in RAM)
    2455.  00:5175                      ;
    2456.  00:5175                      ; out:
    2457.  00:5175                      ;	[HL] points to same location
    2458.  00:5175                      ;	[A']	contains register# written
    2459.  00:5175                      ;-----------
    2460.  00:5175                      _route_FM_keyOff_update:
    2461.  00:5175  08                  	ex	af,af'
    2462.  00:5176  D3 7C               	out	(FM_WRITE),a
    2463.  00:5178  08                  	ex	af,af'		; 4 cycles	 '
    2464.  00:5179  7E                  	ld	a,(hl)
    2465.  00:517A  E6 EF               	and	11101111b	; erase keyON bit.
    2466.  00:517C  D3 7D               	out	(FM_DATA),a	
    2467.  00:517E  23                  	inc	hl
    2468.  00:517F  23                  	inc	hl
    2469.  00:5180  77                  	ld	(hl),a		; make sure to change old value to trigger update
    2470.  00:5181  2B                  	dec	hl
    2471.  00:5182  2B                  	dec	hl
    2472.  00:5183  C9                  	ret
    2473.  00:5184                      
    2474.  00:5184                      
    2475.  00:5184                      
    2476.  00:5184                      load_softwarevoice:
    2477.  00:5184                      	;-- Set the software voice data address
    2478.  00:5184  2A 07 C0            	ld 	hl,(replay_voicebase)
    2479.  00:5187  85                  	add	a,l
    2480.  00:5188  6F                  	ld	l,a
    2481.  00:5189  D2 8D 51            	jp	nc,99f
    2482.  00:518C  24                  	inc	h
    2483.  00:518D                      99:
    2484.  00:518D  AF                  	xor	a		; set reg# 0
    2485.  00:518E                      .voiceupd_loop:
    2486.  00:518E                      
    2487.  00:518E  D3 7C               	out	(FM_WRITE),a
    2488.  00:5190  08                  	ex	af,af'		; 4 cycles	 '
    2489.  00:5191  7E                  	ld	a,(hl)		; 4 cycles 	
    2490.  00:5192  23                  	inc	hl			; 6 cycles
    2491.  00:5193  D3 7D               	out	(FM_DATA),a	
    2492.  00:5195                      
    2493.  00:5195  08                  	ex	af,af' 		; 4 cycles	'
    2494.  00:5196  3C                  	inc	a			; 4 cycles
    2495.  00:5197                      	
    2496.  00:5197  FE 08               	cp	8 			; 7 cycles
    2497.  00:5199                      	;--- delay
    2498.  00:5199  DD E5               	push 	ix			; 15 cycles
    2499.  00:519B  DD E1               	pop	ix			; 14 cycles
    2500.  00:519D  DD E5               	push 	ix			; 15 cycles
    2501.  00:519F  DD E1               	pop	ix			; 14 cycles
    2502.  00:51A1                      		
    2503.  00:51A1  DA 8E 51            	jp	c,.voiceupd_loop 	; 10 cycles
    2504.  00:51A4  C9                  	ret
    2505.  00:51A5                      
    2506.  00:51A5                      	
    2507.  00:51A5                      
    2508.  00:51A5                      	
    2509.  00:51A5                      
    2510.  00:51A5                      
     560   00:51A5                      	include	"..\code\ttreplaySMSDAT.asm"
       1.  00:51A5                      
       2.  00:51A5                      
       3.  00:51A5                      	; Balance setting space volume max - 8
       4.  00:51A5  1E (128)            	ds 8*16, $1E
       5.  00:5225                      _VOLUME_TABLE
       6.  00:5225                      	; Combined volume table PSG/FM
       7.  00:5225                      ;	db	 $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F
       8.  00:5225                      ;	db	 $0F, $0F, $0F, $0F, $0F, $0F, $0F, $1F, $1F, $1F, $1F, $1F, $1F, $1F, $1F, $1E
       9.  00:5225                      ;	db	 $0F, $0F, $0F, $0F, $1F, $1F, $1F, $1F, $1F, $1F, $1F, $1F, $2F, $2F, $2E, $2D
      10.  00:5225                      ;	db	 $0F, $0F, $0F, $1F, $1F, $1F, $1F, $1F, $2F, $2F, $2F, $2F, $2F, $3E, $3D, $3C
      11.  00:5225                      ;	db	 $0F, $0F, $1F, $1F, $1F, $1F, $2F, $2F, $2F, $2F, $3F, $3F, $3E, $3D, $4C, $4B
      12.  00:5225                      ;	db	 $0F, $0F, $1F, $1F, $1F, $2F, $2F, $2F, $3F, $3F, $3F, $4E, $4D, $4C, $5B, $5A
      13.  00:5225                      ;	db	 $0F, $0F, $1F, $1F, $2F, $2F, $2F, $3F, $3F, $4F, $4E, $4D, $5C, $5B, $6A, $69
      14.  00:5225                      ;	db	 $0F, $0F, $1F, $1F, $2F, $2F, $3F, $3F, $4F, $4E, $5D, $5C, $6B, $6A, $79, $78
      15.  00:5225                      ;	db	 $0F, $1F, $1F, $2F, $2F, $3F, $3F, $4F, $4E, $5D, $5C, $6B, $6A, $79, $78, $87
      16.  00:5225                      ;	db	 $0F, $1F, $1F, $2F, $2F, $3F, $4F, $4E, $5D, $5C, $6B, $7A, $79, $88, $87, $96
      17.  00:5225                      ;	db	 $0F, $1F, $1F, $2F, $3F, $3F, $4E, $5D, $5C, $6B, $7A, $79, $88, $97, $96, $A5
      18.  00:5225                      ;	db	 $0F, $1F, $1F, $2F, $3F, $4E, $4D, $5C, $6B, $7A, $79, $88, $97, $A6, $A5, $B4
      19.  00:5225                      ;	db	 $0F, $1F, $2F, $2F, $3E, $4D, $5C, $6B, $6A, $79, $88, $97, $A6, $A5, $B4, $C3
      20.  00:5225                      ;	db	 $0F, $1F, $2F, $3E, $3D, $4C, $5B, $6A, $79, $88, $97, $A6, $A5, $B4, $C3, $D2
      21.  00:5225                      ;	db	 $0F, $1F, $2E, $3D, $4C, $5B, $6A, $79, $78, $87, $96, $A5, $B4, $C3, $D2, $E1
      22.  00:5225                      ;	db	 $0F, $1E, $2D, $3C, $4B, $5A, $69, $78, $87, $96, $A5, $B4, $C3, $D2, $E1, $F0
      23.  00:5225                      
      24.  00:5225                      	; Tail mode on (psg 1/ FM E)	
      25.  00:5225                      	db	 $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E
      25.  00:5225  1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 
      26.  00:5235                      	db	 $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E
      26.  00:5235  1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 
      27.  00:5245                      	db	 $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $2E, $2E, $2E, $2D
      27.  00:5245  1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 2E 2E 2E 2D 
      28.  00:5255                      	db	 $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $2E, $2E, $2E, $2E, $2E, $3E, $3D, $3C
      28.  00:5255  1E 1E 1E 1E 1E 1E 1E 1E 2E 2E 2E 2E 2E 3E 3D 3C 
      29.  00:5265                      	db	 $1E, $1E, $1E, $1E, $1E, $1E, $2E, $2E, $2E, $2E, $3E, $3E, $3E, $3D, $4C, $4B
      29.  00:5265  1E 1E 1E 1E 1E 1E 2E 2E 2E 2E 3E 3E 3E 3D 4C 4B 
      30.  00:5275                      	db	 $1E, $1E, $1E, $1E, $1E, $2E, $2E, $2E, $3E, $3E, $3E, $4E, $4D, $4C, $5B, $5A
      30.  00:5275  1E 1E 1E 1E 1E 2E 2E 2E 3E 3E 3E 4E 4D 4C 5B 5A 
      31.  00:5285                      	db	 $1E, $1E, $1E, $1E, $2E, $2E, $2E, $3E, $3E, $4E, $4E, $4D, $5C, $5B, $6A, $69
      31.  00:5285  1E 1E 1E 1E 2E 2E 2E 3E 3E 4E 4E 4D 5C 5B 6A 69 
      32.  00:5295                      	db	 $1E, $1E, $1E, $1E, $2E, $2E, $3E, $3E, $4E, $4E, $5D, $5C, $6B, $6A, $79, $78
      32.  00:5295  1E 1E 1E 1E 2E 2E 3E 3E 4E 4E 5D 5C 6B 6A 79 78 
      33.  00:52A5                      	db	 $1E, $1E, $1E, $2E, $2E, $3E, $3E, $4E, $4E, $5D, $5C, $6B, $6A, $79, $78, $87
      33.  00:52A5  1E 1E 1E 2E 2E 3E 3E 4E 4E 5D 5C 6B 6A 79 78 87 
      34.  00:52B5                      	db	 $1E, $1E, $1E, $2E, $2E, $3E, $4E, $4E, $5D, $5C, $6B, $7A, $79, $88, $87, $96
      34.  00:52B5  1E 1E 1E 2E 2E 3E 4E 4E 5D 5C 6B 7A 79 88 87 96 
      35.  00:52C5                      	db	 $1E, $1E, $1E, $2E, $3E, $3E, $4E, $5D, $5C, $6B, $7A, $79, $88, $97, $96, $A5
      35.  00:52C5  1E 1E 1E 2E 3E 3E 4E 5D 5C 6B 7A 79 88 97 96 A5 
      36.  00:52D5                      	db	 $1E, $1E, $1E, $2E, $3E, $4E, $4D, $5C, $6B, $7A, $79, $88, $97, $A6, $A5, $B4
      36.  00:52D5  1E 1E 1E 2E 3E 4E 4D 5C 6B 7A 79 88 97 A6 A5 B4 
      37.  00:52E5                      	db	 $1E, $1E, $2E, $2E, $3E, $4D, $5C, $6B, $6A, $79, $88, $97, $A6, $A5, $B4, $C3
      37.  00:52E5  1E 1E 2E 2E 3E 4D 5C 6B 6A 79 88 97 A6 A5 B4 C3 
      38.  00:52F5                      	db	 $1E, $1E, $2E, $3E, $3D, $4C, $5B, $6A, $79, $88, $97, $A6, $A5, $B4, $C3, $D2
      38.  00:52F5  1E 1E 2E 3E 3D 4C 5B 6A 79 88 97 A6 A5 B4 C3 D2 
      39.  00:5305                      	db	 $1E, $1E, $2E, $3D, $4C, $5B, $6A, $79, $78, $87, $96, $A5, $B4, $C3, $D2, $E1
      39.  00:5305  1E 1E 2E 3D 4C 5B 6A 79 78 87 96 A5 B4 C3 D2 E1 
      40.  00:5315                      	db	 $1E, $1E, $2D, $3C, $4B, $5A, $69, $78, $87, $96, $A5, $B4, $C3, $D2, $E1, $F0
      40.  00:5315  1E 1E 2D 3C 4B 5A 69 78 87 96 A5 B4 C3 D2 E1 F0 
      41.  00:5325                      
      42.  00:5325                      TRACK_ToneTable_PSG:	
      43.  00:5325  01 00               	dw $0001	     ; C1			
      44.  00:5327  01 00               	dw $0001	     ; C#1			
      45.  00:5329  01 00               	dw $0001	     ; D1			
      46.  00:532B  01 00               	dw $0001	     ; D#1			
      47.  00:532D  01 00               	dw $0001	     ; E1			
      48.  00:532F  01 00               	dw $0001	     ; F1			
      49.  00:5331  01 00               	dw $0001	     ; F#1			
      50.  00:5333  01 00               	dw $0001	     ; G1
      51.  00:5335  01 00               	dw $0001	     ; G#1	
      52.  00:5337  01 00               	dw $0001         ; A1
      53.  00:5339  01 00               	dw $0001         ; A#1/Bb1 
      54.  00:533B  01 00               	dw $0001         ; B1	
      55.  00:533D  01 00               	dw $0001	     ; C2			
      56.  00:533F  01 00               	dw $0001	     ; C#2			
      57.  00:5341  01 00               	dw $0001	     ; D2			
      58.  00:5343  01 00               	dw $0001	     ; D#2			
      59.  00:5345  01 00               	dw $0001	     ; E2			
      60.  00:5347  01 00               	dw $0001	     ; F2			
      61.  00:5349  01 00               	dw $0001	     ; F#2			
      62.  00:534B  01 00               	dw $0001	     ; G2
      63.  00:534D  01 00               	dw $0001	     ; G#2			
      64.  00:534F                         
      65.  00:534F  F9 03               	dw $03F9      ;A2
      66.  00:5351  C0 03               	dw $03C0      ; A#2/Bb2 
      67.  00:5353  8A 03               	dw $038A      ;B2
      68.  00:5355  57 03               	dw $0357      ;C3
      69.  00:5357  27 03               	dw $0327      ; C#3/Db3 
      70.  00:5359  FA 02               	dw $02FA      ;D3
      71.  00:535B  CF 02               	dw $02CF      ; D#3/Eb3 
      72.  00:535D  A7 02               	dw $02A7      ;E3
      73.  00:535F  81 02               	dw $0281      ;F3
      74.  00:5361  5D 02               	dw $025D      ; F#3/Gb3 
      75.  00:5363  3B 02               	dw $023B      ;G3
      76.  00:5365  1B 02               	dw $021B      ; G#3/Ab3 
      77.  00:5367  FC 01               	dw $01FC      ;A3
      78.  00:5369  E0 01               	dw $01E0      ; A#3/Bb3 
      79.  00:536B  C5 01               	dw $01C5      ;B3
      80.  00:536D  AC 01               	dw $01AC      ;C4
      81.  00:536F  94 01               	dw $0194      ; C#4/Db4 
      82.  00:5371  7D 01               	dw $017D      ;D4
      83.  00:5373  68 01               	dw $0168      ; D#4/Eb4 
      84.  00:5375  53 01               	dw $0153      ;E4
      85.  00:5377  40 01               	dw $0140      ;F4
      86.  00:5379  2E 01               	dw $012E      ; F#4/Gb4 
      87.  00:537B  1D 01               	dw $011D      ;G4
      88.  00:537D  0D 01               	dw $010D      ; G#4/Ab4 
      89.  00:537F  FE 00               	dw $00FE      ;A4
      90.  00:5381  F0 00               	dw $00F0      ; A#4/Bb4 
      91.  00:5383  E2 00               	dw $00E2      ;B4
      92.  00:5385  D6 00               	dw $00D6      ;C5
      93.  00:5387  CA 00               	dw $00CA      ; C#5/Db5 
      94.  00:5389  BE 00               	dw $00BE      ;D5
      95.  00:538B  B4 00               	dw $00B4      ; D#5/Eb5 
      96.  00:538D  AA 00               	dw $00AA      ;E5
      97.  00:538F  A0 00               	dw $00A0      ;F5
      98.  00:5391  97 00               	dw $0097      ; F#5/Gb5 
      99.  00:5393  8F 00               	dw $008F      ;G5
     100.  00:5395  87 00               	dw $0087      ; G#5/Ab5 
     101.  00:5397  7F 00               	dw $007F      ;A5
     102.  00:5399  78 00               	dw $0078      ; A#5/Bb5 
     103.  00:539B  71 00               	dw $0071      ;B5
     104.  00:539D  6B 00               	dw $006B      ;C6
     105.  00:539F  65 00               	dw $0065      ; C#6/Db6 
     106.  00:53A1  5F 00               	dw $005F      ;D6
     107.  00:53A3  5A 00               	dw $005A      ; D#6/Eb6 
     108.  00:53A5  55 00               	dw $0055      ;E6
     109.  00:53A7  50 00               	dw $0050      ;F6
     110.  00:53A9  4C 00               	dw $004C      ; F#6/Gb6 
     111.  00:53AB  47 00               	dw $0047      ;G6
     112.  00:53AD  43 00               	dw $0043      ; G#6/Ab6 
     113.  00:53AF  40 00               	dw $0040      ;A6
     114.  00:53B1  3C 00               	dw $003C      ; A#6/Bb6 
     115.  00:53B3  39 00               	dw $0039      ;B6
     116.  00:53B5  35 00               	dw $0035      ;C7
     117.  00:53B7  32 00               	dw $0032      ; C#7/Db7 
     118.  00:53B9  30 00               	dw $0030      ;D7
     119.  00:53BB  2D 00               	dw $002D      ; D#7/Eb7 
     120.  00:53BD  2A 00               	dw $002A      ;E7
     121.  00:53BF  28 00               	dw $0028      ;F7
     122.  00:53C1  26 00               	dw $0026      ; F#7/Gb7 
     123.  00:53C3  24 00               	dw $0024      ;G7
     124.  00:53C5  22 00               	dw $0022      ; G#7/Ab7 
     125.  00:53C7  20 00               	dw $0020      ;A7
     126.  00:53C9  1E 00               	dw $001E      ; A#7/Bb7 
     127.  00:53CB  1C 00               	dw $001C      ;B7
     128.  00:53CD  1B 00               	dw $001B      ;C8
     129.  00:53CF  19 00               	dw $0019      ; C#8/Db8 
     130.  00:53D1  18 00               	dw $0018      ;D8
     131.  00:53D3  16 00               	dw $0016      ; D#8/Eb8 
     132.  00:53D5  15 00               	dw $0015      ;E8
     133.  00:53D7  14 00               	dw $0014      ;F8
     134.  00:53D9  13 00               	dw $0013      ; F#8/Gb8 
     135.  00:53DB  12 00               	dw $0012      ;G8
     136.  00:53DD  11 00               	dw $0011      ; G#8/Ab8 
     137.  00:53DF  10 00               	dw $0010      ;A8
     138.  00:53E1  0F 00               	dw $000F      ; A#8/Bb8 
     139.  00:53E3  0E 00               	dw $000E      ;B8
     140.  00:53E5                      TRACK_ToneTable_FM:
     141.  00:53E5                      ;	db   	0,0
     142.  00:53E5                      	db	0adh,000h,0b7h,000h,0c2h,000h,0cdh,000h,0d9h,000h,0e6h,000h
     142.  00:53E5  AD 00 B7 00 C2 00 CD 00 D9 00 E6 00 
     143.  00:53F1                            db	0f4h,000h,003h,001h,012h,001h,022h,001h,034h,001h,046h,001h
     143.  00:53F1  F4 00 03 01 12 01 22 01 34 01 46 01 
     144.  00:53FD                            db    0adh,002h,0b7h,002h,0c2h,002h,0cdh,002h,0d9h,002h,0e6h,002h
     144.  00:53FD  AD 02 B7 02 C2 02 CD 02 D9 02 E6 02 
     145.  00:5409                            db    0f4h,002h,003h,003h,012h,003h,022h,003h,034h,003h,046h,003h
     145.  00:5409  F4 02 03 03 12 03 22 03 34 03 46 03 
     146.  00:5415                            db    0adh,004h,0b7h,004h,0c2h,004h,0cdh,004h,0d9h,004h,0e6h,004h
     146.  00:5415  AD 04 B7 04 C2 04 CD 04 D9 04 E6 04 
     147.  00:5421                            db    0f4h,004h,003h,005h,012h,005h,022h,005h,034h,005h,046h,005h
     147.  00:5421  F4 04 03 05 12 05 22 05 34 05 46 05 
     148.  00:542D                            db    0adh,006h,0b7h,006h,0c2h,006h,0cdh,006h,0d9h,006h,0e6h,006h
     148.  00:542D  AD 06 B7 06 C2 06 CD 06 D9 06 E6 06 
     149.  00:5439                            db    0f4h,006h,003h,007h,012h,007h,022h,007h,034h,007h,046h,007h
     149.  00:5439  F4 06 03 07 12 07 22 07 34 07 46 07 
     150.  00:5445                            db    0adh,008h,0b7h,008h,0c2h,008h,0cdh,008h,0d9h,008h,0e6h,008h
     150.  00:5445  AD 08 B7 08 C2 08 CD 08 D9 08 E6 08 
     151.  00:5451                            db    0f4h,008h,003h,009h,012h,009h,022h,009h,034h,009h,046h,009h
     151.  00:5451  F4 08 03 09 12 09 22 09 34 09 46 09 
     152.  00:545D                            db    0adh,00ah,0b7h,00ah,0c2h,00ah,0cdh,00ah,0d9h,00ah,0e6h,00ah
     152.  00:545D  AD 0A B7 0A C2 0A CD 0A D9 0A E6 0A 
     153.  00:5469                            db    0f4h,00ah,003h,00bh,012h,00bh,022h,00bh,034h,00bh,046h,00bh
     153.  00:5469  F4 0A 03 0B 12 0B 22 0B 34 0B 46 0B 
     154.  00:5475                            db    0adh,00ch,0b7h,00ch,0c2h,00ch,0cdh,00ch,0d9h,00ch,0e6h,00ch
     154.  00:5475  AD 0C B7 0C C2 0C CD 0C D9 0C E6 0C 
     155.  00:5481                            db    0f4h,00ch,003h,00dh,012h,00dh,022h,00dh,034h,00dh,046h,00dh
     155.  00:5481  F4 0C 03 0D 12 0D 22 0D 34 0D 46 0D 
     156.  00:548D                            db    0adh,00eh,0b7h,00eh,0c2h,00eh,0cdh,00eh,0d9h,00eh,0e6h,00eh
     156.  00:548D  AD 0E B7 0E C2 0E CD 0E D9 0E E6 0E 
     157.  00:5499                            db    0f4h,00eh,003h,00fh,012h,00fh,022h,00fh,034h,00fh,046h,00fh
     157.  00:5499  F4 0E 03 0F 12 0F 22 0F 34 0F 46 0F 
     158.  00:54A5                      
     159.  00:54A5                      
     160.  00:54A5                      TRACK_Vibrato_sine:	; Sine table used for tremelo and vibrato
     161.  00:54A5                            db 	$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00		      ; depth 	1
     161.  00:54A5  00 00 00 00 00 00 00 00 00 00 01 01 01 01 01 01 
     161.  00:54B5  01 01 01 01 01 01 00 00 00 00 00 00 00 00 00 00 
     162.  00:54C5                            db 	$00,$00,$00,$00,$00,$00,$00,$01,$01,$01,$01,$01,$01,$02,$02,$02,$02,$02,$02,$01,$01,$01,$01,$01,$01,$00,$00,$00,$00,$00,$00,$00		      ; depth 	2
     162.  00:54C5  00 00 00 00 00 00 00 01 01 01 01 01 01 02 02 02 
     162.  00:54D5  02 02 02 01 01 01 01 01 01 00 00 00 00 00 00 00 
     163.  00:54E5                            db 	$00,$00,$00,$00,$00,$01,$01,$01,$01,$01,$02,$02,$02,$02,$03,$03,$03,$03,$02,$02,$02,$02,$01,$01,$01,$01,$01,$00,$00,$00,$00,$00		      ; depth 	3
     163.  00:54E5  00 00 00 00 00 01 01 01 01 01 02 02 02 02 03 03 
     163.  00:54F5  03 03 02 02 02 02 01 01 01 01 01 00 00 00 00 00 
     164.  00:5505                            db 	$00,$00,$00,$00,$00,$01,$01,$01,$01,$02,$02,$02,$03,$03,$04,$04,$04,$04,$03,$03,$02,$02,$02,$01,$01,$01,$01,$00,$00,$00,$00,$00		      ; depth 	4
     164.  00:5505  00 00 00 00 00 01 01 01 01 02 02 02 03 03 04 04 
     164.  00:5515  04 04 03 03 02 02 02 01 01 01 01 00 00 00 00 00 
     165.  00:5525                            db 	$00,$00,$00,$00,$01,$01,$01,$01,$02,$02,$03,$03,$04,$04,$05,$05,$05,$05,$04,$04,$03,$03,$02,$02,$01,$01,$01,$01,$00,$00,$00,$00		      ; depth 	5
     165.  00:5525  00 00 00 00 01 01 01 01 02 02 03 03 04 04 05 05 
     165.  00:5535  05 05 04 04 03 03 02 02 01 01 01 01 00 00 00 00 
     166.  00:5545                            db 	$00,$00,$00,$00,$01,$01,$01,$02,$02,$03,$03,$04,$04,$05,$05,$06,$06,$05,$05,$04,$04,$03,$03,$02,$02,$01,$01,$01,$00,$00,$00,$00		      ; depth 	6
     166.  00:5545  00 00 00 00 01 01 01 02 02 03 03 04 04 05 05 06 
     166.  00:5555  06 05 05 04 04 03 03 02 02 01 01 01 00 00 00 00 
     167.  00:5565                            db 	$00,$00,$00,$01,$01,$01,$02,$02,$03,$04,$04,$05,$06,$06,$07,$08,$08,$07,$06,$06,$05,$04,$04,$03,$02,$02,$01,$01,$01,$00,$00,$00		      ; depth 	7
     167.  00:5565  00 00 00 01 01 01 02 02 03 04 04 05 06 06 07 08 
     167.  00:5575  08 07 06 06 05 04 04 03 02 02 01 01 01 00 00 00 
     168.  00:5585                            db 	$00,$00,$01,$01,$01,$02,$03,$04,$05,$06,$07,$08,$09,$0A,$0C,$0D,$0D,$0C,$0A,$09,$08,$07,$06,$05,$04,$03,$02,$01,$01,$01,$00,$00		      ; depth 	8
     168.  00:5585  00 00 01 01 01 02 03 04 05 06 07 08 09 0A 0C 0D 
     168.  00:5595  0D 0C 0A 09 08 07 06 05 04 03 02 01 01 01 00 00 
     169.  00:55A5                            db 	$00,$00,$01,$02,$02,$04,$05,$06,$08,$09,$0B,$0D,$0F,$11,$13,$15,$15,$13,$11,$0F,$0D,$0B,$09,$08,$06,$05,$04,$02,$02,$01,$00,$00		      ; depth 	9
     169.  00:55A5  00 00 01 02 02 04 05 06 08 09 0B 0D 0F 11 13 15 
     169.  00:55B5  15 13 11 0F 0D 0B 09 08 06 05 04 02 02 01 00 00 
     170.  00:55C5                            db 	$00,$01,$01,$02,$04,$05,$07,$09,$0B,$0E,$10,$13,$16,$19,$1C,$1F,$1F,$1C,$19,$16,$13,$10,$0E,$0B,$09,$07,$05,$04,$02,$01,$01,$00		      ; depth 	A
     170.  00:55C5  00 01 01 02 04 05 07 09 0B 0E 10 13 16 19 1C 1F 
     170.  00:55D5  1F 1C 19 16 13 10 0E 0B 09 07 05 04 02 01 01 00 
     171.  00:55E5                            db 	$00,$01,$02,$03,$05,$08,$0B,$0E,$11,$15,$19,$1D,$21,$26,$2B,$2F,$2F,$2B,$26,$21,$1D,$19,$15,$11,$0E,$0B,$08,$05,$03,$02,$01,$00		      ; depth 	B
     171.  00:55E5  00 01 02 03 05 08 0B 0E 11 15 19 1D 21 26 2B 2F 
     171.  00:55F5  2F 2B 26 21 1D 19 15 11 0E 0B 08 05 03 02 01 00 
     172.  00:5605                            db 	$01,$01,$03,$05,$07,$0B,$0E,$12,$17,$1C,$21,$27,$2D,$33,$39,$3F,$3F,$39,$33,$2D,$27,$21,$1C,$17,$12,$0E,$0B,$07,$05,$03,$01,$01		      ; depth 	C
     172.  00:5605  01 01 03 05 07 0B 0E 12 17 1C 21 27 2D 33 39 3F 
     172.  00:5615  3F 39 33 2D 27 21 1C 17 12 0E 0B 07 05 03 01 01 
     561   00:5625                      ;	include	"..\ttsfxplay\ttsfxplay.asm"
     562   00:5625                      
     563   00:5625                      	
     564   00:5625                      demo_song:
     565   00:5625                      	include	".\demo_sms.asm"
       1.  00:5625                      ; Song: TT -TRIPLETS-SCC Converted to FM
       2.  00:5625                      ; By:   Gryzor87 (c)2021                
       3.  00:5625                      
       4.  00:5625                      ; [ Song start data ]
       5.  00:5625  06                  	db $06					; Initial song speed.
       6.  00:5626  A0 56               	dw .customvoice_start			; Start of the custom voices data.
       7.  00:5628  B0 56               	dw .drummacro_start				; Start of the drum macro data.
       8.  00:562A  B6 56               	dw .instrument_start			; Start of the instrument data.
       9.  00:562C                      
      10.  00:562C                      ; [ Song order pointer list ]
      11.  00:562C                      .restart:
      12.  00:562C                      	dw .track_000, .track_000, .track_002, .track_002, .track_004, .track_005, .track_000, .track_000	; Step:001 Pattern:000
      12.  00:562C  E0 57 E0 57 E3 57 E3 57 E5 57 39 58 E0 57 E0 57 
      13.  00:563C                      	dw .track_008, .track_009, .track_010, .track_011, .track_012, .track_013, .track_014, .track_015	; Step:002 Pattern:001
      13.  00:563C  87 58 D4 58 FA 58 FC 58 24 59 4B 59 6A 59 89 59 
      14.  00:564C                      	dw .track_008, .track_009, .track_010, .track_011, .track_012, .track_013, .track_014, .track_015	; Step:003 Pattern:001
      14.  00:564C  87 58 D4 58 FA 58 FC 58 24 59 4B 59 6A 59 89 59 
      15.  00:565C                      	dw .track_016, .track_017, .track_010, .track_011, .track_012, .track_021, .track_022, .track_023	; Step:004 Pattern:002
      15.  00:565C  B0 59 08 5A FA 58 FC 58 24 59 2E 5A 50 5A A8 5A 
      16.  00:566C                      	dw .track_016, .track_017, .track_010, .track_011, .track_012, .track_021, .track_022, .track_023	; Step:005 Pattern:002
      16.  00:566C  B0 59 08 5A FA 58 FC 58 24 59 2E 5A 50 5A A8 5A 
      17.  00:567C                      	dw .track_008, .track_009, .track_010, .track_011, .track_012, .track_013, .track_014, .track_015	; Step:006 Pattern:001
      17.  00:567C  87 58 D4 58 FA 58 FC 58 24 59 4B 59 6A 59 89 59 
      18.  00:568C                      	dw .track_024, .track_025, .track_010, .track_027, .track_028, .track_029, .track_030, .track_031	; Step:007 Pattern:003
      18.  00:568C  F9 5A 02 5B FA 58 09 5B 13 5B 1A 5B 21 5B 28 5B 
      19.  00:569C  00 00 2C 56         	dw 0x0000, .restart				; End of sequence delimiter + restart address.
      20.  00:56A0                      
      21.  00:56A0                      ; [ Custom FM voices ]
      22.  00:56A0                      .customvoice_start:
      23.  00:56A0                      	db $10,$14,$00,$04,$f1,$f1,$f1,$11 		; Custom voice:61
      23.  00:56A0  10 14 00 04 F1 F1 F1 11 
      24.  00:56A8                      	db $61,$62,$0e,$06,$f5,$f2,$0f,$fe 		; Custom voice:182
      24.  00:56A8  61 62 0E 06 F5 F2 0F FE 
      25.  00:56B0                      
      26.  00:56B0                      ; [ SCC Waveforms ]
      27.  00:56B0                      .waveform_start:
      28.  00:56B0                      
      29.  00:56B0                      ; [ FM Drum macros]
      30.  00:56B0                      .drummacro_start:
      31.  00:56B0  B6 56               	dw .drum_00
      32.  00:56B2  B6 56               	dw .drum_01
      33.  00:56B4  B6 56               	dw .drum_04
      34.  00:56B6                      
      35.  00:56B6                      .drum_00:
      36.  00:56B6                      
      37.  00:56B6                      .drum_01:
      38.  00:56B6                      
      39.  00:56B6                      .drum_04:
      40.  00:56B6                      
      41.  00:56B6                      ; [ Instruments]
      42.  00:56B6                      .instrument_start:
      43.  00:56B6  CE 56               	dw .instrument_00				; SD A3           
      44.  00:56B8  F9 56               	dw .instrument_01				; HH CL A8        
      45.  00:56BA  02 57               	dw .instrument_02				; TOM             
      46.  00:56BC  37 57               	dw .instrument_03				; GTR CHORDS      
      47.  00:56BE  3D 57               	dw .instrument_04				; SC String solo  
      48.  00:56C0  43 57               	dw .instrument_05				; SC Bass         
      49.  00:56C2  53 57               	dw .instrument_06				; SC Brass Satan  
      50.  00:56C4  59 57               	dw .instrument_07				; ARP SQ          
      51.  00:56C6  68 57               	dw .instrument_08				; Clarinet low    
      52.  00:56C8  6D 57               	dw .instrument_09				; Response BELL   
      53.  00:56CA  85 57               	dw .instrument_10				; HH OP A8        
      54.  00:56CC  B5 57               	dw .instrument_11				; SD-MAIN         
      55.  00:56CE                      
      56.  00:56CE                      .instrument_00:					; SD A3           
      57.  00:56CE  10                  	db $10					; FM Hardware Voice 1
      58.  00:56CF  28                  	db $28			; Info byte: 00101000
      59.  00:56D0  0F                  	db $0f			; Volume _
      60.  00:56D1  C8                  	db $c8			; Info byte: 11001000
      61.  00:56D2  0C                  	db $0c			; Volume _
      62.  00:56D3  00                  	db $00			; Noise
      63.  00:56D4  06                  	db $06			; Noise volume
      64.  00:56D5  C8                  	db $c8			; Info byte: 11001000
      65.  00:56D6  0B                  	db $0b			; Volume _
      66.  00:56D7  00                  	db $00			; Noise
      67.  00:56D8  06                  	db $06			; Noise volume
      68.  00:56D9  C8                  	db $c8			; Info byte: 11001000
      69.  00:56DA  0A                  	db $0a			; Volume _
      70.  00:56DB  00                  	db $00			; Noise
      71.  00:56DC  06                  	db $06			; Noise volume
      72.  00:56DD  C8                  	db $c8			; Info byte: 11001000
      73.  00:56DE  09                  	db $09			; Volume _
      74.  00:56DF  00                  	db $00			; Noise
      75.  00:56E0  06                  	db $06			; Noise volume
      76.  00:56E1  C8                  	db $c8			; Info byte: 11001000
      77.  00:56E2  08                  	db $08			; Volume _
      78.  00:56E3  00                  	db $00			; Noise
      79.  00:56E4  06                  	db $06			; Noise volume
      80.  00:56E5  C8                  	db $c8			; Info byte: 11001000
      81.  00:56E6  07                  	db $07			; Volume _
      82.  00:56E7  00                  	db $00			; Noise
      83.  00:56E8  06                  	db $06			; Noise volume
      84.  00:56E9  C8                  	db $c8			; Info byte: 11001000
      85.  00:56EA  06                  	db $06			; Volume _
      86.  00:56EB  00                  	db $00			; Noise
      87.  00:56EC  06                  	db $06			; Noise volume
      88.  00:56ED  C8                  	db $c8			; Info byte: 11001000
      89.  00:56EE  05                  	db $05			; Volume _
      90.  00:56EF  00                  	db $00			; Noise
      91.  00:56F0  06                  	db $06			; Noise volume
      92.  00:56F1  C8                  	db $c8			; Info byte: 11001000
      93.  00:56F2  04                  	db $04			; Volume _
      94.  00:56F3  00                  	db $00			; Noise
      95.  00:56F4  06                  	db $06			; Noise volume
      96.  00:56F5                      .rst_i00:
      97.  00:56F5  09                  	db $09			; Info byte: 00001001
      98.  00:56F6  00                  	db $00			; Volume _
      99.  00:56F7  F5 56               	dw .rst_i00						; Loop address
     100.  00:56F9                      .instrument_01:					; HH CL A8        
     101.  00:56F9  70                  	db $70					; FM Hardware Voice 7
     102.  00:56FA  E8                  	db $e8			; Info byte: 11101000
     103.  00:56FB  0B                  	db $0b			; Volume _
     104.  00:56FC  04                  	db $04			; Noise
     105.  00:56FD  0F                  	db $0f			; Noise volume
     106.  00:56FE                      .rst_i01:
     107.  00:56FE  09                  	db $09			; Info byte: 00001001
     108.  00:56FF  00                  	db $00			; Volume _
     109.  00:5700  FE 56               	dw .rst_i01						; Loop address
     110.  00:5702                      .instrument_02:					; TOM             
     111.  00:5702  10                  	db $10					; FM Hardware Voice 1
     112.  00:5703  38                  	db $38			; Info byte: 00111000
     113.  00:5704  0F                  	db $0f			; Volume _
     114.  00:5705  20 00               	dw $0020			; Tone
     115.  00:5707  38                  	db $38			; Info byte: 00111000
     116.  00:5708  0D                  	db $0d			; Volume _
     117.  00:5709  20 00               	dw $0020			; Tone
     118.  00:570B  3C                  	db $3c			; Info byte: 00111100
     119.  00:570C  FF                  	db $ff			; Volume -
     120.  00:570D  20 00               	dw $0020			; Tone
     121.  00:570F  30                  	db $30			; Info byte: 00110000
     122.  00:5710  20 00               	dw $0020			; Tone
     123.  00:5712  3C                  	db $3c			; Info byte: 00111100
     124.  00:5713  FF                  	db $ff			; Volume -
     125.  00:5714  20 00               	dw $0020			; Tone
     126.  00:5716  30                  	db $30			; Info byte: 00110000
     127.  00:5717  20 00               	dw $0020			; Tone
     128.  00:5719  3C                  	db $3c			; Info byte: 00111100
     129.  00:571A  FF                  	db $ff			; Volume -
     130.  00:571B  20 00               	dw $0020			; Tone
     131.  00:571D  30                  	db $30			; Info byte: 00110000
     132.  00:571E  20 00               	dw $0020			; Tone
     133.  00:5720  30                  	db $30			; Info byte: 00110000
     134.  00:5721  20 00               	dw $0020			; Tone
     135.  00:5723  3C                  	db $3c			; Info byte: 00111100
     136.  00:5724  FF                  	db $ff			; Volume -
     137.  00:5725  20 00               	dw $0020			; Tone
     138.  00:5727  3C                  	db $3c			; Info byte: 00111100
     139.  00:5728  FF                  	db $ff			; Volume -
     140.  00:5729  20 00               	dw $0020			; Tone
     141.  00:572B  3C                  	db $3c			; Info byte: 00111100
     142.  00:572C  FF                  	db $ff			; Volume -
     143.  00:572D  20 00               	dw $0020			; Tone
     144.  00:572F  3C                  	db $3c			; Info byte: 00111100
     145.  00:5730  FF                  	db $ff			; Volume -
     146.  00:5731  20 00               	dw $0020			; Tone
     147.  00:5733                      .rst_i02:
     148.  00:5733  09                  	db $09			; Info byte: 00001001
     149.  00:5734  00                  	db $00			; Volume _
     150.  00:5735  33 57               	dw .rst_i02						; Loop address
     151.  00:5737                      .instrument_03:					; GTR CHORDS      
     152.  00:5737  00 00               	db $00,$00					; FM Software Voice 0
     153.  00:5739                      .rst_i03:
     154.  00:5739  29                  	db $29			; Info byte: 00101001
     155.  00:573A  0F                  	db $0f			; Volume _
     156.  00:573B  39 57               	dw .rst_i03						; Loop address
     157.  00:573D                      .instrument_04:					; SC String solo  
     158.  00:573D  00 08               	db $00,$08					; FM Software Voice 1
     159.  00:573F                      .rst_i04:
     160.  00:573F  29                  	db $29			; Info byte: 00101001
     161.  00:5740  0F                  	db $0f			; Volume _
     162.  00:5741  3F 57               	dw .rst_i04						; Loop address
     163.  00:5743                      .instrument_05:					; SC Bass         
     164.  00:5743  E0                  	db $e0					; FM Hardware Voice 14
     165.  00:5744  28                  	db $28			; Info byte: 00101000
     166.  00:5745  0F                  	db $0f			; Volume _
     167.  00:5746  28                  	db $28			; Info byte: 00101000
     168.  00:5747  0F                  	db $0f			; Volume _
     169.  00:5748  28                  	db $28			; Info byte: 00101000
     170.  00:5749  0F                  	db $0f			; Volume _
     171.  00:574A  28                  	db $28			; Info byte: 00101000
     172.  00:574B  0F                  	db $0f			; Volume _
     173.  00:574C                      .rst_i05:
     174.  00:574C  2C                  	db $2c			; Info byte: 00101100
     175.  00:574D  FF                  	db $ff			; Volume -
     176.  00:574E  20                  	db $20			; Info byte: 00100000
     177.  00:574F  20                  	db $20			; Info byte: 00100000
     178.  00:5750  21                  	db $21			; Info byte: 00100001
     179.  00:5751  4C 57               	dw .rst_i05						; Loop address
     180.  00:5753                      .instrument_06:					; SC Brass Satan  
     181.  00:5753  00 00               	db $00,$00					; FM Software Voice 0
     182.  00:5755                      .rst_i06:
     183.  00:5755  29                  	db $29			; Info byte: 00101001
     184.  00:5756  0F                  	db $0f			; Volume _
     185.  00:5757  55 57               	dw .rst_i06						; Loop address
     186.  00:5759                      .instrument_07:					; ARP SQ          
     187.  00:5759  C0                  	db $c0					; FM Hardware Voice 12
     188.  00:575A  28                  	db $28			; Info byte: 00101000
     189.  00:575B  0E                  	db $0e			; Volume _
     190.  00:575C  28                  	db $28			; Info byte: 00101000
     191.  00:575D  0E                  	db $0e			; Volume _
     192.  00:575E  28                  	db $28			; Info byte: 00101000
     193.  00:575F  0E                  	db $0e			; Volume _
     194.  00:5760  28                  	db $28			; Info byte: 00101000
     195.  00:5761  0E                  	db $0e			; Volume _
     196.  00:5762  28                  	db $28			; Info byte: 00101000
     197.  00:5763  0E                  	db $0e			; Volume _
     198.  00:5764                      .rst_i07:
     199.  00:5764  09                  	db $09			; Info byte: 00001001
     200.  00:5765  00                  	db $00			; Volume _
     201.  00:5766  64 57               	dw .rst_i07						; Loop address
     202.  00:5768                      .instrument_08:					; Clarinet low    
     203.  00:5768  50                  	db $50					; FM Hardware Voice 5
     204.  00:5769                      .rst_i08:
     205.  00:5769  29                  	db $29			; Info byte: 00101001
     206.  00:576A  0D                  	db $0d			; Volume _
     207.  00:576B  69 57               	dw .rst_i08						; Loop address
     208.  00:576D                      .instrument_09:					; Response BELL   
     209.  00:576D  D0                  	db $d0					; FM Hardware Voice 13
     210.  00:576E  28                  	db $28			; Info byte: 00101000
     211.  00:576F  0D                  	db $0d			; Volume _
     212.  00:5770  28                  	db $28			; Info byte: 00101000
     213.  00:5771  0B                  	db $0b			; Volume _
     214.  00:5772  28                  	db $28			; Info byte: 00101000
     215.  00:5773  0A                  	db $0a			; Volume _
     216.  00:5774                      .rst_i09:
     217.  00:5774  2C                  	db $2c			; Info byte: 00101100
     218.  00:5775  FF                  	db $ff			; Volume -
     219.  00:5776  20                  	db $20			; Info byte: 00100000
     220.  00:5777  20                  	db $20			; Info byte: 00100000
     221.  00:5778  20                  	db $20			; Info byte: 00100000
     222.  00:5779  20                  	db $20			; Info byte: 00100000
     223.  00:577A  20                  	db $20			; Info byte: 00100000
     224.  00:577B  2C                  	db $2c			; Info byte: 00101100
     225.  00:577C  01                  	db $01			; Volume +
     226.  00:577D  20                  	db $20			; Info byte: 00100000
     227.  00:577E  20                  	db $20			; Info byte: 00100000
     228.  00:577F  20                  	db $20			; Info byte: 00100000
     229.  00:5780  20                  	db $20			; Info byte: 00100000
     230.  00:5781  2D                  	db $2d			; Info byte: 00101101
     231.  00:5782  FF                  	db $ff			; Volume -
     232.  00:5783  74 57               	dw .rst_i09						; Loop address
     233.  00:5785                      .instrument_10:					; HH OP A8        
     234.  00:5785  00                  	db $00					; FM Hardware Voice 0
     235.  00:5786  C8                  	db $c8			; Info byte: 11001000
     236.  00:5787  0E                  	db $0e			; Volume _
     237.  00:5788  04                  	db $04			; Noise
     238.  00:5789  08                  	db $08			; Noise volume
     239.  00:578A  CC                  	db $cc			; Info byte: 11001100
     240.  00:578B  FF                  	db $ff			; Volume -
     241.  00:578C  04                  	db $04			; Noise
     242.  00:578D  08                  	db $08			; Noise volume
     243.  00:578E  C0                  	db $c0			; Info byte: 11000000
     244.  00:578F  04                  	db $04			; Noise
     245.  00:5790  07                  	db $07			; Noise volume
     246.  00:5791  C0                  	db $c0			; Info byte: 11000000
     247.  00:5792  04                  	db $04			; Noise
     248.  00:5793  07                  	db $07			; Noise volume
     249.  00:5794  C0                  	db $c0			; Info byte: 11000000
     250.  00:5795  04                  	db $04			; Noise
     251.  00:5796  06                  	db $06			; Noise volume
     252.  00:5797  C8                  	db $c8			; Info byte: 11001000
     253.  00:5798  00                  	db $00			; Volume _
     254.  00:5799  04                  	db $04			; Noise
     255.  00:579A  06                  	db $06			; Noise volume
     256.  00:579B  C8                  	db $c8			; Info byte: 11001000
     257.  00:579C  00                  	db $00			; Volume _
     258.  00:579D  04                  	db $04			; Noise
     259.  00:579E  05                  	db $05			; Noise volume
     260.  00:579F  C8                  	db $c8			; Info byte: 11001000
     261.  00:57A0  00                  	db $00			; Volume _
     262.  00:57A1  04                  	db $04			; Noise
     263.  00:57A2  05                  	db $05			; Noise volume
     264.  00:57A3  C8                  	db $c8			; Info byte: 11001000
     265.  00:57A4  00                  	db $00			; Volume _
     266.  00:57A5  04                  	db $04			; Noise
     267.  00:57A6  04                  	db $04			; Noise volume
     268.  00:57A7  C8                  	db $c8			; Info byte: 11001000
     269.  00:57A8  00                  	db $00			; Volume _
     270.  00:57A9  04                  	db $04			; Noise
     271.  00:57AA  04                  	db $04			; Noise volume
     272.  00:57AB  C8                  	db $c8			; Info byte: 11001000
     273.  00:57AC  00                  	db $00			; Volume _
     274.  00:57AD  04                  	db $04			; Noise
     275.  00:57AE  03                  	db $03			; Noise volume
     276.  00:57AF                      .rst_i10:
     277.  00:57AF  C9                  	db $c9			; Info byte: 11001001
     278.  00:57B0  00                  	db $00			; Volume _
     279.  00:57B1  04                  	db $04			; Noise
     280.  00:57B2  03                  	db $03			; Noise volume
     281.  00:57B3  AF 57               	dw .rst_i10						; Loop address
     282.  00:57B5                      .instrument_11:					; SD-MAIN         
     283.  00:57B5  10                  	db $10					; FM Hardware Voice 1
     284.  00:57B6  28                  	db $28			; Info byte: 00101000
     285.  00:57B7  0E                  	db $0e			; Volume _
     286.  00:57B8  C8                  	db $c8			; Info byte: 11001000
     287.  00:57B9  0C                  	db $0c			; Volume _
     288.  00:57BA  06                  	db $06			; Noise
     289.  00:57BB  0C                  	db $0c			; Noise volume
     290.  00:57BC  C8                  	db $c8			; Info byte: 11001000
     291.  00:57BD  0A                  	db $0a			; Volume _
     292.  00:57BE  05                  	db $05			; Noise
     293.  00:57BF  0A                  	db $0a			; Noise volume
     294.  00:57C0  C8                  	db $c8			; Info byte: 11001000
     295.  00:57C1  0A                  	db $0a			; Volume _
     296.  00:57C2  05                  	db $05			; Noise
     297.  00:57C3  0A                  	db $0a			; Noise volume
     298.  00:57C4  C8                  	db $c8			; Info byte: 11001000
     299.  00:57C5  09                  	db $09			; Volume _
     300.  00:57C6  05                  	db $05			; Noise
     301.  00:57C7  09                  	db $09			; Noise volume
     302.  00:57C8  C8                  	db $c8			; Info byte: 11001000
     303.  00:57C9  09                  	db $09			; Volume _
     304.  00:57CA  05                  	db $05			; Noise
     305.  00:57CB  08                  	db $08			; Noise volume
     306.  00:57CC  C8                  	db $c8			; Info byte: 11001000
     307.  00:57CD  08                  	db $08			; Volume _
     308.  00:57CE  04                  	db $04			; Noise
     309.  00:57CF  07                  	db $07			; Noise volume
     310.  00:57D0  C8                  	db $c8			; Info byte: 11001000
     311.  00:57D1  08                  	db $08			; Volume _
     312.  00:57D2  04                  	db $04			; Noise
     313.  00:57D3  06                  	db $06			; Noise volume
     314.  00:57D4  C8                  	db $c8			; Info byte: 11001000
     315.  00:57D5  07                  	db $07			; Volume _
     316.  00:57D6  04                  	db $04			; Noise
     317.  00:57D7  05                  	db $05			; Noise volume
     318.  00:57D8  C8                  	db $c8			; Info byte: 11001000
     319.  00:57D9  07                  	db $07			; Volume _
     320.  00:57DA  04                  	db $04			; Noise
     321.  00:57DB  04                  	db $04			; Noise volume
     322.  00:57DC                      .rst_i11:
     323.  00:57DC  09                  	db $09			; Info byte: 00001001
     324.  00:57DD  00                  	db $00			; Volume _
     325.  00:57DE  DC 57               	dw .rst_i11						; Loop address
     326.  00:57E0                      
     327.  00:57E0                      ; [ Song track data ]
     328.  00:57E0                      .track_000:
     329.  00:57E0  60                  	db $60			;Release 96
     330.  00:57E1  DF                  	db $df			;Wait 32
     331.  00:57E2  BF                  	db $bf			;[End-Of-Track]
     332.  00:57E3                      .track_002:
     333.  00:57E3  DF                  	db $df			;Wait 32
     334.  00:57E4  BF                  	db $bf			;[End-Of-Track]
     335.  00:57E5                      .track_004:
     336.  00:57E5  52                  	db $52			;Note A#7
     337.  00:57E6  6F                  	db $6f			;Volume 14
     338.  00:57E7  78                  	db $78			;Instrument 7
     339.  00:57E8  C0                  	db $c0			;Wait 1
     340.  00:57E9  4F                  	db $4f			;Note G-7
     341.  00:57EA  9A 02               	db $9a,$02			;CMD Note delay
     342.  00:57EC                      					;Wait Repeat 1
     343.  00:57EC  4D                  	db $4d			;Note F-7
     344.  00:57ED  9A 03               	db $9a,$03			;CMD Note delay
     345.  00:57EF  C1                  	db $c1			;Wait 2
     346.  00:57F0  4A                  	db $4a			;Note D-7
     347.  00:57F1  C0                  	db $c0			;Wait 1
     348.  00:57F2  46                  	db $46			;Note A#6
     349.  00:57F3  9A 02               	db $9a,$02			;CMD Note delay
     350.  00:57F5                      					;Wait Repeat 1
     351.  00:57F5  43                  	db $43			;Note G-6
     352.  00:57F6  9A 03               	db $9a,$03			;CMD Note delay
     353.  00:57F8  C1                  	db $c1			;Wait 2
     354.  00:57F9  52                  	db $52			;Note A#7
     355.  00:57FA  6B                  	db $6b			;Volume 10
     356.  00:57FB  A1 08               	db $a1,$08			;CMD Track detune
     357.  00:57FD  C0                  	db $c0			;Wait 1
     358.  00:57FE  4F                  	db $4f			;Note G-7
     359.  00:57FF  9A 02               	db $9a,$02			;CMD Note delay
     360.  00:5801                      					;Wait Repeat 1
     361.  00:5801  4D                  	db $4d			;Note F-7
     362.  00:5802  9A 03               	db $9a,$03			;CMD Note delay
     363.  00:5804  C1                  	db $c1			;Wait 2
     364.  00:5805  4A                  	db $4a			;Note D-7
     365.  00:5806  C0                  	db $c0			;Wait 1
     366.  00:5807  46                  	db $46			;Note A#6
     367.  00:5808  9A 02               	db $9a,$02			;CMD Note delay
     368.  00:580A                      					;Wait Repeat 1
     369.  00:580A  43                  	db $43			;Note G-6
     370.  00:580B  9A 03               	db $9a,$03			;CMD Note delay
     371.  00:580D  C1                  	db $c1			;Wait 2
     372.  00:580E  52                  	db $52			;Note A#7
     373.  00:580F  6B                  	db $6b			;Volume 10
     374.  00:5810  A6 50               	db $a6,$50			;CMD Channel setup
     375.  00:5812  C0                  	db $c0			;Wait 1
     376.  00:5813  4F                  	db $4f			;Note G-7
     377.  00:5814  9A 02               	db $9a,$02			;CMD Note delay
     378.  00:5816                      					;Wait Repeat 1
     379.  00:5816  4D                  	db $4d			;Note F-7
     380.  00:5817  9A 03               	db $9a,$03			;CMD Note delay
     381.  00:5819  C1                  	db $c1			;Wait 2
     382.  00:581A  4A                  	db $4a			;Note D-7
     383.  00:581B  C0                  	db $c0			;Wait 1
     384.  00:581C  46                  	db $46			;Note A#6
     385.  00:581D  9A 02               	db $9a,$02			;CMD Note delay
     386.  00:581F                      					;Wait Repeat 1
     387.  00:581F  43                  	db $43			;Note G-6
     388.  00:5820  9A 03               	db $9a,$03			;CMD Note delay
     389.  00:5822  C1                  	db $c1			;Wait 2
     390.  00:5823  52                  	db $52			;Note A#7
     391.  00:5824  67                  	db $67			;Volume 6
     392.  00:5825  A1 08               	db $a1,$08			;CMD Track detune
     393.  00:5827  C0                  	db $c0			;Wait 1
     394.  00:5828  4F                  	db $4f			;Note G-7
     395.  00:5829  9A 02               	db $9a,$02			;CMD Note delay
     396.  00:582B                      					;Wait Repeat 1
     397.  00:582B  4D                  	db $4d			;Note F-7
     398.  00:582C  9A 03               	db $9a,$03			;CMD Note delay
     399.  00:582E  C1                  	db $c1			;Wait 2
     400.  00:582F  4A                  	db $4a			;Note D-7
     401.  00:5830  C0                  	db $c0			;Wait 1
     402.  00:5831  46                  	db $46			;Note A#6
     403.  00:5832  9A 02               	db $9a,$02			;CMD Note delay
     404.  00:5834                      					;Wait Repeat 1
     405.  00:5834  43                  	db $43			;Note G-6
     406.  00:5835  9A 03               	db $9a,$03			;CMD Note delay
     407.  00:5837  C1                  	db $c1			;Wait 2
     408.  00:5838  BF                  	db $bf			;[End-Of-Track]
     409.  00:5839                      .track_005:
     410.  00:5839  60                  	db $60			;Release 96
     411.  00:583A  C2                  	db $c2			;Wait 3
     412.  00:583B  52                  	db $52			;Note A#7
     413.  00:583C  67                  	db $67			;Volume 6
     414.  00:583D  78                  	db $78			;Instrument 7
     415.  00:583E  C0                  	db $c0			;Wait 1
     416.  00:583F  4F                  	db $4f			;Note G-7
     417.  00:5840  9A 02               	db $9a,$02			;CMD Note delay
     418.  00:5842                      					;Wait Repeat 1
     419.  00:5842  4D                  	db $4d			;Note F-7
     420.  00:5843  9A 03               	db $9a,$03			;CMD Note delay
     421.  00:5845  C1                  	db $c1			;Wait 2
     422.  00:5846  4A                  	db $4a			;Note D-7
     423.  00:5847  C0                  	db $c0			;Wait 1
     424.  00:5848  46                  	db $46			;Note A#6
     425.  00:5849  9A 02               	db $9a,$02			;CMD Note delay
     426.  00:584B                      					;Wait Repeat 1
     427.  00:584B  43                  	db $43			;Note G-6
     428.  00:584C  9A 03               	db $9a,$03			;CMD Note delay
     429.  00:584E  C1                  	db $c1			;Wait 2
     430.  00:584F  52                  	db $52			;Note A#7
     431.  00:5850  66                  	db $66			;Volume 5
     432.  00:5851  A1 08               	db $a1,$08			;CMD Track detune
     433.  00:5853  C0                  	db $c0			;Wait 1
     434.  00:5854  4F                  	db $4f			;Note G-7
     435.  00:5855  9A 02               	db $9a,$02			;CMD Note delay
     436.  00:5857                      					;Wait Repeat 1
     437.  00:5857  4D                  	db $4d			;Note F-7
     438.  00:5858  9A 03               	db $9a,$03			;CMD Note delay
     439.  00:585A  C1                  	db $c1			;Wait 2
     440.  00:585B  4A                  	db $4a			;Note D-7
     441.  00:585C  C0                  	db $c0			;Wait 1
     442.  00:585D  46                  	db $46			;Note A#6
     443.  00:585E  9A 02               	db $9a,$02			;CMD Note delay
     444.  00:5860                      					;Wait Repeat 1
     445.  00:5860  43                  	db $43			;Note G-6
     446.  00:5861  9A 03               	db $9a,$03			;CMD Note delay
     447.  00:5863  C1                  	db $c1			;Wait 2
     448.  00:5864  52                  	db $52			;Note A#7
     449.  00:5865  65                  	db $65			;Volume 4
     450.  00:5866  A6 50               	db $a6,$50			;CMD Channel setup
     451.  00:5868  C0                  	db $c0			;Wait 1
     452.  00:5869  4F                  	db $4f			;Note G-7
     453.  00:586A  9A 02               	db $9a,$02			;CMD Note delay
     454.  00:586C                      					;Wait Repeat 1
     455.  00:586C  4D                  	db $4d			;Note F-7
     456.  00:586D  9A 03               	db $9a,$03			;CMD Note delay
     457.  00:586F  C1                  	db $c1			;Wait 2
     458.  00:5870  4A                  	db $4a			;Note D-7
     459.  00:5871  C0                  	db $c0			;Wait 1
     460.  00:5872  46                  	db $46			;Note A#6
     461.  00:5873  9A 02               	db $9a,$02			;CMD Note delay
     462.  00:5875                      					;Wait Repeat 1
     463.  00:5875  43                  	db $43			;Note G-6
     464.  00:5876  9A 03               	db $9a,$03			;CMD Note delay
     465.  00:5878  C1                  	db $c1			;Wait 2
     466.  00:5879  52                  	db $52			;Note A#7
     467.  00:587A  64                  	db $64			;Volume 3
     468.  00:587B  A1 08               	db $a1,$08			;CMD Track detune
     469.  00:587D  C0                  	db $c0			;Wait 1
     470.  00:587E  4F                  	db $4f			;Note G-7
     471.  00:587F  9A 02               	db $9a,$02			;CMD Note delay
     472.  00:5881                      					;Wait Repeat 1
     473.  00:5881  4D                  	db $4d			;Note F-7
     474.  00:5882  9A 03               	db $9a,$03			;CMD Note delay
     475.  00:5884  C1                  	db $c1			;Wait 2
     476.  00:5885  4A                  	db $4a			;Note D-7
     477.  00:5886  BF                  	db $bf			;[End-Of-Track]
     478.  00:5887                      .track_008:
     479.  00:5887  9C 01               	db $9c,$01			;CMD Drum $01
     480.  00:5889  C3                  	db $c3			;Wait 4
     481.  00:588A  5D                  	db $5d			;Note A-8
     482.  00:588B  6D                  	db $6d			;Volume 12
     483.  00:588C  72                  	db $72			;Instrument 1
     484.  00:588D  C1                  	db $c1			;Wait 2
     485.  00:588E  9C 01               	db $9c,$01			;CMD Drum $01
     486.  00:5890                      					;Wait Repeat 2
     487.  00:5890  21                  	db $21			;Note A-3
     488.  00:5891  70                  	db $70			;Volume 15
     489.  00:5892  7C                  	db $7c			;Instrument 11
     490.  00:5893  9C 02               	db $9c,$02			;CMD Drum $02
     491.  00:5895                      					;Wait Repeat 2
     492.  00:5895  5D                  	db $5d			;Note A-8
     493.  00:5896  6D                  	db $6d			;Volume 12
     494.  00:5897  72                  	db $72			;Instrument 1
     495.  00:5898                      					;Wait Repeat 2
     496.  00:5898  9C 01               	db $9c,$01			;CMD Drum $01
     497.  00:589A  C3                  	db $c3			;Wait 4
     498.  00:589B  2F                  	db $2f			;Note B-4
     499.  00:589C  6E                  	db $6e			;Volume 13
     500.  00:589D  73                  	db $73			;Instrument 2
     501.  00:589E  C0                  	db $c0			;Wait 1
     502.  00:589F  2F                  	db $2f			;Note B-4
     503.  00:58A0  C3                  	db $c3			;Wait 4
     504.  00:58A1  29                  	db $29			;Note F-4
     505.  00:58A2  9A 03               	db $9a,$03			;CMD Note delay
     506.  00:58A4  C4                  	db $c4			;Wait 5
     507.  00:58A5  26                  	db $26			;Note D-4
     508.  00:58A6  9A 05               	db $9a,$05			;CMD Note delay
     509.  00:58A8  C5                  	db $c5			;Wait 6
     510.  00:58A9  9C 01               	db $9c,$01			;CMD Drum $01
     511.  00:58AB  C3                  	db $c3			;Wait 4
     512.  00:58AC  5D                  	db $5d			;Note A-8
     513.  00:58AD  6D                  	db $6d			;Volume 12
     514.  00:58AE  72                  	db $72			;Instrument 1
     515.  00:58AF  C1                  	db $c1			;Wait 2
     516.  00:58B0  9C 01               	db $9c,$01			;CMD Drum $01
     517.  00:58B2                      					;Wait Repeat 2
     518.  00:58B2  21                  	db $21			;Note A-3
     519.  00:58B3  70                  	db $70			;Volume 15
     520.  00:58B4  7C                  	db $7c			;Instrument 11
     521.  00:58B5  9C 02               	db $9c,$02			;CMD Drum $02
     522.  00:58B7                      					;Wait Repeat 2
     523.  00:58B7  5D                  	db $5d			;Note A-8
     524.  00:58B8  6D                  	db $6d			;Volume 12
     525.  00:58B9  72                  	db $72			;Instrument 1
     526.  00:58BA                      					;Wait Repeat 2
     527.  00:58BA  9C 01               	db $9c,$01			;CMD Drum $01
     528.  00:58BC  C3                  	db $c3			;Wait 4
     529.  00:58BD  5D                  	db $5d			;Note A-8
     530.  00:58BE  6D                  	db $6d			;Volume 12
     531.  00:58BF                      					;Wait Repeat 4
     532.  00:58BF  9C 01               	db $9c,$01			;CMD Drum $01
     533.  00:58C1                      					;Wait Repeat 4
     534.  00:58C1  21                  	db $21			;Note A-3
     535.  00:58C2  70                  	db $70			;Volume 15
     536.  00:58C3  7C                  	db $7c			;Instrument 11
     537.  00:58C4  9C 02               	db $9c,$02			;CMD Drum $02
     538.  00:58C6  C1                  	db $c1			;Wait 2
     539.  00:58C7  5D                  	db $5d			;Note A-8
     540.  00:58C8  6D                  	db $6d			;Volume 12
     541.  00:58C9  72                  	db $72			;Instrument 1
     542.  00:58CA                      					;Wait Repeat 2
     543.  00:58CA  5D                  	db $5d			;Note A-8
     544.  00:58CB  6F                  	db $6f			;Volume 14
     545.  00:58CC  7B                  	db $7b			;Instrument 10
     546.  00:58CD  9C 05               	db $9c,$05			;CMD Drum $05
     547.  00:58CF                      					;Wait Repeat 2
     548.  00:58CF  21                  	db $21			;Note A-3
     549.  00:58D0  6D                  	db $6d			;Volume 12
     550.  00:58D1  71                  	db $71			;Instrument 0
     551.  00:58D2  C1                  	db $c1			;Wait 2
     552.  00:58D3  BF                  	db $bf			;[End-Of-Track]
     553.  00:58D4                      .track_009:
     554.  00:58D4                      			;CMD 8 Unused [WARNING]
     555.  00:58D4  C2                  	db $c2			;Wait 3
     556.  00:58D5  47                  	db $47			;Note B-6
     557.  00:58D6  67                  	db $67			;Volume 6
     558.  00:58D7  7A                  	db $7a			;Instrument 9
     559.  00:58D8  A1 08               	db $a1,$08			;CMD Track detune
     560.  00:58DA  C1                  	db $c1			;Wait 2
     561.  00:58DB  42                  	db $42			;Note F#6
     562.  00:58DC                      					;Wait Repeat 2
     563.  00:58DC  3B                  	db $3b			;Note B-5
     564.  00:58DD                      					;Wait Repeat 2
     565.  00:58DD  42                  	db $42			;Note F#6
     566.  00:58DE                      					;Wait Repeat 2
     567.  00:58DE  47                  	db $47			;Note B-6
     568.  00:58DF                      					;Wait Repeat 2
     569.  00:58DF  42                  	db $42			;Note F#6
     570.  00:58E0                      					;Wait Repeat 2
     571.  00:58E0  47                  	db $47			;Note B-6
     572.  00:58E1                      					;Wait Repeat 2
     573.  00:58E1  42                  	db $42			;Note F#6
     574.  00:58E2                      					;Wait Repeat 2
     575.  00:58E2  3B                  	db $3b			;Note B-5
     576.  00:58E3                      					;Wait Repeat 2
     577.  00:58E3  42                  	db $42			;Note F#6
     578.  00:58E4                      					;Wait Repeat 2
     579.  00:58E4  47                  	db $47			;Note B-6
     580.  00:58E5                      					;Wait Repeat 2
     581.  00:58E5  42                  	db $42			;Note F#6
     582.  00:58E6                      					;Wait Repeat 2
     583.  00:58E6  47                  	db $47			;Note B-6
     584.  00:58E7                      					;Wait Repeat 2
     585.  00:58E7  42                  	db $42			;Note F#6
     586.  00:58E8                      					;Wait Repeat 2
     587.  00:58E8  3B                  	db $3b			;Note B-5
     588.  00:58E9                      					;Wait Repeat 2
     589.  00:58E9  42                  	db $42			;Note F#6
     590.  00:58EA                      					;Wait Repeat 2
     591.  00:58EA  47                  	db $47			;Note B-6
     592.  00:58EB                      					;Wait Repeat 2
     593.  00:58EB  42                  	db $42			;Note F#6
     594.  00:58EC                      					;Wait Repeat 2
     595.  00:58EC  3B                  	db $3b			;Note B-5
     596.  00:58ED                      					;Wait Repeat 2
     597.  00:58ED  42                  	db $42			;Note F#6
     598.  00:58EE                      					;Wait Repeat 2
     599.  00:58EE  47                  	db $47			;Note B-6
     600.  00:58EF                      					;Wait Repeat 2
     601.  00:58EF  42                  	db $42			;Note F#6
     602.  00:58F0                      					;Wait Repeat 2
     603.  00:58F0  47                  	db $47			;Note B-6
     604.  00:58F1                      					;Wait Repeat 2
     605.  00:58F1  42                  	db $42			;Note F#6
     606.  00:58F2                      					;Wait Repeat 2
     607.  00:58F2  3B                  	db $3b			;Note B-5
     608.  00:58F3                      					;Wait Repeat 2
     609.  00:58F3  42                  	db $42			;Note F#6
     610.  00:58F4                      					;Wait Repeat 2
     611.  00:58F4  47                  	db $47			;Note B-6
     612.  00:58F5                      					;Wait Repeat 2
     613.  00:58F5  42                  	db $42			;Note F#6
     614.  00:58F6                      					;Wait Repeat 2
     615.  00:58F6  47                  	db $47			;Note B-6
     616.  00:58F7                      					;Wait Repeat 2
     617.  00:58F7  42                  	db $42			;Note F#6
     618.  00:58F8                      					;Wait Repeat 2
     619.  00:58F8  3B                  	db $3b			;Note B-5
     620.  00:58F9  BF                  	db $bf			;[End-Of-Track]
     621.  00:58FA                      .track_010:
     622.  00:58FA  FF                  	db $ff			;Wait 64
     623.  00:58FB  BF                  	db $bf			;[End-Of-Track]
     624.  00:58FC                      .track_011:
     625.  00:58FC  53                  	db $53			;Note B-7
     626.  00:58FD  70                  	db $70			;Volume 15
     627.  00:58FE  78                  	db $78			;Instrument 7
     628.  00:58FF  A1 08               	db $a1,$08			;CMD Track detune
     629.  00:5901  C1                  	db $c1			;Wait 2
     630.  00:5902  4E                  	db $4e			;Note F#7
     631.  00:5903  6F                  	db $6f			;Volume 14
     632.  00:5904                      					;Wait Repeat 2
     633.  00:5904  47                  	db $47			;Note B-6
     634.  00:5905                      					;Wait Repeat 2
     635.  00:5905  4E                  	db $4e			;Note F#7
     636.  00:5906                      					;Wait Repeat 2
     637.  00:5906  53                  	db $53			;Note B-7
     638.  00:5907                      					;Wait Repeat 2
     639.  00:5907  4E                  	db $4e			;Note F#7
     640.  00:5908                      					;Wait Repeat 2
     641.  00:5908  53                  	db $53			;Note B-7
     642.  00:5909                      					;Wait Repeat 2
     643.  00:5909  4E                  	db $4e			;Note F#7
     644.  00:590A                      					;Wait Repeat 2
     645.  00:590A  47                  	db $47			;Note B-6
     646.  00:590B                      					;Wait Repeat 2
     647.  00:590B  4E                  	db $4e			;Note F#7
     648.  00:590C                      					;Wait Repeat 2
     649.  00:590C  53                  	db $53			;Note B-7
     650.  00:590D                      					;Wait Repeat 2
     651.  00:590D  4E                  	db $4e			;Note F#7
     652.  00:590E                      					;Wait Repeat 2
     653.  00:590E  53                  	db $53			;Note B-7
     654.  00:590F                      					;Wait Repeat 2
     655.  00:590F  4E                  	db $4e			;Note F#7
     656.  00:5910                      					;Wait Repeat 2
     657.  00:5910  47                  	db $47			;Note B-6
     658.  00:5911                      					;Wait Repeat 2
     659.  00:5911  4E                  	db $4e			;Note F#7
     660.  00:5912                      					;Wait Repeat 2
     661.  00:5912  53                  	db $53			;Note B-7
     662.  00:5913                      					;Wait Repeat 2
     663.  00:5913  4E                  	db $4e			;Note F#7
     664.  00:5914                      					;Wait Repeat 2
     665.  00:5914  47                  	db $47			;Note B-6
     666.  00:5915                      					;Wait Repeat 2
     667.  00:5915  4E                  	db $4e			;Note F#7
     668.  00:5916                      					;Wait Repeat 2
     669.  00:5916  53                  	db $53			;Note B-7
     670.  00:5917                      					;Wait Repeat 2
     671.  00:5917  4E                  	db $4e			;Note F#7
     672.  00:5918                      					;Wait Repeat 2
     673.  00:5918  53                  	db $53			;Note B-7
     674.  00:5919                      					;Wait Repeat 2
     675.  00:5919  4E                  	db $4e			;Note F#7
     676.  00:591A                      					;Wait Repeat 2
     677.  00:591A  47                  	db $47			;Note B-6
     678.  00:591B                      					;Wait Repeat 2
     679.  00:591B  4E                  	db $4e			;Note F#7
     680.  00:591C                      					;Wait Repeat 2
     681.  00:591C  53                  	db $53			;Note B-7
     682.  00:591D                      					;Wait Repeat 2
     683.  00:591D  4E                  	db $4e			;Note F#7
     684.  00:591E                      					;Wait Repeat 2
     685.  00:591E  53                  	db $53			;Note B-7
     686.  00:591F                      					;Wait Repeat 2
     687.  00:591F  4E                  	db $4e			;Note F#7
     688.  00:5920                      					;Wait Repeat 2
     689.  00:5920  47                  	db $47			;Note B-6
     690.  00:5921                      					;Wait Repeat 2
     691.  00:5921  4E                  	db $4e			;Note F#7
     692.  00:5922  C1                  	db $c1			;Wait 2
     693.  00:5923  BF                  	db $bf			;[End-Of-Track]
     694.  00:5924                      .track_012:
     695.  00:5924  17                  	db $17			;Note B-2
     696.  00:5925  6E                  	db $6e			;Volume 13
     697.  00:5926  76                  	db $76			;Instrument 5
     698.  00:5927  C3                  	db $c3			;Wait 4
     699.  00:5928  17                  	db $17			;Note B-2
     700.  00:5929  C1                  	db $c1			;Wait 2
     701.  00:592A  17                  	db $17			;Note B-2
     702.  00:592B                      					;Wait Repeat 2
     703.  00:592B  23                  	db $23			;Note B-3
     704.  00:592C  C3                  	db $c3			;Wait 4
     705.  00:592D  17                  	db $17			;Note B-2
     706.  00:592E  C1                  	db $c1			;Wait 2
     707.  00:592F  17                  	db $17			;Note B-2
     708.  00:5930                      					;Wait Repeat 2
     709.  00:5930  19                  	db $19			;Note C#3
     710.  00:5931  C4                  	db $c4			;Wait 5
     711.  00:5932  21                  	db $21			;Note A-3
     712.  00:5933  9A 02               	db $9a,$02			;CMD Note delay
     713.  00:5935                      					;Wait Repeat 5
     714.  00:5935  25                  	db $25			;Note C#4
     715.  00:5936  9A 05               	db $9a,$05			;CMD Note delay
     716.  00:5938  C5                  	db $c5			;Wait 6
     717.  00:5939  1A                  	db $1a			;Note D-3
     718.  00:593A  C3                  	db $c3			;Wait 4
     719.  00:593B  1A                  	db $1a			;Note D-3
     720.  00:593C  C1                  	db $c1			;Wait 2
     721.  00:593D  1A                  	db $1a			;Note D-3
     722.  00:593E                      					;Wait Repeat 2
     723.  00:593E  26                  	db $26			;Note D-4
     724.  00:593F  C3                  	db $c3			;Wait 4
     725.  00:5940  1A                  	db $1a			;Note D-3
     726.  00:5941  C1                  	db $c1			;Wait 2
     727.  00:5942  1A                  	db $1a			;Note D-3
     728.  00:5943                      					;Wait Repeat 2
     729.  00:5943  19                  	db $19			;Note C#3
     730.  00:5944  C3                  	db $c3			;Wait 4
     731.  00:5945  19                  	db $19			;Note C#3
     732.  00:5946  C1                  	db $c1			;Wait 2
     733.  00:5947  19                  	db $19			;Note C#3
     734.  00:5948                      					;Wait Repeat 2
     735.  00:5948  25                  	db $25			;Note C#4
     736.  00:5949  C7                  	db $c7			;Wait 8
     737.  00:594A  BF                  	db $bf			;[End-Of-Track]
     738.  00:594B                      .track_013:
     739.  00:594B  39                  	db $39			;Note A-5
     740.  00:594C  6C                  	db $6c			;Volume 11
     741.  00:594D  77                  	db $77			;Instrument 6
     742.  00:594E  CB                  	db $cb			;Wait 12
     743.  00:594F  39                  	db $39			;Note A-5
     744.  00:5950  C1                  	db $c1			;Wait 2
     745.  00:5951  39                  	db $39			;Note A-5
     746.  00:5952                      					;Wait Repeat 2
     747.  00:5952  3B                  	db $3b			;Note B-5
     748.  00:5953  C4                  	db $c4			;Wait 5
     749.  00:5954  3B                  	db $3b			;Note B-5
     750.  00:5955  9A 03               	db $9a,$03			;CMD Note delay
     751.  00:5957                      					;Wait Repeat 5
     752.  00:5957  3B                  	db $3b			;Note B-5
     753.  00:5958  9A 05               	db $9a,$05			;CMD Note delay
     754.  00:595A  C5                  	db $c5			;Wait 6
     755.  00:595B  3D                  	db $3d			;Note C#6
     756.  00:595C  CB                  	db $cb			;Wait 12
     757.  00:595D  3D                  	db $3d			;Note C#6
     758.  00:595E  C1                  	db $c1			;Wait 2
     759.  00:595F  3D                  	db $3d			;Note C#6
     760.  00:5960                      					;Wait Repeat 2
     761.  00:5960  3B                  	db $3b			;Note B-5
     762.  00:5961  C4                  	db $c4			;Wait 5
     763.  00:5962  3B                  	db $3b			;Note B-5
     764.  00:5963  9A 03               	db $9a,$03			;CMD Note delay
     765.  00:5965                      					;Wait Repeat 5
     766.  00:5965  38                  	db $38			;Note G#5
     767.  00:5966  9A 05               	db $9a,$05			;CMD Note delay
     768.  00:5968  C5                  	db $c5			;Wait 6
     769.  00:5969  BF                  	db $bf			;[End-Of-Track]
     770.  00:596A                      .track_014:
     771.  00:596A  3E                  	db $3e			;Note D-6
     772.  00:596B  6C                  	db $6c			;Volume 11
     773.  00:596C  77                  	db $77			;Instrument 6
     774.  00:596D  CB                  	db $cb			;Wait 12
     775.  00:596E  3E                  	db $3e			;Note D-6
     776.  00:596F  C1                  	db $c1			;Wait 2
     777.  00:5970  3E                  	db $3e			;Note D-6
     778.  00:5971                      					;Wait Repeat 2
     779.  00:5971  40                  	db $40			;Note E-6
     780.  00:5972  C4                  	db $c4			;Wait 5
     781.  00:5973  40                  	db $40			;Note E-6
     782.  00:5974  9A 03               	db $9a,$03			;CMD Note delay
     783.  00:5976                      					;Wait Repeat 5
     784.  00:5976  40                  	db $40			;Note E-6
     785.  00:5977  9A 05               	db $9a,$05			;CMD Note delay
     786.  00:5979  C5                  	db $c5			;Wait 6
     787.  00:597A  42                  	db $42			;Note F#6
     788.  00:597B  CB                  	db $cb			;Wait 12
     789.  00:597C  42                  	db $42			;Note F#6
     790.  00:597D  C1                  	db $c1			;Wait 2
     791.  00:597E  42                  	db $42			;Note F#6
     792.  00:597F                      					;Wait Repeat 2
     793.  00:597F  40                  	db $40			;Note E-6
     794.  00:5980  C4                  	db $c4			;Wait 5
     795.  00:5981  40                  	db $40			;Note E-6
     796.  00:5982  9A 03               	db $9a,$03			;CMD Note delay
     797.  00:5984                      					;Wait Repeat 5
     798.  00:5984  3B                  	db $3b			;Note B-5
     799.  00:5985  9A 05               	db $9a,$05			;CMD Note delay
     800.  00:5987  C5                  	db $c5			;Wait 6
     801.  00:5988  BF                  	db $bf			;[End-Of-Track]
     802.  00:5989                      .track_015:
     803.  00:5989  42                  	db $42			;Note F#6
     804.  00:598A  6C                  	db $6c			;Volume 11
     805.  00:598B  77                  	db $77			;Instrument 6
     806.  00:598C  C2                  	db $c2			;Wait 3
     807.  00:598D  94 66               	db $94,$66		;CMD Vibrato
     808.  00:598F  C8                  	db $c8			;Wait 9
     809.  00:5990  42                  	db $42			;Note F#6
     810.  00:5991  9B                  	db $9b			;CMD End 
     811.  00:5992  C1                  	db $c1			;Wait 2
     812.  00:5993  42                  	db $42			;Note F#6
     813.  00:5994                      					;Wait Repeat 2
     814.  00:5994  44                  	db $44			;Note G#6
     815.  00:5995  C4                  	db $c4			;Wait 5
     816.  00:5996  45                  	db $45			;Note A-6
     817.  00:5997  9A 03               	db $9a,$03			;CMD Note delay
     818.  00:5999                      					;Wait Repeat 5
     819.  00:5999  47                  	db $47			;Note B-6
     820.  00:599A  9A 05               	db $9a,$05			;CMD Note delay
     821.  00:599C  C5                  	db $c5			;Wait 6
     822.  00:599D  45                  	db $45			;Note A-6
     823.  00:599E  C3                  	db $c3			;Wait 4
     824.  00:599F  94 66               	db $94,$66		;CMD Vibrato
     825.  00:59A1  C7                  	db $c7			;Wait 8
     826.  00:59A2  45                  	db $45			;Note A-6
     827.  00:59A3  9B                  	db $9b			;CMD End 
     828.  00:59A4  C1                  	db $c1			;Wait 2
     829.  00:59A5  45                  	db $45			;Note A-6
     830.  00:59A6                      					;Wait Repeat 2
     831.  00:59A6  44                  	db $44			;Note G#6
     832.  00:59A7  C4                  	db $c4			;Wait 5
     833.  00:59A8  42                  	db $42			;Note F#6
     834.  00:59A9  9A 03               	db $9a,$03			;CMD Note delay
     835.  00:59AB                      					;Wait Repeat 5
     836.  00:59AB  40                  	db $40			;Note E-6
     837.  00:59AC  9A 05               	db $9a,$05			;CMD Note delay
     838.  00:59AE  C5                  	db $c5			;Wait 6
     839.  00:59AF  BF                  	db $bf			;[End-Of-Track]
     840.  00:59B0                      .track_016:
     841.  00:59B0  9C 01               	db $9c,$01			;CMD Drum $01
     842.  00:59B2  C3                  	db $c3			;Wait 4
     843.  00:59B3  5D                  	db $5d			;Note A-8
     844.  00:59B4  6D                  	db $6d			;Volume 12
     845.  00:59B5  72                  	db $72			;Instrument 1
     846.  00:59B6  C1                  	db $c1			;Wait 2
     847.  00:59B7  9C 01               	db $9c,$01			;CMD Drum $01
     848.  00:59B9                      					;Wait Repeat 2
     849.  00:59B9  21                  	db $21			;Note A-3
     850.  00:59BA  70                  	db $70			;Volume 15
     851.  00:59BB  7C                  	db $7c			;Instrument 11
     852.  00:59BC  9C 02               	db $9c,$02			;CMD Drum $02
     853.  00:59BE                      					;Wait Repeat 2
     854.  00:59BE  5D                  	db $5d			;Note A-8
     855.  00:59BF  6D                  	db $6d			;Volume 12
     856.  00:59C0  72                  	db $72			;Instrument 1
     857.  00:59C1                      					;Wait Repeat 2
     858.  00:59C1  9C 01               	db $9c,$01			;CMD Drum $01
     859.  00:59C3  C3                  	db $c3			;Wait 4
     860.  00:59C4  5D                  	db $5d			;Note A-8
     861.  00:59C5  6D                  	db $6d			;Volume 12
     862.  00:59C6                      					;Wait Repeat 4
     863.  00:59C6  9C 01               	db $9c,$01			;CMD Drum $01
     864.  00:59C8                      					;Wait Repeat 4
     865.  00:59C8  21                  	db $21			;Note A-3
     866.  00:59C9  70                  	db $70			;Volume 15
     867.  00:59CA  7C                  	db $7c			;Instrument 11
     868.  00:59CB  9C 02               	db $9c,$02			;CMD Drum $02
     869.  00:59CD  C1                  	db $c1			;Wait 2
     870.  00:59CE  5D                  	db $5d			;Note A-8
     871.  00:59CF  6D                  	db $6d			;Volume 12
     872.  00:59D0  72                  	db $72			;Instrument 1
     873.  00:59D1                      					;Wait Repeat 2
     874.  00:59D1  5D                  	db $5d			;Note A-8
     875.  00:59D2  6F                  	db $6f			;Volume 14
     876.  00:59D3  7B                  	db $7b			;Instrument 10
     877.  00:59D4                      					;Wait Repeat 2
     878.  00:59D4  21                  	db $21			;Note A-3
     879.  00:59D5  6D                  	db $6d			;Volume 12
     880.  00:59D6  71                  	db $71			;Instrument 0
     881.  00:59D7                      					;Wait Repeat 2
     882.  00:59D7  9C 01               	db $9c,$01			;CMD Drum $01
     883.  00:59D9  C3                  	db $c3			;Wait 4
     884.  00:59DA  5D                  	db $5d			;Note A-8
     885.  00:59DB  6D                  	db $6d			;Volume 12
     886.  00:59DC  72                  	db $72			;Instrument 1
     887.  00:59DD  C1                  	db $c1			;Wait 2
     888.  00:59DE  9C 01               	db $9c,$01			;CMD Drum $01
     889.  00:59E0                      					;Wait Repeat 2
     890.  00:59E0  21                  	db $21			;Note A-3
     891.  00:59E1  70                  	db $70			;Volume 15
     892.  00:59E2  7C                  	db $7c			;Instrument 11
     893.  00:59E3  9C 02               	db $9c,$02			;CMD Drum $02
     894.  00:59E5                      					;Wait Repeat 2
     895.  00:59E5  5D                  	db $5d			;Note A-8
     896.  00:59E6  6D                  	db $6d			;Volume 12
     897.  00:59E7  72                  	db $72			;Instrument 1
     898.  00:59E8                      					;Wait Repeat 2
     899.  00:59E8  9C 01               	db $9c,$01			;CMD Drum $01
     900.  00:59EA  C3                  	db $c3			;Wait 4
     901.  00:59EB  5D                  	db $5d			;Note A-8
     902.  00:59EC  6D                  	db $6d			;Volume 12
     903.  00:59ED  C1                  	db $c1			;Wait 2
     904.  00:59EE  5D                  	db $5d			;Note A-8
     905.  00:59EF  6D                  	db $6d			;Volume 12
     906.  00:59F0                      					;Wait Repeat 2
     907.  00:59F0  5D                  	db $5d			;Note A-8
     908.  00:59F1  6E                  	db $6e			;Volume 13
     909.  00:59F2  7B                  	db $7b			;Instrument 10
     910.  00:59F3  9C 05               	db $9c,$05			;CMD Drum $05
     911.  00:59F5                      					;Wait Repeat 2
     912.  00:59F5  9C 01               	db $9c,$01			;CMD Drum $01
     913.  00:59F7                      					;Wait Repeat 2
     914.  00:59F7  21                  	db $21			;Note A-3
     915.  00:59F8  70                  	db $70			;Volume 15
     916.  00:59F9  7C                  	db $7c			;Instrument 11
     917.  00:59FA  9C 02               	db $9c,$02			;CMD Drum $02
     918.  00:59FC  C3                  	db $c3			;Wait 4
     919.  00:59FD  5D                  	db $5d			;Note A-8
     920.  00:59FE  6F                  	db $6f			;Volume 14
     921.  00:59FF  7B                  	db $7b			;Instrument 10
     922.  00:5A00  9C 05               	db $9c,$05			;CMD Drum $05
     923.  00:5A02  C1                  	db $c1			;Wait 2
     924.  00:5A03  21                  	db $21			;Note A-3
     925.  00:5A04  6D                  	db $6d			;Volume 12
     926.  00:5A05  71                  	db $71			;Instrument 0
     927.  00:5A06  C1                  	db $c1			;Wait 2
     928.  00:5A07  BF                  	db $bf			;[End-Of-Track]
     929.  00:5A08                      .track_017:
     930.  00:5A08                      			;CMD 8 Unused [WARNING]
     931.  00:5A08  C2                  	db $c2			;Wait 3
     932.  00:5A09  47                  	db $47			;Note B-6
     933.  00:5A0A  69                  	db $69			;Volume 8
     934.  00:5A0B  7A                  	db $7a			;Instrument 9
     935.  00:5A0C  A1 08               	db $a1,$08			;CMD Track detune
     936.  00:5A0E  C1                  	db $c1			;Wait 2
     937.  00:5A0F  42                  	db $42			;Note F#6
     938.  00:5A10                      					;Wait Repeat 2
     939.  00:5A10  3B                  	db $3b			;Note B-5
     940.  00:5A11                      					;Wait Repeat 2
     941.  00:5A11  42                  	db $42			;Note F#6
     942.  00:5A12                      					;Wait Repeat 2
     943.  00:5A12  47                  	db $47			;Note B-6
     944.  00:5A13                      					;Wait Repeat 2
     945.  00:5A13  42                  	db $42			;Note F#6
     946.  00:5A14                      					;Wait Repeat 2
     947.  00:5A14  47                  	db $47			;Note B-6
     948.  00:5A15                      					;Wait Repeat 2
     949.  00:5A15  42                  	db $42			;Note F#6
     950.  00:5A16                      					;Wait Repeat 2
     951.  00:5A16  3B                  	db $3b			;Note B-5
     952.  00:5A17                      					;Wait Repeat 2
     953.  00:5A17  42                  	db $42			;Note F#6
     954.  00:5A18                      					;Wait Repeat 2
     955.  00:5A18  47                  	db $47			;Note B-6
     956.  00:5A19                      					;Wait Repeat 2
     957.  00:5A19  42                  	db $42			;Note F#6
     958.  00:5A1A                      					;Wait Repeat 2
     959.  00:5A1A  47                  	db $47			;Note B-6
     960.  00:5A1B                      					;Wait Repeat 2
     961.  00:5A1B  42                  	db $42			;Note F#6
     962.  00:5A1C                      					;Wait Repeat 2
     963.  00:5A1C  3B                  	db $3b			;Note B-5
     964.  00:5A1D                      					;Wait Repeat 2
     965.  00:5A1D  42                  	db $42			;Note F#6
     966.  00:5A1E                      					;Wait Repeat 2
     967.  00:5A1E  47                  	db $47			;Note B-6
     968.  00:5A1F                      					;Wait Repeat 2
     969.  00:5A1F  42                  	db $42			;Note F#6
     970.  00:5A20                      					;Wait Repeat 2
     971.  00:5A20  3B                  	db $3b			;Note B-5
     972.  00:5A21                      					;Wait Repeat 2
     973.  00:5A21  42                  	db $42			;Note F#6
     974.  00:5A22                      					;Wait Repeat 2
     975.  00:5A22  47                  	db $47			;Note B-6
     976.  00:5A23                      					;Wait Repeat 2
     977.  00:5A23  42                  	db $42			;Note F#6
     978.  00:5A24                      					;Wait Repeat 2
     979.  00:5A24  47                  	db $47			;Note B-6
     980.  00:5A25                      					;Wait Repeat 2
     981.  00:5A25  42                  	db $42			;Note F#6
     982.  00:5A26                      					;Wait Repeat 2
     983.  00:5A26  3B                  	db $3b			;Note B-5
     984.  00:5A27                      					;Wait Repeat 2
     985.  00:5A27  42                  	db $42			;Note F#6
     986.  00:5A28                      					;Wait Repeat 2
     987.  00:5A28  47                  	db $47			;Note B-6
     988.  00:5A29                      					;Wait Repeat 2
     989.  00:5A29  42                  	db $42			;Note F#6
     990.  00:5A2A                      					;Wait Repeat 2
     991.  00:5A2A  47                  	db $47			;Note B-6
     992.  00:5A2B                      					;Wait Repeat 2
     993.  00:5A2B  42                  	db $42			;Note F#6
     994.  00:5A2C                      					;Wait Repeat 2
     995.  00:5A2C  3B                  	db $3b			;Note B-5
     996.  00:5A2D  BF                  	db $bf			;[End-Of-Track]
     997.  00:5A2E                      .track_021:
     998.  00:5A2E  32                  	db $32			;Note D-5
     999.  00:5A2F  6C                  	db $6c			;Volume 11
    1000.  00:5A30  74                  	db $74			;Instrument 3
    1001.  00:5A31  C1                  	db $c1			;Wait 2
    1002.  00:5A32  32                  	db $32			;Note D-5
    1003.  00:5A33                      					;Wait Repeat 2
    1004.  00:5A33  32                  	db $32			;Note D-5
    1005.  00:5A34                      					;Wait Repeat 2
    1006.  00:5A34  32                  	db $32			;Note D-5
    1007.  00:5A35  C5                  	db $c5			;Wait 6
    1008.  00:5A36  32                  	db $32			;Note D-5
    1009.  00:5A37  C1                  	db $c1			;Wait 2
    1010.  00:5A38  32                  	db $32			;Note D-5
    1011.  00:5A39                      					;Wait Repeat 2
    1012.  00:5A39  34                  	db $34			;Note E-5
    1013.  00:5A3A                      					;Wait Repeat 2
    1014.  00:5A3A  34                  	db $34			;Note E-5
    1015.  00:5A3B  C5                  	db $c5			;Wait 6
    1016.  00:5A3C  34                  	db $34			;Note E-5
    1017.  00:5A3D  C1                  	db $c1			;Wait 2
    1018.  00:5A3E  34                  	db $34			;Note E-5
    1019.  00:5A3F  C5                  	db $c5			;Wait 6
    1020.  00:5A40  36                  	db $36			;Note F#5
    1021.  00:5A41  C1                  	db $c1			;Wait 2
    1022.  00:5A42  36                  	db $36			;Note F#5
    1023.  00:5A43                      					;Wait Repeat 2
    1024.  00:5A43  36                  	db $36			;Note F#5
    1025.  00:5A44                      					;Wait Repeat 2
    1026.  00:5A44  36                  	db $36			;Note F#5
    1027.  00:5A45  C5                  	db $c5			;Wait 6
    1028.  00:5A46  36                  	db $36			;Note F#5
    1029.  00:5A47  C1                  	db $c1			;Wait 2
    1030.  00:5A48  36                  	db $36			;Note F#5
    1031.  00:5A49                      					;Wait Repeat 2
    1032.  00:5A49  34                  	db $34			;Note E-5
    1033.  00:5A4A  6E                  	db $6e			;Volume 13
    1034.  00:5A4B  75                  	db $75			;Instrument 4
    1035.  00:5A4C  C7                  	db $c7			;Wait 8
    1036.  00:5A4D  2C                  	db $2c			;Note G#4
    1037.  00:5A4E  C7                  	db $c7			;Wait 8
    1038.  00:5A4F  BF                  	db $bf			;[End-Of-Track]
    1039.  00:5A50                      .track_022:
    1040.  00:5A50  34                  	db $34			;Note E-5
    1041.  00:5A51  70                  	db $70			;Volume 15
    1042.  00:5A52  79                  	db $79			;Instrument 8
    1043.  00:5A53  A1 08               	db $a1,$08			;CMD Track detune
    1044.  00:5A55  C0                  	db $c0			;Wait 1
    1045.  00:5A56  36                  	db $36			;Note F#5
    1046.  00:5A57  90 0A               	db $90,$0a			;CMD Portamento tone
    1047.  00:5A59  C3                  	db $c3			;Wait 4
    1048.  00:5A5A  94 26               	db $94,$26		;CMD Vibrato
    1049.  00:5A5C  C4                  	db $c4			;Wait 5
    1050.  00:5A5D  34                  	db $34			;Note E-5
    1051.  00:5A5E  9B                  	db $9b			;CMD End 
    1052.  00:5A5F  C1                  	db $c1			;Wait 2
    1053.  00:5A60  32                  	db $32			;Note D-5
    1054.  00:5A61                      					;Wait Repeat 2
    1055.  00:5A61  36                  	db $36			;Note F#5
    1056.  00:5A62                      					;Wait Repeat 2
    1057.  00:5A62  38                  	db $38			;Note G#5
    1058.  00:5A63                      					;Wait Repeat 2
    1059.  00:5A63  34                  	db $34			;Note E-5
    1060.  00:5A64  9A 03               	db $9a,$03			;CMD Note delay
    1061.  00:5A66  C2                  	db $c2			;Wait 3
    1062.  00:5A67  2F                  	db $2f			;Note B-4
    1063.  00:5A68  9A 02               	db $9a,$02			;CMD Note delay
    1064.  00:5A6A                      					;Wait Repeat 3
    1065.  00:5A6A  34                  	db $34			;Note E-5
    1066.  00:5A6B  C1                  	db $c1			;Wait 2
    1067.  00:5A6C  38                  	db $38			;Note G#5
    1068.  00:5A6D  9A 03               	db $9a,$03			;CMD Note delay
    1069.  00:5A6F  C2                  	db $c2			;Wait 3
    1070.  00:5A70  3B                  	db $3b			;Note B-5
    1071.  00:5A71  9A 02               	db $9a,$02			;CMD Note delay
    1072.  00:5A73                      					;Wait Repeat 3
    1073.  00:5A73  38                  	db $38			;Note G#5
    1074.  00:5A74  C0                  	db $c0			;Wait 1
    1075.  00:5A75  39                  	db $39			;Note A-5
    1076.  00:5A76  90 04               	db $90,$04			;CMD Portamento tone
    1077.  00:5A78  C3                  	db $c3			;Wait 4
    1078.  00:5A79  94 36               	db $94,$36		;CMD Vibrato
    1079.  00:5A7B                      					;Wait Repeat 4
    1080.  00:5A7B  9B                  	db $9b			;CMD End 
    1081.  00:5A7C  C0                  	db $c0			;Wait 1
    1082.  00:5A7D  38                  	db $38			;Note G#5
    1083.  00:5A7E  C1                  	db $c1			;Wait 2
    1084.  00:5A7F  39                  	db $39			;Note A-5
    1085.  00:5A80                      					;Wait Repeat 2
    1086.  00:5A80  3B                  	db $3b			;Note B-5
    1087.  00:5A81                      					;Wait Repeat 2
    1088.  00:5A81  3E                  	db $3e			;Note D-6
    1089.  00:5A82  C0                  	db $c0			;Wait 1
    1090.  00:5A83  3D                  	db $3d			;Note C#6
    1091.  00:5A84  9A 02               	db $9a,$02			;CMD Note delay
    1092.  00:5A86                      					;Wait Repeat 1
    1093.  00:5A86  3B                  	db $3b			;Note B-5
    1094.  00:5A87  9A 03               	db $9a,$03			;CMD Note delay
    1095.  00:5A89  C1                  	db $c1			;Wait 2
    1096.  00:5A8A  39                  	db $39			;Note A-5
    1097.  00:5A8B  C0                  	db $c0			;Wait 1
    1098.  00:5A8C  38                  	db $38			;Note G#5
    1099.  00:5A8D  9A 02               	db $9a,$02			;CMD Note delay
    1100.  00:5A8F                      					;Wait Repeat 1
    1101.  00:5A8F  36                  	db $36			;Note F#5
    1102.  00:5A90  9A 03               	db $9a,$03			;CMD Note delay
    1103.  00:5A92  C1                  	db $c1			;Wait 2
    1104.  00:5A93  34                  	db $34			;Note E-5
    1105.  00:5A94  A1 08               	db $a1,$08			;CMD Track detune
    1106.  00:5A96  C0                  	db $c0			;Wait 1
    1107.  00:5A97  36                  	db $36			;Note F#5
    1108.  00:5A98  9A 02               	db $9a,$02			;CMD Note delay
    1109.  00:5A9A                      					;Wait Repeat 1
    1110.  00:5A9A  38                  	db $38			;Note G#5
    1111.  00:5A9B  9A 03               	db $9a,$03			;CMD Note delay
    1112.  00:5A9D  C1                  	db $c1			;Wait 2
    1113.  00:5A9E  39                  	db $39			;Note A-5
    1114.  00:5A9F  C0                  	db $c0			;Wait 1
    1115.  00:5AA0  34                  	db $34			;Note E-5
    1116.  00:5AA1  9A 02               	db $9a,$02			;CMD Note delay
    1117.  00:5AA3                      					;Wait Repeat 1
    1118.  00:5AA3  31                  	db $31			;Note C#5
    1119.  00:5AA4  9A 03               	db $9a,$03			;CMD Note delay
    1120.  00:5AA6  C1                  	db $c1			;Wait 2
    1121.  00:5AA7  BF                  	db $bf			;[End-Of-Track]
    1122.  00:5AA8                      .track_023:
    1123.  00:5AA8  C2                  	db $c2			;Wait 3
    1124.  00:5AA9  34                  	db $34			;Note E-5
    1125.  00:5AAA  68                  	db $68			;Volume 7
    1126.  00:5AAB  79                  	db $79			;Instrument 8
    1127.  00:5AAC  A1 09               	db $a1,$09			;CMD Track detune
    1128.  00:5AAE  C0                  	db $c0			;Wait 1
    1129.  00:5AAF  36                  	db $36			;Note F#5
    1130.  00:5AB0  90 0A               	db $90,$0a			;CMD Portamento tone
    1131.  00:5AB2  C3                  	db $c3			;Wait 4
    1132.  00:5AB3  94 26               	db $94,$26		;CMD Vibrato
    1133.  00:5AB5  C4                  	db $c4			;Wait 5
    1134.  00:5AB6  34                  	db $34			;Note E-5
    1135.  00:5AB7  9B                  	db $9b			;CMD End 
    1136.  00:5AB8  C1                  	db $c1			;Wait 2
    1137.  00:5AB9  32                  	db $32			;Note D-5
    1138.  00:5ABA                      					;Wait Repeat 2
    1139.  00:5ABA  36                  	db $36			;Note F#5
    1140.  00:5ABB                      					;Wait Repeat 2
    1141.  00:5ABB  38                  	db $38			;Note G#5
    1142.  00:5ABC                      					;Wait Repeat 2
    1143.  00:5ABC  34                  	db $34			;Note E-5
    1144.  00:5ABD  9A 03               	db $9a,$03			;CMD Note delay
    1145.  00:5ABF  C2                  	db $c2			;Wait 3
    1146.  00:5AC0  2F                  	db $2f			;Note B-4
    1147.  00:5AC1  9A 02               	db $9a,$02			;CMD Note delay
    1148.  00:5AC3                      					;Wait Repeat 3
    1149.  00:5AC3  34                  	db $34			;Note E-5
    1150.  00:5AC4  C1                  	db $c1			;Wait 2
    1151.  00:5AC5  38                  	db $38			;Note G#5
    1152.  00:5AC6  9A 03               	db $9a,$03			;CMD Note delay
    1153.  00:5AC8  C2                  	db $c2			;Wait 3
    1154.  00:5AC9  3B                  	db $3b			;Note B-5
    1155.  00:5ACA  9A 02               	db $9a,$02			;CMD Note delay
    1156.  00:5ACC                      					;Wait Repeat 3
    1157.  00:5ACC  38                  	db $38			;Note G#5
    1158.  00:5ACD  C0                  	db $c0			;Wait 1
    1159.  00:5ACE  39                  	db $39			;Note A-5
    1160.  00:5ACF  90 04               	db $90,$04			;CMD Portamento tone
    1161.  00:5AD1  C3                  	db $c3			;Wait 4
    1162.  00:5AD2  94 36               	db $94,$36		;CMD Vibrato
    1163.  00:5AD4                      					;Wait Repeat 4
    1164.  00:5AD4  9B                  	db $9b			;CMD End 
    1165.  00:5AD5  C0                  	db $c0			;Wait 1
    1166.  00:5AD6  38                  	db $38			;Note G#5
    1167.  00:5AD7  C1                  	db $c1			;Wait 2
    1168.  00:5AD8  39                  	db $39			;Note A-5
    1169.  00:5AD9                      					;Wait Repeat 2
    1170.  00:5AD9  3B                  	db $3b			;Note B-5
    1171.  00:5ADA                      					;Wait Repeat 2
    1172.  00:5ADA  3E                  	db $3e			;Note D-6
    1173.  00:5ADB  C0                  	db $c0			;Wait 1
    1174.  00:5ADC  3D                  	db $3d			;Note C#6
    1175.  00:5ADD  9A 02               	db $9a,$02			;CMD Note delay
    1176.  00:5ADF                      					;Wait Repeat 1
    1177.  00:5ADF  3B                  	db $3b			;Note B-5
    1178.  00:5AE0  9A 03               	db $9a,$03			;CMD Note delay
    1179.  00:5AE2  C1                  	db $c1			;Wait 2
    1180.  00:5AE3  39                  	db $39			;Note A-5
    1181.  00:5AE4  C0                  	db $c0			;Wait 1
    1182.  00:5AE5  38                  	db $38			;Note G#5
    1183.  00:5AE6  9A 02               	db $9a,$02			;CMD Note delay
    1184.  00:5AE8                      					;Wait Repeat 1
    1185.  00:5AE8  36                  	db $36			;Note F#5
    1186.  00:5AE9  9A 03               	db $9a,$03			;CMD Note delay
    1187.  00:5AEB  C1                  	db $c1			;Wait 2
    1188.  00:5AEC  34                  	db $34			;Note E-5
    1189.  00:5AED  A1 08               	db $a1,$08			;CMD Track detune
    1190.  00:5AEF  C0                  	db $c0			;Wait 1
    1191.  00:5AF0  36                  	db $36			;Note F#5
    1192.  00:5AF1  9A 02               	db $9a,$02			;CMD Note delay
    1193.  00:5AF3                      					;Wait Repeat 1
    1194.  00:5AF3  38                  	db $38			;Note G#5
    1195.  00:5AF4  9A 03               	db $9a,$03			;CMD Note delay
    1196.  00:5AF6  C1                  	db $c1			;Wait 2
    1197.  00:5AF7  39                  	db $39			;Note A-5
    1198.  00:5AF8  BF                  	db $bf			;[End-Of-Track]
    1199.  00:5AF9                      .track_024:
    1200.  00:5AF9  9C 01               	db $9c,$01			;CMD Drum $01
    1201.  00:5AFB  C0                  	db $c0			;Wait 1
    1202.  00:5AFC  97 8C               	db $97,$8c			;CMD Volume slide up
    1203.  00:5AFE  C6                  	db $c6			;Wait 7
    1204.  00:5AFF  60                  	db $60			;Release 96
    1205.  00:5B00  F7                  	db $f7			;Wait 56
    1206.  00:5B01  BF                  	db $bf			;[End-Of-Track]
    1207.  00:5B02                      .track_025:
    1208.  00:5B02                      			;CMD 8 Unused [WARNING]
    1209.  00:5B02  C0                  	db $c0			;Wait 1
    1210.  00:5B03  97 8C               	db $97,$8c			;CMD Volume slide up
    1211.  00:5B05  C6                  	db $c6			;Wait 7
    1212.  00:5B06  60                  	db $60			;Release 96
    1213.  00:5B07  F7                  	db $f7			;Wait 56
    1214.  00:5B08  BF                  	db $bf			;[End-Of-Track]
    1215.  00:5B09                      .track_027:
    1216.  00:5B09  53                  	db $53			;Note B-7
    1217.  00:5B0A  6E                  	db $6e			;Volume 13
    1218.  00:5B0B  78                  	db $78			;Instrument 7
    1219.  00:5B0C  A1 08               	db $a1,$08			;CMD Track detune
    1220.  00:5B0E  C0                  	db $c0			;Wait 1
    1221.  00:5B0F  97 8C               	db $97,$8c			;CMD Volume slide up
    1222.  00:5B11  FE                  	db $fe			;Wait 63
    1223.  00:5B12  BF                  	db $bf			;[End-Of-Track]
    1224.  00:5B13                      .track_028:
    1225.  00:5B13  17                  	db $17			;Note B-2
    1226.  00:5B14  6E                  	db $6e			;Volume 13
    1227.  00:5B15  76                  	db $76			;Instrument 5
    1228.  00:5B16  97 8A               	db $97,$8a			;CMD Volume slide up
    1229.  00:5B18  FF                  	db $ff			;Wait 64
    1230.  00:5B19  BF                  	db $bf			;[End-Of-Track]
    1231.  00:5B1A                      .track_029:
    1232.  00:5B1A  2D                  	db $2d			;Note A-4
    1233.  00:5B1B  6C                  	db $6c			;Volume 11
    1234.  00:5B1C  77                  	db $77			;Instrument 6
    1235.  00:5B1D  97 86               	db $97,$86			;CMD Volume slide up
    1236.  00:5B1F  FF                  	db $ff			;Wait 64
    1237.  00:5B20  BF                  	db $bf			;[End-Of-Track]
    1238.  00:5B21                      .track_030:
    1239.  00:5B21  32                  	db $32			;Note D-5
    1240.  00:5B22  6C                  	db $6c			;Volume 11
    1241.  00:5B23  77                  	db $77			;Instrument 6
    1242.  00:5B24  97 86               	db $97,$86			;CMD Volume slide up
    1243.  00:5B26  FF                  	db $ff			;Wait 64
    1244.  00:5B27  BF                  	db $bf			;[End-Of-Track]
    1245.  00:5B28                      .track_031:
    1246.  00:5B28  36                  	db $36			;Note F#5
    1247.  00:5B29  6C                  	db $6c			;Volume 11
    1248.  00:5B2A  77                  	db $77			;Instrument 6
    1249.  00:5B2B  97 86               	db $97,$86			;CMD Volume slide up
    1250.  00:5B2D  FF                  	db $ff			;Wait 64
    1251.  00:5B2E  BF                  	db $bf			;[End-Of-Track]
    1252.  00:5B2F                      
     566   00:5B2F                      	
     567   00:5B2F                      TEXT_Title:
     568   00:5B2F                      	db	"TriloTracker FM Re-player Debug info",0	
     568   00:5B2F  54 72 69 6C 6F 54 72 61 63 6B 65 72 20 46 4D 20 
     568   00:5B3F  52 65 2D 70 6C 61 79 65 72 20 44 65 62 75 67 20 
     568   00:5B4F  69 6E 66 6F 00 
     569   00:5B54                      TEXT_Step:
     570   00:5B54  53 74 65 70 3A 00   	db	"Step:",0	
     571   00:5B5A                      TEXT_Header_Data:
     572   00:5B5A                      	db	"C# Nt In FM Vl Cm Flags",0
     572   00:5B5A  43 23 20 4E 74 20 49 6E 20 46 4D 20 56 6C 20 43 
     572   00:5B6A  6D 20 46 6C 61 67 73 00 
     573   00:5B72                      TEXT_Register_Header:
     574   00:5B72                      	db 	"Tone Vl  Tone Vl  Nois Mx  Env  Sh",0
     574   00:5B72  54 6F 6E 65 20 56 6C 20 20 54 6F 6E 65 20 56 6C 
     574   00:5B82  20 20 4E 6F 69 73 20 4D 78 20 20 45 6E 76 20 20 
     574   00:5B92  53 68 00 
     575   00:5B95                      TEXT_Register_Drum:
     576   00:5B95                      	db 	"Macr Drm Tone Vl",0	
     576   00:5B95  4D 61 63 72 20 44 72 6D 20 54 6F 6E 65 20 56 6C 
     576   00:5BA5  00 
     577   00:5BA6                      TEXT_Legend_Data:
     578   00:5BA6                      	db	"Legend: Psg, Fm, Voice, Env, Keyon, Command, Active(note)",0
     578   00:5BA6  4C 65 67 65 6E 64 3A 20 50 73 67 2C 20 46 6D 2C 
     578   00:5BB6  20 56 6F 69 63 65 2C 20 45 6E 76 2C 20 4B 65 79 
     578   00:5BC6  6F 6E 2C 20 43 6F 6D 6D 61 6E 64 2C 20 41 63 74 
     578   00:5BD6  69 76 65 28 6E 6F 74 65 29 00 
     579   00:5BE0                      
     580   00:5BE0                      	
     581   00:5BE0                      	
     582   00:5BE0                      font_data:
     583   00:5BE0  (0800)              	incbin	".\fontpat.bin"
     584   00:63E0                      
     585   00:63E0                      ;	include ".\sfx.asm"
     586   00:63E0                      	
     587   00:63E0                      ;sfx_PSG_STREAMS:
     588   00:63E0                      ;sfx_SCC_STREAMS:
     589   00:63E0                      ;	dw	sfx1
     590   00:63E0                      ;	dw	sfx2
     591   00:63E0                      ;	dw	sfx3
     592   00:63E0                      ;	dw	sfx4
     593   00:63E0                      ;	dw	sfx5
     594   00:63E0                      ;
     595   00:63E0                      ;
     596   00:63E0                      ;
     597   00:63E0                      ;sfx1:
     598   00:63E0                      ;	db	1,4*8
     599   00:63E0                      ;	incbin	"..\ttsfxplay\sfx\menu1.afx"
     600   00:63E0                      ;sfx2:
     601   00:63E0                      ;	db	1,2*8
     602   00:63E0                      ;	incbin	"..\ttsfxplay\sfx\menu2.afx"	
     603   00:63E0                      ;sfx3:
     604   00:63E0                      ;	db	1,3*8
     605   00:63E0                      ;	incbin	"..\ttsfxplay\sfx\menu3.afx"
     606   00:63E0                      ;sfx4:
     607   00:63E0                      ;	db	1,5*8
     608   00:63E0                      ;	incbin	"..\ttsfxplay\sfx\menu4.afx"
     609   00:63E0                      ;sfx5:
     610   00:63E0                      ;	db	1,6*8
     611   00:63E0                      ;	incbin	"..\ttsfxplay\sfx\menu5.afx"
     612   00:63E0                      ;
     613   00:63E0                      	
     614   00:63E0                      	
     615   00:63E0  (C000)              	map	0xc000
     616   00:63E0                      	include	"..\code\ttreplaySMSRAM.asm"
       1.  00:63E0                      ;================================
       2.  00:63E0                      ; The new replayer.
       3.  00:63E0                      ;
       4.  00:63E0                      ; Persistent RAM unswappable
       5.  00:63E0                      ;
       6.  00:63E0                      ;================================
       7.  00:63E0                      
       8.  00:63E0  (00:FFFFFFEF)       TRACK_Instrument		equ 0-17
       9.  00:63E0  (00:FFFFFFF0)       TRACK_Command			equ 1-17
      10.  00:63E0  (00:FFFFFFF1)       TRACK_MacroPointer		equ 2-17
      11.  00:63E0  (00:FFFFFFF3)       TRACK_MacroStart		equ 4-17
      12.  00:63E0  (00:FFFFFFF5)       TRACK_MacroRestart 		equ 6-17		; no longer needed
      13.  00:63E0  (00:FFFFFFF6)       TRACK_Note				equ 7-17
      14.  00:63E0  (00:FFFFFFF7)       TRACK_Volume			equ 8-17
      15.  00:63E0  (00:FFFFFFF8)       TRACK_Voice				equ 9-17
      16.  00:63E0  (00:FFFFFFF9)       TRACK_Flags				equ 10-17
      17.  00:63E0                      	; 0 = note trigger
      18.  00:63E0                      	; 1 = note active
      19.  00:63E0                      	; 4 = morph active		;-< for SCC when 1 then waveform is following morph buffer
      20.  00:63E0                      	; 3 = command trigger
      21.  00:63E0                      	; 2 = envelope trigger
      22.  00:63E0                      	; 5 = instrument trigger
      23.  00:63E0                      	; 6 = waveform trigger
      24.  00:63E0                      	; 7 = PSG/SCC
      25.  00:63E0  (00:FFFFFFFA)       TRACK_empty				equ 11-17		; needed for pushing 0 at note start
      26.  00:63E0  (00:FFFFFFFB)       TRACK_ToneAdd			equ 12-17		; reset after note set
      27.  00:63E0  (00:FFFFFFFD)       TRACK_VolumeAdd			equ 14-17		; reset after note set
      28.  00:63E0  (00:FFFFFFFE)       TRACK_Noise				equ 15-17	;[OBSOLETE]	; reset after note set
      29.  00:63E0  (00:FFFFFFFF)       TRACK_cmd_VolumeAdd		equ 16-17		; reset after note set
      30.  00:63E0  (00:0000)           TRACK_cmd_ToneSlideAdd		equ 17-17		; reset after note set
      31.  00:63E0  (00:0002)           TRACK_cmd_ToneAdd			equ 19-17		; reset after note set
      32.  00:63E0  (00:0004)           TRACK_cmd_detune			equ 21-17
      33.  00:63E0  (00:0006)           TRACK_cmd_0				equ 23-17
      34.  00:63E0  (00:0007)           TRACK_cmd_1				equ 24-17
      35.  00:63E0  (00:0008)           TRACK_cmd_2				equ 25-17
      36.  00:63E0  (00:0009)           TRACK_cmd_3				equ 26-17
      37.  00:63E0  (00:000A)           TRACK_cmd_4_depth			equ 27-17
      38.  00:63E0  (00:000C)           TRACK_cmd_4_step			equ 29-17
      39.  00:63E0  (00:000D)           TRACK_cmd_NoteAdd			equ 30-17		;x reset after note set
      40.  00:63E0  (00:000E)           TRACK_cmd_A				equ 31-17		
      41.  00:63E0  (00:000F)           TRACK_cmd_B				equ 32-17		
      42.  00:63E0  (00:0010)           TRACK_cmd_E				equ 33-17
      43.  00:63E0  (00:0011)           TRACK_Timer				equ 34-17		; used for timing by all cmd's
      44.  00:63E0  (00:0012)           TRACK_Step				equ 35-17		; only for VIBRATO???
      45.  00:63E0  (00:0013)           TRACK_Delay				equ 36-17		; rows to wait till next data
      46.  00:63E0                      ;TRACK_Retrig			equ 35-17		; rows to retrigger command
      47.  00:63E0  (00:0014)           TRACK_prevDelay			equ 37-17
      48.  00:63E0  (00:0015)           TRACK_cmd_A_add			equ 38-17		;<< Still in use???
      49.  00:63E0                      
      50.  00:63E0  (00:0027)           TRACK_REC_SIZE			equ 39
      51.  00:63E0                      
      52.  00:63E0                      
      53.  00:63E0  (00:0000)           B_TRGNOT				equ 0			; note trigger
      54.  00:63E0  (00:0001)           B_ACTNOT				equ 1			; note active
      55.  00:63E0  (00:0002)           B_TRGENV				equ 2			; envelope trigger
      56.  00:63E0  (00:0003)           B_TRGCMD				equ 3			; command active
      57.  00:63E0  (00:0004)           B_KEYON					equ 4			; for fm note trigger
      58.  00:63E0  (00:0005)           B_SUST					equ 5			; for fm note sustain
      59.  00:63E0  (00:0006)           B_TRGVOI				equ 6			; custom voice trigger	
      60.  00:63E0  (00:0007)           B_PSGFM					equ 7			; chip type (PSG or FM)	
      61.  00:63E0                      
      62.  00:63E0                      ;B_ACTMOR			equ 4			; morph active
      63.  00:63E0                      ;B_TRGINS			equ 5			; instrument trigger
      64.  00:63E0                      ;B_TRGWAV			equ 6			; waveform trigger
      65.  00:63E0                      
      66.  00:63E0                      
      67.  00:63E0  (00:C000)           _SP_Storage				#2			; to store the SP
      68.  00:63E0                      
      69.  00:63E0  (00:C002)           replay_trigger			#1			; trigger byte.
      70.  00:63E0  (00:C003)           replay_mainPSGvol		#2			; volume mixer for PSG SCC balance
      71.  00:63E0  (00:C005)           replay_mainSCCvol		#2			; volume mixer for PSG SCC balance
      72.  00:63E0                      ;replay_songbase:		#2			; pointer to song data
      73.  00:63E0                      
      74.  00:63E0                      ; Do not move these
      75.  00:63E0  (00:C007)           replay_voicebase:		#2			; pointer to custom voice data
      76.  00:63E0  (00:C009)           replay_drumbase:		#2			; pointer to drum macro data
      77.  00:63E0  (00:C00B)           replay_insbase:			#2			; pointer to instrument data
      78.  00:63E0  (00:C00D)           TRACK_pointer1			#2
      79.  00:63E0  (00:C00F)           TRACK_pointer2			#2
      80.  00:63E0  (00:C011)           TRACK_pointer3			#2
      81.  00:63E0  (00:C013)           TRACK_pointer4			#2
      82.  00:63E0  (00:C015)           TRACK_pointer5			#2
      83.  00:63E0  (00:C017)           TRACK_pointer6			#2
      84.  00:63E0  (00:C019)           TRACK_pointer7			#2
      85.  00:63E0  (00:C01B)           TRACK_pointer8			#2
      86.  00:63E0                      ; / Do not move above
      87.  00:63E0                      
      88.  00:63E0                      
      89.  00:63E0                      
      90.  00:63E0  (00:C01D)           replay_orderpointer:	#2			; pointer to the order track list pointers
      91.  00:63E0                      
      92.  00:63E0  (00:C01F)           replay_speed 			#1			; speed to replay (get from song)
      93.  00:63E0  (00:C020)           replay_speed_subtimer 	#1			; counter for finer speed
      94.  00:63E0  (00:C021)           replay_speed_timer 		#1 			; counter for speed
      95.  00:63E0  (00:C022)           replay_mode 			#1			; Replayer status
      96.  00:63E0                      ; mode 0  = no sound output
      97.  00:63E0                      ; mode 1  = replay song 
      98.  00:63E0  (00:C023)           replay_chan_setup		#1			; 0 = 2 psg+ 6 fm, 1 = 3psg + 5 fm
      99.  00:63E0  (00:C024)           replay_arp_speed		#1			; arpeggio speed ( 0 = fast, $f = slowest)
     100.  00:63E0  (00:C025)           replay_fade				#1			; Fade active (value = fade speed)
     101.  00:63E0  (00:C026)           replay_fade_timer		#1			; Timer for fade
     102.  00:63E0  (00:C027)           replay_fade_vol			#1			; fade volume to lower the channel volume.
     103.  00:63E0                      
     104.  00:63E0  (00:C028)           replay_previous_note	#1			; previous note played
     105.  00:63E0  (00:C029)           replay_mainvol			#2			; the volume correction.
     106.  00:63E0                      
     107.  00:63E0  (00:C02B)           replay_vib_table		#2			; pointer to the vibrato table
     108.  00:63E0                      ;replay_tonetable_PSG	#2			; ToneTable (affected by transpose);
     109.  00:63E0                      ;replay_tonetable_FM	#2			; ToneTable (affected by transpose);
     110.  00:63E0  (00:C02D)           replay_tonetable		#2			; Current tonetable to read from
     111.  00:63E0                      
     112.  00:63E0  (00:C02F)           equalization_freq:		#1	; vdp type for correct playback on 60hz 0=50Hx, >0=60Hz
     113.  00:63E0  (00:C030)           equalization_cnt:		#1	; counter for correct playback on 60hz
     114.  00:63E0  (00:C031)           equalization_flag:		#1	; flag indicating if only instruments need to be processed.
     115.  00:63E0                      
     116.  00:63E0                      
     117.  00:63E0                      
     118.  00:63E0  (00:C032)           TRACK_Chan1				#TRACK_REC_SIZE
     119.  00:63E0  (00:C059)           TRACK_Chan2				#TRACK_REC_SIZE
     120.  00:63E0  (00:C080)           TRACK_Chan3				#TRACK_REC_SIZE
     121.  00:63E0  (00:C0A7)           TRACK_Chan4				#TRACK_REC_SIZE
     122.  00:63E0  (00:C0CE)           TRACK_Chan5				#TRACK_REC_SIZE
     123.  00:63E0  (00:C0F5)           TRACK_Chan6				#TRACK_REC_SIZE
     124.  00:63E0  (00:C11C)           TRACK_Chan7				#TRACK_REC_SIZE
     125.  00:63E0  (00:C143)           TRACK_Chan8				#TRACK_REC_SIZE
     126.  00:63E0                      
     127.  00:63E0                      
     128.  00:63E0                      
     129.  00:63E0                      ;--- AY SPECIFIC
     130.  00:63E0  (00:C16A)           PSG_registers			#0 
     131.  00:63E0  (00:C16A)           PSG_regToneA 			#2	; Tone A freq low (8bit)
     132.  00:63E0                      						; Tone A freq high (4bit)
     133.  00:63E0  (00:C16C)           PSG_regToneB 			#2	; Tone B freq low
     134.  00:63E0                      						; Tone B freq high
     135.  00:63E0  (00:C16E)           PSG_regToneC 			#2	; Tone C freq low
     136.  00:63E0                      						; Tone C freq high
     137.  00:63E0  (00:C170)           PSG_regNOISE 			#1	; Noise freq (5bit)
     138.  00:63E0  (00:C171)           PSG_regMIXER 			#1	;0x38	;x3f	; Mixer control (1 = off, 0 = on)
     139.  00:63E0  (00:C172)           PSG_regVOLA 			#1	; Chan A volume
     140.  00:63E0  (00:C173)           PSG_regVOLB 			#1	; Chan B volume
     141.  00:63E0  (00:C174)           PSG_regVOLC  			#1	; Chan C volume
     142.  00:63E0  (00:C175)           PSG_regVOLN				#1
     143.  00:63E0  (00:C176)           PSG_regNOISEold			#1
     144.  00:63E0  (00:C177)           GG_panning				#1
     145.  00:63E0                      ;PSG_regEnvL 			#1	; Volume Env Freq low (8bit)	
     146.  00:63E0                      ;PSG_regEnvH 			#1	; Volume Env Freq high (4bit)
     147.  00:63E0                      ;PSG_regEnvShape 		#1	; Volume Env Shape (4bit)
     148.  00:63E0                      
     149.  00:63E0                      ;--- SCC SPECIFIC
     150.  00:63E0                      ;
     151.  00:63E0                      ;_0x9800:	#32			; Waveform data
     152.  00:63E0                      ;_0x9820:	#32
     153.  00:63E0                      ;_0x9840:	#32
     154.  00:63E0                      ;_0x9860:	#32
     155.  00:63E0                      
     156.  00:63E0  (00:C178)           FM_Registers: 	#0	; contains the registers values to write and value previously written
     157.  00:63E0  (00:C178)           FM_regToneA 	#2	; Tone A freq low (8bit)			; Tone A freq high (1bit)
     158.  00:63E0  (00:C17A)           FM_regToneAb 	#2	; Tone A freq low (8bit)			; Tone A freq high (1bit)
     159.  00:63E0  (00:C17C)           FM_regVOLA		#1	; Chan A volume
     160.  00:63E0  (00:C17D)           FM_regVOLAb		#1	; Chan A volume
     161.  00:63E0  (00:C17E)           FM_regToneB 	#2	; Tone B freq low					; Tone B freq high
     162.  00:63E0  (00:C180)           FM_regToneBb 	#2	; Tone B freq low					; Tone B freq high
     163.  00:63E0  (00:C182)           FM_regVOLB		#1	; Chan B volume
     164.  00:63E0  (00:C183)           FM_regVOLBb		#1	; Chan B volume
     165.  00:63E0  (00:C184)           FM_regToneC 	#2	; Tone C freq low					; Tone C freq high
     166.  00:63E0  (00:C186)           FM_regToneCb 	#2	; Tone C freq low					; Tone C freq high
     167.  00:63E0  (00:C188)           FM_regVOLC	 	#1	; Chan C volume
     168.  00:63E0  (00:C189)           FM_regVOLCb	 	#1	; Chan C volume
     169.  00:63E0  (00:C18A)           FM_regToneD 	#2	; Tone D freq low					; Tone D freq high
     170.  00:63E0  (00:C18C)           FM_regToneDb 	#2	; Tone D freq low					; Tone D freq high
     171.  00:63E0  (00:C18E)           FM_regVOLD		#1	; Chan D volume
     172.  00:63E0  (00:C18F)           FM_regVOLDb		#1	; Chan D volume
     173.  00:63E0  (00:C190)           FM_regToneE 	#2	; Tone E freq low					; Tone E freq high
     174.  00:63E0  (00:C192)           FM_regToneEb 	#2	; Tone E freq low					; Tone E freq high
     175.  00:63E0  (00:C194)           FM_regVOLE	  	#1	; Chan E volume
     176.  00:63E0  (00:C195)           FM_regVOLEb	  	#1	; Chan E volume
     177.  00:63E0  (00:C196)           FM_regToneF 	#2	; Tone E freq low					; Tone F freq high
     178.  00:63E0  (00:C198)           FM_regToneFb 	#2	; Tone E freq low					; Tone F freq high
     179.  00:63E0  (00:C19A)           FM_regVOLF	  	#1	; Chan F volume
     180.  00:63E0  (00:C19B)           FM_regVOLFb	  	#1	; Chan F volume
     181.  00:63E0                      
     182.  00:63E0  (00:C19C)           DRUM_regToneBD	#2
     183.  00:63E0  (00:C19E)           DRUM_regToneBDb	#2
     184.  00:63E0  (00:C1A0)           DRUM_regVolBD	#1
     185.  00:63E0  (00:C1A1)           DRUM_regVolBDb	#1
     186.  00:63E0  (00:C1A2)           DRUM_regToneSH	#2
     187.  00:63E0  (00:C1A4)           DRUM_regToneSHb	#2
     188.  00:63E0  (00:C1A6)           DRUM_regVolSH	#1
     189.  00:63E0  (00:C1A7)           DRUM_regVolSHb	#1
     190.  00:63E0  (00:C1A8)           DRUM_regToneCT	#2
     191.  00:63E0  (00:C1AA)           DRUM_regToneCTb	#2
     192.  00:63E0  (00:C1AC)           DRUM_regVolCT	#1
     193.  00:63E0  (00:C1AD)           DRUM_regVolCTb	#1
     194.  00:63E0  (00:C1AE)           FM_DRUM		#1	; Percussion bits
     195.  00:63E0  (00:C1AF)           FM_DRUM_Flags		#1	; 7, percusion, 6,4,2 = tone update, 5,3,1 = vol update
     196.  00:63E0  (00:C1B0)           FM_freqreg1			#2	; Base drum
     197.  00:63E0  (00:C1B2)           FM_volreg1			#1	; Drum (low)
     198.  00:63E0  (00:C1B3)           FM_freqreg2			#2	; Snare + HiHat
     199.  00:63E0  (00:C1B5)           FM_volreg2			#1	; Snare(low) Hihat(High)
     200.  00:63E0  (00:C1B6)           FM_freqreg3			#2	; Cymbal + TomTom
     201.  00:63E0  (00:C1B8)           FM_volreg3			#1	; Cymbal(low) TomTom (High)
     202.  00:63E0                      
     203.  00:63E0  (00:C1B9)           FM_DRUM_LEN			#1	; Length of drum macro
     204.  00:63E0  (00:C1BA)           FM_DRUM_MACRO		#2	; Pointer to drum macro data
     205.  00:63E0                      
     206.  00:63E0  (00:C1BC)           FM_softvoice_req		#1	; Software voice requested
     207.  00:63E0  (00:C1BD)           FM_softvoice_set 		#1	; Software voice currently loaded
     208.  00:63E0                      
     209.  00:63E0                      
     210.  00:63E0                      ; DEze lijkt niet meer nodig
     211.  00:63E0  (00:C1BE)           FM_regMIXER 		#1	; x3f	; Mixer control (1 = off, 0 = on)
     212.  00:63E0                      
     213.  00:63E0                      
     214.  00:63E0                      
     215.  00:63E0                      
     216.  00:63E0                      ;/// see to remove this.
     217.  00:63E0                      ;-- SCC registers
     218.  00:63E0  (00:C1BF)           oldregs:	#(32*4)+(3*5)+1		; a way to int the SCC
     219.  00:63E0                      
     220.  00:63E0                      
     617   00:63E0                      	
     618   00:63E0                      
     619   00:63E0  (00:C24F)           debug_pointer1:	#2
     620   00:63E0  (00:C251)           debug_pointer2:	#2	
     621   00:63E0  (00:C253)           debug_pnt:		#8*80
     622   00:63E0  (00:C4D3)           TEXT_Chan		#40
     623   00:63E0                      
     624   00:63E0                      	
     625   00:63E0                      ;	include	"..\ttsfxplay\ttsfxplay_RAM.asm"
     626   00:63E0  (00:C4FB)           pattern	#1

    LABELS
-------------------------------------------------
00:00004010   initmain
00:000040B2   infinite
00:000040D2   isr
00:000040F6   write_debug
00:00004103   _wd_loop
00:0000410C   clear_debug
00:0000411A   debuginfo
00:00004123   debuginfo.loop
00:00004165   step_debug
00:00004190   register_debug
00:000041CA   register_debug_loop
00:000041F1   REG_list
00:0000422D   clear_TEXT
00:00004239   debug_flags
00:000042A4   init_vdp
00:00000082   _UPLEFT
00:00000081   _HORIZONTAL
00:00000083   _UPRIGHT
00:00000080   _VERTICAL
00:00000087 X _VERTICAL_SMALL
00:00000086 X _VERTICAL_DOUBLE
00:0000008B X _VERTICAL_STEP
00:000000B0 X _ARROWLEFT
00:000000B1 X _ARROWRIGHT
00:000000AE X _LOOPSIGN
00:000000F1 X _TONE_OFF_SIGN
00:000000F2 X _TONE_ON_SIGN
00:000000F3 X _NOISE_OFF_SIGN
00:000000F4 X _NOISE_ON_SIGN
00:000000F5 X _ENV_OFF_SIGN
00:000000F6 X _ENV_ON_SIGN
00:000000BF X _CMD_SIGN
00:000000FE X _CURSOR
00:000000FC X MOUSE_CHR
00:00002000   _PNT
00:00002A00   _CNT
00:000042F0   clear_screen
00:00004305 X clear_cnt
00:0000431C X clear_files
00:00004337   draw_label
00:0000433F   draw_label_loop
00:00004349   draw_label_end
00:0000434B   draw_label_fast
00:0000435C X draw_fake_hex_sp
00:00004372 X draw_fake_hex_sp_small
00:0000437D X draw_hex_sp_small
00:00004385   draw_hex
00:00004387 X draw_fakehex
00:00004390   draw_hex_small
00:00004395   draw_hex2
00:000043A4 X conv_decimal
00:000043A5   draw_decimal
00:000043B2   _dd_Num1
00:000043B4   _dd_Num2
00:000043BC   draw_decimal3
00:000043C4 X draw_box
00:000043CE   draw_box_loop1
00:000043CF   draw_box_loop0
00:00004408   draw_box_end
00:0000440A X draw_colorbox
00:00004417   _dc_maskleft_loop
00:00004432   _dc_maskright_loop
00:00004455   _dc_start_loop
00:00004474   _cb_copyloop_main
00:00004499   _cb_copyloop
00:000044BA   _cp_clip_copy
00:000044DC X erase_colorbox
00:000044E9   _ecb_maskleft_loop
00:00004506   _ecb_maskright_loop
00:0000452B   _ecb_start_loop
00:0000454A   _ecb_copyloop_main
00:0000456F   _ecb_copyloop
00:00004590   _ecb_clip_copy
00:000045B2   set_vdpwrite
00:000045CF   set_vdpread
00:00000000   cb_maskleft
00:00000001   cb_maskright
00:00000002   cb_fullbytes
00:00000003 X cb_status
00:000045EA   init_font
00:000045F9   _fontloop
00:0000007C   FM_WRITE
00:0000007D   FM_DATA
00:00000060   _REL
00:00000061   _SUS
00:00000062   _VOL
00:00000071   _INS
00:00000090   _CMD
00:000000B8 X _SPC
00:000000BF   _EOT
00:000000C0   _WAIT
00:00004602   replay_init
00:0000461E   replay_pause
00:00004625 X _r_pause_enable
00:0000462B   _r_pause_disable
00:00004647   _r_pause_loop
00:0000464C X replay_fade_out
00:00004657   replay_set_FM_balance
00:0000465E   replay_set_PSG_balance
00:00004665   _getnewbalancebase
00:00004673   replay_loadsong
00:00004721   replay_play
00:0000472C X replay_play.NTSC
00:00004740   replay_play.PAL
00:00004757 X decode_data
00:0000475D X decode_data.decode1
00:0000477E   decode_data.decode2
00:000047A5   decode_data.decode3
00:000047C6   decode_data.decode4
00:000047E7   decode_data.decode5
00:00004808   decode_data.decode6
00:00004829   decode_data.decode7
00:0000484A   decode_data.decode8
00:0000486B   decode_data.decode_end
00:0000486B   process_data
00:000048BE X _rdd_3psg_5fm
00:000048F1   _rdd_2psg_6fm
00:00004926   _rdd_cont
00:000049C6   _rdd_cont.cont_fadeing
00:000049CC   _rdd_cont.no_new_step
00:000049E0   _rdd_cont.calc_vol
00:000049E6   _rdd_cont.no_carry
00:000049EB   _replay_check_patternend
00:00004A0F   _replay_check_patternend.no_restart
00:00004A1D   decode_data_chan
00:00004A31   _rdn2
00:00004A36   _rdv2
00:00004A3B   _rdi2
00:00004A43   _rdn
00:00004A4B   _rdi
00:00004A53   _rdv
00:00004A5B   _rdc
00:00004A5C   _rdc_noinc
00:00004A65   _rd_delay
00:00004A6E   _rd_eot
00:00004A75   _replay_decode_delay
00:00004A81   _replay_decode_trigger_porttone_check
00:00004A99   _replay_decode_note
00:00004AA5   _replay_decode_release
00:00004AB0   _replay_decode_sustain
00:00004ABB   _replay_decode_ins
00:00004AD0   _replay_decode_ins.skip
00:00004AE0   _replay_decode_ins.skip_soft
00:00004AEF   _replay_decode_ins.skip_ins
00:00004AF4   _replay_decode_vol
00:00004B09   _replaydecode_cmd
00:00004B1D   _replaydecode_cmd.skip
00:00004B24   DECODE_CMDLIST
00:00004B52   decode_cmd0_arpeggio
00:00004B65   decode_cmd1_port_up
00:00004B70   decode_cmd2_port_down
00:00004B7B   decode_cmd3_port_tone
00:00004B98   decode_cmd3_port_tone_new_note
00:00004BA9   decode_cmd3_port_tone_new_note.skip
00:00004BC1   decode_cmd3_port_tone_new_note.skip2
00:00004BDC   decode_cmd8_tremelo
00:00004BDC   decode_cmd4_vibrato
00:00004BED   decode_cmd4_vibrato.depth
00:00004C07   decode_cmd4_vibrato.end
00:00004C0C   decode_cmd5_vibrato_port_tone
00:00004C23   decode_cmd6_vibrato_vol
00:00004C23   decode_cmd7_vol_slide
00:00004C33   decode_cmd9_note_cut
00:00004C3E   decode_cmd10_note_delay
00:00004C5C   decode_cmd11_command_end
00:00004C61   decode_cmd12_drum
00:00004C87   decode_cmd13_arp_speed
00:00004C8D   decode_cmd14_fine_up
00:00004C97   decode_cmd15_fine_down
00:00004CA2   decode_cmd16_notelink
00:00004CA9   decode_cmd17_track_detune
00:00004CBE   decode_cmd17_track_detune.pos
00:00004CC8   decode_cmd18_trigger
00:00004CCE   decode_cmd19_speed
00:00004CE1   decode_cmd20_tone_panning
00:00004CE4   decode_cmd21_noise_panning
00:00004CE7   decode_cmd22_chan_setup
00:00004CEA   process_data_chan
00:00004D06   process_data_chan.skip
00:00004D0B   process_commandEND
00:00004D0B   process_note
00:00004D10 X process_triggerNote
00:00004D34   process_noNoteTrigger
00:00004D4C   _vol_change
00:00004D53 X _vol_rel
00:00004D65   _vol_rel.skip
00:00004D66   _vol_base
00:00004D69   _noVolumeChange
00:00004D79   _noVolumeChange.skip2
00:00004D79 X _Vadd
00:00004D83   _Vadd.skip
00:00004D8D   _Vadd.skip2
00:00004D92 X _noVolume
00:00004DA1   _noNoise
00:00004DBA   _noNoise.skip
00:00004DC1   _noNoiseVol
00:00004DCF   _noLink
00:00004DE5   _noLink.skip
00:00004DEC   process_noToneAdd
00:00004DF5   process_noToneAdd.noend
00:00004E02   process_noToneBit
00:00004E18   process_noToneBit.skip
00:00004E3B X _wrap_highcheck
00:00004E62   _wrap_lowcheck
00:00004E85   _wrap_skip
00:00004E95   process_noNoteActive
00:00004EA8   PROCESS_CMDLIST
00:00004EBE   process_cmd0_arpeggio
00:00004EE2   process_cmd0_arpeggio.nextNote
00:00004F2F   process_cmd1_port_up
00:00004F43   process_cmd2_port_down
00:00004F57   process_cmd3_port_tone
00:00004F65 X process_cmd3_add
00:00004F6D   process_cmd3_add.skip
00:00004F78   process_cmd3_sub
00:00004F8D   process_cmd3_stop
00:00004F98   process_cmd8_tremelo
00:00004FBE   process_cmd4_vibrato
00:00004FD4 X process_cmd4_vibrato.neg
00:00004FEC   process_cmd4_vibrato.pos
00:00004FF3   process_cmd4_vibrato.zero
00:00004FFD   process_cmd5_vibrato_port_tone
00:00005003   process_cmd6_vibrato_vol
00:00005009   process_cmd7_vol_slide
00:0000500F   process_cmdasub
00:00005024 X process_cmda_dec
00:0000502C   process_cmda_inc
00:00005035   process_cmd9_note_cut
00:00005042   process_cmd10_note_delay
00:00005055   replay_route
00:00005055 X route_SN
00:000050F6 X route_gg
00:000050F9 X route_FM
00:00005106   route_FM.noVoice
00:00005110   route_FM.channel_loop
00:00005143 X _route_FM_drum_update
00:0000515F   _route_FM_reg8_update
00:00005164   _route_FM_reg16_update
00:00005167   _rfr_cont
00:00005175   _route_FM_keyOff_update
00:00005184   load_softwarevoice
00:0000518E   load_softwarevoice.voiceupd_loop
00:00005225   _VOLUME_TABLE
00:00005325   TRACK_ToneTable_PSG
00:000053E5   TRACK_ToneTable_FM
00:000054A5   TRACK_Vibrato_sine
00:00005625   demo_song
00:0000562C   demo_song.restart
00:000056A0   demo_song.customvoice_start
00:000056B0 X demo_song.waveform_start
00:000056B0   demo_song.drummacro_start
00:000056B6   demo_song.drum_00
00:000056B6   demo_song.drum_01
00:000056B6   demo_song.drum_04
00:000056B6   demo_song.instrument_start
00:000056CE   demo_song.instrument_00
00:000056F5   demo_song.rst_i00
00:000056F9   demo_song.instrument_01
00:000056FE   demo_song.rst_i01
00:00005702   demo_song.instrument_02
00:00005733   demo_song.rst_i02
00:00005737   demo_song.instrument_03
00:00005739   demo_song.rst_i03
00:0000573D   demo_song.instrument_04
00:0000573F   demo_song.rst_i04
00:00005743   demo_song.instrument_05
00:0000574C   demo_song.rst_i05
00:00005753   demo_song.instrument_06
00:00005755   demo_song.rst_i06
00:00005759   demo_song.instrument_07
00:00005764   demo_song.rst_i07
00:00005768   demo_song.instrument_08
00:00005769   demo_song.rst_i08
00:0000576D   demo_song.instrument_09
00:00005774   demo_song.rst_i09
00:00005785   demo_song.instrument_10
00:000057AF   demo_song.rst_i10
00:000057B5   demo_song.instrument_11
00:000057DC   demo_song.rst_i11
00:000057E0   demo_song.track_000
00:000057E3   demo_song.track_002
00:000057E5   demo_song.track_004
00:00005839   demo_song.track_005
00:00005887   demo_song.track_008
00:000058D4   demo_song.track_009
00:000058FA   demo_song.track_010
00:000058FC   demo_song.track_011
00:00005924   demo_song.track_012
00:0000594B   demo_song.track_013
00:0000596A   demo_song.track_014
00:00005989   demo_song.track_015
00:000059B0   demo_song.track_016
00:00005A08   demo_song.track_017
00:00005A2E   demo_song.track_021
00:00005A50   demo_song.track_022
00:00005AA8   demo_song.track_023
00:00005AF9   demo_song.track_024
00:00005B02   demo_song.track_025
00:00005B09   demo_song.track_027
00:00005B13   demo_song.track_028
00:00005B1A   demo_song.track_029
00:00005B21   demo_song.track_030
00:00005B28   demo_song.track_031
00:00005B2F   TEXT_Title
00:00005B54   TEXT_Step
00:00005B5A   TEXT_Header_Data
00:00005B72   TEXT_Register_Header
00:00005B95   TEXT_Register_Drum
00:00005BA6   TEXT_Legend_Data
00:00005BE0   font_data
00:FFFFFFEF   TRACK_Instrument
00:FFFFFFF0   TRACK_Command
00:FFFFFFF1   TRACK_MacroPointer
00:FFFFFFF3   TRACK_MacroStart
00:FFFFFFF5 X TRACK_MacroRestart
00:FFFFFFF6   TRACK_Note
00:FFFFFFF7   TRACK_Volume
00:FFFFFFF8   TRACK_Voice
00:FFFFFFF9   TRACK_Flags
00:FFFFFFFA X TRACK_empty
00:FFFFFFFB   TRACK_ToneAdd
00:FFFFFFFD   TRACK_VolumeAdd
00:FFFFFFFE X TRACK_Noise
00:FFFFFFFF   TRACK_cmd_VolumeAdd
00:00000000   TRACK_cmd_ToneSlideAdd
00:00000002   TRACK_cmd_ToneAdd
00:00000004   TRACK_cmd_detune
00:00000006   TRACK_cmd_0
00:00000007   TRACK_cmd_1
00:00000008   TRACK_cmd_2
00:00000009   TRACK_cmd_3
00:0000000A   TRACK_cmd_4_depth
00:0000000C   TRACK_cmd_4_step
00:0000000D   TRACK_cmd_NoteAdd
00:0000000E   TRACK_cmd_A
00:0000000F X TRACK_cmd_B
00:00000010   TRACK_cmd_E
00:00000011   TRACK_Timer
00:00000012   TRACK_Step
00:00000013   TRACK_Delay
00:00000014   TRACK_prevDelay
00:00000015 X TRACK_cmd_A_add
00:00000027   TRACK_REC_SIZE
00:00000000   B_TRGNOT
00:00000001   B_ACTNOT
00:00000002 X B_TRGENV
00:00000003   B_TRGCMD
00:00000004   B_KEYON
00:00000005   B_SUST
00:00000006   B_TRGVOI
00:00000007   B_PSGFM
00:0000C000   _SP_Storage
00:0000C002   replay_trigger
00:0000C003   replay_mainPSGvol
00:0000C005   replay_mainSCCvol
00:0000C007   replay_voicebase
00:0000C009   replay_drumbase
00:0000C00B   replay_insbase
00:0000C00D   TRACK_pointer1
00:0000C00F   TRACK_pointer2
00:0000C011   TRACK_pointer3
00:0000C013   TRACK_pointer4
00:0000C015   TRACK_pointer5
00:0000C017   TRACK_pointer6
00:0000C019   TRACK_pointer7
00:0000C01B   TRACK_pointer8
00:0000C01D   replay_orderpointer
00:0000C01F   replay_speed
00:0000C020   replay_speed_subtimer
00:0000C021   replay_speed_timer
00:0000C022   replay_mode
00:0000C023   replay_chan_setup
00:0000C024   replay_arp_speed
00:0000C025   replay_fade
00:0000C026   replay_fade_timer
00:0000C027   replay_fade_vol
00:0000C028   replay_previous_note
00:0000C029   replay_mainvol
00:0000C02B X replay_vib_table
00:0000C02D   replay_tonetable
00:0000C02F   equalization_freq
00:0000C030   equalization_cnt
00:0000C031   equalization_flag
00:0000C032   TRACK_Chan1
00:0000C059   TRACK_Chan2
00:0000C080   TRACK_Chan3
00:0000C0A7   TRACK_Chan4
00:0000C0CE   TRACK_Chan5
00:0000C0F5   TRACK_Chan6
00:0000C11C   TRACK_Chan7
00:0000C143   TRACK_Chan8
00:0000C16A X PSG_registers
00:0000C16A   PSG_regToneA
00:0000C16C   PSG_regToneB
00:0000C16E   PSG_regToneC
00:0000C170   PSG_regNOISE
00:0000C171   PSG_regMIXER
00:0000C172   PSG_regVOLA
00:0000C173   PSG_regVOLB
00:0000C174   PSG_regVOLC
00:0000C175   PSG_regVOLN
00:0000C176   PSG_regNOISEold
00:0000C177   GG_panning
00:0000C178   FM_Registers
00:0000C178   FM_regToneA
00:0000C17A X FM_regToneAb
00:0000C17C   FM_regVOLA
00:0000C17D X FM_regVOLAb
00:0000C17E   FM_regToneB
00:0000C180 X FM_regToneBb
00:0000C182   FM_regVOLB
00:0000C183 X FM_regVOLBb
00:0000C184   FM_regToneC
00:0000C186 X FM_regToneCb
00:0000C188   FM_regVOLC
00:0000C189 X FM_regVOLCb
00:0000C18A   FM_regToneD
00:0000C18C X FM_regToneDb
00:0000C18E   FM_regVOLD
00:0000C18F X FM_regVOLDb
00:0000C190   FM_regToneE
00:0000C192 X FM_regToneEb
00:0000C194   FM_regVOLE
00:0000C195 X FM_regVOLEb
00:0000C196   FM_regToneF
00:0000C198 X FM_regToneFb
00:0000C19A   FM_regVOLF
00:0000C19B X FM_regVOLFb
00:0000C19C X DRUM_regToneBD
00:0000C19E X DRUM_regToneBDb
00:0000C1A0 X DRUM_regVolBD
00:0000C1A1 X DRUM_regVolBDb
00:0000C1A2 X DRUM_regToneSH
00:0000C1A4 X DRUM_regToneSHb
00:0000C1A6 X DRUM_regVolSH
00:0000C1A7 X DRUM_regVolSHb
00:0000C1A8 X DRUM_regToneCT
00:0000C1AA X DRUM_regToneCTb
00:0000C1AC X DRUM_regVolCT
00:0000C1AD X DRUM_regVolCTb
00:0000C1AE   FM_DRUM
00:0000C1AF X FM_DRUM_Flags
00:0000C1B0   FM_freqreg1
00:0000C1B2   FM_volreg1
00:0000C1B3   FM_freqreg2
00:0000C1B5   FM_volreg2
00:0000C1B6   FM_freqreg3
00:0000C1B8   FM_volreg3
00:0000C1B9   FM_DRUM_LEN
00:0000C1BA   FM_DRUM_MACRO
00:0000C1BC   FM_softvoice_req
00:0000C1BD   FM_softvoice_set
00:0000C1BE   FM_regMIXER
00:0000C1BF X oldregs
00:0000C24F   debug_pointer1
00:0000C251 X debug_pointer2
00:0000C253   debug_pnt
00:0000C4D3   TEXT_Chan
00:0000C4FB   pattern


 Output: main.rom
-------------------------------------------------

 Page: 00
  Org: 00004000  Size: 00008000  Used: 000023E0

   Address   Length Align   Label
   00004000    9184         initmain
   000063E0   23584       <empty>
