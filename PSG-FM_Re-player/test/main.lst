Sjasm Z80 Assembler v0.42b8 - www.xl2s.tk             [2021.03.12 - 13:07:37]

main.asm
Errors: 0

       1   00:0000                      	defpage	0,0x4000, 0x8000		; page 0 contains main code + far call routines
       2   00:0000                      
       3   00:0000                      ; -----------------------------
       4   00:0000                      ; TT-replayer example
       5   00:0000                      ; 
       6   00:0000                      ; This example plays compiled PSG+SCC songs
       7   00:0000                      ; ------------------------------
       8   00:0000                      
       9   00:0000                      ;	include	".\code\variables.asm"
      10   00:0000                      
      11   00:0000  (00)                	page 0
      12   00:4000                      	code page 0
      13   00:4000                      	
      14   00:4000                      	org	04000h
      15   00:4000  41 42               	db	041h,042h
      16   00:4002  10 40               	dw	initmain
      17   00:4004                      	dz 	'TTDEMO'
      17   00:4004  54 54 44 45 4D 4F 00 
      18   00:400B  00 (5)              	ds	5
      19   00:4010                      		
      20   00:4010                      initmain:
      21   00:4010                      
      22   00:4010                      ;	ei
      23   00:4010                      ;	halt
      24   00:4010  F3                  	di
      25   00:4011                      		
      26   00:4011                      ;; set pages and subslot
      27   00:4011                      ;;
      28   00:4011  CD 38 01            	call    0x138
      29   00:4014  0F                  	rrca
      30   00:4015  0F                  	rrca
      31   00:4016  E6 03               	and     0x03
      32   00:4018  4F                  	ld      c,a
      33   00:4019  06 00               	ld      b,0
      34   00:401B  21 C1 FC            	ld      hl,0xfcc1
      35   00:401E  09                  	add     hl,bc
      36   00:401F  B6                  	or      (hl)
      37   00:4020  47                  	ld      b,a
      38   00:4021  23                  	inc     hl
      39   00:4022  23                  	inc     hl
      40   00:4023  23                  	inc     hl
      41   00:4024  23                  	inc     hl
      42   00:4025  7E                  	ld      a,(hl)
      43   00:4026  E6 0C               	and     0x0c
      44   00:4028  B0                  	or      b
      45   00:4029                          
      46   00:4029  26 80               	ld      h,0x80
      47   00:402B  CD 24 00            	call    0x24        
      48   00:402E                      	
      49   00:402E                      	;clear RAM (first kb only)
      50   00:402E  01 00 04            	ld	bc,1024
      51   00:4031  21 00 C0            	ld	hl,0xc000
      52   00:4034  11 01 C0            	ld	de,0xc001
      53   00:4037                      
      54   00:4037  36 00               	ld	(hl),0
      55   00:4039  ED B0               	ldir	
      56   00:403B                      
      57   00:403B                      	;--- place replayer on hook
      58   00:403B  3E C3               	ld	a,0xc3
      59   00:403D  21 D2 40            	ld	hl,isr
      60   00:4040  32 9A FD            	ld	(0xFD9A),a
      61   00:4043  22 9B FD            	ld	(0xFD9B),hl	
      62   00:4046                      	
      63   00:4046                      	
      64   00:4046                      	;--- Set speed equalization
      65   00:4046  3A E8 FF            	ld	a,($FFE8)	; get mirror of VDP reg# 9
      66   00:4049  E6 02               	and	2
      67   00:404B  CA 50 40            	jp	z,99f
      68   00:404E  3E FF               	ld	a,-1
      69   00:4050                      99:
      70   00:4050  3C                  	inc	a			; 1 = 60hz
      71   00:4051  32 2F C0            	ld	(equalization_freq),a
      72   00:4054  32 30 C0            	ld	(equalization_cnt),a
      73   00:4057                      	
      74   00:4057                      	;--- Init screen
      75   00:4057  CD A4 42            	call 	init_vdp
      76   00:405A  FB                  	ei
      77   00:405B  76                  	halt
      78   00:405C  F3                  	di
      79   00:405D  CD EA 45            	call	init_font		; set the new font
      80   00:4060                      	
      81   00:4060                      	;--- initialise replayer
      82   00:4060  CD 02 46            	call	replay_init
      83   00:4063                      ;	call	ttsfx_init
      84   00:4063  3E 01               	ld	a,1
      85   00:4065  32 2F C0            	ld	(equalization_freq),a
      86   00:4068  32 30 C0            	ld	(equalization_cnt),a	
      87   00:406B                      	;--- initialise demo song
      88   00:406B  21 10 56            	ld	hl,demo_song
      89   00:406E  CD 73 46            	call	replay_loadsong
      90   00:4071                      	
      91   00:4071                      	;--- initialise sfx pointers
      92   00:4071                      	
      93   00:4071                      	
      94   00:4071  CD 0C 41            	call	clear_debug
      95   00:4074                      	
      96   00:4074  FB                  	ei
      97   00:4075                      	
      98   00:4075  CD F0 42            	call	clear_screen
      99   00:4078  21 56 01            	ld	hl,80*4+22
     100   00:407B  11 FA 5A            	ld	de,TEXT_Title
     101   00:407E  CD 37 43            	call	draw_label
     102   00:4081  21 04 02            	ld	hl,80*6+36
     103   00:4084  11 1F 5B            	ld	de,TEXT_Step
     104   00:4087  CD 37 43            	call	draw_label
     105   00:408A  21 84 02            	ld	hl,80*8+4
     106   00:408D  11 25 5B            	ld	de,TEXT_Header_Data
     107   00:4090  CD 37 43            	call	draw_label	
     108   00:4093                      	
     109   00:4093  21 A6 02            	ld	hl,80*8+38
     110   00:4096  11 3D 5B            	ld	de,TEXT_Register_Header
     111   00:4099  CD 37 43            	call	draw_label		
     112   00:409C                      
     113   00:409C  21 48 04            	ld 	hl,80*13+56
     114   00:409F  11 60 5B            	ld	de,TEXT_Register_Drum
     115   00:40A2  CD 37 43            	call	draw_label	
     116   00:40A5                      
     117   00:40A5  21 A4 05            	ld 	hl,80*18+4
     118   00:40A8  11 71 5B            	ld	de,TEXT_Legend_Data
     119   00:40AB  CD 37 43            	call	draw_label	
     120   00:40AE                      
     121   00:40AE                      
     122   00:40AE                      	
     123   00:40AE  AF                  	xor	a
     124   00:40AF  32 FB C4            	ld	(pattern),a
     125   00:40B2                      
     126   00:40B2                      ;	call	replay_pause
     127   00:40B2                      ;	ld	bc,$0001
     128   00:40B2                      ;	call	ttsfx_start
     129   00:40B2                      	
     130   00:40B2                      infinite:
     131   00:40B2  76                  	halt	
     132   00:40B3                      ;	call	register_debug
     133   00:40B3                      
     134   00:40B3                      	
     135   00:40B3                      ;	ld	a,$f0 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     136   00:40B3                      ;	out	(0x99),a
     137   00:40B3                      ;	ld	a,7+128
     138   00:40B3                      ;	out	(0x99),a	
     139   00:40B3                      
     140   00:40B3                      
     141   00:40B3                      	
     142   00:40B3                      ;	ld	a,$f3 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     143   00:40B3                      ;	out	(0x99),a
     144   00:40B3                      ;	ld	a,7+128
     145   00:40B3                      ;	out	(0x99),a
     146   00:40B3                      	
     147   00:40B3                      ;	ld	a,$f0
     148   00:40B3                      ;	out	(0x99),a
     149   00:40B3                      ;	ld	a,7+128
     150   00:40B3                      ;	out	(0x99),a	
     151   00:40B3                      	;--- display debug info
     152   00:40B3  CD 1A 41            	call	debuginfo	
     153   00:40B6  CD 90 41            	call	register_debug
     154   00:40B9  CD 65 41            	call	step_debug
     155   00:40BC                      	
     156   00:40BC                      	
     157   00:40BC                      	
     158   00:40BC                      	
     159   00:40BC                      	;---- Test for space
     160   00:40BC  AF                  	xor	a
     161   00:40BD  CD D8 00            	call	$00D8
     162   00:40C0  A7                  	and	a
     163   00:40C1  CA B2 40            	jp	z,infinite
     164   00:40C4                      
     165   00:40C4                      ;	call	replay_pause
     166   00:40C4  01 01 00            	ld	bc,$0001
     167   00:40C7                      ;	call	ttsfx_start
     168   00:40C7                      ;	ld	a,0
     169   00:40C7                      ;	call	replay_set_SCC_balance
     170   00:40C7                      ;	ld	de,-2
     171   00:40C7                      ;	call	replay_transpose	
     172   00:40C7                      ;	ld	a,32
     173   00:40C7                      ;	call	replay_fade_out
     174   00:40C7                      ;	call	replay_pause
     175   00:40C7                      	; wait_key_release
     176   00:40C7                      99:	
     177   00:40C7  AF                  	xor	a
     178   00:40C8  CD D8 00            	call	$00D8
     179   00:40CB  A7                  	and	a
     180   00:40CC  C2 C7 40            	jp	nz,99b
     181   00:40CF                      	
     182   00:40CF  C3 B2 40            	jp	infinite
     183   00:40D2                      
     184   00:40D2                      	
     185   00:40D2                      	
     186   00:40D2                      isr:
     187   00:40D2  DB 99               	in	a,(0x99)
     188   00:40D4  CD F6 40            	call	write_debug
     189   00:40D7  3E FC               	ld	a,$fc ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     190   00:40D9  D3 99               	out	(0x99),a
     191   00:40DB  3E 87               	ld	a,7+128
     192   00:40DD  D3 99               	out	(0x99),a	
     193   00:40DF  CD 41 50            	call	replay_route		; first outout data
     194   00:40E2  3E F4               	ld	a,$f4 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     195   00:40E4  D3 99               	out	(0x99),a
     196   00:40E6  3E 87               	ld	a,7+128
     197   00:40E8  D3 99               	out	(0x99),a		
     198   00:40EA  CD 21 47            	call	replay_play			; calculate next output
     199   00:40ED  3E F0               	ld	a,$f0 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     200   00:40EF  D3 99               	out	(0x99),a
     201   00:40F1  3E 87               	ld	a,7+128
     202   00:40F3  D3 99               	out	(0x99),a	
     203   00:40F5                      ;	call	ttsfx_play
     204   00:40F5                      
     205   00:40F5                      
     206   00:40F5                      
     207   00:40F5  C9                  	ret
     208   00:40F6                      	
     209   00:40F6                      write_debug:
     210   00:40F6  21 D0 22            	ld 	hl,_PNT+(80*9)
     211   00:40F9  CD B2 45            	call	set_vdpwrite	
     212   00:40FC                      
     213   00:40FC  21 53 C2            	ld 	hl,debug_pnt
     214   00:40FF  3E 08               	ld	a,8
     215   00:4101  0E 98               	ld	c,$98
     216   00:4103                      _wd_loop:
     217   00:4103  06 50               	ld	b,80
     218   00:4105  ED B3               	otir
     219   00:4107                      	
     220   00:4107  3D                  	dec	a
     221   00:4108  C2 03 41            	jp	nz,_wd_loop
     222   00:410B                      
     223   00:410B  C9                  	ret
     224   00:410C                      	
     225   00:410C                      clear_debug:
     226   00:410C  21 53 C2            	ld	hl,debug_pnt
     227   00:410F  11 54 C2            	ld	de,debug_pnt+1
     228   00:4112  36 20               	ld	(hl),32
     229   00:4114  01 7F 02            	ld	bc,(8*80)-1
     230   00:4117  ED B0               	ldir
     231   00:4119  C9                  	ret
     232   00:411A                      
     233   00:411A                      debuginfo:
     234   00:411A                      ;	ld	bc,40
     235   00:411A                      ;	call	clear_TEXT
     236   00:411A                      	
     237   00:411A  06 08               	ld	b,8
     238   00:411C  DD 21 43 C0         	ld	ix,TRACK_Chan1+17
     239   00:4120  11 57 C2            	ld	de,debug_pnt+4
     240   00:4123                      .loop	
     241   00:4123  C5                  	push	bc
     242   00:4124  D5                  	push	de
     243   00:4125                      	
     244   00:4125  3E 09               	ld	a,9
     245   00:4127  90                  	sub	b
     246   00:4128  CD A5 43            	call	draw_decimal
     247   00:412B  13                  	inc	de
     248   00:412C  DD 7E F6            	ld	a,(ix+TRACK_Note)
     249   00:412F  CD 95 43            	call	draw_hex2
     250   00:4132  13                  	inc 	de
     251   00:4133  DD 7E EF            	ld	a,(ix+TRACK_Instrument)
     252   00:4136  CD 95 43            	call	draw_hex2
     253   00:4139  13                  	inc 	de
     254   00:413A  DD 7E F8            	ld	a,(ix+TRACK_Voice)
     255   00:413D  CD 95 43            	call	draw_hex2
     256   00:4140  13                  	inc 	de	
     257   00:4141  DD 7E F7            	ld	a,(ix+TRACK_Volume)
     258   00:4144  CD 95 43            	call	draw_hex2
     259   00:4147  13                  	inc 	de
     260   00:4148  DD 7E F0            	ld	a,(ix+TRACK_Command)
     261   00:414B  CD 95 43            	call	draw_hex2	
     262   00:414E  13                  	inc 	de
     263   00:414F                      
     264   00:414F  EB                  	ex	de,hl
     265   00:4150  DD 46 F9            	ld	b,(ix+TRACK_Flags)
     266   00:4153  CD 39 42            	call 	debug_flags
     267   00:4156                      
     268   00:4156                      
     269   00:4156                      	; next line
     270   00:4156  E1                  	pop	hl
     271   00:4157  11 50 00            	ld	de,80
     272   00:415A  19                  	add	hl,de
     273   00:415B  EB                  	ex	de,hl
     274   00:415C                      	
     275   00:415C                      
     276   00:415C                      	;--- Next track
     277   00:415C  01 27 00            	ld	bc,TRACK_REC_SIZE
     278   00:415F  DD 09               	add	ix,bc
     279   00:4161                      	
     280   00:4161  C1                  	pop	bc
     281   00:4162  10 BF               	djnz	.loop
     282   00:4164  C9                  	ret
     283   00:4165                      
     284   00:4165                      step_debug:
     285   00:4165  01 07 00            	ld	bc,7
     286   00:4168  CD 2D 42            	call	clear_TEXT
     287   00:416B  2A 1D C0            	ld	hl,(replay_orderpointer)
     288   00:416E  11 17 56            	ld	de,demo_song+7
     289   00:4171  AF                  	xor 	a
     290   00:4172  ED 52               	sbc	hl,de
     291   00:4174  29                  	add	hl,hl		;X2
     292   00:4175  29                  	add	hl,hl		;X4	
     293   00:4176  29                  	add	hl,hl		;X8
     294   00:4177  29                  	add	hl,hl		;X16
     295   00:4178  7C                  	ld	a,h
     296   00:4179  3D                  	dec	a
     297   00:417A  21 4F C2            	ld	hl,debug_pointer1
     298   00:417D  77                  	ld	(hl),a
     299   00:417E  11 D3 C4            	ld	de,TEXT_Chan
     300   00:4181  CD BC 43            	call	draw_decimal3
     301   00:4184                      	
     302   00:4184  21 09 02            	ld	hl,80*6+41
     303   00:4187  11 D3 C4            	ld	de,TEXT_Chan
     304   00:418A  06 03               	ld	b,3
     305   00:418C  CD 4B 43            	call	draw_label_fast
     306   00:418F  C9                  	ret
     307   00:4190                      	
     308   00:4190                      
     309   00:4190                      register_debug:
     310   00:4190                      ;	ld	bc,7
     311   00:4190                      ;	call	clear_TEXT
     312   00:4190  21 F1 41            	ld	hl,REG_list
     313   00:4193                      	
     314   00:4193                      	;	DRAW PSG Tone vol	
     315   00:4193  FD 2E 03            	ld	iyl,3
     316   00:4196  11 82 C2            	ld 	de,debug_pnt+47
     317   00:4199                      ;	ld	(debug_pointer1),bc
     318   00:4199  CD CA 41            	call	register_debug_loop
     319   00:419C                      
     320   00:419C                      	;	DRAW PSG Noise and mixer	
     321   00:419C  FD 2E 01            	ld	iyl,1
     322   00:419F  11 8B C2            	ld 	de,debug_pnt+56
     323   00:41A2                      ;	ld	(debug_pointer1),bc
     324   00:41A2  CD CA 41            	call	register_debug_loop	
     325   00:41A5                      	
     326   00:41A5                      	;	DRAW PSG Envelop + shape
     327   00:41A5  FD 2E 01            	ld	iyl,1
     328   00:41A8  11 94 C2            	ld 	de,debug_pnt+65
     329   00:41AB                      ;	ld	(debug_pointer1),bc
     330   00:41AB  CD CA 41            	call	register_debug_loop		
     331   00:41AE                      
     332   00:41AE                      	;	DRAW FM Tone Vol	
     333   00:41AE  FD 2E 06            	ld	iyl,6
     334   00:41B1  11 19 C3            	ld 	de,debug_pnt+(80*2)+38
     335   00:41B4                      ;	ld	(debug_pointer1),bc
     336   00:41B4  CD CA 41            	call	register_debug_loop
     337   00:41B7                      	
     338   00:41B7                      	
     339   00:41B7                      	;	DRAW FM Drum macro + percusion
     340   00:41B7  FD 2E 01            	ld	iyl,1
     341   00:41BA  11 1B C4            	ld 	de,debug_pnt+(80*5)+56
     342   00:41BD                      ;	ld	(debug_pointer1),bc
     343   00:41BD  CD CA 41            	call	register_debug_loop
     344   00:41C0                      
     345   00:41C0                      	;	DRAW FM Drum tone + vol
     346   00:41C0  FD 2E 03            	ld	iyl,3
     347   00:41C3  11 24 C4            	ld 	de,debug_pnt+(80*5)+65
     348   00:41C6                      ;	ld	(debug_pointer1),bc
     349   00:41C6  CD CA 41            	call	register_debug_loop
     350   00:41C9                      	
     351   00:41C9  C9                  	ret
     352   00:41CA                      
     353   00:41CA                      register_debug_loop:
     354   00:41CA  D5                  	push 	de
     355   00:41CB                      ;	ld	de,TEXT_Chan
     356   00:41CB  4E                  	ld	c,(hl)
     357   00:41CC  23                  	inc	hl
     358   00:41CD  46                  	ld	b,(hl)
     359   00:41CE  23                  	inc	hl
     360   00:41CF                      	
     361   00:41CF  03                  	inc	bc
     362   00:41D0  0A                  	ld	a,(bc)
     363   00:41D1  0B                  	dec	bc
     364   00:41D2  CD 95 43            	call	draw_hex2		; tone
     365   00:41D5  0A                  	ld	a,(bc)
     366   00:41D6  CD 95 43            	call	draw_hex2
     367   00:41D9                      	
     368   00:41D9  13                  	inc 	de	
     369   00:41DA                      	
     370   00:41DA  4E                  	ld	c,(hl)
     371   00:41DB  23                  	inc	hl
     372   00:41DC  46                  	ld	b,(hl)
     373   00:41DD  23                  	inc	hl	
     374   00:41DE                      	
     375   00:41DE  0A                  	ld	a,(bc)
     376   00:41DF  CD 95 43            	call	draw_hex2		; vol
     377   00:41E2                      	
     378   00:41E2                      	;-- next line
     379   00:41E2  D1                  	pop 	de
     380   00:41E3  3E 50               	ld	a,80
     381   00:41E5  83                  	add	a,e
     382   00:41E6  5F                  	ld	e,a
     383   00:41E7  D2 EB 41            	jp	nc,99f
     384   00:41EA  14                  	inc	d
     385   00:41EB                      99:	
     386   00:41EB  FD 2D               	dec	iyl
     387   00:41ED  C2 CA 41            	jp	nz,register_debug_loop
     388   00:41F0  C9                  	ret
     389   00:41F1                      
     390   00:41F1                      REG_list:
     391   00:41F1  6A C1 72 C1         	dw	PSG_regToneA,PSG_regVOLA
     392   00:41F5  6C C1 73 C1         	dw	PSG_regToneB,PSG_regVOLB
     393   00:41F9  6E C1 74 C1         	dw	PSG_regToneC,PSG_regVOLC
     394   00:41FD  70 C1 71 C1         	dw	PSG_regNOISE,PSG_regMIXER
     395   00:4201  00 00 00 00         	dw	0,0;PSG_regEnvL,PSG_regEnvShape 	
     396   00:4205  78 C1 7C C1         	dw	FM_regToneA,FM_regVOLA 
     397   00:4209  7E C1 82 C1         	dw	FM_regToneB,FM_regVOLB 
     398   00:420D  84 C1 88 C1         	dw	FM_regToneC,FM_regVOLC 
     399   00:4211  8A C1 8E C1         	dw	FM_regToneD,FM_regVOLD 
     400   00:4215  90 C1 94 C1         	dw	FM_regToneE,FM_regVOLE 
     401   00:4219  96 C1 9A C1         	dw	FM_regToneF,FM_regVOLF 
     402   00:421D  BA C1 AE C1         	dw	FM_DRUM_MACRO,FM_DRUM
     403   00:4221  B0 C1 B2 C1         	dw	FM_freqreg1,FM_volreg1
     404   00:4225  B3 C1 B5 C1         	dw	FM_freqreg2,FM_volreg2	
     405   00:4229  B6 C1 B8 C1         	dw	FM_freqreg3,FM_volreg3	
     406   00:422D                      
     407   00:422D                      
     408   00:422D                      
     409   00:422D                      
     410   00:422D                      ; input BC length to clear
     411   00:422D                      clear_TEXT:
     412   00:422D  0B                  	dec	bc
     413   00:422E  21 D3 C4            	ld	hl,TEXT_Chan
     414   00:4231  11 D4 C4            	ld	de,TEXT_Chan+1
     415   00:4234  36 20               	ld	(hl),' '
     416   00:4236  ED B0               	ldir
     417   00:4238  C9                  	ret
     418   00:4239                      
     419   00:4239                      debug_flags:
     420   00:4239  CB 78               	bit	7,b
     421   00:423B  CA 43 42            	jp	z,1f
     422   00:423E  36 46               	ld	(hl),'F'
     423   00:4240  C3 45 42            	jp	2f
     424   00:4243                      1:
     425   00:4243  36 50               	ld	(hl),'P'
     426   00:4245                      	
     427   00:4245                      2:
     428   00:4245  23                  	inc	hl
     429   00:4246  CB 70               	bit	6,b
     430   00:4248  CA 50 42            	jp	z,1f
     431   00:424B  36 56               	ld	(hl),'V'
     432   00:424D  C3 52 42            	jp	2f
     433   00:4250                      1:
     434   00:4250  36 20               	ld	(hl),' '
     435   00:4252                      	
     436   00:4252                      2:	
     437   00:4252  23                  	inc	hl
     438   00:4253  CB 68               	bit	5,b
     439   00:4255  CA 5D 42            	jp	z,1f
     440   00:4258  36 53               	ld	(hl),'S'
     441   00:425A  C3 5F 42            	jp	2f
     442   00:425D                      1:
     443   00:425D  36 20               	ld	(hl),' '
     444   00:425F                      	
     445   00:425F                      2:	
     446   00:425F  23                  	inc	hl
     447   00:4260  CB 60               	bit	4,b
     448   00:4262  C2 6A 42            	jp	nz,1f
     449   00:4265  36 4B               	ld	(hl),'K'
     450   00:4267  C3 6C 42            	jp	2f
     451   00:426A                      1:
     452   00:426A  36 20               	ld	(hl),' '
     453   00:426C                      	
     454   00:426C                      2:	
     455   00:426C  23                  	inc	hl
     456   00:426D  CB 58               	bit	3,b
     457   00:426F  CA 77 42            	jp	z,1f
     458   00:4272  36 43               	ld	(hl),'C'
     459   00:4274  C3 79 42            	jp	2f
     460   00:4277                      1:
     461   00:4277  36 20               	ld	(hl),' '
     462   00:4279                      	
     463   00:4279                      2:	
     464   00:4279  23                  	inc	hl
     465   00:427A  CB 50               	bit	2,b
     466   00:427C  CA 84 42            	jp	z,1f
     467   00:427F  36 45               	ld	(hl),'E'
     468   00:4281  C3 86 42            	jp	2f
     469   00:4284                      1:
     470   00:4284  36 20               	ld	(hl),' '
     471   00:4286                      	
     472   00:4286                      2:	
     473   00:4286  23                  	inc	hl	
     474   00:4287  CB 48               	bit	1,b
     475   00:4289  CA 91 42            	jp	z,1f
     476   00:428C  36 41               	ld	(hl),'A'
     477   00:428E  C3 93 42            	jp	2f
     478   00:4291                      1:
     479   00:4291  36 20               	ld	(hl),' '
     480   00:4293                      	
     481   00:4293                      2:	
     482   00:4293  23                  	inc	hl	
     483   00:4294  CB 40               	bit	0,b
     484   00:4296  CA 9E 42            	jp	z,1f
     485   00:4299  36 4E               	ld	(hl),'N'
     486   00:429B  C3 A0 42            	jp	2f
     487   00:429E                      1:
     488   00:429E  36 20               	ld	(hl),' '
     489   00:42A0                      	
     490   00:42A0                      2:	
     491   00:42A0  23                  	inc	hl		
     492   00:42A1  EB                  	ex	de,hl
     493   00:42A2                      
     494   00:42A2  13                  	inc 	de
     495   00:42A3  C9                  	ret
     496   00:42A4                      
     497   00:42A4                      
     498   00:42A4                      
     499   00:42A4                      
     500   00:42A4                      	
     501   00:42A4                      	; --- init_vdp
     502   00:42A4                      	; 
     503   00:42A4                      	; Initial init of the vdp
     504   00:42A4                      init_vdp:
     505   00:42A4                      
     506   00:42A4  3E 04               	ld	a,00000100b ; Reg#0 [ 0 ][DG ][IE2][IE1][M5 ][M4 ][M3 ][ 0 ]
     507   00:42A6  D3 99               	out	(0x99),a
     508   00:42A8  3E 80               	ld	a,0+128
     509   00:42AA  D3 99               	out	(0x99),a
     510   00:42AC                      
     511   00:42AC  3E 70               	ld	a,01110000b ; Reg#1 [ 0 ][BL ][IE0][M1 ][M2 ][ 0 ][SIZ][MAG]
     512   00:42AE                      
     513   00:42AE  D3 99               	out	(0x99),a
     514   00:42B0  3E 81               	ld	a,1+128
     515   00:42B2  D3 99               	out	(0x99),a	
     516   00:42B4                      
     517   00:42B4  3E 0B               	ld	a,00001011b ; REG#2[ 0 ][A16][A15][A14][A13][A12][ 1 ][ 1 ]  - Pattern layout table
     518   00:42B6                      
     519   00:42B6  D3 99               	out	(0x99),a
     520   00:42B8  3E 82               	ld	a,2+128
     521   00:42BA  D3 99               	out	(0x99),a	
     522   00:42BC                      
     523   00:42BC  3E AF               	ld	a,10101111b ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     524   00:42BE                      
     525   00:42BE  D3 99               	out	(0x99),a
     526   00:42C0  3E 83               	ld	a,3+128
     527   00:42C2  D3 99               	out	(0x99),a	
     528   00:42C4                      	
     529   00:42C4  3E 12               	ld	a,00010010b ; Reg#4 [ 0 ][ 0 ][A16][A15][A14][A13][A12][A11]  - Pattern generator table
     530   00:42C6                      
     531   00:42C6  D3 99               	out	(0x99),a
     532   00:42C8  3E 84               	ld	a,4+128
     533   00:42CA  D3 99               	out	(0x99),a	
     534   00:42CC                      	
     535   00:42CC  3A E8 FF            	ld	a,($FFE8)
     536   00:42CF  F6 80               	or	10000000b ; Reg#9 [LN ][ 0 ][S1 ][S0 ][IL ][EO ][NT ][DC ]
     537   00:42D1  D3 99               	out	(0x99),a
     538   00:42D3  3E 89               	ld	a,9+128
     539   00:42D5  D3 99               	out	(0x99),a	
     540   00:42D7                      
     541   00:42D7                      
     542   00:42D7  3E F0               	ld	a,$f0
     543   00:42D9  D3 99               	out	(0x99),a
     544   00:42DB  3E 87               	ld	a,7+128
     545   00:42DD  D3 99               	out	(0x99),a
     546   00:42DF  3E E1               	ld	a,$e1
     547   00:42E1  D3 99               	out	(0x99),a
     548   00:42E3  3E 8C               	ld	a,12+128
     549   00:42E5  D3 99               	out	(0x99),a
     550   00:42E7  3E F0               	ld	a,0xF0	;reg#13
     551   00:42E9  D3 99               	out	(0x99),a
     552   00:42EB  3E 8D               	ld	a,13+128
     553   00:42ED  D3 99               	out	(0x99),a		
     554   00:42EF                      	
     555   00:42EF                      	
     556   00:42EF                      
     557   00:42EF  C9                  	ret		
     558   00:42F0                      	include	".\screen.asm"
       1.  00:42F0  (00:0082)           _UPLEFT			equ	130
       2.  00:42F0  (00:0081)           _HORIZONTAL			equ	129
       3.  00:42F0  (00:0083)           _UPRIGHT			equ	131
       4.  00:42F0  (00:0080)           _VERTICAL			equ	128
       5.  00:42F0  (00:0087)           _VERTICAL_SMALL		equ	135
       6.  00:42F0  (00:0086)           _VERTICAL_DOUBLE		equ	134
       7.  00:42F0  (00:008B)           _VERTICAL_STEP		equ	139
       8.  00:42F0  (00:00B0)           _ARROWLEFT			equ	176
       9.  00:42F0  (00:00B1)           _ARROWRIGHT			equ	177
      10.  00:42F0  (00:00AE)           _LOOPSIGN			equ	174
      11.  00:42F0  (00:00F1)           _TONE_OFF_SIGN		equ	241
      12.  00:42F0  (00:00F2)           _TONE_ON_SIGN		equ	242
      13.  00:42F0  (00:00F3)           _NOISE_OFF_SIGN		equ	243
      14.  00:42F0  (00:00F4)           _NOISE_ON_SIGN		equ	244
      15.  00:42F0  (00:00F5)           _ENV_OFF_SIGN		equ	245
      16.  00:42F0  (00:00F6)           _ENV_ON_SIGN		equ	246
      17.  00:42F0  (00:00BF)           _CMD_SIGN			equ	6*32-1
      18.  00:42F0  (00:00FE)           _CURSOR			equ	254
      19.  00:42F0                      
      20.  00:42F0  (00:00FC)           MOUSE_CHR			equ 	252
      21.  00:42F0                      
      22.  00:42F0  (00:2000)           _PNT		equ	0x2000		; pnt
      23.  00:42F0  (00:2A00)           _CNT		equ	0x2a00		; cnt
      24.  00:42F0                      
      25.  00:42F0                      
      26.  00:42F0                      
      27.  00:42F0                      ; ==========================================================	
      28.  00:42F0                      	; --- clear_window
      29.  00:42F0                      	; 
      30.  00:42F0                      	; Clears the current screen (pnt and cnt)
      31.  00:42F0                      	;
      32.  00:42F0                      ; ==========================================================	
      33.  00:42F0                      clear_screen:
      34.  00:42F0  21 00 20            	ld 	hl,_PNT
      35.  00:42F3  CD B2 45            	call	set_vdpwrite	
      36.  00:42F6                      
      37.  00:42F6  1E 1B               	ld	e,27
      38.  00:42F8  3E 20               	ld	a,32
      39.  00:42FA  F3                  	di
      40.  00:42FB                      0:	;-- main loop
      41.  00:42FB  01 98 50            	ld	bc,0x5098
      42.  00:42FE                      1:	;--- sub loop
      43.  00:42FE  ED 79               		out	(c),a
      44.  00:4300  10 FC               		djnz 	1b
      45.  00:4302                      	; -- end sub loop
      46.  00:4302  1D                  	dec	e
      47.  00:4303  20 F6               	jr	nz,0b
      48.  00:4305                      	; -- end main loop	
      49.  00:4305                      
      50.  00:4305                      clear_cnt:
      51.  00:4305  21 00 2A            	ld 	hl,_CNT
      52.  00:4308  CD B2 45            	call	set_vdpwrite	
      53.  00:430B                      	
      54.  00:430B  1E 1B               	ld	e,27
      55.  00:430D  3E 00               	ld	a,0
      56.  00:430F  F3                  	di
      57.  00:4310                      0:	;-- main loop
      58.  00:4310  01 98 0A            	ld	bc,0x0a98
      59.  00:4313                      1:	;--- sub loop
      60.  00:4313  ED 79               		out	(c),a
      61.  00:4315  10 FC               		djnz 	1b
      62.  00:4317                      	; -- end sub loop
      63.  00:4317  1D                  	dec	e
      64.  00:4318  20 F6               	jr	nz,0b
      65.  00:431A                      	; -- end main loop	
      66.  00:431A                      	
      67.  00:431A  FB                  	ei
      68.  00:431B  C9                  	ret
      69.  00:431C                      
      70.  00:431C                      ; ==========================================================	
      71.  00:431C                      	; --- clear_files
      72.  00:431C                      	; 
      73.  00:431C                      	; Clears the files area in the file dialog 
      74.  00:431C                      	;
      75.  00:431C                      ; ==========================================================	
      76.  00:431C                      clear_files:
      77.  00:431C                      
      78.  00:431C  06 14               	ld	b,20
      79.  00:431E  21 E0 21            	ld	hl,_PNT+(80*6)
      80.  00:4321                      
      81.  00:4321  C5                  0:	push	bc
      82.  00:4322  E5                  	push	hl
      83.  00:4323  CD B2 45            	call	set_vdpwrite	
      84.  00:4326                      
      85.  00:4326  06 38               	ld	b,56
      86.  00:4328  3E 20               	ld	a,32
      87.  00:432A                      
      88.  00:432A                      1:	;--- sub loop
      89.  00:432A  D3 98               		out	(0x98),a
      90.  00:432C  10 FC               		djnz 	1b
      91.  00:432E                      	; -- end sub loop
      92.  00:432E  E1                  	pop	hl
      93.  00:432F  01 50 00            	ld	bc,80
      94.  00:4332  09                  	add	hl,bc
      95.  00:4333                      	
      96.  00:4333  C1                  	pop	bc
      97.  00:4334  10 EB               	djnz	0b
      98.  00:4336                      
      99.  00:4336  C9                  	ret	
     100.  00:4337                      
     101.  00:4337                      
     102.  00:4337                      
     103.  00:4337                      
     104.  00:4337                      ; ==========================================================	
     105.  00:4337                      	; --- draw_label
     106.  00:4337                      	; 
     107.  00:4337                      	; Draw box 
     108.  00:4337                      	; HL = position in PNT (relative)
     109.  00:4337                      	; DE = pointer to the label text
     110.  00:4337                      ; ==========================================================
     111.  00:4337                      draw_label:
     112.  00:4337  F3                  	di
     113.  00:4338                      ;	ld	a,$f3 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     114.  00:4338                      ;	out	(0x99),a
     115.  00:4338                      ;	ld	a,7+128
     116.  00:4338                      ;	out	(0x99),a	
     117.  00:4338                      
     118.  00:4338                      	
     119.  00:4338  01 00 20            	ld 	bc,_PNT
     120.  00:433B  09                  	add	hl,bc
     121.  00:433C  CD B2 45            	call	set_vdpwrite			
     122.  00:433F                      	
     123.  00:433F                      draw_label_loop:
     124.  00:433F  1A                  	ld	a,(de)
     125.  00:4340  FE 00               	cp	0
     126.  00:4342  28 05               	jr.	z,draw_label_end	
     127.  00:4344  D3 98               	out	(0x98),a
     128.  00:4346                      	
     129.  00:4346  13                  	inc	de
     130.  00:4347  18 F6               	jr.	draw_label_loop
     131.  00:4349                      	
     132.  00:4349                      draw_label_end:
     133.  00:4349                      ;	ld	a,$f0 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     134.  00:4349                      ;	out	(0x99),a
     135.  00:4349                      ;	ld	a,7+128
     136.  00:4349                      ;	out	(0x99),a	
     137.  00:4349  FB                  	ei
     138.  00:434A  C9                  	ret
     139.  00:434B                      
     140.  00:434B                      ; ==========================================================	
     141.  00:434B                      	; --- draw_label_fast
     142.  00:434B                      	; 
     143.  00:434B                      	; Draw box 
     144.  00:434B                      	; HL = position in PNT (relative)
     145.  00:434B                      	; DE = pointer to the label text
     146.  00:434B                      	; BC = number of bytes to copy to vram
     147.  00:434B                      ; ==========================================================
     148.  00:434B                      draw_label_fast:
     149.  00:434B  F3                  	di
     150.  00:434C                      ;	ld	a,$f5 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     151.  00:434C                      ;	out	(0x99),a
     152.  00:434C                      ;	ld	a,7+128
     153.  00:434C                      ;	out	(0x99),a		
     154.  00:434C                      	
     155.  00:434C  C5                  	push	bc
     156.  00:434D  01 00 20            	ld 	bc,_PNT
     157.  00:4350  09                  	add	hl,bc	
     158.  00:4351  CD B2 45            	call	set_vdpwrite	
     159.  00:4354                      			
     160.  00:4354  EB                  	ex	de,hl
     161.  00:4355  C1                  	pop	bc
     162.  00:4356  0E 98               	ld	c,0x98
     163.  00:4358                      	
     164.  00:4358  ED B3               	otir
     165.  00:435A                      		
     166.  00:435A                      		
     167.  00:435A                      ;	ld	a,$f0 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     168.  00:435A                      ;	out	(0x99),a
     169.  00:435A                      ;	ld	a,7+128
     170.  00:435A                      ;	out	(0x99),a			
     171.  00:435A  FB                  	ei
     172.  00:435B                      	
     173.  00:435B  C9                  	ret
     174.  00:435C                      
     175.  00:435C                      ; ==========================================================	
     176.  00:435C                      	; --- draw_fake_hex_sp
     177.  00:435C                      	; 
     178.  00:435C                      	; Prints the value at an address as 1 digit decimal value 
     179.  00:435C                      	; But value 0 is printed as '.'
     180.  00:435C                      	; Values can be larger than F
     181.  00:435C                      	; A = the value
     182.  00:435C                      	; DE = position (relative) to put the value in PNT
     183.  00:435C                      	; 
     184.  00:435C                      ; ==========================================================
     185.  00:435C                      draw_fake_hex_sp:
     186.  00:435C  A7                  	and	a
     187.  00:435D  20 05               	jr.	nz,0f
     188.  00:435F  3E 2E               	ld	a,'.'
     189.  00:4361  12                  	ld	(de),a
     190.  00:4362  13                  	inc	de
     191.  00:4363  C9                  	ret
     192.  00:4364                      0:	
     193.  00:4364  FE 0A               	cp	10
     194.  00:4366  30 05               	jr.	nc,1f
     195.  00:4368  C6 30               	add	48
     196.  00:436A  12                  	ld	(de),a
     197.  00:436B  13                  	inc	de
     198.  00:436C  C9                  	ret
     199.  00:436D                      1:
     200.  00:436D  C6 37               	add 	55
     201.  00:436F  12                  	ld	(de),a
     202.  00:4370  13                  	inc	de	
     203.  00:4371  C9                  	ret
     204.  00:4372                      	
     205.  00:4372                      ; ==========================================================	
     206.  00:4372                      	; --- draw_fake_hex_sp_small
     207.  00:4372                      	; 
     208.  00:4372                      	; Prints the value at an address as 1 digit decimal value 
     209.  00:4372                      	; But value 0 is printed as '.'
     210.  00:4372                      	; Values can be larger than F
     211.  00:4372                      	; A = the value
     212.  00:4372                      	; DE = position (relative) to put the value in PNT
     213.  00:4372                      	; 
     214.  00:4372                      ; ==========================================================
     215.  00:4372                      draw_fake_hex_sp_small:
     216.  00:4372  A7                  	and	a
     217.  00:4373  20 05               	jr.	nz,0f
     218.  00:4375  3E 2E               	ld	a,'.'
     219.  00:4377  12                  	ld	(de),a
     220.  00:4378  13                  	inc	de
     221.  00:4379  C9                  	ret
     222.  00:437A                      0:	
     223.  00:437A  12                  	ld	(de),a
     224.  00:437B  13                  	inc	de	
     225.  00:437C  C9                  	ret
     226.  00:437D                      	
     227.  00:437D                      	
     228.  00:437D                      	
     229.  00:437D                      ; ==========================================================	
     230.  00:437D                      	; --- draw_hex_sp
     231.  00:437D                      	; 
     232.  00:437D                      	; Prints the value at an address as 1 digit decimal value 
     233.  00:437D                      	; But value 0 is printed as '.'
     234.  00:437D                      	; A = the value
     235.  00:437D                      	; DE = position (relative) to put the value in PNT
     236.  00:437D                      	; 
     237.  00:437D                      ; ==========================================================
     238.  00:437D                      ;draw_hex_sp:
     239.  00:437D                      ;	and	a
     240.  00:437D                      ;	jr.	nz,draw_hex
     241.  00:437D                      ;	ld	a,"."
     242.  00:437D                      ;	ld	(de),a
     243.  00:437D                      ;	inc	de
     244.  00:437D                      ;	ret
     245.  00:437D                      
     246.  00:437D                      ; ==========================================================	
     247.  00:437D                      	; --- draw_hex_sp_small
     248.  00:437D                      	; 
     249.  00:437D                      	; Prints the value at an address as 1 digit decimal value 
     250.  00:437D                      	; But value 0 is printed as '.'
     251.  00:437D                      	; A = the value
     252.  00:437D                      	; DE = position (relative) to put the value in PNT
     253.  00:437D                      	; 
     254.  00:437D                      ; ==========================================================
     255.  00:437D                      draw_hex_sp_small:
     256.  00:437D  A7                  	and	a
     257.  00:437E  20 10               	jr.	nz,draw_hex_small
     258.  00:4380  3E 2E               	ld	a,"."
     259.  00:4382  12                  	ld	(de),a
     260.  00:4383  13                  	inc	de
     261.  00:4384  C9                  	ret
     262.  00:4385                      
     263.  00:4385                      ; ==========================================================	
     264.  00:4385                      	; --- draw_hex2_cmd
     265.  00:4385                      	; 
     266.  00:4385                      	; Prints the value at an address as 2 digit decimal value 
     267.  00:4385                      	; A =  the value
     268.  00:4385                      	; DE = position (relative) to put the value in PNT
     269.  00:4385                      	; 
     270.  00:4385                      	; Changes: AF
     271.  00:4385                      ; ==========================================================
     272.  00:4385                      ;draw_hex2_cmd:
     273.  00:4385                      ;	push	af
     274.  00:4385                      ;	and	0xf0
     275.  00:4385                      ;	rrca
     276.  00:4385                      ;	rrca
     277.  00:4385                      ;	rrca
     278.  00:4385                      ;	rrca	
     279.  00:4385                      ;	call	draw_hex_small
     280.  00:4385                      ;	pop	af
     281.  00:4385                      ;	call	draw_hex_small
     282.  00:4385                      ;	ret
     283.  00:4385                      
     284.  00:4385                      
     285.  00:4385                      ; ==========================================================	
     286.  00:4385                      	; --- draw_hex
     287.  00:4385                      	; 
     288.  00:4385                      	; Prints the value at an address as 1 digit decimal value 
     289.  00:4385                      	; A = the value
     290.  00:4385                      	; DE = position (relative) to put the value in PNT
     291.  00:4385                      	; 
     292.  00:4385                      ; ==========================================================
     293.  00:4385                      draw_hex:
     294.  00:4385  E6 0F               	and	0x0f
     295.  00:4387                      draw_fakehex:	
     296.  00:4387  C6 90               	add	a,0x90
     297.  00:4389  27                  	daa
     298.  00:438A  CE 40               	adc	a,0x40
     299.  00:438C  27                  	daa
     300.  00:438D  12                  	ld	(de),a
     301.  00:438E  13                  	inc	de
     302.  00:438F  C9                  	ret
     303.  00:4390                      	
     304.  00:4390                      	
     305.  00:4390                      ; ==========================================================	
     306.  00:4390                      	; --- draw_hex_small
     307.  00:4390                      	; 
     308.  00:4390                      	; Prints the value at an address as 1 digit decimal value 
     309.  00:4390                      	; A = the value
     310.  00:4390                      	; DE = position (relative) to put the value in PNT
     311.  00:4390                      	; 
     312.  00:4390                      ; ==========================================================
     313.  00:4390                      draw_hex_small:
     314.  00:4390  E6 0F               	and	0x0f
     315.  00:4392  12                  	ld	(de),a
     316.  00:4393  13                  	inc	de
     317.  00:4394  C9                  	ret	
     318.  00:4395                      	
     319.  00:4395                      	
     320.  00:4395                      ; ==========================================================	
     321.  00:4395                      	; --- draw_hex2
     322.  00:4395                      	; 
     323.  00:4395                      	; Prints the value at an address as 2 digit decimal value 
     324.  00:4395                      	; A =  the value
     325.  00:4395                      	; DE = position (relative) to put the value in PNT
     326.  00:4395                      	; 
     327.  00:4395                      	; Changes: AF
     328.  00:4395                      ; ==========================================================
     329.  00:4395                      draw_hex2:
     330.  00:4395  F5                  	push	af
     331.  00:4396  E6 F0               	and	0xf0
     332.  00:4398  0F                  	rrca
     333.  00:4399  0F                  	rrca
     334.  00:439A  0F                  	rrca
     335.  00:439B  0F                  	rrca	
     336.  00:439C  CD 85 43            	call	draw_hex
     337.  00:439F  F1                  	pop	af
     338.  00:43A0  CD 85 43            	call	draw_hex
     339.  00:43A3  C9                  	ret
     340.  00:43A4                      	
     341.  00:43A4                      	
     342.  00:43A4                      	
     343.  00:43A4                      	
     344.  00:43A4                      
     345.  00:43A4                      ; ==========================================================	
     346.  00:43A4                      ; --- conv_decimal
     347.  00:43A4                      ; 
     348.  00:43A4                      ; converts the value at HL into a 2 digit decimal at DE 
     349.  00:43A4                      ; HL = position of the value
     350.  00:43A4                      ; DE = postion  to put the 2 digit value value 
     351.  00:43A4                      ; 
     352.  00:43A4                      ; ==========================================================	
     353.  00:43A4                      
     354.  00:43A4                      conv_decimal:
     355.  00:43A4                      
     356.  00:43A4  7E                  	ld	a,(hl)
     357.  00:43A5                      draw_decimal:
     358.  00:43A5  EB                  	ex	de,hl
     359.  00:43A6                      ;	ld	hl,_dd_tmpstring
     360.  00:43A6                      	
     361.  00:43A6  06 F6               1:	ld	b,-10
     362.  00:43A8  CD B2 43            	call	_dd_Num1
     363.  00:43AB  06 FF               	ld	b,-1
     364.  00:43AD  CD B2 43            	call	_dd_Num1
     365.  00:43B0                      
     366.  00:43B0  EB                  	ex	de,hl
     367.  00:43B1                      ;	ld	hl,_dd_tmpstring
     368.  00:43B1                      
     369.  00:43B1  C9                  	ret	
     370.  00:43B2                      _dd_Num1:	
     371.  00:43B2  0E 2F               	ld	c,"0"-1
     372.  00:43B4                      _dd_Num2:	
     373.  00:43B4  0C                  	inc	c
     374.  00:43B5  80                  	add	a,b
     375.  00:43B6  38 FC               	jr	c,_dd_Num2
     376.  00:43B8  98                  	sbc	a,b
     377.  00:43B9  71                  	ld	(hl),c
     378.  00:43BA  23                  	inc	hl
     379.  00:43BB  C9                  	ret 
     380.  00:43BC                      
     381.  00:43BC                      draw_decimal3:
     382.  00:43BC  EB                  	ex	de,hl
     383.  00:43BD  06 9C               	ld	b,-100
     384.  00:43BF  CD B2 43            	call	_dd_Num1
     385.  00:43C2  18 E2               	jr.	1b
     386.  00:43C4                      	
     387.  00:43C4                      	
     388.  00:43C4                      ;_dd_tmpstring:		
     389.  00:43C4                      ;	db	"XX",0		; temporary + delimiter
     390.  00:43C4                      
     391.  00:43C4                      ; ==========================================================	
     392.  00:43C4                      	; --- draw_box
     393.  00:43C4                      	; 
     394.  00:43C4                      	; Draw box 
     395.  00:43C4                      	; HL = position in PNT (relative)
     396.  00:43C4                      	; D = width
     397.  00:43C4                      	; E = height
     398.  00:43C4                      ; ==========================================================
     399.  00:43C4                      draw_box:
     400.  00:43C4  F3                  	di
     401.  00:43C5                      
     402.  00:43C5  01 00 20            	ld 	bc,_PNT
     403.  00:43C8  09                  	add	hl,bc
     404.  00:43C9  CD B2 45            	call	set_vdpwrite		
     405.  00:43CC                      	
     406.  00:43CC  3E 82               	ld	a,_UPLEFT		; upperleft corner
     407.  00:43CE                      
     408.  00:43CE                      draw_box_loop1:
     409.  00:43CE  42                  	ld	b,d	
     410.  00:43CF                      draw_box_loop0:
     411.  00:43CF                      
     412.  00:43CF                      	; change on last pos
     413.  00:43CF  05                  	dec	b
     414.  00:43D0  20 10               	jr.	nz,1f
     415.  00:43D2  FE 81               	cp	_HORIZONTAL
     416.  00:43D4  20 04               	jr.	nz,0f
     417.  00:43D6  3E 83               	ld	a,_UPRIGHT
     418.  00:43D8  18 08               	jr.	1f
     419.  00:43DA                      0:
     420.  00:43DA  FE 20               	cp	32
     421.  00:43DC  20 04               	jr.	nz,1f
     422.  00:43DE  3E 80               	ld	a,_VERTICAL
     423.  00:43E0  18 00               	jr.	1f
     424.  00:43E2                      	
     425.  00:43E2                      1:
     426.  00:43E2  04                  	inc	b	
     427.  00:43E3                      
     428.  00:43E3                      
     429.  00:43E3                      
     430.  00:43E3  D3 98               	out	(0x98),a
     431.  00:43E5                      	
     432.  00:43E5                      	; changed on pos > 1
     433.  00:43E5  FE 82               	cp	_UPLEFT		; if is upleftcorner thern	
     434.  00:43E7  20 04               	jr.	nz,0f
     435.  00:43E9  3E 81               	ld	a,_HORIZONTAL
     436.  00:43EB  18 08               	jr.	1f
     437.  00:43ED                      0:	
     438.  00:43ED  FE 80               	cp	_VERTICAL	; if is vertical line then space
     439.  00:43EF  20 04               	jr.	nz,0f
     440.  00:43F1  3E 20               	ld	a,32			; space	
     441.  00:43F3  18 00               	jr.	1f
     442.  00:43F5                      0:
     443.  00:43F5                      1:
     444.  00:43F5                      
     445.  00:43F5  10 D8               	djnz	draw_box_loop0
     446.  00:43F7                      
     447.  00:43F7                      
     448.  00:43F7                      	;loop lines
     449.  00:43F7  1D                  	dec	e
     450.  00:43F8  28 0E               	jr.	z,draw_box_end
     451.  00:43FA                      	
     452.  00:43FA  01 50 00            	ld	bc,80
     453.  00:43FD  09                  	add	hl,bc
     454.  00:43FE  01 00 20            	ld 	bc,_PNT
     455.  00:4401  CD B2 45            	call	set_vdpwrite
     456.  00:4404  3E 80               	ld	a,_VERTICAL			
     457.  00:4406  18 C6               	jr.	draw_box_loop1
     458.  00:4408                      
     459.  00:4408                      
     460.  00:4408                      draw_box_end:
     461.  00:4408  FB                  	ei
     462.  00:4409  C9                  	ret
     463.  00:440A                      
     464.  00:440A                      
     465.  00:440A                      
     466.  00:440A                      
     467.  00:440A                      ; ==========================================================	
     468.  00:440A                      	; --- draw_colorbox
     469.  00:440A                      	; 
     470.  00:440A                      	; Draw box 
     471.  00:440A                      	; H = x pos
     472.  00:440A                      	; L = y pos
     473.  00:440A                      	; D = width
     474.  00:440A                      	; E = height
     475.  00:440A                      ; ==========================================================
     476.  00:440A                      draw_colorbox:
     477.  00:440A                      	; --- get maskleft
     478.  00:440A  7C                  	ld	a,h
     479.  00:440B  E6 07               	and	0x07
     480.  00:440D  A7                  	and	a
     481.  00:440E  20 04               	jr.	nz,0f
     482.  00:4410  3E FF               	ld	a,255
     483.  00:4412  18 07               	jr.	1f
     484.  00:4414                      0:	
     485.  00:4414  47                  	ld	b,a
     486.  00:4415  3E FF               	ld	a,255
     487.  00:4417                      	
     488.  00:4417                      _dc_maskleft_loop:
     489.  00:4417  CB 3F               		srl	a
     490.  00:4419  10 FC               		djnz	_dc_maskleft_loop
     491.  00:441B  32 00 00            1:	ld	(cb_maskleft),a
     492.  00:441E                      
     493.  00:441E                      	; --- get maskright (7-(x+(w-1)) & 0x07)	
     494.  00:441E  7A                  	ld	a,d
     495.  00:441F  3D                  	dec	a
     496.  00:4420  84                  	add	h
     497.  00:4421  E6 07               	and	0x07
     498.  00:4423  FE 07               	cp	7
     499.  00:4425  20 04               	jr.	nz,0f
     500.  00:4427  3E 00               	ld	a,0
     501.  00:4429  18 0B               	jr.	1f
     502.  00:442B  47                  0:	ld	b,a
     503.  00:442C  3E 07               	ld	a,7
     504.  00:442E  90                  	sub	b
     505.  00:442F                      
     506.  00:442F                      
     507.  00:442F  47                  	ld	b,a
     508.  00:4430  3E FF               	ld	a,255	
     509.  00:4432                      	
     510.  00:4432                      _dc_maskright_loop:
     511.  00:4432  CB 27               		sla	a
     512.  00:4434  10 FC               		djnz	_dc_maskright_loop
     513.  00:4436  32 01 00            1:	ld	(cb_maskright),a
     514.  00:4439                      	
     515.  00:4439                      	; --- calculate the full cnt bytes to copy
     516.  00:4439  7C                  	ld	a,h
     517.  00:443A  E6 F8               	and	0xf8
     518.  00:443C  47                  	ld	b,a		; store in b the full bytes
     519.  00:443D  7C                  	ld	a,h
     520.  00:443E  82                  	add	d
     521.  00:443F  E6 F8               	and	0xf8
     522.  00:4441  90                  	sub	b
     523.  00:4442  CB 3F CB 3F CB 3F   [3]	srl	a		; divide by 8
     524.  00:4448  3D                  	dec	a		; 255 is begin and end in same byte
     525.  00:4449                      				; 0 is no full bytes to copy
     526.  00:4449                      				; >0 full bytes to copy inbetween masks
     527.  00:4449  32 02 00            	ld	(cb_fullbytes),a	
     528.  00:444C                      
     529.  00:444C                      	; --- Calculate start address
     530.  00:444C  4C                  	ld	c,h		; x in c
     531.  00:444D  45                  	ld	b,l		; y in b
     532.  00:444E  21 00 2A            	ld	hl,_CNT
     533.  00:4451  78                  	ld	a,b
     534.  00:4452  A7                  	and	a
     535.  00:4453  28 09               	jr.	z,0f
     536.  00:4455                      
     537.  00:4455                      _dc_start_loop:
     538.  00:4455  7D                  	ld	a,l
     539.  00:4456  C6 0A               	add	10		; every line adds 10 bytes to the addres
     540.  00:4458  6F                  	ld	l,a
     541.  00:4459  30 01               	jr.	nc,1f
     542.  00:445B  24                  	inc	h
     543.  00:445C                      1:
     544.  00:445C  10 F7               	djnz	_dc_start_loop	
     545.  00:445E                      0:
     546.  00:445E  79                  	ld	a,c		; add the x pos.
     547.  00:445F  E6 F8               	and	0xf8
     548.  00:4461  CB 3F CB 3F CB 3F   [3]	srl	a	
     549.  00:4467  85                  	add	l
     550.  00:4468  6F                  	ld	l,a
     551.  00:4469  30 01               	jr.	nc,1f
     552.  00:446B  24                  	inc	h
     553.  00:446C                      1:
     554.  00:446C                      	; now we have start addres in the cnt in HL
     555.  00:446C  4B                  	ld	c,e	; # lines to plot
     556.  00:446D                      	
     557.  00:446D                      	; --- get way to copy
     558.  00:446D  3A 02 00            	ld	a,(cb_fullbytes)
     559.  00:4470  FE FF               	cp	255
     560.  00:4472  28 46               	jr.	z,_cp_clip_copy
     561.  00:4474                      	
     562.  00:4474                      	; --- 'normal' copy
     563.  00:4474                      _cb_copyloop_main:	
     564.  00:4474  E5                  	push	hl
     565.  00:4475  CD CF 45            	call	set_vdpread
     566.  00:4478  DB 98               	in	a,(0x98)
     567.  00:447A  47                  	ld	b,a
     568.  00:447B  3A 00 00            	ld	a,(cb_maskleft)
     569.  00:447E  B0                  	or	b
     570.  00:447F  47                  	ld	b,a
     571.  00:4480                      	
     572.  00:4480  E1                  	pop	hl
     573.  00:4481  E5                  	push	hl
     574.  00:4482  CD B2 45            	call	set_vdpwrite
     575.  00:4485                      	
     576.  00:4485  78                  	ld	a,b
     577.  00:4486  D3 98               	out	(0x98),a
     578.  00:4488  3A 02 00            	ld	a,(cb_fullbytes)
     579.  00:448B  A7                  	and	a
     580.  00:448C  47                  	ld	b,a
     581.  00:448D  E1                  	pop	hl
     582.  00:448E  E5                  	push	hl
     583.  00:448F  23                  	inc	hl
     584.  00:4490  28 0B               	jr.	z,0f
     585.  00:4492                      
     586.  00:4492  85                  	add	a,l
     587.  00:4493  6F                  	ld	l,a
     588.  00:4494  30 01               	jr.	nc,9f
     589.  00:4496  24                  	inc	h
     590.  00:4497                      9:
     591.  00:4497  3E FF               	ld	a,255
     592.  00:4499                      _cb_copyloop:
     593.  00:4499  D3 98               	out	(0x98),a
     594.  00:449B  10 FC               	djnz	_cb_copyloop
     595.  00:449D                      0:	
     596.  00:449D  54                  	ld	d,h
     597.  00:449E  5D                  	ld	e,l
     598.  00:449F  CD CF 45            	call	set_vdpread
     599.  00:44A2  DB 98               	in	a,(0x98)
     600.  00:44A4  47                  	ld	b,a
     601.  00:44A5  3A 01 00            	ld	a,(cb_maskright)
     602.  00:44A8  B0                  	or	b
     603.  00:44A9  47                  	ld	b,a
     604.  00:44AA                      	
     605.  00:44AA  EB                  	ex	de,hl	
     606.  00:44AB  CD B2 45            	call	set_vdpwrite
     607.  00:44AE  78                  	ld	a,b	
     608.  00:44AF  D3 98               	out	(0x98),a
     609.  00:44B1                      	
     610.  00:44B1  E1                  	pop 	hl
     611.  00:44B2  11 0A 00            	ld	de,10
     612.  00:44B5  19                  	add	hl,de
     613.  00:44B6                      	
     614.  00:44B6  0D                  	dec	c
     615.  00:44B7  20 BB               	jr.	nz,_cb_copyloop_main
     616.  00:44B9                      	
     617.  00:44B9  C9                  	ret
     618.  00:44BA                      	
     619.  00:44BA                      
     620.  00:44BA                      _cp_clip_copy:
     621.  00:44BA  E5                  	push	hl
     622.  00:44BB                      
     623.  00:44BB  3A 00 00            	ld	a,(cb_maskleft)
     624.  00:44BE  47                  	ld	b,a
     625.  00:44BF  3A 01 00            	ld	a,(cb_maskright)
     626.  00:44C2  A0                  	and	b
     627.  00:44C3  47                  	ld	b,a
     628.  00:44C4                      
     629.  00:44C4  CD CF 45            	call	set_vdpread
     630.  00:44C7  DB 98               	in	a,(0x98)
     631.  00:44C9                      
     632.  00:44C9  B0                  	or	b
     633.  00:44CA  47                  	ld	b,a
     634.  00:44CB                      	
     635.  00:44CB  E1                  	pop	hl
     636.  00:44CC  E5                  	push	hl
     637.  00:44CD  CD B2 45            	call	set_vdpwrite
     638.  00:44D0                      	
     639.  00:44D0  78                  	ld	a,b
     640.  00:44D1  D3 98               	out	(0x98),a	
     641.  00:44D3                      
     642.  00:44D3  E1                  	pop 	hl
     643.  00:44D4  11 0A 00            	ld	de,10
     644.  00:44D7  19                  	add	hl,de
     645.  00:44D8                      	
     646.  00:44D8  0D                  	dec	c
     647.  00:44D9  20 DF               	jr.	nz,_cp_clip_copy	
     648.  00:44DB                      	
     649.  00:44DB  C9                  	ret
     650.  00:44DC                      
     651.  00:44DC                      ; ==========================================================	
     652.  00:44DC                      	; --- erase_colorbox
     653.  00:44DC                      	; 
     654.  00:44DC                      	; Draw box 
     655.  00:44DC                      	; H = x pos
     656.  00:44DC                      	; L = y pos
     657.  00:44DC                      	; D = width
     658.  00:44DC                      	; E = height
     659.  00:44DC                      ; ==========================================================
     660.  00:44DC                      erase_colorbox:
     661.  00:44DC                      	; --- get maskleft
     662.  00:44DC  7C                  	ld	a,h
     663.  00:44DD  E6 07               	and	0x07
     664.  00:44DF  A7                  	and	a
     665.  00:44E0  20 04               	jr.	nz,0f
     666.  00:44E2  3E FF               	ld	a,255
     667.  00:44E4  18 07               	jr.	1f
     668.  00:44E6                      0:	
     669.  00:44E6  47                  	ld	b,a
     670.  00:44E7  3E FF               	ld	a,255
     671.  00:44E9                      	
     672.  00:44E9                      _ecb_maskleft_loop:
     673.  00:44E9  CB 3F               		srl	a
     674.  00:44EB  10 FC               		djnz	_ecb_maskleft_loop
     675.  00:44ED                      1:	
     676.  00:44ED  EE FF               	xor	255
     677.  00:44EF  32 00 00            	ld	(cb_maskleft),a
     678.  00:44F2                      
     679.  00:44F2                      	; --- get maskright (7-(x+(w-1)) & 0x07)	
     680.  00:44F2  7A                  	ld	a,d
     681.  00:44F3  3D                  	dec	a
     682.  00:44F4  84                  	add	h
     683.  00:44F5  E6 07               	and	0x07
     684.  00:44F7  FE 07               	cp	7
     685.  00:44F9  20 04               	jr.	nz,0f
     686.  00:44FB  3E 00               	ld	a,0
     687.  00:44FD  18 0B               	jr.	1f
     688.  00:44FF  47                  0:	ld	b,a
     689.  00:4500  3E 07               	ld	a,7
     690.  00:4502  90                  	sub	b
     691.  00:4503                      
     692.  00:4503                      
     693.  00:4503  47                  	ld	b,a
     694.  00:4504  3E FF               	ld	a,255	
     695.  00:4506                      	
     696.  00:4506                      _ecb_maskright_loop:
     697.  00:4506  CB 27               		sla	a
     698.  00:4508  10 FC               		djnz	_ecb_maskright_loop
     699.  00:450A                      1:	
     700.  00:450A  EE FF               	xor	255
     701.  00:450C  32 01 00            	ld	(cb_maskright),a
     702.  00:450F                      	
     703.  00:450F                      	; --- calculate the full cnt bytes to copy
     704.  00:450F  7C                  	ld	a,h
     705.  00:4510  E6 F8               	and	0xf8
     706.  00:4512  47                  	ld	b,a		; store in b the full bytes
     707.  00:4513  7C                  	ld	a,h
     708.  00:4514  82                  	add	d
     709.  00:4515  E6 F8               	and	0xf8
     710.  00:4517  90                  	sub	b
     711.  00:4518  CB 3F CB 3F CB 3F   [3]	srl	a		; divide by 8
     712.  00:451E  3D                  	dec	a		; 255 is begin and end in same byte
     713.  00:451F                      				; 0 is no full bytes to copy
     714.  00:451F                      				; >0 full bytes to copy inbetween masks
     715.  00:451F  32 02 00            	ld	(cb_fullbytes),a	
     716.  00:4522                      
     717.  00:4522                      	; --- Calculate start address
     718.  00:4522  4C                  	ld	c,h		; x in c
     719.  00:4523  45                  	ld	b,l		; y in b
     720.  00:4524  21 00 2A            	ld	hl,_CNT
     721.  00:4527  78                  	ld	a,b
     722.  00:4528  A7                  	and	a
     723.  00:4529  28 09               	jr.	z,0f
     724.  00:452B                      
     725.  00:452B                      _ecb_start_loop:
     726.  00:452B  7D                  	ld	a,l
     727.  00:452C  C6 0A               	add	10		; every line adds 10 bytes to the addres
     728.  00:452E  6F                  	ld	l,a
     729.  00:452F  30 01               	jr.	nc,1f
     730.  00:4531  24                  	inc	h
     731.  00:4532                      1:
     732.  00:4532  10 F7               	djnz	_ecb_start_loop	
     733.  00:4534                      0:
     734.  00:4534  79                  	ld	a,c		; add the x pos.
     735.  00:4535  E6 F8               	and	0xf8
     736.  00:4537  CB 3F CB 3F CB 3F   [3]	srl	a	
     737.  00:453D  85                  	add	l
     738.  00:453E  6F                  	ld	l,a
     739.  00:453F  30 01               	jr.	nc,1f
     740.  00:4541  24                  	inc	h
     741.  00:4542                      1:
     742.  00:4542                      	; now we have start addres in the cnt in HL
     743.  00:4542  4B                  	ld	c,e	; # lines to plot
     744.  00:4543                      	
     745.  00:4543                      	; --- get way to copy
     746.  00:4543  3A 02 00            	ld	a,(cb_fullbytes)
     747.  00:4546  FE FF               	cp	255
     748.  00:4548  28 46               	jr.	z,_ecb_clip_copy
     749.  00:454A                      	
     750.  00:454A                      	; --- 'normal' copy
     751.  00:454A                      _ecb_copyloop_main:	
     752.  00:454A  E5                  	push	hl
     753.  00:454B  CD CF 45            	call	set_vdpread
     754.  00:454E  DB 98               	in	a,(0x98)
     755.  00:4550  47                  	ld	b,a
     756.  00:4551  3A 00 00            	ld	a,(cb_maskleft)
     757.  00:4554  A0                  	and	b
     758.  00:4555  47                  	ld	b,a
     759.  00:4556                      	
     760.  00:4556  E1                  	pop	hl
     761.  00:4557  E5                  	push	hl
     762.  00:4558  CD B2 45            	call	set_vdpwrite
     763.  00:455B                      	
     764.  00:455B  78                  	ld	a,b
     765.  00:455C  D3 98               	out	(0x98),a
     766.  00:455E  3A 02 00            	ld	a,(cb_fullbytes)
     767.  00:4561  A7                  	and	a
     768.  00:4562  47                  	ld	b,a
     769.  00:4563  E1                  	pop	hl
     770.  00:4564  E5                  	push	hl
     771.  00:4565  23                  	inc	hl
     772.  00:4566  28 0B               	jr.	z,0f
     773.  00:4568                      
     774.  00:4568  85                  	add	a,l
     775.  00:4569  6F                  	ld	l,a
     776.  00:456A  30 01               	jr.	nc,9f
     777.  00:456C  24                  	inc	h
     778.  00:456D                      9:
     779.  00:456D  3E 00               	ld	a,0
     780.  00:456F                      _ecb_copyloop:
     781.  00:456F  D3 98               	out	(0x98),a
     782.  00:4571  10 FC               	djnz	_ecb_copyloop
     783.  00:4573                      0:	
     784.  00:4573  54                  	ld	d,h
     785.  00:4574  5D                  	ld	e,l
     786.  00:4575  CD CF 45            	call	set_vdpread
     787.  00:4578  DB 98               	in	a,(0x98)
     788.  00:457A  47                  	ld	b,a
     789.  00:457B  3A 01 00            	ld	a,(cb_maskright)
     790.  00:457E  A0                  	and	b
     791.  00:457F  47                  	ld	b,a
     792.  00:4580                      	
     793.  00:4580  EB                  	ex	de,hl	
     794.  00:4581  CD B2 45            	call	set_vdpwrite
     795.  00:4584  78                  	ld	a,b	
     796.  00:4585  D3 98               	out	(0x98),a
     797.  00:4587                      	
     798.  00:4587  E1                  	pop 	hl
     799.  00:4588  11 0A 00            	ld	de,10
     800.  00:458B  19                  	add	hl,de
     801.  00:458C                      	
     802.  00:458C  0D                  	dec	c
     803.  00:458D  20 BB               	jr.	nz,_ecb_copyloop_main
     804.  00:458F                      	
     805.  00:458F  C9                  	ret
     806.  00:4590                      	
     807.  00:4590                      
     808.  00:4590                      _ecb_clip_copy:
     809.  00:4590  E5                  	push	hl
     810.  00:4591                      
     811.  00:4591  3A 00 00            	ld	a,(cb_maskleft)
     812.  00:4594  47                  	ld	b,a
     813.  00:4595  3A 01 00            	ld	a,(cb_maskright)
     814.  00:4598  B0                  	or	b
     815.  00:4599  47                  	ld	b,a
     816.  00:459A                      
     817.  00:459A  CD CF 45            	call	set_vdpread
     818.  00:459D  DB 98               	in	a,(0x98)
     819.  00:459F                      
     820.  00:459F  A0                  	and	b
     821.  00:45A0  47                  	ld	b,a
     822.  00:45A1                      	
     823.  00:45A1  E1                  	pop	hl
     824.  00:45A2  E5                  	push	hl
     825.  00:45A3  CD B2 45            	call	set_vdpwrite
     826.  00:45A6                      	
     827.  00:45A6  78                  	ld	a,b
     828.  00:45A7  D3 98               	out	(0x98),a	
     829.  00:45A9                      
     830.  00:45A9  E1                  	pop 	hl
     831.  00:45AA  11 0A 00            	ld	de,10
     832.  00:45AD  19                  	add	hl,de
     833.  00:45AE                      	
     834.  00:45AE  0D                  	dec	c
     835.  00:45AF  20 DF               	jr.	nz,_ecb_clip_copy	
     836.  00:45B1                      	
     837.  00:45B1  C9                  	ret
     838.  00:45B2                      
     839.  00:45B2                      	; --- set_vdpwrite
     840.  00:45B2                      	; sets up the vdp address in HL to write to
     841.  00:45B2                      	; enables ISR and changes a
     842.  00:45B2                      
     843.  00:45B2                      set_vdpwrite:
     844.  00:45B2  AF                  	xor	a
     845.  00:45B3  CB 04               	rlc	h
     846.  00:45B5  17                  	rla
     847.  00:45B6  CB 04               	rlc	h
     848.  00:45B8  17                  	rla
     849.  00:45B9  CB 3C               	srl	h
     850.  00:45BB  CB 3C               	srl	h
     851.  00:45BD  F3                  	di
     852.  00:45BE  D3 99               	out	(#99),a
     853.  00:45C0  3E 8E               	ld	a,14+128
     854.  00:45C2  D3 99               	out	(#99),a
     855.  00:45C4  7D                  	ld	a,l
     856.  00:45C5  00                  	nop
     857.  00:45C6  D3 99               	out	(#99),a
     858.  00:45C8  7C                  	ld	a,h
     859.  00:45C9  F6 40               	or	64
     860.  00:45CB  FB                  	ei
     861.  00:45CC  D3 99               	out	(#99),a
     862.  00:45CE  C9                  	ret
     863.  00:45CF                      
     864.  00:45CF                      
     865.  00:45CF                      	; --- set_vdpwrite
     866.  00:45CF                      	; sets up the vdp address in HL to write to
     867.  00:45CF                      	; enables ISR and changes a
     868.  00:45CF                      
     869.  00:45CF                      set_vdpread:
     870.  00:45CF  AF                  	xor	a
     871.  00:45D0  CB 04               	rlc	h
     872.  00:45D2  17                  	rla
     873.  00:45D3  CB 04               	rlc	h
     874.  00:45D5  17                  	rla
     875.  00:45D6  CB 3C               	srl	h
     876.  00:45D8  CB 3C               	srl	h
     877.  00:45DA  F3                  	di
     878.  00:45DB  D3 99               	out	(#99),a
     879.  00:45DD  3E 8E               	ld	a,14+128
     880.  00:45DF  D3 99               	out	(#99),a
     881.  00:45E1  7D                  	ld	a,l
     882.  00:45E2  00                  	nop
     883.  00:45E3  D3 99               	out	(#99),a
     884.  00:45E5  7C                  	ld	a,h
     885.  00:45E6  D3 99               	out	(#99),a
     886.  00:45E8  FB                  	ei
     887.  00:45E9  C9                  	ret
     888.  00:45EA                      
     889.  00:45EA                      
     890.  00:45EA                      ; --- Colorbox function variables
     891.  00:45EA  (00:0000)           cb_maskleft:	#1
     892.  00:45EA  (00:0001)           cb_maskright:	#1
     893.  00:45EA  (00:0002)           cb_fullbytes:	#1
     894.  00:45EA  (00:0003)           cb_status:		#1
     895.  00:45EA                      
     896.  00:45EA                      
     897.  00:45EA                      	; --- init_font
     898.  00:45EA                      	;
     899.  00:45EA                      	; Init the font in the PGT.
     900.  00:45EA                      
     901.  00:45EA                      init_font:
     902.  00:45EA                      
     903.  00:45EA  F3                  	di
     904.  00:45EB                      	; relocate the PGT (old is at 0x1000)
     905.  00:45EB                      	; new is at 0x9000
     906.  00:45EB                      ;	ld	a,00010010b
     907.  00:45EB                      ;	out	(0x99),a
     908.  00:45EB                      ;	ld	a,128+4	
     909.  00:45EB                      ;	out	(0x99),a
     910.  00:45EB                      
     911.  00:45EB  21 00 90            	ld	hl,0x9000
     912.  00:45EE  CD B2 45            	call	set_vdpwrite
     913.  00:45F1                      	
     914.  00:45F1  F3                  	di
     915.  00:45F2  3E 08               	ld a,8		; loop 8 times
     916.  00:45F4  0E 98               	ld c,0x98
     917.  00:45F6                      
     918.  00:45F6  21 AB 5B            	ld hl,font_data
     919.  00:45F9                      
     920.  00:45F9                      _fontloop:
     921.  00:45F9  06 FF               		ld b,255		; subloop 255 times
     922.  00:45FB  ED B3               		otir
     923.  00:45FD  3D                  	dec a
     924.  00:45FE  20 F9               	jr. nz,_fontloop
     925.  00:4600                      	
     926.  00:4600  FB                  	ei
     927.  00:4601  C9                  	ret
     559   00:4602                      	include	"..\code\ttreplaySMS.asm"
       1.  00:4602                      ;=================================
       2.  00:4602                      ; TriloTracker Re-player SMS
       3.  00:4602                      ; 
       4.  00:4602                      ; Functions:
       5.  00:4602                      ; 	replay_init
       6.  00:4602                      ;	replay_pause
       7.  00:4602                      ;	replay_fade_out
       8.  00:4602                      ;================================
       9.  00:4602  (00:007C)           FM_WRITE:	equ	0x7c	; port to set fm reg nr.
      10.  00:4602  (00:007D)           FM_DATA:	equ	0x7d	; port to set fm data for reg	
      11.  00:4602                      ;===============================
      12.  00:4602  (00:0060)           _REL:		equ	96	; = release
      13.  00:4602  (00:0061)           _SUS:		equ	97	; = sustain
      14.  00:4602  (00:0062)           _VOL:		equ	98	; = volume 1
      15.  00:4602  (00:0071)           _INS:		equ	113	; = instrument 1
      16.  00:4602  (00:0090)           _CMD:		equ	144	; = effect 0
      17.  00:4602  (00:00B8)           _SPC:		equ	184	; = special commands
      18.  00:4602  (00:00BF)           _EOT:		equ	191	; = end of track
      19.  00:4602  (00:00C0)           _WAIT:	equ	192	; = wait 1
      20.  00:4602                      
      21.  00:4602                      	
      22.  00:4602                      ;===========================================================
      23.  00:4602                      ; ---	replay_init
      24.  00:4602                      ; Initialize re-player data
      25.  00:4602                      ; Only call this on start-up
      26.  00:4602                      ; Input: none
      27.  00:4602                      ;===========================================================
      28.  00:4602                      replay_init:
      29.  00:4602  3E 07               	ld	a,7
      30.  00:4604  CD 57 46            	call	replay_set_FM_balance
      31.  00:4607  3E 07               	ld	a,7
      32.  00:4609  CD 5E 46            	call	replay_set_PSG_balance
      33.  00:460C                      
      34.  00:460C  AF                  	xor	a
      35.  00:460D  32 22 C0            	ld	(replay_mode),a	
      36.  00:4610  32 30 C0            	ld	(equalization_cnt),a
      37.  00:4613  32 31 C0            	ld	(equalization_flag),a	
      38.  00:4616  32 2F C0            	ld	(equalization_freq),a
      39.  00:4619  3C                  	inc	a
      40.  00:461A  32 23 C0            	ld	(replay_chan_setup),a	
      41.  00:461D                      	
      42.  00:461D  C9                  	ret
      43.  00:461E                      
      44.  00:461E                      ;===========================================================
      45.  00:461E                      ; ---	replay_pause
      46.  00:461E                      ; Stop/Restart music playback
      47.  00:461E                      ; 
      48.  00:461E                      ; Input: none
      49.  00:461E                      ;===========================================================
      50.  00:461E                      replay_pause:
      51.  00:461E  3A 22 C0            	ld	a,(replay_mode)
      52.  00:4621  A7                  	and	a
      53.  00:4622  CA 2B 46            	jp	z,_r_pause_disable
      54.  00:4625                      _r_pause_enable:
      55.  00:4625                      	;-- re-enable music decoding and processing
      56.  00:4625  3E 01               	ld	a,1
      57.  00:4627  32 22 C0            	ld	(replay_mode),a
      58.  00:462A  C9                  	ret
      59.  00:462B                      	
      60.  00:462B                      _r_pause_disable:
      61.  00:462B                      	;-- stop decoding and processing music data
      62.  00:462B  AF                  	xor	a
      63.  00:462C  32 22 C0            	ld	(replay_mode),a	
      64.  00:462F  32 AE C1            	ld	(FM_DRUM),a
      65.  00:4632                      	;--- Silence the SN7 PSG
      66.  00:4632  32 72 C1            	ld	(PSG_regVOLA),a
      67.  00:4635  32 73 C1            	ld	(PSG_regVOLB),a
      68.  00:4638  32 74 C1            	ld	(PSG_regVOLC),a
      69.  00:463B  32 75 C1            	ld	(PSG_regVOLN),a
      70.  00:463E                      	; release key on all FM channels
      71.  00:463E  06 09               	ld	b,9
      72.  00:4640  21 79 C1            	ld	hl,FM_Registers+1
      73.  00:4643  11 06 00            	ld	de,6
      74.  00:4646  AF                  	xor	a
      75.  00:4647                      _r_pause_loop:
      76.  00:4647  77                  	ld	(hl),a
      77.  00:4648  19                  	add	hl,de
      78.  00:4649  10 FC               	djnz	_r_pause_loop
      79.  00:464B  C9                  	ret	
      80.  00:464C                      	
      81.  00:464C                      
      82.  00:464C                      ;===========================================================
      83.  00:464C                      ; ---	replay_fade_out
      84.  00:464C                      ; Fade out the music. 
      85.  00:464C                      ; Once the sound is silence the replayer is paused.
      86.  00:464C                      ;
      87.  00:464C                      ; in: [A] fade speed (1 - 255)
      88.  00:464C                      ;===========================================================	
      89.  00:464C                      replay_fade_out:
      90.  00:464C  32 25 C0            	ld	(replay_fade),a
      91.  00:464F  32 26 C0            	ld	(replay_fade_timer),a
      92.  00:4652  AF                  	xor	a
      93.  00:4653  32 27 C0            	ld	(replay_fade_vol),a
      94.  00:4656  C9                  	ret
      95.  00:4657                      
      96.  00:4657                      
      97.  00:4657                      	
      98.  00:4657                      ;===========================================================
      99.  00:4657                      ; ---	replay_set_FM_balance
     100.  00:4657                      ; Set the main volume for the SCC chip. This enables for
     101.  00:4657                      ; setting the balance between SCC en PSG as some MSX models 
     102.  00:4657                      ; default balance differs. 
     103.  00:4657                      ;
     104.  00:4657                      ; in: [A] master volume (0-7) 0=halve volume, 7=full volume. 
     105.  00:4657                      ;===========================================================	
     106.  00:4657                      replay_set_FM_balance:
     107.  00:4657  CD 65 46            	call	_getnewbalancebase
     108.  00:465A  22 05 C0            	ld	(replay_mainSCCvol),hl	
     109.  00:465D  C9                  	ret
     110.  00:465E                      	
     111.  00:465E                      ;===========================================================
     112.  00:465E                      ; ---	replay_set_PSG_balance
     113.  00:465E                      ; Set the main volume for the PSG chip. This enables for
     114.  00:465E                      ; setting the balance between SCC en PSG as some MSX models 
     115.  00:465E                      ; default balance differs. 
     116.  00:465E                      ;
     117.  00:465E                      ; in: [A] master volume (0-7) 0=halve volume, 7=full volume. 
     118.  00:465E                      ;===========================================================	
     119.  00:465E                      replay_set_PSG_balance:
     120.  00:465E  CD 65 46            	call	_getnewbalancebase
     121.  00:4661  22 03 C0            	ld	(replay_mainPSGvol),hl	
     122.  00:4664  C9                  	ret
     123.  00:4665                      	
     124.  00:4665                      _getnewbalancebase:
     125.  00:4665  07                  	rlca
     126.  00:4666  07                  	rlca
     127.  00:4667  07                  	rlca
     128.  00:4668  07                  	rlca
     129.  00:4669  21 90 51            	ld	hl,_VOLUME_TABLE-128
     130.  00:466C  E6 F0               	and	$f0
     131.  00:466E  85                  	add	a,l
     132.  00:466F  6F                  	ld	l,a
     133.  00:4670  D0                  	ret nc
     134.  00:4671  24                  	inc	h
     135.  00:4672  C9                  	ret
     136.  00:4673                      	
     137.  00:4673                      	
     138.  00:4673                      	
     139.  00:4673                      ;===========================================================
     140.  00:4673                      ; ---	replay_loadsong
     141.  00:4673                      ; Initialize a song for playback
     142.  00:4673                      ; 
     143.  00:4673                      ; Input [HL] points to start song
     144.  00:4673                      ;===========================================================
     145.  00:4673                      replay_loadsong:
     146.  00:4673                      	;--- Get the start speed.
     147.  00:4673  7E                  	ld	a,(hl)	
     148.  00:4674  23                  	inc	hl
     149.  00:4675  32 1F C0            	ld	(replay_speed),a
     150.  00:4678                      
     151.  00:4678                      	;--- Set voice base, drum base, instrument base and track pointers
     152.  00:4678  11 07 C0            	ld 	de,replay_voicebase
     153.  00:467B  01 16 00            	ld	bc,22
     154.  00:467E  ED B0               	ldir
     155.  00:4680  22 1D C0            	ld	(replay_orderpointer),hl		; store pointer for next set
     156.  00:4683                      										; of track pointers
     157.  00:4683                      	;--- Initialize re-player variables.
     158.  00:4683  AF                  	xor	a
     159.  00:4684  32 20 C0            	ld	(replay_speed_subtimer),a
     160.  00:4687                      	
     161.  00:4687                      	;--- Erase channel data	in RAM
     162.  00:4687  01 37 01            	ld	bc,TRACK_REC_SIZE*8-1
     163.  00:468A  21 32 C0            	ld	hl,TRACK_Chan1
     164.  00:468D  11 33 C0            	ld	de,TRACK_Chan1+1
     165.  00:4690  77                  	ld	(hl),a
     166.  00:4691  ED B0               	ldir
     167.  00:4693                      	
     168.  00:4693  32 24 C0            	ld	(replay_arp_speed),a
     169.  00:4696  32 B9 C1            	ld	(FM_DRUM_LEN),a
     170.  00:4699  32 AE C1            	ld	(FM_DRUM),a	
     171.  00:469C                      	
     172.  00:469C  32 72 C1            	ld	(PSG_regVOLA),a
     173.  00:469F  32 73 C1            	ld	(PSG_regVOLB),a	
     174.  00:46A2  32 74 C1            	ld	(PSG_regVOLC),a
     175.  00:46A5  32 70 C1            	ld	(PSG_regNOISE),a
     176.  00:46A8                      
     177.  00:46A8                      ;	;--- Set the tone table base
     178.  00:46A8                      ;	ld	hl,TRACK_ToneTable_PSG
     179.  00:46A8                      ;	ld	(replay_tonetable_PSG),hl
     180.  00:46A8                      ;	ld	hl,TRACK_ToneTable_FM
     181.  00:46A8                      ;	ld	(replay_tonetable_FM),hl
     182.  00:46A8                      
     183.  00:46A8  3E 01               	ld	a,1
     184.  00:46AA  32 21 C0            	ld	(replay_speed_timer),a
     185.  00:46AD  32 56 C0            	ld	(TRACK_Chan1+17+TRACK_Delay),a	
     186.  00:46B0  32 7D C0            	ld	(TRACK_Chan2+17+TRACK_Delay),a		
     187.  00:46B3  32 A4 C0            	ld	(TRACK_Chan3+17+TRACK_Delay),a	
     188.  00:46B6  32 CB C0            	ld	(TRACK_Chan4+17+TRACK_Delay),a	
     189.  00:46B9  32 F2 C0            	ld	(TRACK_Chan5+17+TRACK_Delay),a		
     190.  00:46BC  32 19 C1            	ld	(TRACK_Chan6+17+TRACK_Delay),a		
     191.  00:46BF  32 40 C1            	ld	(TRACK_Chan7+17+TRACK_Delay),a		
     192.  00:46C2  32 67 C1            	ld	(TRACK_Chan8+17+TRACK_Delay),a	
     193.  00:46C5                      	
     194.  00:46C5  3E FE               	ld	a,254
     195.  00:46C7  32 32 C0            	ld	(TRACK_Chan1+17+TRACK_Instrument),a	
     196.  00:46CA  32 59 C0            	ld	(TRACK_Chan2+17+TRACK_Instrument),a		
     197.  00:46CD  32 80 C0            	ld	(TRACK_Chan3+17+TRACK_Instrument),a	
     198.  00:46D0  32 A7 C0            	ld	(TRACK_Chan4+17+TRACK_Instrument),a	
     199.  00:46D3  32 CE C0            	ld	(TRACK_Chan5+17+TRACK_Instrument),a		
     200.  00:46D6  32 F5 C0            	ld	(TRACK_Chan6+17+TRACK_Instrument),a		
     201.  00:46D9  32 1C C1            	ld	(TRACK_Chan7+17+TRACK_Instrument),a		
     202.  00:46DC  32 43 C1            	ld	(TRACK_Chan8+17+TRACK_Instrument),a	
     203.  00:46DF  32 BC C1            	ld	(FM_softvoice_req),a	
     204.  00:46E2  32 BD C1            	ld	(FM_softvoice_set),a
     205.  00:46E5                      
     206.  00:46E5  3E 10               	ld	a,16
     207.  00:46E7  32 89 C0            	ld	(TRACK_Chan3+17+TRACK_Voice),a
     208.  00:46EA  32 B0 C0            	ld	(TRACK_Chan4+17+TRACK_Voice),a
     209.  00:46ED  32 D7 C0            	ld	(TRACK_Chan5+17+TRACK_Voice),a
     210.  00:46F0  32 FE C0            	ld	(TRACK_Chan6+17+TRACK_Voice),a	
     211.  00:46F3  32 25 C1            	ld	(TRACK_Chan7+17+TRACK_Voice),a	
     212.  00:46F6  32 4C C1            	ld	(TRACK_Chan8+17+TRACK_Voice),a
     213.  00:46F9  3E 80               	ld	a,128
     214.  00:46FB  32 8A C0            	ld	(TRACK_Chan3+17+TRACK_Flags),a
     215.  00:46FE  32 B1 C0            	ld	(TRACK_Chan4+17+TRACK_Flags),a
     216.  00:4701  32 D8 C0            	ld	(TRACK_Chan5+17+TRACK_Flags),a
     217.  00:4704  32 FF C0            	ld	(TRACK_Chan6+17+TRACK_Flags),a	
     218.  00:4707  32 26 C1            	ld	(TRACK_Chan7+17+TRACK_Flags),a
     219.  00:470A  32 4D C1            	ld	(TRACK_Chan8+17+TRACK_Flags),a	
     220.  00:470D                      	
     221.  00:470D                      	;--- Check if there are 3 psg chans.
     222.  00:470D  3A 23 C0            	ld	a,(replay_chan_setup)
     223.  00:4710  A7                  	and	a
     224.  00:4711  CA 18 47            	jp	z,99f
     225.  00:4714  AF                  	xor 	a
     226.  00:4715  32 8A C0            	ld	(TRACK_Chan3+17+TRACK_Flags),a	
     227.  00:4718                      99:	
     228.  00:4718                      
     229.  00:4718  CD 41 50            	call	replay_route
     230.  00:471B                      	
     231.  00:471B                      	; end	is here
     232.  00:471B  3E 01               	ld	a,1
     233.  00:471D  32 22 C0            	ld	(replay_mode),a	
     234.  00:4720  C9                  	ret
     235.  00:4721                      
     236.  00:4721                      ;===========================================================
     237.  00:4721                      ; ---	replay_play
     238.  00:4721                      ; Decode music data and process instruments and effects. 
     239.  00:4721                      ; Music chip registers will be prepared for replay_route 
     240.  00:4721                      ;
     241.  00:4721                      ; Input none
     242.  00:4721                      ;===========================================================	
     243.  00:4721                      replay_play:
     244.  00:4721  3A 22 C0            	ld	a,(replay_mode)
     245.  00:4724  A7                  	and	a
     246.  00:4725  C8                  	ret	z		; replay mode = 0	; halted
     247.  00:4726                      				; replay mode = 1	; active
     248.  00:4726                      	
     249.  00:4726                      	;---- SPEED EQUALIZATION 
     250.  00:4726  3A 2F C0            	ld	a,(equalization_freq)		; 0 = 50Hz, otherwise 60Hz
     251.  00:4729  A7                  	and	a
     252.  00:472A  28 14               	jr.	z,.PAL               		; if PAL process at any interrupt;
     253.  00:472C                      
     254.  00:472C                      .NTSC:
     255.  00:472C  21 30 C0            	ld	hl,equalization_cnt  		; if NTSC call 5 times out of 6
     256.  00:472F  35                  	dec	(hl)
     257.  00:4730  20 0E               	jr.	nz,.PAL               		; skip music data processing one tic out of 6
     258.  00:4732                      
     259.  00:4732                      	;--- Reset timer and raise equalization flag
     260.  00:4732  3E 06               	ld	a,6
     261.  00:4734  77                  	ld	(hl),a						
     262.  00:4735  32 31 C0             	ld	(equalization_flag),a		
     263.  00:4738                      
     264.  00:4738  CD 56 48            	call	process_data	
     265.  00:473B  AF                  	xor	a
     266.  00:473C  32 31 C0            	ld	(equalization_flag),a
     267.  00:473F  C9                  	ret
     268.  00:4740                      .PAL:                             
     269.  00:4740                      	;---- END SPEED EQUALIZATION	
     270.  00:4740                      
     271.  00:4740                      		
     272.  00:4740                      	;--- The speed timer
     273.  00:4740  21 21 C0            	ld	hl,replay_speed_timer
     274.  00:4743  35                  	dec	(hl)
     275.  00:4744                      
     276.  00:4744  C2 D9 49            	jp	nz,_replay_check_patternend	
     277.  00:4747                      		
     278.  00:4747                      	;--- Re-init Timer == 0
     279.  00:4747  AF                  	xor	a
     280.  00:4748  ED 4B 1F C0         	ld	bc,(replay_speed)		; [b]	sub-timer [c] speed
     281.  00:474C  CB 39               	srl	c				; bit	0 is halve speed step
     282.  00:474E  8F                  	adc	a,a
     283.  00:474F  A8                  	xor	b				; alternate	speed	to have halve speed.
     284.  00:4750  32 20 C0            	ld	(replay_speed_subtimer),a
     285.  00:4753  81                  	add	c
     286.  00:4754  32 21 C0            	ld	(replay_speed_timer),a
     287.  00:4757                      		
     288.  00:4757                      ;===========================================================
     289.  00:4757                      ; ---	replay_decodedata
     290.  00:4757                      ; Process the pattern data 
     291.  00:4757                      ;===========================================================
     292.  00:4757                      decode_data:
     293.  00:4757                      	;--- process the channels (tracks)
     294.  00:4757  21 10 53            	ld	hl,TRACK_ToneTable_PSG			; Set the PSG note table
     295.  00:475A  22 2D C0            	ld	(replay_tonetable),hl	
     296.  00:475D                      	
     297.  00:475D                      .decode1:	
     298.  00:475D  21 56 C0            	ld 	hl,TRACK_Chan1+17+TRACK_Delay
     299.  00:4760  35                  	dec	(hl)
     300.  00:4761  C2 7E 47            	jp	nz,.decode2
     301.  00:4764                      
     302.  00:4764  3A 3C C0            	ld	a,(TRACK_Chan1+17+TRACK_Flags)
     303.  00:4767  57                  	ld	d,a
     304.  00:4768  3A 39 C0            	ld	a,(TRACK_Chan1+17+TRACK_Note)	
     305.  00:476B  DD 21 43 C0         	ld	ix,TRACK_Chan1+17
     306.  00:476F  ED 4B 0D C0         	ld	bc,(TRACK_pointer1)
     307.  00:4773  CD 0B 4A            	call	decode_data_chan
     308.  00:4776  ED 43 0D C0         	ld	(TRACK_pointer1),bc
     309.  00:477A  7A                  	ld	a,d
     310.  00:477B  32 3C C0            	ld	(TRACK_Chan1+17+TRACK_Flags),a	
     311.  00:477E                      
     312.  00:477E                      .decode2:	
     313.  00:477E  21 7D C0            	ld 	hl,TRACK_Chan2+17+TRACK_Delay
     314.  00:4781  35                  	dec	(hl)
     315.  00:4782  C2 A2 47            	jp	nz,.decode3
     316.  00:4785                      
     317.  00:4785  3A 63 C0            	ld	a,(TRACK_Chan2+17+TRACK_Flags)
     318.  00:4788  57                  	ld	d,a
     319.  00:4789  3A 60 C0            	ld	a,(TRACK_Chan2+17+TRACK_Note)	
     320.  00:478C  DD 21 6A C0         	ld	ix,TRACK_Chan2+17
     321.  00:4790  ED 4B 0F C0         	ld	bc,(TRACK_pointer2)
     322.  00:4794                      ;	call	decode_data_chan
     323.  00:4794  ED 43 0F C0         	ld	(TRACK_pointer2),bc
     324.  00:4798  7A                  	ld	a,d				;'
     325.  00:4799  32 63 C0            	ld	(TRACK_Chan2+17+TRACK_Flags),a	
     326.  00:479C                      
     327.  00:479C                      	;--- Set FM Tone table
     328.  00:479C  21 D0 53            	ld	hl,TRACK_ToneTable_FM
     329.  00:479F  22 2D C0            	ld	(replay_tonetable),hl
     330.  00:47A2                      
     331.  00:47A2                      
     332.  00:47A2                      .decode3:
     333.  00:47A2  21 A4 C0            	ld 	hl,TRACK_Chan3+17+TRACK_Delay
     334.  00:47A5  35                  	dec	(hl)
     335.  00:47A6  C2 C0 47            	jp	nz,.decode4
     336.  00:47A9                      
     337.  00:47A9  3A 8A C0            	ld	a,(TRACK_Chan3+17+TRACK_Flags)
     338.  00:47AC  57                  	ld	d,a		;'
     339.  00:47AD  3A 87 C0            	ld	a,(TRACK_Chan3+17+TRACK_Note)	
     340.  00:47B0  DD 21 91 C0         	ld	ix,TRACK_Chan3+17
     341.  00:47B4  ED 4B 11 C0         	ld	bc,(TRACK_pointer3)
     342.  00:47B8                      ;	call	decode_data_chan
     343.  00:47B8  ED 43 11 C0         	ld	(TRACK_pointer3),bc
     344.  00:47BC  7A                  	ld	a,d				;'
     345.  00:47BD  32 8A C0            	ld	(TRACK_Chan3+17+TRACK_Flags),a	
     346.  00:47C0                      
     347.  00:47C0                      .decode4:
     348.  00:47C0  21 CB C0            	ld 	hl,TRACK_Chan4+17+TRACK_Delay
     349.  00:47C3  35                  	dec	(hl)
     350.  00:47C4  C2 DE 47            	jp	nz,.decode5
     351.  00:47C7                      
     352.  00:47C7  3A B1 C0            	ld	a,(TRACK_Chan4+17+TRACK_Flags)
     353.  00:47CA  57                  	ld 	d,a		;'
     354.  00:47CB  3A AE C0            	ld	a,(TRACK_Chan4+17+TRACK_Note)	
     355.  00:47CE  DD 21 B8 C0         	ld	ix,TRACK_Chan4+17
     356.  00:47D2  ED 4B 13 C0         	ld	bc,(TRACK_pointer4)
     357.  00:47D6                      ;	call	decode_data_chan
     358.  00:47D6  ED 43 13 C0         	ld	(TRACK_pointer4),bc
     359.  00:47DA  7A                  	ld	a,d			;'
     360.  00:47DB  32 B1 C0            	ld	(TRACK_Chan4+17+TRACK_Flags),a	
     361.  00:47DE                      
     362.  00:47DE                      .decode5:
     363.  00:47DE  21 F2 C0            	ld 	hl,TRACK_Chan5+17+TRACK_Delay
     364.  00:47E1  35                  	dec	(hl)
     365.  00:47E2  C2 FC 47            	jp	nz,.decode6
     366.  00:47E5                      
     367.  00:47E5  3A D8 C0            	ld	a,(TRACK_Chan5+17+TRACK_Flags)
     368.  00:47E8  57                  	ld	d,a		;'
     369.  00:47E9  3A D5 C0            	ld	a,(TRACK_Chan5+17+TRACK_Note)	
     370.  00:47EC  DD 21 DF C0         	ld	ix,TRACK_Chan5+17
     371.  00:47F0  ED 4B 15 C0         	ld	bc,(TRACK_pointer5)
     372.  00:47F4                      ;	call	decode_data_chan
     373.  00:47F4  ED 43 15 C0         	ld	(TRACK_pointer5),bc
     374.  00:47F8  7A                  	ld	a,d			;'
     375.  00:47F9  32 D8 C0            	ld	(TRACK_Chan5+17+TRACK_Flags),a	
     376.  00:47FC                      
     377.  00:47FC                      .decode6:
     378.  00:47FC  21 19 C1            	ld 	hl,TRACK_Chan6+17+TRACK_Delay
     379.  00:47FF  35                  	dec	(hl)
     380.  00:4800  C2 1A 48            	jp	nz,.decode7
     381.  00:4803                      
     382.  00:4803  3A FF C0            	ld	a,(TRACK_Chan6+17+TRACK_Flags)
     383.  00:4806  57                  	ld	d,a		;'
     384.  00:4807  3A FC C0            	ld	a,(TRACK_Chan6+17+TRACK_Note)	
     385.  00:480A  DD 21 06 C1         	ld	ix,TRACK_Chan6+17
     386.  00:480E  ED 4B 17 C0         	ld	bc,(TRACK_pointer6)
     387.  00:4812                      ;	call	decode_data_chan
     388.  00:4812  ED 43 17 C0         	ld	(TRACK_pointer6),bc
     389.  00:4816  7A                  	ld	a,d				;'
     390.  00:4817  32 FF C0            	ld	(TRACK_Chan6+17+TRACK_Flags),a	
     391.  00:481A                      
     392.  00:481A                      .decode7:
     393.  00:481A  21 40 C1            	ld 	hl,TRACK_Chan7+17+TRACK_Delay
     394.  00:481D  35                  	dec	(hl)
     395.  00:481E  C2 38 48            	jp	nz,.decode8
     396.  00:4821                      
     397.  00:4821  3A 26 C1            	ld	a,(TRACK_Chan7+17+TRACK_Flags)
     398.  00:4824  57                  	ld	d,a		;'
     399.  00:4825  3A 23 C1            	ld	a,(TRACK_Chan7+17+TRACK_Note)	
     400.  00:4828  DD 21 2D C1         	ld	ix,TRACK_Chan7+17
     401.  00:482C  ED 4B 19 C0         	ld	bc,(TRACK_pointer7)
     402.  00:4830                      ;	call	decode_data_chan
     403.  00:4830  ED 43 19 C0         	ld	(TRACK_pointer7),bc
     404.  00:4834  7A                  	ld	a,d				;'
     405.  00:4835  32 26 C1            	ld	(TRACK_Chan7+17+TRACK_Flags),a	
     406.  00:4838                      
     407.  00:4838                      .decode8:
     408.  00:4838  21 67 C1            	ld 	hl,TRACK_Chan8+17+TRACK_Delay
     409.  00:483B  35                  	dec	(hl)
     410.  00:483C  C2 56 48            	jp	nz,.decode_end
     411.  00:483F                      
     412.  00:483F  3A 4D C1            	ld	a,(TRACK_Chan8+17+TRACK_Flags)
     413.  00:4842  57                  	ld	d,a		;'
     414.  00:4843  3A 4A C1            	ld	a,(TRACK_Chan8+17+TRACK_Note)	
     415.  00:4846  DD 21 54 C1         	ld	ix,TRACK_Chan8+17
     416.  00:484A  ED 4B 1B C0         	ld	bc,(TRACK_pointer8)
     417.  00:484E                      ;	call	decode_data_chan
     418.  00:484E  ED 43 1B C0         	ld	(TRACK_pointer8),bc
     419.  00:4852  7A                  	ld	a,d				;'
     420.  00:4853  32 4D C1            	ld	(TRACK_Chan8+17+TRACK_Flags),a
     421.  00:4856                      		
     422.  00:4856                      .decode_end:
     423.  00:4856                      	; continue to process data
     424.  00:4856                      ;===========================================================
     425.  00:4856                      ; ---	replay_decodedata_NO
     426.  00:4856                      ; Process changes.
     427.  00:4856                      ; 
     428.  00:4856                      ; 
     429.  00:4856                      ;===========================================================
     430.  00:4856                      process_data:
     431.  00:4856  3E FA               	ld	a,$fa ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     432.  00:4858  D3 99               	out	(0x99),a
     433.  00:485A  3E 87               	ld	a,7+128
     434.  00:485C  D3 99               	out	(0x99),a	
     435.  00:485E                      
     436.  00:485E                      
     437.  00:485E                      
     438.  00:485E                      	; Set tone table
     439.  00:485E  21 10 53            	ld	hl,TRACK_ToneTable_PSG
     440.  00:4861  22 2D C0            	ld	(replay_tonetable),hl
     441.  00:4864                      
     442.  00:4864                      	;--- Initialize PSG Mixer and volume
     443.  00:4864  AF                  	xor	a
     444.  00:4865  32 BE C1            	ld	(FM_regMIXER),a
     445.  00:4868  32 75 C1            	ld	(PSG_regVOLN),a
     446.  00:486B  32 72 C1            	ld	(PSG_regVOLA),a
     447.  00:486E  32 73 C1            	ld	(PSG_regVOLB),a
     448.  00:4871  32 74 C1            	ld	(PSG_regVOLC),a
     449.  00:4874                      	
     450.  00:4874                      	;--- PSG balance
     451.  00:4874  2A 03 C0            	ld	hl,(replay_mainPSGvol)
     452.  00:4877  22 29 C0            	ld	(replay_mainvol),hl
     453.  00:487A                      	
     454.  00:487A                      	;--------------------
     455.  00:487A                      	;--- Process track 1
     456.  00:487A                      	;--------------------
     457.  00:487A  DD 21 43 C0         	ld	ix,TRACK_Chan1+17
     458.  00:487E  3A 3C C0            	ld	a,(TRACK_Chan1+17+TRACK_Flags)
     459.  00:4881  57                  	ld	d,a
     460.  00:4882  21 6A C1            	ld	hl,PSG_regToneA
     461.  00:4885  CD D8 4C            	call	process_data_chan
     462.  00:4888                      ;	ld	(PSG_regToneA),hl
     463.  00:4888  3A 9A C1            	ld	a,(FM_regVOLF)
     464.  00:488B  32 72 C1            	ld	(PSG_regVOLA),a	
     465.  00:488E                      
     466.  00:488E                      	;--------------------
     467.  00:488E                      	;--- Process track 2
     468.  00:488E                      	;--------------------
     469.  00:488E  DD 21 6A C0         	ld	ix,TRACK_Chan2+17
     470.  00:4892  3A 63 C0            	ld	a,(TRACK_Chan2+17+TRACK_Flags)
     471.  00:4895  57                  	ld	d,a
     472.  00:4896  21 6C C1            	ld	hl,PSG_regToneB
     473.  00:4899  CD D8 4C            	call	process_data_chan
     474.  00:489C                      ;	ld	(PSG_regToneB),hl
     475.  00:489C  3A 9A C1            	ld	a,(FM_regVOLF)
     476.  00:489F  32 73 C1            	ld	(PSG_regVOLB),a	
     477.  00:48A2                      
     478.  00:48A2  3A 23 C0            	ld	a,(replay_chan_setup)
     479.  00:48A5  A7                  	and	a
     480.  00:48A6  CA DC 48            	jp	z,_rdd_2psg_6fm
     481.  00:48A9                      
     482.  00:48A9                      _rdd_3psg_5fm:
     483.  00:48A9                      	;--------------------
     484.  00:48A9                      	;--- Process track 3	
     485.  00:48A9                      	;--------------------
     486.  00:48A9  DD 21 91 C0         	ld	ix,TRACK_Chan3+17
     487.  00:48AD  3A 8A C0            	ld	a,(TRACK_Chan3+17+TRACK_Flags)
     488.  00:48B0  57                  	ld	d,a
     489.  00:48B1  21 6E C1            	ld	hl,PSG_regToneC
     490.  00:48B4  CD D8 4C            	call	process_data_chan
     491.  00:48B7                      ;	ld	(PSG_regToneC),hl
     492.  00:48B7  3A 9A C1            	ld	a,(FM_regVOLF)
     493.  00:48BA  32 74 C1            	ld	(PSG_regVOLC),a
     494.  00:48BD                      
     495.  00:48BD                      	;-- Convert mixer to AY
     496.  00:48BD  3A BE C1            	ld	a,(FM_regMIXER)		
     497.  00:48C0  CB 3F               	srl	a
     498.  00:48C2  CB 3F               	srl	a
     499.  00:48C4  EE 3F               	xor	0x3f
     500.  00:48C6  32 71 C1            	ld	(PSG_regMIXER),a
     501.  00:48C9  AF                  	xor	a
     502.  00:48CA  32 BE C1            	ld	(FM_regMIXER),a
     503.  00:48CD                      
     504.  00:48CD                      	; Set tone table
     505.  00:48CD  21 D0 53            	ld	hl,TRACK_ToneTable_FM
     506.  00:48D0  22 2D C0            	ld	(replay_tonetable),hl
     507.  00:48D3                      	;--- set SCC balance
     508.  00:48D3  2A 05 C0            	ld	hl,(replay_mainSCCvol)
     509.  00:48D6  22 29 C0            	ld	(replay_mainvol),hl
     510.  00:48D9                      	
     511.  00:48D9  C3 11 49            	jp	_rdd_cont
     512.  00:48DC                      	
     513.  00:48DC                      	
     514.  00:48DC                      _rdd_2psg_6fm:
     515.  00:48DC                      	;-- Convert mixer to AY
     516.  00:48DC  3A BE C1            	ld	a,(FM_regMIXER)		
     517.  00:48DF  CB 3F               	srl	a
     518.  00:48E1  CB 3F               	srl	a
     519.  00:48E3  CB 3F               	srl	a
     520.  00:48E5  EE 3F               	xor	0x3f
     521.  00:48E7  32 71 C1            	ld	(PSG_regMIXER),a
     522.  00:48EA                      
     523.  00:48EA                      	; Set tone table
     524.  00:48EA  21 D0 53            	ld	hl,TRACK_ToneTable_FM
     525.  00:48ED  22 2D C0            	ld	(replay_tonetable),hl
     526.  00:48F0                      	;--- set SCC balance
     527.  00:48F0  2A 05 C0            	ld	hl,(replay_mainSCCvol)
     528.  00:48F3  22 29 C0            	ld	(replay_mainvol),hl
     529.  00:48F6                      
     530.  00:48F6                      	;--------------------
     531.  00:48F6                      	;--- Process track 3
     532.  00:48F6                      	;--------------------
     533.  00:48F6  DD 21 91 C0         	ld	ix,TRACK_Chan3+17
     534.  00:48FA  3A 8A C0            	ld	a,(TRACK_Chan3+17+TRACK_Flags)
     535.  00:48FD  57                  	ld	d,a
     536.  00:48FE  21 78 C1            	ld	hl,FM_regToneA
     537.  00:4901  CD D8 4C            	call	process_data_chan
     538.  00:4904                      ;	ld	(FM_regToneA),hl
     539.  00:4904  3A 9A C1            	ld	a,(FM_regVOLF)
     540.  00:4907  57                  	ld	d,a
     541.  00:4908  3A 89 C0            	ld	a,(TRACK_Chan3+17+TRACK_Voice)
     542.  00:490B  E6 F0               	and	$f0
     543.  00:490D  B2                  	or	d
     544.  00:490E  32 7C C1            	ld	(FM_regVOLA),a	
     545.  00:4911                      
     546.  00:4911                      
     547.  00:4911                      _rdd_cont:
     548.  00:4911                      	;--------------------
     549.  00:4911                      	;--- Process track 4
     550.  00:4911                      	;--------------------
     551.  00:4911  DD 21 B8 C0         	ld	ix,TRACK_Chan4+17
     552.  00:4915  3A B1 C0            	ld	a,(TRACK_Chan4+17+TRACK_Flags)
     553.  00:4918  57                  	ld	d,a
     554.  00:4919  21 7E C1            	ld	hl,FM_regToneB
     555.  00:491C  CD D8 4C            	call	process_data_chan
     556.  00:491F                      ;	ld	(FM_regToneB),hl
     557.  00:491F  3A 9A C1            	ld	a,(FM_regVOLF)
     558.  00:4922  57                  	ld	d,a
     559.  00:4923  3A B0 C0            	ld	a,(TRACK_Chan4+17+TRACK_Voice)
     560.  00:4926  E6 F0               	and	$f0
     561.  00:4928  B2                  	or	d
     562.  00:4929  32 82 C1            	ld	(FM_regVOLB),a	
     563.  00:492C                      
     564.  00:492C                      	;--------------------
     565.  00:492C                      	;--- Process track 5
     566.  00:492C                      	;--------------------	
     567.  00:492C  DD 21 DF C0         	ld	ix,TRACK_Chan5+17
     568.  00:4930  3A D8 C0            	ld	a,(TRACK_Chan5+17+TRACK_Flags)
     569.  00:4933  57                  	ld	d,a
     570.  00:4934  21 84 C1            	ld	hl,FM_regToneC
     571.  00:4937  CD D8 4C            	call	process_data_chan
     572.  00:493A                      ;	ld	(FM_regToneC),hl
     573.  00:493A  3A 9A C1            	ld	a,(FM_regVOLF)
     574.  00:493D  57                  	ld	d,a
     575.  00:493E  3A D7 C0            	ld	a,(TRACK_Chan5+17+TRACK_Voice)
     576.  00:4941  E6 F0               	and	$f0
     577.  00:4943  B2                  	or	d
     578.  00:4944  32 88 C1            	ld	(FM_regVOLC),a	
     579.  00:4947                      
     580.  00:4947                      	;--------------------
     581.  00:4947                      	;--- Process track 6
     582.  00:4947                      	;--------------------
     583.  00:4947                      		
     584.  00:4947  DD 21 06 C1         	ld	ix,TRACK_Chan6+17
     585.  00:494B  3A FF C0            	ld	a,(TRACK_Chan6+17+TRACK_Flags)
     586.  00:494E  57                  	ld	d,a
     587.  00:494F  21 8A C1            	ld	hl,FM_regToneD
     588.  00:4952  CD D8 4C            	call	process_data_chan
     589.  00:4955                      ;	ld	(FM_regToneD),hl
     590.  00:4955  3A 9A C1            	ld	a,(FM_regVOLF)
     591.  00:4958  57                  	ld	d,a
     592.  00:4959  3A FE C0            	ld	a,(TRACK_Chan6+17+TRACK_Voice)
     593.  00:495C  E6 F0               	and	$f0
     594.  00:495E  B2                  	or	d
     595.  00:495F  32 8E C1            	ld	(FM_regVOLD),a	
     596.  00:4962                      
     597.  00:4962                      	;--------------------
     598.  00:4962                      	;--- Process track 7
     599.  00:4962                      	;--------------------
     600.  00:4962  DD 21 2D C1         	ld	ix,TRACK_Chan7+17
     601.  00:4966  3A 26 C1            	ld	a,(TRACK_Chan7+17+TRACK_Flags)
     602.  00:4969  57                  	ld	d,a
     603.  00:496A  21 90 C1            	ld	hl,FM_regToneE
     604.  00:496D  CD D8 4C            	call	process_data_chan
     605.  00:4970                      ;	ld	(FM_regToneE),hl
     606.  00:4970                      ;	ld	a,d
     607.  00:4970                      ;	ld	(TRACK_Chan7+17+TRACK_Flags),a	
     608.  00:4970  3A 9A C1            	ld	a,(FM_regVOLF)
     609.  00:4973  57                  	ld	d,a
     610.  00:4974  3A 25 C1            	ld	a,(TRACK_Chan7+17+TRACK_Voice)
     611.  00:4977  E6 F0               	and	$f0
     612.  00:4979  B2                  	or	d
     613.  00:497A  32 94 C1            	ld	(FM_regVOLE),a		
     614.  00:497D                      
     615.  00:497D                      	;--------------------
     616.  00:497D                      	;--- Process track 8
     617.  00:497D                      	;--------------------		
     618.  00:497D  DD 21 54 C1         	ld	ix,TRACK_Chan8+17
     619.  00:4981  3A 4D C1            	ld	a,(TRACK_Chan8+17+TRACK_Flags)
     620.  00:4984  57                  	ld	d,a
     621.  00:4985  21 96 C1            	ld	hl,FM_regToneF
     622.  00:4988  CD D8 4C            	call	process_data_chan
     623.  00:498B  3A 9A C1            	ld	a,(FM_regVOLF)
     624.  00:498E  57                  	ld	d,a
     625.  00:498F  3A 4C C1            	ld	a,(TRACK_Chan8+17+TRACK_Voice)
     626.  00:4992  E6 F0               	and	$f0
     627.  00:4994  B2                  	or	d	
     628.  00:4995  32 9A C1            	ld	(FM_regVOLF),a
     629.  00:4998                      ;	ld	(FM_regToneF),hl
     630.  00:4998                      	
     631.  00:4998                      
     632.  00:4998                      	;--------------------
     633.  00:4998                      	; Fade out processing
     634.  00:4998                      	;--------------------
     635.  00:4998  3A 25 C0            	ld	a,(replay_fade)
     636.  00:499B  A7                  	and	a
     637.  00:499C  C8                  	ret	z	; if replay fade = 0 then no fade active
     638.  00:499D                      	
     639.  00:499D                      	; decrease fade timer
     640.  00:499D  3A 26 C0            	ld	a,(replay_fade_timer)
     641.  00:49A0  3D                  	dec	a
     642.  00:49A1  C2 BA 49            	jp	nz,.no_new_step
     643.  00:49A4                      
     644.  00:49A4  3A 27 C0            	ld	a,(replay_fade_vol)
     645.  00:49A7  3C                  	inc	a
     646.  00:49A8  FE 10               	cp	16
     647.  00:49AA  DA B4 49            	jp	c,.cont_fadeing
     648.  00:49AD  AF                  	xor	a
     649.  00:49AE  32 25 C0            	ld	(replay_fade),a
     650.  00:49B1  C3 1E 46            	jp	replay_pause
     651.  00:49B4                      .cont_fadeing:	
     652.  00:49B4  32 27 C0            	ld	(replay_fade_vol),a
     653.  00:49B7  3A 25 C0            	ld	a,(replay_fade)
     654.  00:49BA                      .no_new_step:
     655.  00:49BA  32 26 C0            	ld	(replay_fade_timer),a
     656.  00:49BD                      
     657.  00:49BD  3A 27 C0            	ld	a,(replay_fade_vol)
     658.  00:49C0  4F                  	ld	c,a
     659.  00:49C1  06 03               	ld	b,3
     660.  00:49C3  21 72 C1            	ld	hl,PSG_regVOLA
     661.  00:49C6  CD CE 49            	call	.calc_vol
     662.  00:49C9  06 06               	ld	b,6
     663.  00:49CB  21 7C C1            	ld	hl,FM_regVOLA
     664.  00:49CE                      
     665.  00:49CE                      .calc_vol:	
     666.  00:49CE  7E                  	ld	a,(hl)
     667.  00:49CF  91                  	sub	c
     668.  00:49D0  D2 D4 49            	jp	nc,.no_carry
     669.  00:49D3  AF                  	xor	a
     670.  00:49D4                      .no_carry:	
     671.  00:49D4  77                  	ld	(hl),a
     672.  00:49D5  23                  	inc	hl
     673.  00:49D6  10 F6               	djnz	.calc_vol
     674.  00:49D8  C9                  	ret
     675.  00:49D9                      
     676.  00:49D9                      
     677.  00:49D9                      
     678.  00:49D9                      ;--------------------
     679.  00:49D9                      	
     680.  00:49D9                      	
     681.  00:49D9                      ;--------------------
     682.  00:49D9                      _replay_check_patternend:
     683.  00:49D9  3A 56 C0            	ld 	a,(TRACK_Chan1+17+TRACK_Delay)
     684.  00:49DC  3D                  	dec	a
     685.  00:49DD  C2 56 48            	jp	nz,process_data
     686.  00:49E0                      	
     687.  00:49E0  2A 0D C0            	ld	hl,(TRACK_pointer1)
     688.  00:49E3  7E                  	ld	a,(hl)
     689.  00:49E4                      	
     690.  00:49E4                      	;--- check for end of pattern
     691.  00:49E4  FE BF               	cp	191	
     692.  00:49E6  C2 56 48            	jp	nz,process_data
     693.  00:49E9                      
     694.  00:49E9                      	;--- Set track pointers to start
     695.  00:49E9  2A 1D C0            	ld	hl,(replay_orderpointer)
     696.  00:49EC  AF                  	xor	a
     697.  00:49ED  BE                  	cp	(hl)
     698.  00:49EE  C2 FD 49            	jp	nz,.no_restart
     699.  00:49F1  23                  	inc	hl
     700.  00:49F2  BE                  	cp	(hl)
     701.  00:49F3  2B                  	dec	hl
     702.  00:49F4  C2 FD 49            	jp	nz,.no_restart
     703.  00:49F7                      	;--- next is restart order
     704.  00:49F7  23                  	inc	hl
     705.  00:49F8  23                  	inc	hl
     706.  00:49F9  7E                  	ld	a,(hl)
     707.  00:49FA  23                  	inc	hl
     708.  00:49FB  66                  	ld	h,(hl)
     709.  00:49FC  6F                  	ld	l,a
     710.  00:49FD                      .no_restart:	
     711.  00:49FD  11 0D C0            	ld	de,TRACK_pointer1
     712.  00:4A00  01 10 00            	ld	bc,16
     713.  00:4A03  ED B0               	ldir
     714.  00:4A05  22 1D C0            	ld	(replay_orderpointer),hl		; store pointer for next set
     715.  00:4A08                      								; of strack pointers
     716.  00:4A08  C3 56 48            	jp	process_data
     717.  00:4A0B                      
     718.  00:4A0B                      
     719.  00:4A0B                      
     720.  00:4A0B                      
     721.  00:4A0B                      
     722.  00:4A0B                      
     723.  00:4A0B                      
     724.  00:4A0B                      
     725.  00:4A0B                      
     726.  00:4A0B                      
     727.  00:4A0B                      
     728.  00:4A0B                      
     729.  00:4A0B                      ;===========================================================
     730.  00:4A0B                      ; ---	decode_data_chan
     731.  00:4A0B                      ; Process the channel data
     732.  00:4A0B                      ; 
     733.  00:4A0B                      ; in BC is the pointer to the	data
     734.  00:4A0B                      ;    D contains flags.
     735.  00:4A0B                      ;===========================================================	
     736.  00:4A0B                      decode_data_chan:
     737.  00:4A0B                      	;--- initialize data
     738.  00:4A0B  DD 7E F6            	ld	a,(ix+TRACK_Note)
     739.  00:4A0E  32 28 C0            	ld	(replay_previous_note),a
     740.  00:4A11                      
     741.  00:4A11                      	;=============
     742.  00:4A11                      	; Note 
     743.  00:4A11                      	;=============
     744.  00:4A11  0A                  	ld	a,(bc)
     745.  00:4A12  FE 60               	cp	_REL
     746.  00:4A14  DA 87 4A            	jp	c,_replay_decode_note
     747.  00:4A17  FE 61               	cp	_SUS
     748.  00:4A19  DA 93 4A            	jp	c,_replay_decode_release
     749.  00:4A1C  CA 9E 4A            	jp	z,_replay_decode_sustain
     750.  00:4A1F                      _rdn2:
     751.  00:4A1F  FE 71               	cp	_INS
     752.  00:4A21  DA E2 4A            	jp	c,_replay_decode_vol
     753.  00:4A24                      _rdv2:
     754.  00:4A24  FE 90               	cp	_CMD
     755.  00:4A26  DA A9 4A            	jp	c,_replay_decode_ins
     756.  00:4A29                      _rdi2:
     757.  00:4A29  FE BF               	cp	_EOT
     758.  00:4A2B  DA F7 4A            	jp	c,_replaydecode_cmd
     759.  00:4A2E  C3 63 4A            	jp	_replay_decode_delay
     760.  00:4A31                      
     761.  00:4A31                      _rdn:
     762.  00:4A31  FE 62               	cp	_SUS+1		
     763.  00:4A33  DA 53 4A            	jp	c,_rd_delay
     764.  00:4A36  C3 1F 4A            	jp	_rdn2
     765.  00:4A39                      
     766.  00:4A39                      _rdi:
     767.  00:4A39  FE 90               	cp	_CMD
     768.  00:4A3B  DA 53 4A            	jp	c,_rd_delay
     769.  00:4A3E  C3 29 4A            	jp	_rdi2
     770.  00:4A41                      
     771.  00:4A41                      _rdv:
     772.  00:4A41  FE 71               	cp	_INS
     773.  00:4A43  DA 53 4A            	jp	c,_rd_delay
     774.  00:4A46  C3 24 4A            	jp	_rdv2
     775.  00:4A49                      _rdc:
     776.  00:4A49  03                  	inc	bc
     777.  00:4A4A                      _rdc_noinc:	
     778.  00:4A4A  0A                  	ld	a,(bc)
     779.  00:4A4B  FE BF               	cp	_EOT
     780.  00:4A4D  DA 53 4A            	jp	c,_rd_delay
     781.  00:4A50  C3 63 4A            	jp	_replay_decode_delay
     782.  00:4A53                      
     783.  00:4A53                      	;--- re-init previous delay
     784.  00:4A53                      _rd_delay:
     785.  00:4A53  DD 7E 14            	ld	a,(ix+TRACK_prevDelay)
     786.  00:4A56  DD 77 13            	ld	(ix+TRACK_Delay),a
     787.  00:4A59  C3 6F 4A            	jp	_replay_decode_trigger_porttone_check
     788.  00:4A5C                      
     789.  00:4A5C                      _rd_eot:
     790.  00:4A5C  3C                  	inc	a
     791.  00:4A5D  DD 77 13            	ld	(ix+TRACK_Delay),a
     792.  00:4A60  C3 6F 4A            	jp	_replay_decode_trigger_porttone_check
     793.  00:4A63                      
     794.  00:4A63                      _replay_decode_delay:
     795.  00:4A63  D6 BF               	sub	_WAIT-1
     796.  00:4A65  CA 5C 4A            	jp	z,_rd_eot		; EOT found
     797.  00:4A68  DD 77 13            	ld	(ix+TRACK_Delay),a
     798.  00:4A6B  DD 77 14            	ld	(ix+TRACK_prevDelay),a
     799.  00:4A6E  03                  	inc	bc
     800.  00:4A6F                      	
     801.  00:4A6F                      _replay_decode_trigger_porttone_check:	
     802.  00:4A6F                      	;--- Check cmd active and note trigger?
     803.  00:4A6F  CB 42               	bit 	B_TRGNOT,d
     804.  00:4A71  C8                  	ret	z
     805.  00:4A72  CB 5A               	bit	B_TRGCMD,d
     806.  00:4A74  C8                  	ret	z
     807.  00:4A75                      	;--- Check for cmd3 or cmd5 (value 0 or 1) to continue
     808.  00:4A75  DD 7E F0            	ld	a,(ix+TRACK_Command)
     809.  00:4A78  FE 02               	cp	2
     810.  00:4A7A  D0                  	ret	nc
     811.  00:4A7B                      	;-- trigger CMD
     812.  00:4A7B  CB 82               	res	B_TRGNOT,d
     813.  00:4A7D  3E 12               	ld	a,0010010b		;B_ACTNOT B_KEYON
     814.  00:4A7F  B2                  	or	d
     815.  00:4A80  57                  	ld 	d,a
     816.  00:4A81  DD 7E 09            	ld	a,(ix+TRACK_cmd_3)
     817.  00:4A84  C3 86 4B            	jp	decode_cmd3_port_tone_new_note	
     818.  00:4A87                      	;ret
     819.  00:4A87                      
     820.  00:4A87                      _replay_decode_note:
     821.  00:4A87  DD 77 F6            	ld	(ix+TRACK_Note),a
     822.  00:4A8A  CB C2               	set 	B_TRGNOT,d
     823.  00:4A8C  CB E2               	set 	B_KEYON,d
     824.  00:4A8E                      
     825.  00:4A8E  03                  	inc	bc
     826.  00:4A8F  0A                  	ld	a,(bc)
     827.  00:4A90  C3 31 4A            	jp	_rdn
     828.  00:4A93                      	
     829.  00:4A93                      
     830.  00:4A93                      
     831.  00:4A93                      _replay_decode_release:
     832.  00:4A93  CB 8A               	res	B_ACTNOT,d				; reset note bit to	0
     833.  00:4A95  CB AA               	res	B_SUST,d				; rest sustain
     834.  00:4A97  CB A2               	res	B_KEYON,d				; reset Key on
     835.  00:4A99                      
     836.  00:4A99  03                  	inc	bc
     837.  00:4A9A  0A                  	ld	a,(bc)
     838.  00:4A9B  C3 31 4A            	jp	_rdn	
     839.  00:4A9E                      	
     840.  00:4A9E                      
     841.  00:4A9E                      
     842.  00:4A9E                      _replay_decode_sustain:
     843.  00:4A9E  CB 8A               	res	B_ACTNOT,d				; reset note bit to	0
     844.  00:4AA0  CB EA               	set	B_SUST,d				; rest sustain
     845.  00:4AA2  CB A2               	res	B_KEYON,d				; reset Key on
     846.  00:4AA4                      
     847.  00:4AA4  03                  	inc	bc
     848.  00:4AA5  0A                  	ld	a,(bc)
     849.  00:4AA6  C3 31 4A            	jp	_rdn
     850.  00:4AA9                      
     851.  00:4AA9                      
     852.  00:4AA9                      
     853.  00:4AA9                      _replay_decode_ins:
     854.  00:4AA9  D6 71               	sub	_INS
     855.  00:4AAB  DD BE EF            	cp	(ix+TRACK_Instrument)
     856.  00:4AAE  CA DD 4A            	jp	z,.skip_ins
     857.  00:4AB1                      	
     858.  00:4AB1                      	;--- instrument change found	
     859.  00:4AB1  DD 77 EF            	ld	(ix+TRACK_Instrument),a
     860.  00:4AB4                      
     861.  00:4AB4                      	;--- set instrument pointer
     862.  00:4AB4  87                  	add	a
     863.  00:4AB5  2A 0B C0            	ld	hl,(replay_insbase)
     864.  00:4AB8  85                  	add	a,l
     865.  00:4AB9  6F                  	ld	l,a
     866.  00:4ABA  D2 BE 4A            	jp	nc,.skip
     867.  00:4ABD  24                  	inc	h
     868.  00:4ABE                      .skip:
     869.  00:4ABE  7E                  	ld	a,(hl)
     870.  00:4ABF  23                  	inc	hl
     871.  00:4AC0  66                  	ld	h,(hl)
     872.  00:4AC1  6F                  	ld	l,a
     873.  00:4AC2                      
     874.  00:4AC2                      	;-- get voice
     875.  00:4AC2  7E                  	ld	a,(hl)
     876.  00:4AC3  23                  	inc	hl
     877.  00:4AC4                      		
     878.  00:4AC4                      	;--- Set the software voice (if needed)
     879.  00:4AC4  A7                  	and	a
     880.  00:4AC5  C2 CE 4A            	jp	nz,.skip_soft
     881.  00:4AC8                      	;--- software voice found
     882.  00:4AC8                      	
     883.  00:4AC8  7E                  	ld	a,(hl)		; value is the offset in the soft voice data (8bytes)
     884.  00:4AC9  23                  	inc	hl
     885.  00:4ACA  32 BC C1            	ld 	(FM_softvoice_req),a
     886.  00:4ACD  AF                  	xor 	a
     887.  00:4ACE                      
     888.  00:4ACE                      .skip_soft:
     889.  00:4ACE  DD 77 F8            	ld	(ix+TRACK_Voice),a
     890.  00:4AD1                      
     891.  00:4AD1                      	;--- Store the macro start
     892.  00:4AD1  DD 75 F1            	ld	(ix+TRACK_MacroPointer),l
     893.  00:4AD4  DD 74 F2            	ld	(ix+TRACK_MacroPointer+1),h	
     894.  00:4AD7                      	;--- Store the macro re-start
     895.  00:4AD7  DD 75 F3            	ld	(ix+TRACK_MacroStart),l
     896.  00:4ADA  DD 74 F4            	ld	(ix+TRACK_MacroStart+1),h
     897.  00:4ADD                      
     898.  00:4ADD                      .skip_ins:	
     899.  00:4ADD  03                  	inc	bc
     900.  00:4ADE  0A                  	ld	a,(bc)
     901.  00:4ADF  C3 39 4A            	jp	_rdi
     902.  00:4AE2                      
     903.  00:4AE2                      
     904.  00:4AE2                      
     905.  00:4AE2                      _replay_decode_vol:
     906.  00:4AE2  D6 61               	sub	_VOL-1
     907.  00:4AE4  87                  	add	a
     908.  00:4AE5  87                  	add	a
     909.  00:4AE6  87                  	add	a
     910.  00:4AE7  87                  	add	a
     911.  00:4AE8                      	
     912.  00:4AE8                      	;--- Set new base	volume (high byte) but keep relative offset (low byte)
     913.  00:4AE8  5F                  	ld	e,a
     914.  00:4AE9  DD 7E F7            	ld	a,(ix+TRACK_Volume)
     915.  00:4AEC  E6 0F               	and	0xf
     916.  00:4AEE  B3                  	or	e
     917.  00:4AEF  DD 77 F7            	ld	(ix+TRACK_Volume),a
     918.  00:4AF2                      
     919.  00:4AF2  03                  	inc	bc
     920.  00:4AF3  0A                  	ld	a,(bc)
     921.  00:4AF4  C3 41 4A            	jp	_rdv
     922.  00:4AF7                      
     923.  00:4AF7                      
     924.  00:4AF7                      
     925.  00:4AF7                      _replaydecode_cmd:
     926.  00:4AF7  D6 90               	sub	_CMD
     927.  00:4AF9                      	
     928.  00:4AF9                      	;[Debug]
     929.  00:4AF9  FE 17               	cp	23
     930.  00:4AFB  DA 00 4B            	jp	c,99f
     931.  00:4AFE  F3                  	di
     932.  00:4AFF  76                  	halt
     933.  00:4B00                      99:
     934.  00:4B00                      	;[Debug end]
     935.  00:4B00                      	
     936.  00:4B00  5F                  	ld	e,a				; store command for later
     937.  00:4B01  21 12 4B            	ld	hl,DECODE_CMDLIST
     938.  00:4B04  87                  	add	a,a
     939.  00:4B05  85                  	add	a,l
     940.  00:4B06  6F                  	ld	l,a
     941.  00:4B07  D2 0B 4B            	jp	nc,.skip
     942.  00:4B0A  24                  	inc	h
     943.  00:4B0B                      .skip:
     944.  00:4B0B  7E                  	ld	a,(hl)
     945.  00:4B0C  23                  	inc	hl
     946.  00:4B0D  66                  	ld	h,(hl)
     947.  00:4B0E  6F                  	ld	l,a
     948.  00:4B0F                      	
     949.  00:4B0F  03                  	inc	bc
     950.  00:4B10  0A                  	ld	a,(bc)
     951.  00:4B11  E9                  	jp	(hl)
     952.  00:4B12                      
     953.  00:4B12                      
     954.  00:4B12                      DECODE_CMDLIST:
     955.  00:4B12                      	; Primary
     956.  00:4B12  69 4B               	dw	decode_cmd3_port_tone
     957.  00:4B14  FA 4B               	dw	decode_cmd5_vibrato_port_tone
     958.  00:4B16  5E 4B               	dw	decode_cmd2_port_down
     959.  00:4B18  40 4B               	dw	decode_cmd0_arpeggio
     960.  00:4B1A  CA 4B               	dw	decode_cmd4_vibrato
     961.  00:4B1C  53 4B               	dw	decode_cmd1_port_up
     962.  00:4B1E  11 4C               	dw	decode_cmd6_vibrato_vol	
     963.  00:4B20  11 4C               	dw	decode_cmd7_vol_slide
     964.  00:4B22  CA 4B               	dw	decode_cmd8_tremelo
     965.  00:4B24  21 4C               	dw	decode_cmd9_note_cut
     966.  00:4B26  2C 4C               	dw	decode_cmd10_note_delay
     967.  00:4B28                      	; Secondary
     968.  00:4B28  4A 4C               	dw	decode_cmd11_command_end
     969.  00:4B2A  4F 4C               	dw	decode_cmd12_drum
     970.  00:4B2C  75 4C               	dw	decode_cmd13_arp_speed
     971.  00:4B2E  7B 4C               	dw	decode_cmd14_fine_up
     972.  00:4B30  85 4C               	dw	decode_cmd15_fine_down
     973.  00:4B32  90 4C               	dw	decode_cmd16_notelink
     974.  00:4B34  97 4C               	dw	decode_cmd17_track_detune
     975.  00:4B36  B6 4C               	dw	decode_cmd18_trigger
     976.  00:4B38  BC 4C               	dw	decode_cmd19_speed
     977.  00:4B3A                      	; SoundChip Specific
     978.  00:4B3A  CF 4C               	dw	decode_cmd20_tone_panning
     979.  00:4B3C  D2 4C               	dw	decode_cmd21_noise_panning
     980.  00:4B3E  D5 4C               	dw	decode_cmd22_chan_setup	
     981.  00:4B40                      	
     982.  00:4B40                      
     983.  00:4B40                      decode_cmd0_arpeggio:
     984.  00:4B40                      	; in:	[A] contains the paramvalue
     985.  00:4B40                      	; 
     986.  00:4B40                      	; ! do not change	[BC] this is the data pointer
     987.  00:4B40                      	;--------------------------------------------------
     988.  00:4B40  DD 77 06            	ld	(ix+TRACK_cmd_0),a
     989.  00:4B43  DD 73 F0            	ld	(ix+TRACK_Command),e
     990.  00:4B46  CB DA               	set	B_TRGCMD,d
     991.  00:4B48  DD 36 11 00         	ld	(ix+TRACK_Timer),0
     992.  00:4B4C  DD 36 12 02         	ld	(ix+TRACK_Step),2
     993.  00:4B50  C3 49 4A            	jp	_rdc
     994.  00:4B53                      
     995.  00:4B53                      
     996.  00:4B53                      	
     997.  00:4B53                      decode_cmd1_port_up:
     998.  00:4B53                      	; in:	[A] contains the paramvalue
     999.  00:4B53                      	; 
    1000.  00:4B53                      	; ! do not change	[BC] this is the data pointer
    1001.  00:4B53                      	;--------------------------------------------------
    1002.  00:4B53  DD 73 F0            	ld	(ix+TRACK_Command),e
    1003.  00:4B56  DD 77 07            	ld	(ix+TRACK_cmd_1),a
    1004.  00:4B59  CB DA               	set	B_TRGCMD,d
    1005.  00:4B5B  C3 49 4A            	jp	_rdc
    1006.  00:4B5E                      	
    1007.  00:4B5E                      	 
    1008.  00:4B5E                      	 
    1009.  00:4B5E                      decode_cmd2_port_down:
    1010.  00:4B5E                      	; in:	[A] contains the paramvalue
    1011.  00:4B5E                      	; 
    1012.  00:4B5E                      	; ! do not change	[BC] this is the data pointer
    1013.  00:4B5E                      	;--------------------------------------------------
    1014.  00:4B5E  DD 73 F0            	ld	(ix+TRACK_Command),e
    1015.  00:4B61  DD 77 08            	ld	(ix+TRACK_cmd_2),a
    1016.  00:4B64  CB DA               	set	B_TRGCMD,d
    1017.  00:4B66  C3 49 4A            	jp	_rdc
    1018.  00:4B69                      
    1019.  00:4B69                      
    1020.  00:4B69                      decode_cmd3_port_tone:
    1021.  00:4B69                      	; in:	[A] contains the param value
    1022.  00:4B69                      	; 
    1023.  00:4B69                      	; ! do not change	[BC] this is the data pointer
    1024.  00:4B69                      	;--------------------------------------------------
    1025.  00:4B69  DD 73 F0            	ld	(ix+TRACK_Command),e
    1026.  00:4B6C  CB DA               	set	B_TRGCMD,d
    1027.  00:4B6E  CB CA               	set	B_ACTNOT,d
    1028.  00:4B70                      	
    1029.  00:4B70  DD 77 09            	ld	(ix+TRACK_cmd_3),a
    1030.  00:4B73  DD 36 11 02         	ld	(ix+TRACK_Timer),2
    1031.  00:4B77                      
    1032.  00:4B77                      ;decode_cmd3_port_tone_cont:
    1033.  00:4B77                      	;--- Check if we have a	note on the	same event
    1034.  00:4B77  CB 42               	bit	B_TRGNOT,d
    1035.  00:4B79  CA 49 4A            	jp	z,_rdc
    1036.  00:4B7C                      
    1037.  00:4B7C  CB E2               	set	B_KEYON,d
    1038.  00:4B7E  CB 82               	res 	B_TRGNOT,d
    1039.  00:4B80                      	
    1040.  00:4B80  CD 86 4B            	call	decode_cmd3_port_tone_new_note
    1041.  00:4B83  C3 49 4A            	jp	_rdc
    1042.  00:4B86                      	
    1043.  00:4B86                      decode_cmd3_port_tone_new_note:
    1044.  00:4B86                      	;-- remove deviation from parameter
    1045.  00:4B86  E6 7F               	and 	$7f
    1046.  00:4B88  08                  	ex	af,af'		;'
    1047.  00:4B89  D9                  	exx
    1048.  00:4B8A                      
    1049.  00:4B8A                      	;-- get the	previous note freq
    1050.  00:4B8A  3A 28 C0            	ld	a,(replay_previous_note)
    1051.  00:4B8D  87                  	add	a
    1052.  00:4B8E  2A 2D C0            	ld	hl,(replay_tonetable)
    1053.  00:4B91  85                  	add	a,l
    1054.  00:4B92  6F                  	ld	l,a
    1055.  00:4B93  D2 97 4B            	jp	nc,.skip
    1056.  00:4B96  24                  	inc	h
    1057.  00:4B97                      .skip:
    1058.  00:4B97  5E                  	ld	e,(hl)
    1059.  00:4B98  23                  	inc	hl
    1060.  00:4B99  56                  	ld	d,(hl)
    1061.  00:4B9A                      
    1062.  00:4B9A                      	; add	the toneadd
    1063.  00:4B9A  DD 6E 00            	ld	l,(ix+TRACK_cmd_ToneSlideAdd)
    1064.  00:4B9D  DD 66 01            	ld	h,(ix+TRACK_cmd_ToneSlideAdd+1)
    1065.  00:4BA0                      
    1066.  00:4BA0  19                  	add	hl,de	
    1067.  00:4BA1  EB                  	ex	de,hl				; store current freq in	[de]
    1068.  00:4BA2                      	;--- get the current note freq
    1069.  00:4BA2  DD 7E F6            	ld	a,(ix+TRACK_Note)
    1070.  00:4BA5  87                  	add	a
    1071.  00:4BA6  2A 2D C0            	ld	hl,(replay_tonetable)	;TRACK_ToneTable
    1072.  00:4BA9  85                  	add	a,l
    1073.  00:4BAA  6F                  	ld	l,a
    1074.  00:4BAB  D2 AF 4B            	jp	nc,.skip2
    1075.  00:4BAE  24                  	inc	h
    1076.  00:4BAF                      .skip2:
    1077.  00:4BAF  7E                  	ld	a,(hl)
    1078.  00:4BB0  23                  	inc	hl
    1079.  00:4BB1  66                  	ld	h,(hl)
    1080.  00:4BB2  6F                  	ld	l,a				; destination freq in [hl]
    1081.  00:4BB3                      	
    1082.  00:4BB3                      	;--- Calculate the delta
    1083.  00:4BB3  AF                  	xor	a
    1084.  00:4BB4  EB                  	ex	de,hl
    1085.  00:4BB5  ED 52               	sbc	hl,de				; results in pos/neg delta
    1086.  00:4BB7                      	
    1087.  00:4BB7  DD 75 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),l
    1088.  00:4BBA  DD 74 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),h
    1089.  00:4BBD                      	
    1090.  00:4BBD                      	;--- re-apply deviation
    1091.  00:4BBD  08                  	ex	af,af'			;'
    1092.  00:4BBE  CB 7C               	bit	7,h
    1093.  00:4BC0  C2 C5 4B            	jp	nz,99f
    1094.  00:4BC3  F6 80               	or 	128
    1095.  00:4BC5                      99:
    1096.  00:4BC5  DD 77 09            	ld 	(ix+TRACK_cmd_3),a
    1097.  00:4BC8                      	
    1098.  00:4BC8  D9                  	exx					; restore flags in D
    1099.  00:4BC9  C9                  	ret
    1100.  00:4BCA                      	
    1101.  00:4BCA                      	
    1102.  00:4BCA                      decode_cmd8_tremelo:
    1103.  00:4BCA                      	; in:	[A] contains the paramvalue
    1104.  00:4BCA                      	; 
    1105.  00:4BCA                      	; ! do not change	[BC] this is the data pointer
    1106.  00:4BCA                      	;--------------------------------------------------
    1107.  00:4BCA                      decode_cmd4_vibrato:
    1108.  00:4BCA                      	; in:	[A] contains the paramvalue
    1109.  00:4BCA                      	; 
    1110.  00:4BCA                      	; ! do not change	[BC] this is the data pointer
    1111.  00:4BCA                      	;--------------------------------------------------
    1112.  00:4BCA                      	; Vibrato with speed x and depth y.	This command 
    1113.  00:4BCA                      	; will oscillate the frequency of the current note
    1114.  00:4BCA                      	; with a sine wave. 
    1115.  00:4BCA                      	;
    1116.  00:4BCA                      	; high 3 bits is depth (0-7) (direct offset in sinetable)
    1117.  00:4BCA                      	; low 5 bits is the speed. 1-16
    1118.  00:4BCA                      	;--- Init values
    1119.  00:4BCA  DD 73 F0            	ld	(ix+TRACK_Command),e
    1120.  00:4BCD  5F                  	ld	e,a
    1121.  00:4BCE                      	
    1122.  00:4BCE                      	;--- Set the speed
    1123.  00:4BCE  E6 0F               	and	$0f
    1124.  00:4BD0  CA DB 4B            	jp	z,.depth
    1125.  00:4BD3  DD 77 0C            	ld	(ix+TRACK_cmd_4_step),a	
    1126.  00:4BD6  ED 44               	neg	
    1127.  00:4BD8  DD 77 12            	ld	(ix+TRACK_Step),a	
    1128.  00:4BDB                      	
    1129.  00:4BDB                      .depth:
    1130.  00:4BDB                      	;-- set the depth
    1131.  00:4BDB  7B                  	ld	a,e
    1132.  00:4BDC  E6 F0               	and	$f0
    1133.  00:4BDE  CA F5 4B            	jp	z,.end		; set depth when 0 only when command was not active.
    1134.  00:4BE1                      
    1135.  00:4BE1                      ;	sub	16
    1136.  00:4BE1  21 80 54            	ld	hl,TRACK_Vibrato_sine-16
    1137.  00:4BE4  87                  	add	a,a
    1138.  00:4BE5  D2 E9 4B            	jp	nc,99f
    1139.  00:4BE8  24                  	inc	h
    1140.  00:4BE9                      99:	
    1141.  00:4BE9  85                  	add	a,l
    1142.  00:4BEA  6F                  	ld 	l,a
    1143.  00:4BEB  D2 EF 4B            	jp	nc,99f
    1144.  00:4BEE  24                  	inc	h
    1145.  00:4BEF                      99:
    1146.  00:4BEF  DD 75 0A            	ld	(ix+TRACK_cmd_4_depth),l
    1147.  00:4BF2  DD 74 0B            	ld	(ix+TRACK_cmd_4_depth+1),h
    1148.  00:4BF5                      	
    1149.  00:4BF5                      .end:	
    1150.  00:4BF5  CB DA               	set	B_TRGCMD,d
    1151.  00:4BF7  C3 49 4A            	jp	_rdc	
    1152.  00:4BFA                      
    1153.  00:4BFA                      
    1154.  00:4BFA                      decode_cmd5_vibrato_port_tone:
    1155.  00:4BFA                      	; in:	[A] contains the paramvalue
    1156.  00:4BFA                      	; 
    1157.  00:4BFA                      	; ! do not change	[BC] this is the data pointer
    1158.  00:4BFA                      	;--------------------------------------------------
    1159.  00:4BFA                      	; portTone	+ volumeslide
    1160.  00:4BFA                      	;--- Init values
    1161.  00:4BFA  DD 73 F0            	ld	(ix+TRACK_Command),e
    1162.  00:4BFD  DD 77 0E            	ld	(ix+TRACK_cmd_A),a
    1163.  00:4C00  CB DA               	set	B_TRGCMD,d
    1164.  00:4C02                      	
    1165.  00:4C02                      	;-- Check if new note
    1166.  00:4C02  CB 42               	bit	B_TRGNOT,d
    1167.  00:4C04  CA 49 4A            	jp	z,_rdc
    1168.  00:4C07                      	
    1169.  00:4C07                      	;-- Set new port tone value
    1170.  00:4C07  CB E2               	set	B_KEYON,d
    1171.  00:4C09  CB 82               	res	B_TRGNOT,d
    1172.  00:4C0B  DD 7E 09            	ld	a,(ix+TRACK_cmd_3)
    1173.  00:4C0E  C3 86 4B            	jp	decode_cmd3_port_tone_new_note
    1174.  00:4C11                      	
    1175.  00:4C11                      	
    1176.  00:4C11                      	
    1177.  00:4C11                      decode_cmd6_vibrato_vol:
    1178.  00:4C11                      	; in:	[A] contains the paramvalue
    1179.  00:4C11                      	; 
    1180.  00:4C11                      	; ! do not change	[BC] this is the data pointer
    1181.  00:4C11                      	;--------------------------------------------------
    1182.  00:4C11                      decode_cmd7_vol_slide:
    1183.  00:4C11                      	; in:	[A] contains the paramvalue
    1184.  00:4C11                      	; 
    1185.  00:4C11                      	; ! do not change	[BC] this is the data pointer
    1186.  00:4C11                      	;--------------------------------------------------
    1187.  00:4C11  DD 73 F0            	ld	(ix+TRACK_Command),e	
    1188.  00:4C14  DD 77 0E            	ld	(ix+TRACK_cmd_A),a
    1189.  00:4C17  E6 7F               	and  	$7f
    1190.  00:4C19  DD 77 11            	ld	(ix+TRACK_Timer),a
    1191.  00:4C1C  CB DA               	set	B_TRGCMD,d
    1192.  00:4C1E  C3 49 4A            	jp	_rdc
    1193.  00:4C21                      
    1194.  00:4C21                      
    1195.  00:4C21                      decode_cmd9_note_cut:
    1196.  00:4C21  CB DA               	set	B_TRGCMD,d
    1197.  00:4C23  DD 73 F0            	ld	(ix+TRACK_Command),e
    1198.  00:4C26  DD 77 11            	ld	(ix+TRACK_Timer),a		; set	the timer to param y
    1199.  00:4C29  C3 49 4A            	jp 	_rdc
    1200.  00:4C2C                      
    1201.  00:4C2C                      
    1202.  00:4C2C                      decode_cmd10_note_delay:
    1203.  00:4C2C  CB 42               	bit	B_TRGNOT,d		; is there a note	in this eventstep?
    1204.  00:4C2E  CA 49 4A            	jp	z,_rdc
    1205.  00:4C31                      
    1206.  00:4C31  CB DA               	set	B_TRGCMD,d					; command active
    1207.  00:4C33  CB 82               	res	B_TRGNOT,d					; reset any	trigger note
    1208.  00:4C35  DD 73 F0            	ld	(ix+TRACK_Command),e
    1209.  00:4C38                      	
    1210.  00:4C38  DD 77 11            	ld	(ix+TRACK_Timer),a			; set	the timer to param y
    1211.  00:4C3B  DD 7E F6            	ld	a,(ix+TRACK_Note)
    1212.  00:4C3E  DD 77 10            	ld	(ix+TRACK_cmd_E),a			; store the	new note
    1213.  00:4C41  3A 28 C0            	ld	a,(replay_previous_note)
    1214.  00:4C44  DD 77 F6            	ld	(ix+TRACK_Note),a				; restore the old	note
    1215.  00:4C47  C3 49 4A            	jp	_rdc	
    1216.  00:4C4A                      
    1217.  00:4C4A                      
    1218.  00:4C4A                      decode_cmd11_command_end:
    1219.  00:4C4A                      	; in:	[A] contains the paramvalue
    1220.  00:4C4A                      	; 
    1221.  00:4C4A                      	; ! do not change	[BC] this is the data pointer
    1222.  00:4C4A                      	;--------------------------------------------------
    1223.  00:4C4A  CB 9A               	res	B_TRGCMD,d
    1224.  00:4C4C  C3 4A 4A            	jp	_rdc_noinc
    1225.  00:4C4F                      	
    1226.  00:4C4F                      
    1227.  00:4C4F                      decode_cmd12_drum:
    1228.  00:4C4F  A7                  	and 	a		; drum reset not supported
    1229.  00:4C50  28 1F               	jr 	z,0f
    1230.  00:4C52                      	
    1231.  00:4C52                      	; Get the base addres of the drum list
    1232.  00:4C52  87                  	add 	a 
    1233.  00:4C53  2A 09 C0            	ld	hl,(replay_drumbase)
    1234.  00:4C56  85                  	add	a,l 
    1235.  00:4C57  6F                  	ld	l,a
    1236.  00:4C58  D2 5C 4C            	jp	nc,99f
    1237.  00:4C5B  24                  	inc	h 
    1238.  00:4C5C                      99:
    1239.  00:4C5C  6F                  	ld	l,a
    1240.  00:4C5D                      	; Get the start of the drum macro
    1241.  00:4C5D  7E                  	ld	a,(hl)
    1242.  00:4C5E  23                  	inc	hl
    1243.  00:4C5F  66                  	ld	h,(hl)
    1244.  00:4C60  6F                  	ld	l,a
    1245.  00:4C61                      	
    1246.  00:4C61                      	; Store the length
    1247.  00:4C61  7E                  	ld	a,(hl)
    1248.  00:4C62  32 B9 C1            	ld	(FM_DRUM_LEN),a
    1249.  00:4C65  23                  	inc	hl
    1250.  00:4C66                      	; Store the address
    1251.  00:4C66  7D                  	ld	a,l
    1252.  00:4C67  32 BA C1            	ld 	(FM_DRUM_MACRO),a
    1253.  00:4C6A  7C                  	ld	a,h
    1254.  00:4C6B  32 BB C1            	ld	(FM_DRUM_MACRO+1),a
    1255.  00:4C6E  C3 49 4A            	jp	_rdc		
    1256.  00:4C71                      0:
    1257.  00:4C71  0B                  	dec	bc
    1258.  00:4C72  C3 49 4A            	jp	_rdc		
    1259.  00:4C75                      	
    1260.  00:4C75                      
    1261.  00:4C75                      
    1262.  00:4C75                      decode_cmd13_arp_speed:
    1263.  00:4C75  32 24 C0            	ld	(replay_arp_speed),a		; store the halve not to add
    1264.  00:4C78  C3 49 4A            	jp	_rdc	
    1265.  00:4C7B                      	
    1266.  00:4C7B                      	
    1267.  00:4C7B                      
    1268.  00:4C7B                      decode_cmd14_fine_up:
    1269.  00:4C7B  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    1270.  00:4C7E  AF                  	xor	a
    1271.  00:4C7F  DD 77 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),a
    1272.  00:4C82  C3 49 4A            	jp	_rdc
    1273.  00:4C85                      	
    1274.  00:4C85                      decode_cmd15_fine_down:
    1275.  00:4C85  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    1276.  00:4C88  3E FF               	ld	a,$ff
    1277.  00:4C8A  DD 77 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),a
    1278.  00:4C8D  C3 49 4A            	jp	_rdc
    1279.  00:4C90                      
    1280.  00:4C90                      
    1281.  00:4C90                      decode_cmd16_notelink:
    1282.  00:4C90  CB 82               	res	B_TRGNOT,d
    1283.  00:4C92  CB E2               	set 	B_KEYON,d
    1284.  00:4C94  C3 4A 4A            	jp	_rdc_noinc	
    1285.  00:4C97                      
    1286.  00:4C97                      decode_cmd17_track_detune:
    1287.  00:4C97                      	; This command sets the	detune of the track.
    1288.  00:4C97  5F                  	ld	e,a
    1289.  00:4C98  E6 07               	and	0x07		; low	4 bits is value
    1290.  00:4C9A  CB 5B               	bit	3,e		; Center around 8
    1291.  00:4C9C  CA AC 4C            	jp	z,.pos
    1292.  00:4C9F  3C                  	inc	a
    1293.  00:4CA0  ED 44               	neg			; make correct value
    1294.  00:4CA2  DD 77 04            	ld	(ix+TRACK_cmd_detune),a
    1295.  00:4CA5  DD 36 05 FF         	ld	(ix+TRACK_cmd_detune+1),0xff
    1296.  00:4CA9                      
    1297.  00:4CA9  C3 49 4A            	jp	_rdc	
    1298.  00:4CAC                      
    1299.  00:4CAC                      .pos:
    1300.  00:4CAC  DD 77 04            	ld	(ix+TRACK_cmd_detune),a
    1301.  00:4CAF  DD 36 05 00         	ld	(ix+TRACK_cmd_detune+1),0x00	
    1302.  00:4CB3                      
    1303.  00:4CB3  C3 49 4A            	jp	_rdc	
    1304.  00:4CB6                      
    1305.  00:4CB6                      
    1306.  00:4CB6                      
    1307.  00:4CB6                      decode_cmd18_trigger:
    1308.  00:4CB6  32 02 C0            	ld	(replay_trigger),a
    1309.  00:4CB9  C3 49 4A            	jp	_rdc		
    1310.  00:4CBC                      
    1311.  00:4CBC                      
    1312.  00:4CBC                      decode_cmd19_speed:
    1313.  00:4CBC  32 1F C0            	ld	(replay_speed),a
    1314.  00:4CBF                      	;--- Reset Timer == 0
    1315.  00:4CBF  CB 3F               	srl	a				; divide speed with 2
    1316.  00:4CC1  5F                  	ld	e,a
    1317.  00:4CC2  3E 00               	ld	a,0				
    1318.  00:4CC4  8F                  	adc	a				; store carry of shift as subtimer
    1319.  00:4CC5  32 20 C0            	ld	(replay_speed_subtimer),a
    1320.  00:4CC8  83                  	add	a,e
    1321.  00:4CC9  32 21 C0            	ld	(replay_speed_timer),a
    1322.  00:4CCC                      
    1323.  00:4CCC  C3 49 4A            	jp	_rdc	
    1324.  00:4CCF                      	
    1325.  00:4CCF                      decode_cmd20_tone_panning:
    1326.  00:4CCF  C3 49 4A            	jp	_rdc	
    1327.  00:4CD2                      
    1328.  00:4CD2                      decode_cmd21_noise_panning:
    1329.  00:4CD2  C3 49 4A            	jp	_rdc
    1330.  00:4CD5                      
    1331.  00:4CD5                      decode_cmd22_chan_setup:
    1332.  00:4CD5  C3 49 4A            	jp	_rdc
    1333.  00:4CD8                      
    1334.  00:4CD8                      
    1335.  00:4CD8                      
    1336.  00:4CD8                      ;===========================================================
    1337.  00:4CD8                      ; ---process_data_chan
    1338.  00:4CD8                      ; Process the cmd/instrument/note and vol data 
    1339.  00:4CD8                      ; 
    1340.  00:4CD8                      ; in HL is the current tone freq
    1341.  00:4CD8                      ; in D is TRACK_FLAGS  
    1342.  00:4CD8                      ;===========================================================
    1343.  00:4CD8                      process_data_chan:
    1344.  00:4CD8  E5                  	push	hl
    1345.  00:4CD9                      
    1346.  00:4CD9                      	;-- set the	mixer	right
    1347.  00:4CD9  21 BE C1            	ld	hl,FM_regMIXER   
    1348.  00:4CDC  CB 0E               	rrc	(hl)
    1349.  00:4CDE                      
    1350.  00:4CDE                      
    1351.  00:4CDE                      	;===== 
    1352.  00:4CDE                      	; Speed equalization check
    1353.  00:4CDE                      	;=====
    1354.  00:4CDE                      ;	ld	a,(equalization_flag)			; check for speed equalization
    1355.  00:4CDE                      ;	and	a
    1356.  00:4CDE                      ;	jp	nz,process_noNoteTrigger		; Only process instruments macro
    1357.  00:4CDE                      	
    1358.  00:4CDE                      	
    1359.  00:4CDE                      	;=====
    1360.  00:4CDE                      	; COMMAND
    1361.  00:4CDE                      	;=====
    1362.  00:4CDE  DD 36 0D 00         	ld	(ix+TRACK_cmd_NoteAdd),0			; Always reset note add
    1363.  00:4CE2                      	
    1364.  00:4CE2  CB 5A               	bit	B_TRGCMD,d	;(ix+TRACK_Flags)
    1365.  00:4CE4  CA F9 4C            	jp	z,process_note
    1366.  00:4CE7                      
    1367.  00:4CE7  21 94 4E            	ld	hl,PROCESS_CMDLIST
    1368.  00:4CEA  DD 7E F0            	ld	a,(ix+TRACK_Command)
    1369.  00:4CED                      
    1370.  00:4CED  87                  	add	a
    1371.  00:4CEE  85                  	add	a,l
    1372.  00:4CEF  6F                  	ld	l,a
    1373.  00:4CF0  D2 F4 4C            	jp	nc,.skip
    1374.  00:4CF3  24                  	inc	h
    1375.  00:4CF4                      .skip:
    1376.  00:4CF4  7E                  	ld	a,(hl)
    1377.  00:4CF5  23                  	inc	hl
    1378.  00:4CF6  66                  	ld	h,(hl)
    1379.  00:4CF7  6F                  	ld	l,a	
    1380.  00:4CF8  E9                  	jp	(hl)
    1381.  00:4CF9                      
    1382.  00:4CF9                      
    1383.  00:4CF9                      process_commandEND:
    1384.  00:4CF9                      process_note:
    1385.  00:4CF9                      
    1386.  00:4CF9                      	;=====
    1387.  00:4CF9                      	; NOTE
    1388.  00:4CF9                      	;=====
    1389.  00:4CF9                      	;--- Check if we need to trigger a new note
    1390.  00:4CF9  CB 42               	bit	B_TRGNOT,d	;(ix+TRACK_Flags)
    1391.  00:4CFB  CA 20 4D            	jp	z,process_noNoteTrigger
    1392.  00:4CFE                      	
    1393.  00:4CFE                      
    1394.  00:4CFE                      process_triggerNote:	
    1395.  00:4CFE                      	;--- get new Note
    1396.  00:4CFE                      ;	res	B_TRGNOT,d		;(ix+TRACK_Flags)		; reset trigger note flag
    1397.  00:4CFE  CB CA               	set	B_ACTNOT,d		;(ix+TRACK_Flags)		; set	note active	flag
    1398.  00:4D00                      
    1399.  00:4D00                      
    1400.  00:4D00  DD 6E F3            	ld	l,(ix+TRACK_MacroStart)
    1401.  00:4D03  DD 66 F4            	ld	h,(ix+TRACK_MacroStart+1)
    1402.  00:4D06                      	;--- Store the macro start	
    1403.  00:4D06  DD 75 F1            	ld	(ix+TRACK_MacroPointer),l
    1404.  00:4D09  DD 74 F2            	ld	(ix+TRACK_MacroPointer+1),h	
    1405.  00:4D0C                      
    1406.  00:4D0C  21 00 00            	ld	hl,0
    1407.  00:4D0F  ED 73 00 C0         	ld	(_SP_Storage),sp
    1408.  00:4D13  DD F9               	ld	sp,ix
    1409.  00:4D15  F1                  	pop	af
    1410.  00:4D16  F1                  	pop	af
    1411.  00:4D17  E5                  	push	hl
    1412.  00:4D18  E5                  	push	hl		
    1413.  00:4D19  E5                  	push	hl
    1414.  00:4D1A  E5                  	push	hl
    1415.  00:4D1B  E5                  	push	hl
    1416.  00:4D1C  ED 7B 00 C0         	ld	sp,(_SP_Storage)
    1417.  00:4D20                      
    1418.  00:4D20                      ;	ld	(ix+TRACK_ToneAdd),0
    1419.  00:4D20                      ;	ld	(ix+TRACK_ToneAdd+1),0
    1420.  00:4D20                      ;	ld	(ix+TRACK_VolumeAdd),0	
    1421.  00:4D20                      ;	ld	(ix+TRACK_cmd_ToneAdd),0
    1422.  00:4D20                      ;	ld	(ix+TRACK_cmd_ToneAdd+1),0
    1423.  00:4D20                      ;	ld	(ix+TRACK_cmd_VolumeAdd),0
    1424.  00:4D20                      ;	ld	(ix+TRACK_Noise),0
    1425.  00:4D20                      ;	ld	(ix+TRACK_cmd_ToneSlideAdd),0
    1426.  00:4D20                      ;	ld	(ix+TRACK_cmd_ToneSlideAdd+1),0
    1427.  00:4D20                      
    1428.  00:4D20                      process_noNoteTrigger:
    1429.  00:4D20                      	;Get note freq
    1430.  00:4D20                      ;	ld	a,(ix+TRACK_Note)
    1431.  00:4D20                      ;	add	a,(ix+TRACK_cmd_NoteAdd)
    1432.  00:4D20                      ;	add	a
    1433.  00:4D20                      ;	ex	af,af'			;'store the	note offset
    1434.  00:4D20                      
    1435.  00:4D20                      
    1436.  00:4D20                      	;==============
    1437.  00:4D20                      	; Macro instrument
    1438.  00:4D20                      	;==============
    1439.  00:4D20  CB 4A               	bit	B_ACTNOT,d			
    1440.  00:4D22  CA 81 4E            	jp	z,process_noNoteActive
    1441.  00:4D25                      	
    1442.  00:4D25                      	;--- Get the macro len and loop
    1443.  00:4D25  DD 6E F1            	ld	l,(ix+TRACK_MacroPointer)
    1444.  00:4D28  DD 66 F2            	ld	h,(ix+TRACK_MacroPointer+1)
    1445.  00:4D2B                      
    1446.  00:4D2B  5E                  	ld	e,(hl)				; info byte
    1447.  00:4D2C  23                  	inc	hl
    1448.  00:4D2D  CB 5B               	bit	3,e					; Volume change
    1449.  00:4D2F  C2 38 4D            	jp	nz,_vol_change
    1450.  00:4D32  DD 7E FD            	ld	a,(ix+TRACK_VolumeAdd)
    1451.  00:4D35  C3 55 4D            	jp	_noVolumeChange
    1452.  00:4D38                      	
    1453.  00:4D38                      	;--- Volume change
    1454.  00:4D38                      _vol_change:
    1455.  00:4D38  7E                  	ld	a,(hl)
    1456.  00:4D39  23                  	inc	hl
    1457.  00:4D3A                      	
    1458.  00:4D3A  CB 53               	bit	2,e
    1459.  00:4D3C  CA 52 4D            	jp	z,_vol_base
    1460.  00:4D3F                      _vol_rel:
    1461.  00:4D3F  DD 86 FD            	add	 (ix+TRACK_VolumeAdd)
    1462.  00:4D42  FE 10               	cp	16
    1463.  00:4D44  DA 52 4D            	jp	c,_vol_base
    1464.  00:4D47  FE 80               	cp	128
    1465.  00:4D49  D2 51 4D            	jp	nc,.skip
    1466.  00:4D4C  3E 0F               	ld	a,$0f
    1467.  00:4D4E  C3 52 4D            	jp	_vol_base
    1468.  00:4D51                      .skip:	
    1469.  00:4D51  AF                  	xor	a
    1470.  00:4D52                      	
    1471.  00:4D52                      _vol_base:
    1472.  00:4D52  DD 77 FD            	ld	(ix+TRACK_VolumeAdd),a
    1473.  00:4D55                      
    1474.  00:4D55                      	;---- envelope check
    1475.  00:4D55                      	; is done here to be able to continue
    1476.  00:4D55                      	; macro volume values.
    1477.  00:4D55                      ;	bit	B_TRGENV,d		;'(IX+TRACK_Flags)
    1478.  00:4D55                      ;	jp	z,_noEnv		; if not set then normal volume calculation
    1479.  00:4D55                      ;	ld	a,16			; set volume to 16 == envelope
    1480.  00:4D55                      ;	ld	(FM_regVOLF),a
    1481.  00:4D55                      ;	jp	_noVolume	
    1482.  00:4D55                      	
    1483.  00:4D55                      _noVolumeChange:
    1484.  00:4D55  DD B6 F7            	or	(ix+TRACK_Volume)
    1485.  00:4D58  4F                  	ld	c,a			; store volume add
    1486.  00:4D59                      
    1487.  00:4D59  DD 7E FF            	ld 	a,(ix+TRACK_cmd_VolumeAdd)
    1488.  00:4D5C                      ;	rla				; shift to detect shift
    1489.  00:4D5C                      ;	jp 	c,.sub_Vadd		
    1490.  00:4D5C                      ;.add_Vadd:  
    1491.  00:4D5C                      ;	add	a,c
    1492.  00:4D5C                      ;	jp	nc,_Vadd
    1493.  00:4D5C                      ;	ld	a,c
    1494.  00:4D5C                      ;	or	0xf0
    1495.  00:4D5C                      ;	jp	_Vadd	
    1496.  00:4D5C                      ;.sub_Vadd:	
    1497.  00:4D5C  47                  	ld	b,a
    1498.  00:4D5D                      ;	xor	a
    1499.  00:4D5D                      ;	sub 	b
    1500.  00:4D5D                      ;	ld	b,a
    1501.  00:4D5D  79                  	ld	a,c
    1502.  00:4D5E  90                  	sub	a,b
    1503.  00:4D5F  D2 65 4D            	jp 	nc,.skip2
    1504.  00:4D62  79                  	ld	a,c
    1505.  00:4D63  E6 0F                	and	0x0f
    1506.  00:4D65                      .skip2:
    1507.  00:4D65                      
    1508.  00:4D65                      	
    1509.  00:4D65                      	;-- next is _Vadd
    1510.  00:4D65                      _Vadd:
    1511.  00:4D65                      	;--- apply main volume balance
    1512.  00:4D65  ED 4B 29 C0         	ld	bc,(replay_mainvol)
    1513.  00:4D69  81                  	add	a,c
    1514.  00:4D6A  4F                  	ld	c,a
    1515.  00:4D6B  D2 6F 4D            	jp	nc,.skip
    1516.  00:4D6E  04                  	inc	b
    1517.  00:4D6F                      .skip:
    1518.  00:4D6F  0A                  	ld	a,(bc)	
    1519.  00:4D70                      	; Test which CHIP.
    1520.  00:4D70  CB 7A               	bit	B_PSGFM,d		;(ix+TRACK_Flags)
    1521.  00:4D72  C2 79 4D            	jp	nz,.skip2
    1522.  00:4D75  1F                  	rra
    1523.  00:4D76  1F                  	rra
    1524.  00:4D77  1F                  	rra
    1525.  00:4D78  1F                  	rra
    1526.  00:4D79                      .skip2:
    1527.  00:4D79  E6 0F               	and	0x0f
    1528.  00:4D7B  32 9A C1            	ld	(FM_regVOLF),a
    1529.  00:4D7E                      
    1530.  00:4D7E                      _noVolume:
    1531.  00:4D7E                      	;-------------------------------
    1532.  00:4D7E                      	;
    1533.  00:4D7E                      	; NOISE
    1534.  00:4D7E                      	;
    1535.  00:4D7E                      	;-------------------------------
    1536.  00:4D7E  CB 7B               	bit 	7,e			; test if noise value
    1537.  00:4D80  CA 8D 4D            	jp	z,_noNoise
    1538.  00:4D83                      
    1539.  00:4D83                      	;--- prevent FM and noise
    1540.  00:4D83  7E                  	ld	a,(hl)		; get the value	
    1541.  00:4D84  23                  	inc	hl	
    1542.  00:4D85                      	
    1543.  00:4D85  CB 7A               	bit	B_PSGFM,d		;(ix+TRACK_Flags)
    1544.  00:4D87  C2 8D 4D            	jp	nz,_noNoise		; Noise and Link not at the same time
    1545.  00:4D8A                      	
    1546.  00:4D8A                      	;--- Set the mixer for noise
    1547.  00:4D8A                      ;	ld	a,(FM_regMIXER)
    1548.  00:4D8A                      ;	or	128
    1549.  00:4D8A                      ;	ld	(FM_regMIXER),a
    1550.  00:4D8A                      
    1551.  00:4D8A                      ;	bit	5,e
    1552.  00:4D8A                      ;	jp	z,_noLink
    1553.  00:4D8A                      ;	ld	a,(hl)	; get the deviation	
    1554.  00:4D8A                      ;	inc	hl
    1555.  00:4D8A                      ;	bit	6,e
    1556.  00:4D8A                      ;	jp	z,.skip
    1557.  00:4D8A                      ;	add	(ix+TRACK_Noise)
    1558.  00:4D8A                      ;.skip:	
    1559.  00:4D8A  32 70 C1            	ld	(PSG_regNOISE),a
    1560.  00:4D8D                      	
    1561.  00:4D8D                      	
    1562.  00:4D8D                      _noNoise:
    1563.  00:4D8D                      	;-------------------------------
    1564.  00:4D8D                      	;
    1565.  00:4D8D                      	; NOISE volume
    1566.  00:4D8D                      	;
    1567.  00:4D8D                      	;-------------------------------
    1568.  00:4D8D  CB 73               	bit 	6,e			; test if noise volume
    1569.  00:4D8F  CA AD 4D            	jp	z,_noNoiseVol
    1570.  00:4D92                      	
    1571.  00:4D92                      	;--- prevent FM and noise
    1572.  00:4D92  7E                  	ld	a,(hl)		; get the volume	
    1573.  00:4D93  23                  	inc	hl
    1574.  00:4D94                      	
    1575.  00:4D94  CB 7A               	bit	B_PSGFM,d		;(ix+TRACK_Flags)
    1576.  00:4D96  C2 BB 4D            	jp	nz,_noLink		; Noise and Link not at the same time
    1577.  00:4D99                      	
    1578.  00:4D99  DD B6 F7            	or	(ix+TRACK_Volume)
    1579.  00:4D9C                      	;--- apply main volume balance
    1580.  00:4D9C  ED 4B 29 C0         	ld	bc,(replay_mainvol)
    1581.  00:4DA0  81                  	add	a,c
    1582.  00:4DA1  4F                  	ld	c,a
    1583.  00:4DA2  D2 A6 4D            	jp	nc,.skip
    1584.  00:4DA5  04                  	inc	b
    1585.  00:4DA6                      .skip:
    1586.  00:4DA6  0A                  	ld	a,(bc)
    1587.  00:4DA7  32 75 C1            	ld	(PSG_regVOLN),a
    1588.  00:4DAA  C3 BB 4D            	jp	_noLink
    1589.  00:4DAD                      
    1590.  00:4DAD                      
    1591.  00:4DAD                      _noNoiseVol
    1592.  00:4DAD                      	;-------------------------------
    1593.  00:4DAD                      	;
    1594.  00:4DAD                      	; VoiceLink
    1595.  00:4DAD                      	;
    1596.  00:4DAD                      	;-------------------------------
    1597.  00:4DAD  CB 4B               	bit 	1,e
    1598.  00:4DAF  CA BB 4D            	jp	z,_noLink
    1599.  00:4DB2                      
    1600.  00:4DB2  7E                  	ld	a,(hl)					; get the new hw voice	
    1601.  00:4DB3  23                  	inc	hl
    1602.  00:4DB4                      	
    1603.  00:4DB4  DD CB F9 F6         	set 	B_TRGVOI,(ix+TRACK_Flags)
    1604.  00:4DB8  DD 77 F8            	ld	(ix+TRACK_Voice),a			; set new voice to be loaded
    1605.  00:4DBB                      
    1606.  00:4DBB                      
    1607.  00:4DBB                      
    1608.  00:4DBB                      _noLink
    1609.  00:4DBB                      	;-------------------------------
    1610.  00:4DBB                      	;
    1611.  00:4DBB                      	; TONE 
    1612.  00:4DBB                      	;
    1613.  00:4DBB                      	;-------------------------------
    1614.  00:4DBB  DD 46 FB            	ld	b,(ix+TRACK_ToneAdd)	; get	the current	deviation	
    1615.  00:4DBE  DD 4E FC            	ld	c,(ix+TRACK_ToneAdd+1)
    1616.  00:4DC1                      
    1617.  00:4DC1  CB 63               	bit 	4,e
    1618.  00:4DC3  CA D8 4D            	jp	z,process_noToneAdd
    1619.  00:4DC6                      	
    1620.  00:4DC6  7E                  	ld	a,(hl)
    1621.  00:4DC7  23                  	inc	hl
    1622.  00:4DC8  81                  	add	c
    1623.  00:4DC9  4F                  	ld	c,a
    1624.  00:4DCA  DD 71 FC            	ld	(ix+TRACK_ToneAdd+1),c
    1625.  00:4DCD  D2 D1 4D            	jp	nc,.skip
    1626.  00:4DD0  04                  	inc	b
    1627.  00:4DD1                      .skip:
    1628.  00:4DD1  7E                  	ld	a,(hl)
    1629.  00:4DD2  23                  	inc	hl
    1630.  00:4DD3  80                  	add	b
    1631.  00:4DD4  47                  	ld	b,a
    1632.  00:4DD5  DD 70 FB            	ld	(ix+TRACK_ToneAdd),b
    1633.  00:4DD8                      	
    1634.  00:4DD8                      	
    1635.  00:4DD8                      process_noToneAdd:	
    1636.  00:4DD8                      	;---- check for macro end
    1637.  00:4DD8  CB 43               	bit	0,e		
    1638.  00:4DDA  CA E1 4D            	jp	z,.noend
    1639.  00:4DDD                      	
    1640.  00:4DDD  7E                  	ld	a,(hl)
    1641.  00:4DDE  23                  	inc	hl
    1642.  00:4DDF  66                  	ld	h,(hl)
    1643.  00:4DE0  6F                  	ld	l,a
    1644.  00:4DE1                      
    1645.  00:4DE1                      .noend:
    1646.  00:4DE1                      	;--- Set the mixer bit (T)
    1647.  00:4DE1  CB 6B               	bit	5,e		; do we have tone?
    1648.  00:4DE3  CA EE 4D            	jp	z,process_noToneBit
    1649.  00:4DE6                      
    1650.  00:4DE6                      	;-- enable tone output
    1651.  00:4DE6  3A BE C1            	ld	a,(FM_regMIXER)
    1652.  00:4DE9  F6 10               	or	16
    1653.  00:4DEB  32 BE C1            	ld	(FM_regMIXER),a
    1654.  00:4DEE                      	
    1655.  00:4DEE                      process_noToneBit:	
    1656.  00:4DEE  DD 75 F1            	ld	(ix+TRACK_MacroPointer),l	;--- store pointer for next time
    1657.  00:4DF1  DD 74 F2            	ld	(ix+TRACK_MacroPointer+1),h	
    1658.  00:4DF4                      
    1659.  00:4DF4                      	;-- Get current note
    1660.  00:4DF4  DD 7E F6            	ld	a,(ix+TRACK_Note)
    1661.  00:4DF7  DD 86 0D            	add	a,(ix+TRACK_cmd_NoteAdd)
    1662.  00:4DFA  87                  	add	a
    1663.  00:4DFB                      
    1664.  00:4DFB  2A 2D C0            	ld	hl,(replay_tonetable)
    1665.  00:4DFE  85                  	add	a,l
    1666.  00:4DFF  6F                  	ld	l,a
    1667.  00:4E00  D2 04 4E            	jp	nc,.skip
    1668.  00:4E03  24                  	inc	h
    1669.  00:4E04                      .skip:
    1670.  00:4E04  7E                  	ld	a,(hl)	;--- Store the note tone value in hl
    1671.  00:4E05  23                  	inc	hl
    1672.  00:4E06  66                  	ld	h,(hl)
    1673.  00:4E07  6F                  	ld	l,a
    1674.  00:4E08                      		
    1675.  00:4E08  09                  	add	hl,bc		;--- Store tone deviation		
    1676.  00:4E09                      
    1677.  00:4E09  7A                  	ld	a,d
    1678.  00:4E0A  DD 72 F9            	ld	(ix+TRACK_Flags),d
    1679.  00:4E0D                      	; set	the detune.
    1680.  00:4E0D  ED 73 00 C0         	ld	(_SP_Storage),sp
    1681.  00:4E11  DD F9               	ld	sp,ix
    1682.  00:4E13  D1                  	pop	de		; cmd detune
    1683.  00:4E14  19                  	add	hl,de
    1684.  00:4E15  C1                  	pop	bc		; cmd toneadd
    1685.  00:4E16  09                  	add	hl,bc
    1686.  00:4E17  C1                  	pop	bc		; cmd tone slide add
    1687.  00:4E18  09                  	add	hl,bc
    1688.  00:4E19  ED 7B 00 C0         	ld	sp,(_SP_Storage)
    1689.  00:4E1D                      
    1690.  00:4E1D                      	;-----------------
    1691.  00:4E1D                      	; FM Octave wrapper
    1692.  00:4E1D                      	; enable slides over multiple octaves.
    1693.  00:4E1D                      	; [DE] still contains tone slide add.
    1694.  00:4E1D                      	;-----------------
    1695.  00:4E1D  CB 7F               	bit	B_PSGFM,a			;(ix+TRACK_Flags)
    1696.  00:4E1F  CA 71 4E            	jp	z,_wrap_skip		; skip wrapper for PSG
    1697.  00:4E22                      
    1698.  00:4E22  CB 44               	bit	0,h
    1699.  00:4E24  CA 4E 4E            	jp	z,_wrap_lowcheck
    1700.  00:4E27                      _wrap_highcheck:
    1701.  00:4E27  7D                  	ld	a,l
    1702.  00:4E28  FE 5A               	cp	$5a				; $5a is the strict limit
    1703.  00:4E2A  DA 71 4E            	jp	c,_wrap_skip		; stop if smaller	
    1704.  00:4E2D                      	
    1705.  00:4E2D  E5                  	push	hl
    1706.  00:4E2E  D5                  	push	de
    1707.  00:4E2F                      	
    1708.  00:4E2F                      	;--- Set new tone value for same note 1 octave lower
    1709.  00:4E2F  CB 3F               	srl	a
    1710.  00:4E31  CB 44               	bit 	0,h		; test 9th bit
    1711.  00:4E33  CA 38 4E            	jp	z,99f
    1712.  00:4E36  C6 80               	add	128
    1713.  00:4E38                      99:
    1714.  00:4E38  5F                  	ld	e,a
    1715.  00:4E39                      ;	ld	d,0
    1716.  00:4E39                      	;--- set octave higher
    1717.  00:4E39  7C                  	ld	a,h
    1718.  00:4E3A  E6 FE               	and	$fe
    1719.  00:4E3C  C6 02               	add	$02
    1720.  00:4E3E                      ;	add	d		; merge with tone value
    1721.  00:4E3E  57                  	ld	d,a
    1722.  00:4E3F                      	;--- get difference between now and new
    1723.  00:4E3F  EB                  	ex	de,hl
    1724.  00:4E40  AF                  	xor	a		; reset carry flag
    1725.  00:4E41  ED 52               	sbc	hl,de
    1726.  00:4E43                      	;--- add difference to current slide
    1727.  00:4E43  D1                  	pop	de		; restore slide
    1728.  00:4E44  19                  	add	hl,de
    1729.  00:4E45  DD 75 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),l
    1730.  00:4E48  DD 74 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),h	
    1731.  00:4E4B  E1                  	pop	hl	
    1732.  00:4E4C  18 23               	jr.	_wrap_skip
    1733.  00:4E4E                      	
    1734.  00:4E4E                      _wrap_lowcheck:
    1735.  00:4E4E  7D                  	ld	a,l
    1736.  00:4E4F  FE 3B               	cp	$3b		; $ad is the strict limit
    1737.  00:4E51  30 1E               	jr.	nc,_wrap_skip		; stop if smaller
    1738.  00:4E53                      
    1739.  00:4E53                      
    1740.  00:4E53  E5                  	push 	hl		; store freq
    1741.  00:4E54  D5                  	push	de		; store slide
    1742.  00:4E55                      	;--- set new tone value for same note (but octave lower)
    1743.  00:4E55  87                  	add	a,a		; multiply by 2 in de 
    1744.  00:4E56  5F                  	ld	e,a
    1745.  00:4E57  16 00               	ld	d,0
    1746.  00:4E59  D2 5D 4E            	jp	nc,99f
    1747.  00:4E5C  14                  	inc	d	
    1748.  00:4E5D                      99:
    1749.  00:4E5D                      	;--- set octave higher
    1750.  00:4E5D  7C                  	ld	a,h
    1751.  00:4E5E  E6 FE               	and	$fe
    1752.  00:4E60  D6 02               	sub	$02
    1753.  00:4E62  82                  	add	d		; merge with tone value
    1754.  00:4E63  57                  	ld	d,a
    1755.  00:4E64                      	;--- get difference between now and new
    1756.  00:4E64  EB                  	ex	de,hl
    1757.  00:4E65  AF                  	xor	a		; reset carry flag
    1758.  00:4E66  ED 52               	sbc	hl,de
    1759.  00:4E68                      	;--- add difference to current slide
    1760.  00:4E68  D1                  	pop	de		; restore slide
    1761.  00:4E69  19                  	add	hl,de	
    1762.  00:4E6A                      	
    1763.  00:4E6A  DD 75 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),l
    1764.  00:4E6D  DD 74 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),h	
    1765.  00:4E70  E1                  	pop	hl	
    1766.  00:4E71                      	
    1767.  00:4E71                      _wrap_skip:
    1768.  00:4E71                      	; replace the last pushed value on stack
    1769.  00:4E71  D1                  	pop	de
    1770.  00:4E72  EB                  	ex	de,hl
    1771.  00:4E73  73                  	ld	(hl),e
    1772.  00:4E74  23                  	inc	hl
    1773.  00:4E75  7A                  	ld	a,d	; reset key on and sustain
    1774.  00:4E76  E6 0F               	and	$0f
    1775.  00:4E78  57                  	ld	d,a
    1776.  00:4E79  DD 7E F9            	ld	a,(ix+TRACK_Flags)	; Add the sustain and key bits.
    1777.  00:4E7C  E6 30               	and	16+32	
    1778.  00:4E7E  B2                  	or	d
    1779.  00:4E7F  77                  	ld	(hl),a
    1780.  00:4E80  C9                  	ret
    1781.  00:4E81                      
    1782.  00:4E81                      	
    1783.  00:4E81                      process_noNoteActive:
    1784.  00:4E81  E1                  	pop	hl
    1785.  00:4E82                      	
    1786.  00:4E82                      	;-- for FM add key and sustain bits to tone
    1787.  00:4E82  23                  	inc	hl
    1788.  00:4E83  7A                  	ld	a,d
    1789.  00:4E84  E6 30               	and	16+32	; keep key and sustain flags
    1790.  00:4E86  47                  	ld	b,a
    1791.  00:4E87  7E                  	ld	a,(hl)
    1792.  00:4E88  E6 0F               	and 	$0f
    1793.  00:4E8A  B0                  	or 	b
    1794.  00:4E8B  77                  	ld	(hl),a
    1795.  00:4E8C                      	
    1796.  00:4E8C                      	;-- Silence
    1797.  00:4E8C  AF                  	xor	a
    1798.  00:4E8D  32 9A C1            	ld	(FM_regVOLF),a
    1799.  00:4E90  DD 72 F9            	ld	(ix+TRACK_Flags),d
    1800.  00:4E93  C9                  	ret	
    1801.  00:4E94                      
    1802.  00:4E94                      PROCESS_CMDLIST:
    1803.  00:4E94                      	; This list only contains the primary commands.
    1804.  00:4E94  43 4F               	dw	process_cmd3_port_tone
    1805.  00:4E96  E9 4F               	dw	process_cmd5_vibrato_port_tone
    1806.  00:4E98  2F 4F               	dw	process_cmd2_port_down		
    1807.  00:4E9A  AA 4E               	dw	process_cmd0_arpeggio			
    1808.  00:4E9C  AA 4F               	dw	process_cmd4_vibrato		
    1809.  00:4E9E  1B 4F               	dw	process_cmd1_port_up	
    1810.  00:4EA0  EF 4F               	dw	process_cmd6_vibrato_vol		
    1811.  00:4EA2  F5 4F               	dw	process_cmd7_vol_slide
    1812.  00:4EA4  84 4F               	dw	process_cmd8_tremelo
    1813.  00:4EA6  21 50               	dw	process_cmd9_note_cut		
    1814.  00:4EA8  2E 50               	dw	process_cmd10_note_delay		
    1815.  00:4EAA                      
    1816.  00:4EAA                      			
    1817.  00:4EAA                      process_cmd0_arpeggio:
    1818.  00:4EAA  DD 7E 11            	ld	a,(ix+TRACK_Timer)
    1819.  00:4EAD  A7                  	and	a
    1820.  00:4EAE  CA CE 4E            	jp	z,.nextNote
    1821.  00:4EB1                      	
    1822.  00:4EB1  3D                  	dec	a
    1823.  00:4EB2  DD 77 11            	ld	(IX+TRACK_Timer),a
    1824.  00:4EB5  DD 7E 12            	ld	a,(ix+TRACK_Step)
    1825.  00:4EB8  A7                  	and	a
    1826.  00:4EB9  CA C7 4E            	jp	z,99f
    1827.  00:4EBC  DD 7E 06            	ld	a,(IX+TRACK_cmd_0)
    1828.  00:4EBF  E6 0F               	and	$0f
    1829.  00:4EC1  DD 77 0D            	ld	(ix+TRACK_cmd_NoteAdd),a	
    1830.  00:4EC4  C3 F9 4C            	jr.	process_commandEND
    1831.  00:4EC7                      99:
    1832.  00:4EC7  DD 36 0D 00         	ld	(ix+TRACK_cmd_NoteAdd),0	
    1833.  00:4ECB  C3 F9 4C            	jr.	process_commandEND
    1834.  00:4ECE                      	
    1835.  00:4ECE                      
    1836.  00:4ECE                      .nextNote:
    1837.  00:4ECE                      	; re-init the speed.
    1838.  00:4ECE  3A 24 C0            	ld	a,(replay_arp_speed)
    1839.  00:4ED1  DD 77 11            	ld	(IX+TRACK_Timer),a
    1840.  00:4ED4                      	
    1841.  00:4ED4  DD 7E 12            	ld	a,(ix+TRACK_Step)
    1842.  00:4ED7  A7                  	and	a
    1843.  00:4ED8  20 16               	jr.	nz,99f
    1844.  00:4EDA                      
    1845.  00:4EDA                      	;--- set x
    1846.  00:4EDA  DD 36 12 01         		ld	(ix+TRACK_Step),1
    1847.  00:4EDE  DD 7E 06            		ld	a,(ix+TRACK_cmd_0)
    1848.  00:4EE1  07                  		rlca
    1849.  00:4EE2  07                  		rlca
    1850.  00:4EE3  07                  		rlca
    1851.  00:4EE4  07                  		rlca		
    1852.  00:4EE5  DD 77 06            		ld	(ix+TRACK_cmd_0),a	
    1853.  00:4EE8  E6 0F               		and	$0f
    1854.  00:4EEA  DD 77 0D            		ld	(ix+TRACK_cmd_NoteAdd),a
    1855.  00:4EED  C3 F9 4C            		jr.	process_commandEND
    1856.  00:4EF0                      	
    1857.  00:4EF0                      99:
    1858.  00:4EF0  3D                  	dec	a
    1859.  00:4EF1  20 1D               	jr.	nz,99f
    1860.  00:4EF3                      
    1861.  00:4EF3                      	;--- set y
    1862.  00:4EF3  DD 36 12 02         		ld	(ix+TRACK_Step),2
    1863.  00:4EF7  DD 7E 06            		ld	a,(ix+TRACK_cmd_0)
    1864.  00:4EFA  07                  		rlca
    1865.  00:4EFB  07                  		rlca
    1866.  00:4EFC  07                  		rlca
    1867.  00:4EFD  07                  		rlca		
    1868.  00:4EFE  DD 77 06            		ld	(ix+TRACK_cmd_0),a			
    1869.  00:4F01  E6 0F               		and	0x0f
    1870.  00:4F03  C2 0A 4F            		jp	nz,0f
    1871.  00:4F06                      		;--- if zero then skip this note and set step to start
    1872.  00:4F06  DD 36 12 00         		ld	(ix+TRACK_Step),0
    1873.  00:4F0A                      0:		
    1874.  00:4F0A  DD 77 0D            		ld	(ix+TRACK_cmd_NoteAdd),a	
    1875.  00:4F0D  C3 F9 4C            		jr.	process_commandEND
    1876.  00:4F10                      	
    1877.  00:4F10                      99:
    1878.  00:4F10                      	;--- set none
    1879.  00:4F10  DD 36 12 00         	ld	(ix+TRACK_Step),0
    1880.  00:4F14  DD 36 0D 00         	ld	(ix+TRACK_cmd_NoteAdd),0		
    1881.  00:4F18  C3 F9 4C            	jr.	process_commandEND
    1882.  00:4F1B                      		
    1883.  00:4F1B                      
    1884.  00:4F1B                      	
    1885.  00:4F1B                      
    1886.  00:4F1B                      	
    1887.  00:4F1B                      process_cmd1_port_up:
    1888.  00:4F1B  DD 7E 07            	ld	a,(ix+TRACK_cmd_1)	
    1889.  00:4F1E                      
    1890.  00:4F1E  47                  	ld	b,a
    1891.  00:4F1F  DD 7E 00            	ld	a,(ix+TRACK_cmd_ToneSlideAdd)
    1892.  00:4F22  90                  	sub	b
    1893.  00:4F23  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    1894.  00:4F26  D2 F9 4C            	jp	nc,process_commandEND
    1895.  00:4F29  DD 34 01            	inc	(ix+TRACK_cmd_ToneSlideAdd+1)
    1896.  00:4F2C  C3 F9 4C            	jp	process_commandEND
    1897.  00:4F2F                      
    1898.  00:4F2F                      	
    1899.  00:4F2F                      process_cmd2_port_down:	
    1900.  00:4F2F  DD 7E 08            	ld	a,(ix+TRACK_cmd_2)
    1901.  00:4F32  47                  	ld	b,a
    1902.  00:4F33  DD 7E 00            	ld	a,(ix+TRACK_cmd_ToneSlideAdd)
    1903.  00:4F36  80                  	add	b
    1904.  00:4F37  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    1905.  00:4F3A  D2 F9 4C            	jp	nc,process_commandEND
    1906.  00:4F3D  DD 35 01            	dec	(ix+TRACK_cmd_ToneSlideAdd+1)
    1907.  00:4F40  C3 F9 4C            	jp	process_commandEND
    1908.  00:4F43                      	
    1909.  00:4F43                      
    1910.  00:4F43                      process_cmd3_port_tone:
    1911.  00:4F43  DD 7E 09            	ld	a,(ix+TRACK_cmd_3)
    1912.  00:4F46  DD 6E 00            	ld	l,(ix+TRACK_cmd_ToneSlideAdd)
    1913.  00:4F49  DD 66 01            	ld	h,(ix+TRACK_cmd_ToneSlideAdd+1)
    1914.  00:4F4C  CB 7C               	bit	7,h
    1915.  00:4F4E  CA 64 4F            	jp	z,process_cmd3_sub
    1916.  00:4F51                      process_cmd3_add:
    1917.  00:4F51                      	;pos slide
    1918.  00:4F51  85                  	add	a,l
    1919.  00:4F52  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    1920.  00:4F55  D2 59 4F            	jp	nc,.skip
    1921.  00:4F58  24                  	inc	h					
    1922.  00:4F59                      .skip:
    1923.  00:4F59  CB 7C               	bit	7,h
    1924.  00:4F5B  CA 79 4F            	jp	z,process_cmd3_stop			; delta turned pos ?
    1925.  00:4F5E  DD 74 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),h
    1926.  00:4F61  C3 F9 4C            	jp	process_commandEND
    1927.  00:4F64                      process_cmd3_sub:
    1928.  00:4F64                      	;negative slide	
    1929.  00:4F64  E6 7F               	and	$7f
    1930.  00:4F66  4F                  	ld	c,a
    1931.  00:4F67  AF                  	xor	a
    1932.  00:4F68  47                  	ld	b,a
    1933.  00:4F69  ED 42               	sbc	hl,bc
    1934.  00:4F6B  CB 7C               	bit	7,h
    1935.  00:4F6D  C2 79 4F            	jp	nz,process_cmd3_stop			; delta turned neg ?
    1936.  00:4F70  DD 75 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),l
    1937.  00:4F73  DD 74 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),h
    1938.  00:4F76  C3 F9 4C            	jp	process_commandEND
    1939.  00:4F79                      process_cmd3_stop:	
    1940.  00:4F79                      ;	res	B_TRGCMD,d		;(ix+TRACK_Flags)
    1941.  00:4F79  DD 36 00 00         	ld	(ix+TRACK_cmd_ToneSlideAdd),0
    1942.  00:4F7D  DD 36 01 00         	ld	(ix+TRACK_cmd_ToneSlideAdd+1),0	
    1943.  00:4F81  C3 F9 4C            	jp	process_commandEND
    1944.  00:4F84                      
    1945.  00:4F84                      
    1946.  00:4F84                      process_cmd8_tremelo:
    1947.  00:4F84                      	;=================================
    1948.  00:4F84                      	;
    1949.  00:4F84                      	; Tremelo	
    1950.  00:4F84                      	;
    1951.  00:4F84                      	;=================================	
    1952.  00:4F84  DD 6E 0A            	ld	l,(ix+TRACK_cmd_4_depth)
    1953.  00:4F87  DD 66 0B            	ld	h,(ix+TRACK_cmd_4_depth+1)
    1954.  00:4F8A                      
    1955.  00:4F8A                      	;--- Get next step
    1956.  00:4F8A  DD 7E 12            	ld	a,(IX+TRACK_Step)
    1957.  00:4F8D  DD 86 0C            	add	(ix+TRACK_cmd_4_step)
    1958.  00:4F90  E6 1F               	and	$1F			; max	32
    1959.  00:4F92  DD 77 12            	ld	(ix+TRACK_Step),a
    1960.  00:4F95                      
    1961.  00:4F95  85                  	add	a,l
    1962.  00:4F96  6F                  	ld	l,a
    1963.  00:4F97  D2 9B 4F            	jp	nc,99f
    1964.  00:4F9A  24                  	inc	h
    1965.  00:4F9B                      99:
    1966.  00:4F9B  7E                  	ld	a,(hl)
    1967.  00:4F9C  CB 27               	sla	a
    1968.  00:4F9E  CB 27               	sla	a	
    1969.  00:4FA0  CB 27               	sla	a	
    1970.  00:4FA2  CB 27               	sla	a
    1971.  00:4FA4  DD 77 FF            	ld	(ix+TRACK_cmd_VolumeAdd),a
    1972.  00:4FA7  C3 F9 4C            	jp	process_commandEND	
    1973.  00:4FAA                      
    1974.  00:4FAA                      
    1975.  00:4FAA                      	;=================================
    1976.  00:4FAA                      	;
    1977.  00:4FAA                      	; Vibrato	
    1978.  00:4FAA                      	;
    1979.  00:4FAA                      	;=================================
    1980.  00:4FAA                      process_cmd4_vibrato:
    1981.  00:4FAA  DD 6E 0A            	ld	l,(ix+TRACK_cmd_4_depth)
    1982.  00:4FAD  DD 66 0B            	ld	h,(ix+TRACK_cmd_4_depth+1)
    1983.  00:4FB0                      
    1984.  00:4FB0                      	;--- Get next step
    1985.  00:4FB0  DD 7E 12            	ld	a,(IX+TRACK_Step)
    1986.  00:4FB3  DD 86 0C            	add	(ix+TRACK_cmd_4_step)
    1987.  00:4FB6  E6 3F               	and	$3F			; max	64
    1988.  00:4FB8  DD 77 12            	ld	(ix+TRACK_Step),a
    1989.  00:4FBB                      	
    1990.  00:4FBB  CB 6F               	bit	5,a			; step 32-63 the neg	
    1991.  00:4FBD  CA D8 4F            	jp	z,.pos	
    1992.  00:4FC0                      	
    1993.  00:4FC0                      .neg:
    1994.  00:4FC0  E6 1F               	and	$1f	; make it 32 steps again
    1995.  00:4FC2  85                  	add	a,l
    1996.  00:4FC3  6F                  	ld	l,a
    1997.  00:4FC4  D2 C8 4F            	jp	nc,99f
    1998.  00:4FC7  24                  	inc	h
    1999.  00:4FC8                      99:
    2000.  00:4FC8  7E                  	ld	a,(hl)
    2001.  00:4FC9  ED 44               	neg
    2002.  00:4FCB  CA DF 4F            	jp	z,.zero			; $ff00 gives strange result ;)	
    2003.  00:4FCE  DD 77 02            	ld	(ix+TRACK_cmd_ToneAdd),a
    2004.  00:4FD1  DD 36 03 FF         	ld	(ix+TRACK_cmd_ToneAdd+1),0xff
    2005.  00:4FD5  C3 F9 4C            	jp	process_commandEND	
    2006.  00:4FD8                      
    2007.  00:4FD8                      .pos:
    2008.  00:4FD8  85                  	add	a,l
    2009.  00:4FD9  6F                  	ld	l,a
    2010.  00:4FDA  D2 DE 4F            	jp	nc,99f
    2011.  00:4FDD  24                  	inc	h
    2012.  00:4FDE                      99:
    2013.  00:4FDE  7E                  	ld	a,(hl)
    2014.  00:4FDF                      .zero:	
    2015.  00:4FDF  DD 77 02            	ld	(ix+TRACK_cmd_ToneAdd),a
    2016.  00:4FE2  DD 36 03 00         	ld	(ix+TRACK_cmd_ToneAdd+1),0
    2017.  00:4FE6  C3 F9 4C            	jp	process_commandEND	
    2018.  00:4FE9                      
    2019.  00:4FE9                      
    2020.  00:4FE9                      ;	ld	hl,(replay_vib_table)
    2021.  00:4FE9                      ;	;--- Get next step
    2022.  00:4FE9                      ;	ld	a,(IX+TRACK_Step)
    2023.  00:4FE9                      ;	add	(ix+TRACK_cmd_4_step)
    2024.  00:4FE9                      ;	and	$3F			; max	64
    2025.  00:4FE9                      ;	ld	(ix+TRACK_Step),a
    2026.  00:4FE9                      ;	
    2027.  00:4FE9                      ;	bit	5,a			; step 32-63 the neg	
    2028.  00:4FE9                      ;	jp	z,process_cmd4pos
    2029.  00:4FE9                      ;
    2030.  00:4FE9                      ;; neg	
    2031.  00:4FE9                      ;	and	$1f
    2032.  00:4FE9                      ;	add	a,l
    2033.  00:4FE9                      ;	ld	l,a
    2034.  00:4FE9                      ;	jp	nc,.skip
    2035.  00:4FE9                      ;	inc	h
    2036.  00:4FE9                      ;.skip:
    2037.  00:4FE9                      ;	ld	a,(hl)
    2038.  00:4FE9                      ;	;apply depth
    2039.  00:4FE9                      ;	ld	b,(ix+TRACK_cmd_4_depth)
    2040.  00:4FE9                      ;.loop:
    2041.  00:4FE9                      ;	srl	a
    2042.  00:4FE9                      ;	djnz	.loop
    2043.  00:4FE9                      ;;	and	$0f
    2044.  00:4FE9                      ;
    2045.  00:4FE9                      ;	neg
    2046.  00:4FE9                      ;	jp	z,process_cmd4_zero			; $ff00 gives strange result ;)	
    2047.  00:4FE9                      ;	ld	(ix+TRACK_cmd_ToneAdd),a
    2048.  00:4FE9                      ;	ld	(ix+TRACK_cmd_ToneAdd+1),0xff
    2049.  00:4FE9                      ;	jp	process_commandEND
    2050.  00:4FE9                      ;
    2051.  00:4FE9                      ;process_cmd4pos:	
    2052.  00:4FE9                      ;;	and	$1f
    2053.  00:4FE9                      ;	add	a,l
    2054.  00:4FE9                      ;	ld	l,a
    2055.  00:4FE9                      ;	jp	nc,.skip
    2056.  00:4FE9                      ;	inc	h
    2057.  00:4FE9                      ;.skip:
    2058.  00:4FE9                      ;	ld	a,(hl)
    2059.  00:4FE9                      ;	;apply depth
    2060.  00:4FE9                      ;	ld	b,(ix+TRACK_cmd_4_depth)
    2061.  00:4FE9                      ;.loop:
    2062.  00:4FE9                      ;	srl	a
    2063.  00:4FE9                      ;	djnz	.loop
    2064.  00:4FE9                      ;process_cmd4_zero:
    2065.  00:4FE9                      ;	ld	(ix+TRACK_cmd_ToneAdd),a
    2066.  00:4FE9                      ;	ld	(ix+TRACK_cmd_ToneAdd+1),0
    2067.  00:4FE9                      ;	jp	process_commandEND
    2068.  00:4FE9                      		
    2069.  00:4FE9                      	
    2070.  00:4FE9                      
    2071.  00:4FE9                      process_cmd5_vibrato_port_tone:
    2072.  00:4FE9  CD FB 4F            	call	process_cmdasub
    2073.  00:4FEC  C3 43 4F            	jp	process_cmd3_port_tone
    2074.  00:4FEF                      	
    2075.  00:4FEF                      process_cmd6_vibrato_vol:
    2076.  00:4FEF  CD FB 4F            	call	process_cmdasub
    2077.  00:4FF2  C3 AA 4F            	jp	process_cmd4_vibrato	
    2078.  00:4FF5                      
    2079.  00:4FF5                      process_cmd7_vol_slide:
    2080.  00:4FF5  CD FB 4F            	call	process_cmdasub
    2081.  00:4FF8  C3 F9 4C            	jp	process_commandEND
    2082.  00:4FFB                      
    2083.  00:4FFB                      
    2084.  00:4FFB                      process_cmdasub:
    2085.  00:4FFB  DD 35 11            	dec	(ix+TRACK_Timer)
    2086.  00:4FFE  C0                  	ret	nz
    2087.  00:4FFF                      		
    2088.  00:4FFF                      	; vol	slide
    2089.  00:4FFF  DD 7E 0E            	ld	a,(ix+TRACK_cmd_A)
    2090.  00:5002  4F                  	ld	c,a
    2091.  00:5003  E6 7F               	and	$7f
    2092.  00:5005  DD 77 11            	ld	(ix+TRACK_Timer),a
    2093.  00:5008                      
    2094.  00:5008  DD 7E F7            	ld	a,(ix+TRACK_Volume)
    2095.  00:500B  CB 79               	bit	7,c
    2096.  00:500D  CA 18 50            	jp	z,process_cmda_inc
    2097.  00:5010                      process_cmda_dec:
    2098.  00:5010  A7                  	and	a
    2099.  00:5011  C8                  	ret	z
    2100.  00:5012  D6 10               	sub	$10
    2101.  00:5014  DD 77 F7            	ld	(ix+TRACK_Volume),a
    2102.  00:5017  C9                  	ret
    2103.  00:5018                      	
    2104.  00:5018                      process_cmda_inc:
    2105.  00:5018  FE F0               	cp	$f0
    2106.  00:501A  D0                  	ret	nc
    2107.  00:501B  C6 10               	add	$10	
    2108.  00:501D  DD 77 F7            	ld	(ix+TRACK_Volume),a
    2109.  00:5020  C9                  	ret
    2110.  00:5021                      
    2111.  00:5021                      
    2112.  00:5021                      
    2113.  00:5021                      process_cmd9_note_cut:
    2114.  00:5021  DD 35 11            	dec	(ix+TRACK_Timer)
    2115.  00:5024  C2 F9 4C            	jp	nz,process_commandEND
    2116.  00:5027                      	
    2117.  00:5027                      	; stop note
    2118.  00:5027  CB 9A               	res	B_TRGCMD,d	; set	note bit to	0
    2119.  00:5029  CB 8A               	res	B_ACTNOT,d
    2120.  00:502B  C3 F9 4C            	jp	process_commandEND		
    2121.  00:502E                      	
    2122.  00:502E                      process_cmd10_note_delay:
    2123.  00:502E                      	; note delay
    2124.  00:502E  DD 35 11            	dec	(ix+TRACK_Timer)
    2125.  00:5031  C2 F9 4C            	jp	nz,process_commandEND	; no delay yet
    2126.  00:5034                      
    2127.  00:5034                      	; trigger note
    2128.  00:5034  DD 7E 10            	ld	a,(ix+TRACK_cmd_E)		
    2129.  00:5037  DD 77 F6            	ld	(ix+TRACK_Note),a		; set	the note val
    2130.  00:503A  CB C2               	set	B_TRGNOT,d	;(ix+TRACK_Flags)		; set	trigger note flag
    2131.  00:503C  CB 9A               	res	B_TRGCMD,d	;(ix+TRACK_Flags)		; reset trigger cmd flag
    2132.  00:503E                      	
    2133.  00:503E  C3 F9 4C            	jp	process_commandEND	
    2134.  00:5041                      
    2135.  00:5041                      
    2136.  00:5041                      
    2137.  00:5041                      ;===========================================================
    2138.  00:5041                      ; ---replay_route
    2139.  00:5041                      ; Output the data	to the CHIP	registers
    2140.  00:5041                      ; 
    2141.  00:5041                      ; 
    2142.  00:5041                      ;===========================================================
    2143.  00:5041                      replay_route:
    2144.  00:5041                      ;---------------
    2145.  00:5041                      ; P S	G 
    2146.  00:5041                      ;---------------
    2147.  00:5041                      route_SN:
    2148.  00:5041                      ;	ld	a,(_CONFIG_PSGPORT)
    2149.  00:5041  0E 3F               	ld	c,$3f
    2150.  00:5043                      99:	
    2151.  00:5043                      	; vol chan 1
    2152.  00:5043  3A 72 C1            	ld	a,(PSG_regVOLA)
    2153.  00:5046  3C                  	inc	a
    2154.  00:5047  ED 44               	neg
    2155.  00:5049  E6 0F               	and	$0f
    2156.  00:504B  F6 90               	or	10010000b
    2157.  00:504D  ED 79               	out	(c),a	
    2158.  00:504F                      	
    2159.  00:504F                      	; vol chan 2
    2160.  00:504F  3A 73 C1            	ld	a,(PSG_regVOLB)
    2161.  00:5052  3C                  	inc	a
    2162.  00:5053  ED 44               	neg
    2163.  00:5055  E6 0F               	and	$0f
    2164.  00:5057  F6 B0               	or	10110000b
    2165.  00:5059  ED 79               	out	(c),a		
    2166.  00:505B                      		
    2167.  00:505B                      ;	;-- check if we need 3rd psg
    2168.  00:505B                      ;	ld	a,10110000b
    2169.  00:505B                      ;	cp	b
    2170.  00:505B                      ;	jp	z,99f
    2171.  00:505B                      		
    2172.  00:505B                      	; vol chan 3
    2173.  00:505B  3A 74 C1            	ld	a,(PSG_regVOLC)
    2174.  00:505E  3C                  	inc	a
    2175.  00:505F  ED 44               	neg
    2176.  00:5061  E6 0F               	and	$0f
    2177.  00:5063  F6 D0               	or	11010000b 
    2178.  00:5065  ED 79               	out	(c),a			
    2179.  00:5067                      
    2180.  00:5067                      ;99:	
    2181.  00:5067                      	;--- next reg
    2182.  00:5067                      	; vol noise
    2183.  00:5067  3A 75 C1            	ld	a,(PSG_regVOLN)
    2184.  00:506A  3C                  	inc	a
    2185.  00:506B  ED 44               	neg
    2186.  00:506D  E6 0F               	and	$0f
    2187.  00:506F  F6 F0               	or	11110000b
    2188.  00:5071                      
    2189.  00:5071  ED 79               	out	(c),a	
    2190.  00:5073                      
    2191.  00:5073                      	; noise chan 
    2192.  00:5073  21 76 C1            	ld	hl,PSG_regNOISEold
    2193.  00:5076  3A 70 C1            	ld	a,(PSG_regNOISE)
    2194.  00:5079  BE                  	cp	(hl)
    2195.  00:507A  CA 82 50            	jp	z,0f
    2196.  00:507D  77                  	ld	(hl),a
    2197.  00:507E  3E E0               	ld	a,11100000b
    2198.  00:5080                      	;or	11100000b
    2199.  00:5080  D3 3F               	out	($3f),a
    2200.  00:5082                      0:
    2201.  00:5082                      	; tone chan a
    2202.  00:5082  ED 4B 6A C1         	ld	bc,(PSG_regToneA)
    2203.  00:5086  79                  	ld	a,c
    2204.  00:5087  E6 0F               	and	$0f
    2205.  00:5089  F6 80               	or	10000000b
    2206.  00:508B  D3 3F               	out	($3f),a	
    2207.  00:508D  CB 11               	rl	c
    2208.  00:508F  CB 10               	rl	b
    2209.  00:5091  CB 11               	rl	c
    2210.  00:5093  CB 10               	rl	b
    2211.  00:5095  CB 11               	rl	c
    2212.  00:5097  CB 10               	rl	b
    2213.  00:5099  CB 11               	rl	c
    2214.  00:509B  CB 10               	rl	b
    2215.  00:509D  3E 3F               	ld	a,00111111b
    2216.  00:509F  A0                  	and	b
    2217.  00:50A0  D3 3F               	out	($3f),a		
    2218.  00:50A2                      	
    2219.  00:50A2                      	
    2220.  00:50A2                      	; tone chan b
    2221.  00:50A2  ED 4B 6C C1         	ld	bc,(PSG_regToneB)
    2222.  00:50A6  79                  	ld	a,c
    2223.  00:50A7  E6 0F               	and	$0f
    2224.  00:50A9  F6 A0               	or	10100000b
    2225.  00:50AB  D3 3F               	out	($3f),a	
    2226.  00:50AD  CB 11               	rl	c
    2227.  00:50AF  CB 10               	rl	b
    2228.  00:50B1  CB 11               	rl	c
    2229.  00:50B3  CB 10               	rl	b
    2230.  00:50B5  CB 11               	rl	c
    2231.  00:50B7  CB 10               	rl	b
    2232.  00:50B9  CB 11               	rl	c
    2233.  00:50BB  CB 10               	rl	b
    2234.  00:50BD  3E 3F               	ld	a,00111111b
    2235.  00:50BF  A0                  	and	b
    2236.  00:50C0  D3 3F               	out	($3f),a	
    2237.  00:50C2                      	
    2238.  00:50C2                      	; tone chan c
    2239.  00:50C2  ED 4B 6E C1         	ld	bc,(PSG_regToneC)
    2240.  00:50C6  79                  	ld	a,c
    2241.  00:50C7  E6 0F               	and	$0f
    2242.  00:50C9  F6 C0               	or	11000000b
    2243.  00:50CB  D3 3F               	out	($3f),a	
    2244.  00:50CD  CB 11               	rl	c
    2245.  00:50CF  CB 10               	rl	b
    2246.  00:50D1  CB 11               	rl	c
    2247.  00:50D3  CB 10               	rl	b
    2248.  00:50D5  CB 11               	rl	c
    2249.  00:50D7  CB 10               	rl	b
    2250.  00:50D9  CB 11               	rl	c
    2251.  00:50DB  CB 10               	rl	b
    2252.  00:50DD  3E 3F               	ld	a,00111111b
    2253.  00:50DF  A0                  	and	b
    2254.  00:50E0  D3 3F               	out	($3f),a	
    2255.  00:50E2                      
    2256.  00:50E2                      route_gg:
    2257.  00:50E2                      	;==== output the GG stereo panning
    2258.  00:50E2  3A 77 C1            	ld	a,(GG_panning)
    2259.  00:50E5                      ;	out	($06),a
    2260.  00:50E5                      
    2261.  00:50E5                      
    2262.  00:50E5                      
    2263.  00:50E5                      
    2264.  00:50E5                      
    2265.  00:50E5                      
    2266.  00:50E5                      ;	;--- Push values to AY HW
    2267.  00:50E5                      ;	ld	b,0
    2268.  00:50E5                      ;	ld	c,0xa0
    2269.  00:50E5                      ;	ld	hl,PSG_registers
    2270.  00:50E5                      ;_comp_loop:	
    2271.  00:50E5                      ;	out	(c),b
    2272.  00:50E5                      ;	ld	a,(hl)
    2273.  00:50E5                      ;	add	1
    2274.  00:50E5                      ;	out	(0xa1),a
    2275.  00:50E5                      ;	inc	hl
    2276.  00:50E5                      ;	ld	a,(hl)
    2277.  00:50E5                      ;	adc	a,0
    2278.  00:50E5                      ;	inc	b
    2279.  00:50E5                      ;	out	(c),b	
    2280.  00:50E5                      ;	inc	hl
    2281.  00:50E5                      ;	out	(0xa1),a	
    2282.  00:50E5                      ;	inc	b
    2283.  00:50E5                      ;	ld	a,6
    2284.  00:50E5                      ;	cp	b
    2285.  00:50E5                      ;	jp	nz,_comp_loop
    2286.  00:50E5                      ;	
    2287.  00:50E5                      ;	ld	a,b	
    2288.  00:50E5                      ;	
    2289.  00:50E5                      ;	
    2290.  00:50E5                      ;_ptPSG_loop:
    2291.  00:50E5                      ;	out	(c),a
    2292.  00:50E5                      ;	inc	c
    2293.  00:50E5                      ;	outi
    2294.  00:50E5                      ;	dec	c
    2295.  00:50E5                      ;	inc	a
    2296.  00:50E5                      ;	cp	13
    2297.  00:50E5                      ;	jr	nz,_ptPSG_loop
    2298.  00:50E5                      ;
    2299.  00:50E5                      ;	ld	b,a
    2300.  00:50E5                      ;	ld	a,(hl)
    2301.  00:50E5                      ;	and	a
    2302.  00:50E5                      ;	jp	z,_ptPSG_noEnv
    2303.  00:50E5                      ;	out	(c),b
    2304.  00:50E5                      ;	inc	c
    2305.  00:50E5                      ;	out 	(c),a
    2306.  00:50E5                      ;	ld	(hl),0	;reset the envwrite
    2307.  00:50E5                      ;	
    2308.  00:50E5                      ;	
    2309.  00:50E5                      ;_ptPSG_noEnv:
    2310.  00:50E5                      
    2311.  00:50E5                      
    2312.  00:50E5                      
    2313.  00:50E5                      
    2314.  00:50E5                      ;---------------
    2315.  00:50E5                      ; F M
    2316.  00:50E5                      ;---------------
    2317.  00:50E5                      route_FM:
    2318.  00:50E5                      	; Check if we need to load a software voice
    2319.  00:50E5  21 BC C1            	ld	hl,FM_softvoice_req
    2320.  00:50E8  7E                  	ld	a,(hl)
    2321.  00:50E9  23                  	inc	hl
    2322.  00:50EA  BE                  	cp	(hl)
    2323.  00:50EB  CA F2 50            	jp	z,.noVoice
    2324.  00:50EE                      	
    2325.  00:50EE  77                  	ld	(hl),a
    2326.  00:50EF                      
    2327.  00:50EF  CD 70 51            	call	load_softwarevoice
    2328.  00:50F2                      	
    2329.  00:50F2                      .noVoice:
    2330.  00:50F2                      	;------------------------------------------
    2331.  00:50F2                      	;---- Process Drum macro
    2332.  00:50F2                      	;------------------------------------------
    2333.  00:50F2                      	;call	_route_FM_drum_update
    2334.  00:50F2                      	
    2335.  00:50F2                      
    2336.  00:50F2                      	;------------------------------------------
    2337.  00:50F2                      	;---- Update the tone and drum registers
    2338.  00:50F2                      	;------------------------------------------
    2339.  00:50F2  21 78 C1            	ld 	hl,FM_Registers
    2340.  00:50F5  11 8A C0            	ld	de,TRACK_Chan3+17+TRACK_Flags
    2341.  00:50F8  3E 10               	ld	a,$10		; Register $10
    2342.  00:50FA  06 09               	ld	b,9		; 6(tone)+3(drum) channels to update
    2343.  00:50FC                      
    2344.  00:50FC                      .channel_loop:	
    2345.  00:50FC                      	; Tone low
    2346.  00:50FC  CD 50 51            	call	_route_FM_reg16_update
    2347.  00:50FF  2B                  	dec	hl
    2348.  00:5100  C6 10               	add	a,$10	; Register# $20
    2349.  00:5102                      
    2350.  00:5102  08                  	ex	af,af'
    2351.  00:5103                      
    2352.  00:5103  78                  	ld	a,b	;-- Only do this check for first 6 chans. Other are drum
    2353.  00:5104  FE 04               	cp	4
    2354.  00:5106  DA 1F 51            	jp	c,0f
    2355.  00:5109                      
    2356.  00:5109                      	;-- Check if we need to toggle key to start a new note
    2357.  00:5109  1A                  	ld	a,(de)
    2358.  00:510A  CB 47               	bit	0,a
    2359.  00:510C  CA 17 51            	jp	z,99f	; no notetrigger
    2360.  00:510F                      	
    2361.  00:510F  CB 87               	res	0,a		; reset trigger
    2362.  00:5111  12                  	ld	(de),a
    2363.  00:5112  CB 67               	bit	4,a
    2364.  00:5114  C4 61 51            	call	nz,_route_FM_keyOff_update
    2365.  00:5117                      99:
    2366.  00:5117  3E 27               	ld	a,TRACK_REC_SIZE
    2367.  00:5119  83                  	add	a,e
    2368.  00:511A  5F                  	ld	e,a
    2369.  00:511B  D2 1F 51            	jp	nc,99f
    2370.  00:511E  14                  	inc	d
    2371.  00:511F                      99:	
    2372.  00:511F                      0:
    2373.  00:511F  08                  	ex	af,af'
    2374.  00:5120                      	
    2375.  00:5120                      	; Tone High + key & sustain
    2376.  00:5120  CD 50 51            	call	_route_FM_reg16_update
    2377.  00:5123  23                  	inc	hl
    2378.  00:5124  C6 10               	add	a,$10	; Register# $30
    2379.  00:5126                      	
    2380.  00:5126                      	; Volume + voice
    2381.  00:5126  CD 4B 51            	call	_route_FM_reg8_update
    2382.  00:5129  23                  	inc	hl
    2383.  00:512A  C6 E1               	add	a,-$1F	; Register# = channel + $10
    2384.  00:512C  10 CE               	djnz	.channel_loop
    2385.  00:512E  C9                  	ret
    2386.  00:512F                      
    2387.  00:512F                      _route_FM_drum_update:
    2388.  00:512F  3A AE C1            	ld	a,(FM_DRUM)
    2389.  00:5132  E6 1F               	and	00011111b		; erase bit 5
    2390.  00:5134  C8                  	ret	z			; no drums to play
    2391.  00:5135                      	
    2392.  00:5135  47                  	ld	b,a
    2393.  00:5136  3E 0E               	ld	a,0x0e
    2394.  00:5138                      	;-- load the new values
    2395.  00:5138  D3 7C               	out	(FM_WRITE),a	; Select rythm register
    2396.  00:513A                      	
    2397.  00:513A  78                  	ld	a,b			; 5 cycles
    2398.  00:513B  78                  	ld	a,b			; 5 cycles	; dummy code for delay
    2399.  00:513C  D3 7D               	out	(FM_DATA),a		
    2400.  00:513E                      
    2401.  00:513E  DD E5               	push	ix			; 17 cycles	dummy code to implement delay
    2402.  00:5140  DD E1               	pop	ix			; 17 cycles
    2403.  00:5142  ED 6F               	rld				; 20 cycles
    2404.  00:5144  ED 67               	rrd				; 20 cycles
    2405.  00:5146                      
    2406.  00:5146  F6 20               	or	100000b		; set the percussion bit
    2407.  00:5148  D3 7D               	out	(FM_DATA),a
    2408.  00:514A                      	
    2409.  00:514A  C9                  	ret
    2410.  00:514B                      	
    2411.  00:514B                      
    2412.  00:514B                      ;------- Writes safe to the FM chip
    2413.  00:514B                      ; in :
    2414.  00:514B                      ;	[a]	Register# to write
    2415.  00:514B                      ;	[HL]	point to register (previous value is next in RAM)
    2416.  00:514B                      ;
    2417.  00:514B                      ; out:
    2418.  00:514B                      ;	[HL] points to previous value
    2419.  00:514B                      ;	[A]	contains register# written
    2420.  00:514B                      ;-----------
    2421.  00:514B                      _route_FM_reg8_update:
    2422.  00:514B  08                  	ex	af,af'
    2423.  00:514C  7E                  	ld	a,(hl)
    2424.  00:514D  C3 53 51            	jp	_rfr_cont
    2425.  00:5150                      	
    2426.  00:5150                      	
    2427.  00:5150                      ;------- Writes safe to the FM chip
    2428.  00:5150                      ; in :
    2429.  00:5150                      ;	[a]	Register# to write
    2430.  00:5150                      ;	[HL]	point to register (previous value is next in RAM)
    2431.  00:5150                      ;
    2432.  00:5150                      ; out:
    2433.  00:5150                      ;	[HL] points to previous value
    2434.  00:5150                      ;	[A]	contains register# written
    2435.  00:5150                      ;-----------
    2436.  00:5150                      _route_FM_reg16_update:
    2437.  00:5150  08                  	ex	af,af'
    2438.  00:5151  7E                  	ld	a,(hl)
    2439.  00:5152  23                  	inc	hl
    2440.  00:5153                      _rfr_cont:
    2441.  00:5153  23                  	inc	hl
    2442.  00:5154  BE                  	cp	(hl)	
    2443.  00:5155  CA 5F 51            	jp	z,99f		; no change in tone low value
    2444.  00:5158  08                  	ex	af,af'	
    2445.  00:5159  D3 7C               	out	(FM_WRITE),a
    2446.  00:515B  08                  	ex	af,af'
    2447.  00:515C  77                  	ld	(hl),a
    2448.  00:515D  D3 7D               	out	(FM_DATA),a	
    2449.  00:515F  08                  99:	ex	af,af'
    2450.  00:5160                      ;	dec	hl	
    2451.  00:5160  C9                  	ret
    2452.  00:5161                      	
    2453.  00:5161                      ;------- Writes a keyoff to the existing tone high register 
    2454.  00:5161                      ; in :
    2455.  00:5161                      ;	[A']	register# to write
    2456.  00:5161                      ;	[HL]	point to register (previous value is next in RAM)
    2457.  00:5161                      ;
    2458.  00:5161                      ; out:
    2459.  00:5161                      ;	[HL] points to same location
    2460.  00:5161                      ;	[A']	contains register# written
    2461.  00:5161                      ;-----------
    2462.  00:5161                      _route_FM_keyOff_update:
    2463.  00:5161  08                  	ex	af,af'
    2464.  00:5162  D3 7C               	out	(FM_WRITE),a
    2465.  00:5164  08                  	ex	af,af'		; 4 cycles	 '
    2466.  00:5165  7E                  	ld	a,(hl)
    2467.  00:5166  E6 EF               	and	11101111b	; erase keyON bit.
    2468.  00:5168  D3 7D               	out	(FM_DATA),a	
    2469.  00:516A  23                  	inc	hl
    2470.  00:516B  23                  	inc	hl
    2471.  00:516C  77                  	ld	(hl),a		; make sure to change old value to trigger update
    2472.  00:516D  2B                  	dec	hl
    2473.  00:516E  2B                  	dec	hl
    2474.  00:516F  C9                  	ret
    2475.  00:5170                      
    2476.  00:5170                      
    2477.  00:5170                      
    2478.  00:5170                      load_softwarevoice:
    2479.  00:5170                      	;-- Set the software voice data address
    2480.  00:5170  2A 07 C0            	ld 	hl,(replay_voicebase)
    2481.  00:5173  5F                  	ld	e,a
    2482.  00:5174  16 00               	ld	d,0
    2483.  00:5176  19                  	add	hl,de
    2484.  00:5177  19                  	add	hl,de
    2485.  00:5178  AF                  	xor	a		; set reg# 0
    2486.  00:5179                      
    2487.  00:5179                      
    2488.  00:5179                      
    2489.  00:5179                      .voiceupd_loop:
    2490.  00:5179                      
    2491.  00:5179  D3 7C               	out	(FM_WRITE),a
    2492.  00:517B  08                  	ex	af,af'		; 4 cycles	 '
    2493.  00:517C  7E                  	ld	a,(hl)		; 4 cycles 	
    2494.  00:517D  23                  	inc	hl			; 6 cycles
    2495.  00:517E  D3 7D               	out	(FM_DATA),a	
    2496.  00:5180                      
    2497.  00:5180  08                  	ex	af,af' 		; 4 cycles	'
    2498.  00:5181  3C                  	inc	a			; 4 cycles
    2499.  00:5182                      	
    2500.  00:5182  FE 08               	cp	8 			; 7 cycles
    2501.  00:5184                      	;--- delay
    2502.  00:5184  DD E5               	push 	ix			; 15 cycles
    2503.  00:5186  DD E1               	pop	ix			; 14 cycles
    2504.  00:5188  DD E5               	push 	ix			; 15 cycles
    2505.  00:518A  DD E1               	pop	ix			; 14 cycles
    2506.  00:518C                      		
    2507.  00:518C  DA 79 51            	jp	c,.voiceupd_loop 	; 10 cycles
    2508.  00:518F  C9                  	ret
    2509.  00:5190                      
    2510.  00:5190                      	
    2511.  00:5190                      
    2512.  00:5190                      	
    2513.  00:5190                      
    2514.  00:5190                      
     560   00:5190                      	include	"..\code\ttreplaySMSDAT.asm"
       1.  00:5190                      
       2.  00:5190                      
       3.  00:5190                      	; Balance setting space volume max - 8
       4.  00:5190  1E (128)            	ds 8*16, $1E
       5.  00:5210                      _VOLUME_TABLE
       6.  00:5210                      	; Combined volume table PSG/FM
       7.  00:5210                      ;	db	 $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F
       8.  00:5210                      ;	db	 $0F, $0F, $0F, $0F, $0F, $0F, $0F, $1F, $1F, $1F, $1F, $1F, $1F, $1F, $1F, $1E
       9.  00:5210                      ;	db	 $0F, $0F, $0F, $0F, $1F, $1F, $1F, $1F, $1F, $1F, $1F, $1F, $2F, $2F, $2E, $2D
      10.  00:5210                      ;	db	 $0F, $0F, $0F, $1F, $1F, $1F, $1F, $1F, $2F, $2F, $2F, $2F, $2F, $3E, $3D, $3C
      11.  00:5210                      ;	db	 $0F, $0F, $1F, $1F, $1F, $1F, $2F, $2F, $2F, $2F, $3F, $3F, $3E, $3D, $4C, $4B
      12.  00:5210                      ;	db	 $0F, $0F, $1F, $1F, $1F, $2F, $2F, $2F, $3F, $3F, $3F, $4E, $4D, $4C, $5B, $5A
      13.  00:5210                      ;	db	 $0F, $0F, $1F, $1F, $2F, $2F, $2F, $3F, $3F, $4F, $4E, $4D, $5C, $5B, $6A, $69
      14.  00:5210                      ;	db	 $0F, $0F, $1F, $1F, $2F, $2F, $3F, $3F, $4F, $4E, $5D, $5C, $6B, $6A, $79, $78
      15.  00:5210                      ;	db	 $0F, $1F, $1F, $2F, $2F, $3F, $3F, $4F, $4E, $5D, $5C, $6B, $6A, $79, $78, $87
      16.  00:5210                      ;	db	 $0F, $1F, $1F, $2F, $2F, $3F, $4F, $4E, $5D, $5C, $6B, $7A, $79, $88, $87, $96
      17.  00:5210                      ;	db	 $0F, $1F, $1F, $2F, $3F, $3F, $4E, $5D, $5C, $6B, $7A, $79, $88, $97, $96, $A5
      18.  00:5210                      ;	db	 $0F, $1F, $1F, $2F, $3F, $4E, $4D, $5C, $6B, $7A, $79, $88, $97, $A6, $A5, $B4
      19.  00:5210                      ;	db	 $0F, $1F, $2F, $2F, $3E, $4D, $5C, $6B, $6A, $79, $88, $97, $A6, $A5, $B4, $C3
      20.  00:5210                      ;	db	 $0F, $1F, $2F, $3E, $3D, $4C, $5B, $6A, $79, $88, $97, $A6, $A5, $B4, $C3, $D2
      21.  00:5210                      ;	db	 $0F, $1F, $2E, $3D, $4C, $5B, $6A, $79, $78, $87, $96, $A5, $B4, $C3, $D2, $E1
      22.  00:5210                      ;	db	 $0F, $1E, $2D, $3C, $4B, $5A, $69, $78, $87, $96, $A5, $B4, $C3, $D2, $E1, $F0
      23.  00:5210                      
      24.  00:5210                      	; Tail mode on (psg 1/ FM E)	
      25.  00:5210                      	db	 $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E
      25.  00:5210  1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 
      26.  00:5220                      	db	 $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E
      26.  00:5220  1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 
      27.  00:5230                      	db	 $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $2E, $2E, $2E, $2D
      27.  00:5230  1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 2E 2E 2E 2D 
      28.  00:5240                      	db	 $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $2E, $2E, $2E, $2E, $2E, $3E, $3D, $3C
      28.  00:5240  1E 1E 1E 1E 1E 1E 1E 1E 2E 2E 2E 2E 2E 3E 3D 3C 
      29.  00:5250                      	db	 $1E, $1E, $1E, $1E, $1E, $1E, $2E, $2E, $2E, $2E, $3E, $3E, $3E, $3D, $4C, $4B
      29.  00:5250  1E 1E 1E 1E 1E 1E 2E 2E 2E 2E 3E 3E 3E 3D 4C 4B 
      30.  00:5260                      	db	 $1E, $1E, $1E, $1E, $1E, $2E, $2E, $2E, $3E, $3E, $3E, $4E, $4D, $4C, $5B, $5A
      30.  00:5260  1E 1E 1E 1E 1E 2E 2E 2E 3E 3E 3E 4E 4D 4C 5B 5A 
      31.  00:5270                      	db	 $1E, $1E, $1E, $1E, $2E, $2E, $2E, $3E, $3E, $4E, $4E, $4D, $5C, $5B, $6A, $69
      31.  00:5270  1E 1E 1E 1E 2E 2E 2E 3E 3E 4E 4E 4D 5C 5B 6A 69 
      32.  00:5280                      	db	 $1E, $1E, $1E, $1E, $2E, $2E, $3E, $3E, $4E, $4E, $5D, $5C, $6B, $6A, $79, $78
      32.  00:5280  1E 1E 1E 1E 2E 2E 3E 3E 4E 4E 5D 5C 6B 6A 79 78 
      33.  00:5290                      	db	 $1E, $1E, $1E, $2E, $2E, $3E, $3E, $4E, $4E, $5D, $5C, $6B, $6A, $79, $78, $87
      33.  00:5290  1E 1E 1E 2E 2E 3E 3E 4E 4E 5D 5C 6B 6A 79 78 87 
      34.  00:52A0                      	db	 $1E, $1E, $1E, $2E, $2E, $3E, $4E, $4E, $5D, $5C, $6B, $7A, $79, $88, $87, $96
      34.  00:52A0  1E 1E 1E 2E 2E 3E 4E 4E 5D 5C 6B 7A 79 88 87 96 
      35.  00:52B0                      	db	 $1E, $1E, $1E, $2E, $3E, $3E, $4E, $5D, $5C, $6B, $7A, $79, $88, $97, $96, $A5
      35.  00:52B0  1E 1E 1E 2E 3E 3E 4E 5D 5C 6B 7A 79 88 97 96 A5 
      36.  00:52C0                      	db	 $1E, $1E, $1E, $2E, $3E, $4E, $4D, $5C, $6B, $7A, $79, $88, $97, $A6, $A5, $B4
      36.  00:52C0  1E 1E 1E 2E 3E 4E 4D 5C 6B 7A 79 88 97 A6 A5 B4 
      37.  00:52D0                      	db	 $1E, $1E, $2E, $2E, $3E, $4D, $5C, $6B, $6A, $79, $88, $97, $A6, $A5, $B4, $C3
      37.  00:52D0  1E 1E 2E 2E 3E 4D 5C 6B 6A 79 88 97 A6 A5 B4 C3 
      38.  00:52E0                      	db	 $1E, $1E, $2E, $3E, $3D, $4C, $5B, $6A, $79, $88, $97, $A6, $A5, $B4, $C3, $D2
      38.  00:52E0  1E 1E 2E 3E 3D 4C 5B 6A 79 88 97 A6 A5 B4 C3 D2 
      39.  00:52F0                      	db	 $1E, $1E, $2E, $3D, $4C, $5B, $6A, $79, $78, $87, $96, $A5, $B4, $C3, $D2, $E1
      39.  00:52F0  1E 1E 2E 3D 4C 5B 6A 79 78 87 96 A5 B4 C3 D2 E1 
      40.  00:5300                      	db	 $1E, $1E, $2D, $3C, $4B, $5A, $69, $78, $87, $96, $A5, $B4, $C3, $D2, $E1, $F0
      40.  00:5300  1E 1E 2D 3C 4B 5A 69 78 87 96 A5 B4 C3 D2 E1 F0 
      41.  00:5310                      
      42.  00:5310                      TRACK_ToneTable_PSG:	
      43.  00:5310  01 00               	dw $0001	     ; C1			
      44.  00:5312  01 00               	dw $0001	     ; C#1			
      45.  00:5314  01 00               	dw $0001	     ; D1			
      46.  00:5316  01 00               	dw $0001	     ; D#1			
      47.  00:5318  01 00               	dw $0001	     ; E1			
      48.  00:531A  01 00               	dw $0001	     ; F1			
      49.  00:531C  01 00               	dw $0001	     ; F#1			
      50.  00:531E  01 00               	dw $0001	     ; G1
      51.  00:5320  01 00               	dw $0001	     ; G#1	
      52.  00:5322  01 00               	dw $0001         ; A1
      53.  00:5324  01 00               	dw $0001         ; A#1/Bb1 
      54.  00:5326  01 00               	dw $0001         ; B1	
      55.  00:5328  01 00               	dw $0001	     ; C2			
      56.  00:532A  01 00               	dw $0001	     ; C#2			
      57.  00:532C  01 00               	dw $0001	     ; D2			
      58.  00:532E  01 00               	dw $0001	     ; D#2			
      59.  00:5330  01 00               	dw $0001	     ; E2			
      60.  00:5332  01 00               	dw $0001	     ; F2			
      61.  00:5334  01 00               	dw $0001	     ; F#2			
      62.  00:5336  01 00               	dw $0001	     ; G2
      63.  00:5338  01 00               	dw $0001	     ; G#2			
      64.  00:533A                         
      65.  00:533A  F9 03               	dw $03F9      ;A2
      66.  00:533C  C0 03               	dw $03C0      ; A#2/Bb2 
      67.  00:533E  8A 03               	dw $038A      ;B2
      68.  00:5340  57 03               	dw $0357      ;C3
      69.  00:5342  27 03               	dw $0327      ; C#3/Db3 
      70.  00:5344  FA 02               	dw $02FA      ;D3
      71.  00:5346  CF 02               	dw $02CF      ; D#3/Eb3 
      72.  00:5348  A7 02               	dw $02A7      ;E3
      73.  00:534A  81 02               	dw $0281      ;F3
      74.  00:534C  5D 02               	dw $025D      ; F#3/Gb3 
      75.  00:534E  3B 02               	dw $023B      ;G3
      76.  00:5350  1B 02               	dw $021B      ; G#3/Ab3 
      77.  00:5352  FC 01               	dw $01FC      ;A3
      78.  00:5354  E0 01               	dw $01E0      ; A#3/Bb3 
      79.  00:5356  C5 01               	dw $01C5      ;B3
      80.  00:5358  AC 01               	dw $01AC      ;C4
      81.  00:535A  94 01               	dw $0194      ; C#4/Db4 
      82.  00:535C  7D 01               	dw $017D      ;D4
      83.  00:535E  68 01               	dw $0168      ; D#4/Eb4 
      84.  00:5360  53 01               	dw $0153      ;E4
      85.  00:5362  40 01               	dw $0140      ;F4
      86.  00:5364  2E 01               	dw $012E      ; F#4/Gb4 
      87.  00:5366  1D 01               	dw $011D      ;G4
      88.  00:5368  0D 01               	dw $010D      ; G#4/Ab4 
      89.  00:536A  FE 00               	dw $00FE      ;A4
      90.  00:536C  F0 00               	dw $00F0      ; A#4/Bb4 
      91.  00:536E  E2 00               	dw $00E2      ;B4
      92.  00:5370  D6 00               	dw $00D6      ;C5
      93.  00:5372  CA 00               	dw $00CA      ; C#5/Db5 
      94.  00:5374  BE 00               	dw $00BE      ;D5
      95.  00:5376  B4 00               	dw $00B4      ; D#5/Eb5 
      96.  00:5378  AA 00               	dw $00AA      ;E5
      97.  00:537A  A0 00               	dw $00A0      ;F5
      98.  00:537C  97 00               	dw $0097      ; F#5/Gb5 
      99.  00:537E  8F 00               	dw $008F      ;G5
     100.  00:5380  87 00               	dw $0087      ; G#5/Ab5 
     101.  00:5382  7F 00               	dw $007F      ;A5
     102.  00:5384  78 00               	dw $0078      ; A#5/Bb5 
     103.  00:5386  71 00               	dw $0071      ;B5
     104.  00:5388  6B 00               	dw $006B      ;C6
     105.  00:538A  65 00               	dw $0065      ; C#6/Db6 
     106.  00:538C  5F 00               	dw $005F      ;D6
     107.  00:538E  5A 00               	dw $005A      ; D#6/Eb6 
     108.  00:5390  55 00               	dw $0055      ;E6
     109.  00:5392  50 00               	dw $0050      ;F6
     110.  00:5394  4C 00               	dw $004C      ; F#6/Gb6 
     111.  00:5396  47 00               	dw $0047      ;G6
     112.  00:5398  43 00               	dw $0043      ; G#6/Ab6 
     113.  00:539A  40 00               	dw $0040      ;A6
     114.  00:539C  3C 00               	dw $003C      ; A#6/Bb6 
     115.  00:539E  39 00               	dw $0039      ;B6
     116.  00:53A0  35 00               	dw $0035      ;C7
     117.  00:53A2  32 00               	dw $0032      ; C#7/Db7 
     118.  00:53A4  30 00               	dw $0030      ;D7
     119.  00:53A6  2D 00               	dw $002D      ; D#7/Eb7 
     120.  00:53A8  2A 00               	dw $002A      ;E7
     121.  00:53AA  28 00               	dw $0028      ;F7
     122.  00:53AC  26 00               	dw $0026      ; F#7/Gb7 
     123.  00:53AE  24 00               	dw $0024      ;G7
     124.  00:53B0  22 00               	dw $0022      ; G#7/Ab7 
     125.  00:53B2  20 00               	dw $0020      ;A7
     126.  00:53B4  1E 00               	dw $001E      ; A#7/Bb7 
     127.  00:53B6  1C 00               	dw $001C      ;B7
     128.  00:53B8  1B 00               	dw $001B      ;C8
     129.  00:53BA  19 00               	dw $0019      ; C#8/Db8 
     130.  00:53BC  18 00               	dw $0018      ;D8
     131.  00:53BE  16 00               	dw $0016      ; D#8/Eb8 
     132.  00:53C0  15 00               	dw $0015      ;E8
     133.  00:53C2  14 00               	dw $0014      ;F8
     134.  00:53C4  13 00               	dw $0013      ; F#8/Gb8 
     135.  00:53C6  12 00               	dw $0012      ;G8
     136.  00:53C8  11 00               	dw $0011      ; G#8/Ab8 
     137.  00:53CA  10 00               	dw $0010      ;A8
     138.  00:53CC  0F 00               	dw $000F      ; A#8/Bb8 
     139.  00:53CE  0E 00               	dw $000E      ;B8
     140.  00:53D0                      TRACK_ToneTable_FM:
     141.  00:53D0                      ;	db   	0,0
     142.  00:53D0                      	db	0adh,000h,0b7h,000h,0c2h,000h,0cdh,000h,0d9h,000h,0e6h,000h
     142.  00:53D0  AD 00 B7 00 C2 00 CD 00 D9 00 E6 00 
     143.  00:53DC                            db	0f4h,000h,003h,001h,012h,001h,022h,001h,034h,001h,046h,001h
     143.  00:53DC  F4 00 03 01 12 01 22 01 34 01 46 01 
     144.  00:53E8                            db    0adh,002h,0b7h,002h,0c2h,002h,0cdh,002h,0d9h,002h,0e6h,002h
     144.  00:53E8  AD 02 B7 02 C2 02 CD 02 D9 02 E6 02 
     145.  00:53F4                            db    0f4h,002h,003h,003h,012h,003h,022h,003h,034h,003h,046h,003h
     145.  00:53F4  F4 02 03 03 12 03 22 03 34 03 46 03 
     146.  00:5400                            db    0adh,004h,0b7h,004h,0c2h,004h,0cdh,004h,0d9h,004h,0e6h,004h
     146.  00:5400  AD 04 B7 04 C2 04 CD 04 D9 04 E6 04 
     147.  00:540C                            db    0f4h,004h,003h,005h,012h,005h,022h,005h,034h,005h,046h,005h
     147.  00:540C  F4 04 03 05 12 05 22 05 34 05 46 05 
     148.  00:5418                            db    0adh,006h,0b7h,006h,0c2h,006h,0cdh,006h,0d9h,006h,0e6h,006h
     148.  00:5418  AD 06 B7 06 C2 06 CD 06 D9 06 E6 06 
     149.  00:5424                            db    0f4h,006h,003h,007h,012h,007h,022h,007h,034h,007h,046h,007h
     149.  00:5424  F4 06 03 07 12 07 22 07 34 07 46 07 
     150.  00:5430                            db    0adh,008h,0b7h,008h,0c2h,008h,0cdh,008h,0d9h,008h,0e6h,008h
     150.  00:5430  AD 08 B7 08 C2 08 CD 08 D9 08 E6 08 
     151.  00:543C                            db    0f4h,008h,003h,009h,012h,009h,022h,009h,034h,009h,046h,009h
     151.  00:543C  F4 08 03 09 12 09 22 09 34 09 46 09 
     152.  00:5448                            db    0adh,00ah,0b7h,00ah,0c2h,00ah,0cdh,00ah,0d9h,00ah,0e6h,00ah
     152.  00:5448  AD 0A B7 0A C2 0A CD 0A D9 0A E6 0A 
     153.  00:5454                            db    0f4h,00ah,003h,00bh,012h,00bh,022h,00bh,034h,00bh,046h,00bh
     153.  00:5454  F4 0A 03 0B 12 0B 22 0B 34 0B 46 0B 
     154.  00:5460                            db    0adh,00ch,0b7h,00ch,0c2h,00ch,0cdh,00ch,0d9h,00ch,0e6h,00ch
     154.  00:5460  AD 0C B7 0C C2 0C CD 0C D9 0C E6 0C 
     155.  00:546C                            db    0f4h,00ch,003h,00dh,012h,00dh,022h,00dh,034h,00dh,046h,00dh
     155.  00:546C  F4 0C 03 0D 12 0D 22 0D 34 0D 46 0D 
     156.  00:5478                            db    0adh,00eh,0b7h,00eh,0c2h,00eh,0cdh,00eh,0d9h,00eh,0e6h,00eh
     156.  00:5478  AD 0E B7 0E C2 0E CD 0E D9 0E E6 0E 
     157.  00:5484                            db    0f4h,00eh,003h,00fh,012h,00fh,022h,00fh,034h,00fh,046h,00fh
     157.  00:5484  F4 0E 03 0F 12 0F 22 0F 34 0F 46 0F 
     158.  00:5490                      
     159.  00:5490                      
     160.  00:5490                      TRACK_Vibrato_sine:	; Sine table used for tremelo and vibrato
     161.  00:5490                            db 	$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00		      ; depth 	1
     161.  00:5490  00 00 00 00 00 00 00 00 00 00 01 01 01 01 01 01 
     161.  00:54A0  01 01 01 01 01 01 00 00 00 00 00 00 00 00 00 00 
     162.  00:54B0                            db 	$00,$00,$00,$00,$00,$00,$00,$01,$01,$01,$01,$01,$01,$02,$02,$02,$02,$02,$02,$01,$01,$01,$01,$01,$01,$00,$00,$00,$00,$00,$00,$00		      ; depth 	2
     162.  00:54B0  00 00 00 00 00 00 00 01 01 01 01 01 01 02 02 02 
     162.  00:54C0  02 02 02 01 01 01 01 01 01 00 00 00 00 00 00 00 
     163.  00:54D0                            db 	$00,$00,$00,$00,$00,$01,$01,$01,$01,$01,$02,$02,$02,$02,$03,$03,$03,$03,$02,$02,$02,$02,$01,$01,$01,$01,$01,$00,$00,$00,$00,$00		      ; depth 	3
     163.  00:54D0  00 00 00 00 00 01 01 01 01 01 02 02 02 02 03 03 
     163.  00:54E0  03 03 02 02 02 02 01 01 01 01 01 00 00 00 00 00 
     164.  00:54F0                            db 	$00,$00,$00,$00,$00,$01,$01,$01,$01,$02,$02,$02,$03,$03,$04,$04,$04,$04,$03,$03,$02,$02,$02,$01,$01,$01,$01,$00,$00,$00,$00,$00		      ; depth 	4
     164.  00:54F0  00 00 00 00 00 01 01 01 01 02 02 02 03 03 04 04 
     164.  00:5500  04 04 03 03 02 02 02 01 01 01 01 00 00 00 00 00 
     165.  00:5510                            db 	$00,$00,$00,$00,$01,$01,$01,$01,$02,$02,$03,$03,$04,$04,$05,$05,$05,$05,$04,$04,$03,$03,$02,$02,$01,$01,$01,$01,$00,$00,$00,$00		      ; depth 	5
     165.  00:5510  00 00 00 00 01 01 01 01 02 02 03 03 04 04 05 05 
     165.  00:5520  05 05 04 04 03 03 02 02 01 01 01 01 00 00 00 00 
     166.  00:5530                            db 	$00,$00,$00,$00,$01,$01,$01,$02,$02,$03,$03,$04,$04,$05,$05,$06,$06,$05,$05,$04,$04,$03,$03,$02,$02,$01,$01,$01,$00,$00,$00,$00		      ; depth 	6
     166.  00:5530  00 00 00 00 01 01 01 02 02 03 03 04 04 05 05 06 
     166.  00:5540  06 05 05 04 04 03 03 02 02 01 01 01 00 00 00 00 
     167.  00:5550                            db 	$00,$00,$00,$01,$01,$01,$02,$02,$03,$04,$04,$05,$06,$06,$07,$08,$08,$07,$06,$06,$05,$04,$04,$03,$02,$02,$01,$01,$01,$00,$00,$00		      ; depth 	7
     167.  00:5550  00 00 00 01 01 01 02 02 03 04 04 05 06 06 07 08 
     167.  00:5560  08 07 06 06 05 04 04 03 02 02 01 01 01 00 00 00 
     168.  00:5570                            db 	$00,$00,$01,$01,$01,$02,$03,$04,$05,$06,$07,$08,$09,$0A,$0C,$0D,$0D,$0C,$0A,$09,$08,$07,$06,$05,$04,$03,$02,$01,$01,$01,$00,$00		      ; depth 	8
     168.  00:5570  00 00 01 01 01 02 03 04 05 06 07 08 09 0A 0C 0D 
     168.  00:5580  0D 0C 0A 09 08 07 06 05 04 03 02 01 01 01 00 00 
     169.  00:5590                            db 	$00,$00,$01,$02,$02,$04,$05,$06,$08,$09,$0B,$0D,$0F,$11,$13,$15,$15,$13,$11,$0F,$0D,$0B,$09,$08,$06,$05,$04,$02,$02,$01,$00,$00		      ; depth 	9
     169.  00:5590  00 00 01 02 02 04 05 06 08 09 0B 0D 0F 11 13 15 
     169.  00:55A0  15 13 11 0F 0D 0B 09 08 06 05 04 02 02 01 00 00 
     170.  00:55B0                            db 	$00,$01,$01,$02,$04,$05,$07,$09,$0B,$0E,$10,$13,$16,$19,$1C,$1F,$1F,$1C,$19,$16,$13,$10,$0E,$0B,$09,$07,$05,$04,$02,$01,$01,$00		      ; depth 	A
     170.  00:55B0  00 01 01 02 04 05 07 09 0B 0E 10 13 16 19 1C 1F 
     170.  00:55C0  1F 1C 19 16 13 10 0E 0B 09 07 05 04 02 01 01 00 
     171.  00:55D0                            db 	$00,$01,$02,$03,$05,$08,$0B,$0E,$11,$15,$19,$1D,$21,$26,$2B,$2F,$2F,$2B,$26,$21,$1D,$19,$15,$11,$0E,$0B,$08,$05,$03,$02,$01,$00		      ; depth 	B
     171.  00:55D0  00 01 02 03 05 08 0B 0E 11 15 19 1D 21 26 2B 2F 
     171.  00:55E0  2F 2B 26 21 1D 19 15 11 0E 0B 08 05 03 02 01 00 
     172.  00:55F0                            db 	$01,$01,$03,$05,$07,$0B,$0E,$12,$17,$1C,$21,$27,$2D,$33,$39,$3F,$3F,$39,$33,$2D,$27,$21,$1C,$17,$12,$0E,$0B,$07,$05,$03,$01,$01		      ; depth 	C
     172.  00:55F0  01 01 03 05 07 0B 0E 12 17 1C 21 27 2D 33 39 3F 
     172.  00:5600  3F 39 33 2D 27 21 1C 17 12 0E 0B 07 05 03 01 01 
     561   00:5610                      ;	include	"..\ttsfxplay\ttsfxplay.asm"
     562   00:5610                      
     563   00:5610                      	
     564   00:5610                      demo_song:
     565   00:5610                      	include	".\demo_sms.asm"
       1.  00:5610                      ; Song: TT -TRIPLETS-SCC Converted to FM
       2.  00:5610                      ; By:   Gryzor87 (c)2021                
       3.  00:5610                      
       4.  00:5610                      ; [ Song start data ]
       5.  00:5610  06                  	db $06					; Initial song speed.
       6.  00:5611  63 56               	dw .customvoice_start-8			; Start of the custom voices data.
       7.  00:5613  7B 56               	dw .drummacro_start				; Start of the drum macro data.
       8.  00:5615  81 56               	dw .instrument_start			; Start of the instrument data.
       9.  00:5617                      
      10.  00:5617                      ; [ Song order pointer list ]
      11.  00:5617                      .restart:
      12.  00:5617                      ;	dw .track_000, .track_000, .track_002, .track_002, .track_004, .track_005, .track_000, .track_000	; Step:001 Pattern:000
      13.  00:5617                      	dw .track_008, .track_009, .track_010, .track_011, .track_012, .track_013, .track_014, .track_015	; Step:002 Pattern:001
      13.  00:5617  52 58 9F 58 C5 58 C7 58 EF 58 16 59 35 59 54 59 
      14.  00:5627                      	dw .track_008, .track_009, .track_010, .track_011, .track_012, .track_013, .track_014, .track_015	; Step:003 Pattern:001
      14.  00:5627  52 58 9F 58 C5 58 C7 58 EF 58 16 59 35 59 54 59 
      15.  00:5637                      	dw .track_016, .track_017, .track_010, .track_011, .track_012, .track_021, .track_022, .track_023	; Step:004 Pattern:002
      15.  00:5637  7B 59 D3 59 C5 58 C7 58 EF 58 F9 59 1B 5A 73 5A 
      16.  00:5647                      	dw .track_016, .track_017, .track_010, .track_011, .track_012, .track_021, .track_022, .track_023	; Step:005 Pattern:002
      16.  00:5647  7B 59 D3 59 C5 58 C7 58 EF 58 F9 59 1B 5A 73 5A 
      17.  00:5657                      	dw .track_008, .track_009, .track_010, .track_011, .track_012, .track_013, .track_014, .track_015	; Step:006 Pattern:001
      17.  00:5657  52 58 9F 58 C5 58 C7 58 EF 58 16 59 35 59 54 59 
      18.  00:5667                      ;	dw .track_024, .track_025, .track_010, .track_027, .track_028, .track_029, .track_030, .track_031	; Step:007 Pattern:003
      19.  00:5667  00 00 17 56         	dw 0x0000, .restart				; End of sequence delimiter + restart address.
      20.  00:566B                      
      21.  00:566B                      
      22.  00:566B                      
      23.  00:566B                      ; [ Custom FM voices ]
      24.  00:566B                      .customvoice_start:
      25.  00:566B                      	db $10,$14,$00,$04,$f1,$f1,$f1,$11 		; Custom voice:61
      25.  00:566B  10 14 00 04 F1 F1 F1 11 
      26.  00:5673                      	db $61,$62,$0e,$06,$f5,$f2,$0f,$fe 		; Custom voice:182
      26.  00:5673  61 62 0E 06 F5 F2 0F FE 
      27.  00:567B                      
      28.  00:567B                      ; [ SCC Waveforms ]
      29.  00:567B                      .waveform_start:
      30.  00:567B                      
      31.  00:567B                      ; [ FM Drum macros]
      32.  00:567B                      .drummacro_start:
      33.  00:567B  81 56               	dw .drum_00
      34.  00:567D  81 56               	dw .drum_01
      35.  00:567F  81 56               	dw .drum_04
      36.  00:5681                      
      37.  00:5681                      .drum_00:
      38.  00:5681                      
      39.  00:5681                      .drum_01:
      40.  00:5681                      
      41.  00:5681                      .drum_04:
      42.  00:5681                      
      43.  00:5681                      ; [ Instruments]
      44.  00:5681                      .instrument_start:
      45.  00:5681  99 56               	dw .instrument_00				; SD A3           
      46.  00:5683  C4 56               	dw .instrument_01				; HH CL A8        
      47.  00:5685  CD 56               	dw .instrument_02				; TOM             
      48.  00:5687  02 57               	dw .instrument_03				; GTR CHORDS      
      49.  00:5689  08 57               	dw .instrument_04				; SC String solo  
      50.  00:568B  0E 57               	dw .instrument_05				; SC Bass         
      51.  00:568D  1E 57               	dw .instrument_06				; SC Brass Satan  
      52.  00:568F  24 57               	dw .instrument_07				; ARP SQ          
      53.  00:5691  33 57               	dw .instrument_08				; Clarinet low    
      54.  00:5693  38 57               	dw .instrument_09				; Response BELL   
      55.  00:5695  50 57               	dw .instrument_10				; HH OP A8        
      56.  00:5697  80 57               	dw .instrument_11				; SD-MAIN         
      57.  00:5699                      
      58.  00:5699                      .instrument_00:					; SD A3           
      59.  00:5699  10                  	db $10					; FM Hardware Voice 1
      60.  00:569A  28                  	db $28			; Info byte: 00101000
      61.  00:569B  0F                  	db $0f			; Volume _
      62.  00:569C  C8                  	db $c8			; Info byte: 11001000
      63.  00:569D  0C                  	db $0c			; Volume _
      64.  00:569E  00                  	db $00			; Noise
      65.  00:569F  06                  	db $06			; Noise volume
      66.  00:56A0  C8                  	db $c8			; Info byte: 11001000
      67.  00:56A1  0B                  	db $0b			; Volume _
      68.  00:56A2  00                  	db $00			; Noise
      69.  00:56A3  06                  	db $06			; Noise volume
      70.  00:56A4  C8                  	db $c8			; Info byte: 11001000
      71.  00:56A5  0A                  	db $0a			; Volume _
      72.  00:56A6  00                  	db $00			; Noise
      73.  00:56A7  06                  	db $06			; Noise volume
      74.  00:56A8  C8                  	db $c8			; Info byte: 11001000
      75.  00:56A9  09                  	db $09			; Volume _
      76.  00:56AA  00                  	db $00			; Noise
      77.  00:56AB  06                  	db $06			; Noise volume
      78.  00:56AC  C8                  	db $c8			; Info byte: 11001000
      79.  00:56AD  08                  	db $08			; Volume _
      80.  00:56AE  00                  	db $00			; Noise
      81.  00:56AF  06                  	db $06			; Noise volume
      82.  00:56B0  C8                  	db $c8			; Info byte: 11001000
      83.  00:56B1  07                  	db $07			; Volume _
      84.  00:56B2  00                  	db $00			; Noise
      85.  00:56B3  06                  	db $06			; Noise volume
      86.  00:56B4  C8                  	db $c8			; Info byte: 11001000
      87.  00:56B5  06                  	db $06			; Volume _
      88.  00:56B6  00                  	db $00			; Noise
      89.  00:56B7  06                  	db $06			; Noise volume
      90.  00:56B8  C8                  	db $c8			; Info byte: 11001000
      91.  00:56B9  05                  	db $05			; Volume _
      92.  00:56BA  00                  	db $00			; Noise
      93.  00:56BB  06                  	db $06			; Noise volume
      94.  00:56BC  C8                  	db $c8			; Info byte: 11001000
      95.  00:56BD  04                  	db $04			; Volume _
      96.  00:56BE  00                  	db $00			; Noise
      97.  00:56BF  06                  	db $06			; Noise volume
      98.  00:56C0                      .rst_i00:
      99.  00:56C0  09                  	db $09			; Info byte: 00001001
     100.  00:56C1  00                  	db $00			; Volume _
     101.  00:56C2  C0 56               	dw .rst_i00						; Loop address
     102.  00:56C4                      .instrument_01:					; HH CL A8        
     103.  00:56C4  70                  	db $70					; FM Hardware Voice 7
     104.  00:56C5  E8                  	db $e8			; Info byte: 11101000
     105.  00:56C6  0B                  	db $0b			; Volume _
     106.  00:56C7  04                  	db $04			; Noise
     107.  00:56C8  0F                  	db $0f			; Noise volume
     108.  00:56C9                      .rst_i01:
     109.  00:56C9  09                  	db $09			; Info byte: 00001001
     110.  00:56CA  00                  	db $00			; Volume _
     111.  00:56CB  C9 56               	dw .rst_i01						; Loop address
     112.  00:56CD                      .instrument_02:					; TOM             
     113.  00:56CD  10                  	db $10					; FM Hardware Voice 1
     114.  00:56CE  38                  	db $38			; Info byte: 00111000
     115.  00:56CF  0F                  	db $0f			; Volume _
     116.  00:56D0  20 00               	dw $0020			; Tone
     117.  00:56D2  38                  	db $38			; Info byte: 00111000
     118.  00:56D3  0D                  	db $0d			; Volume _
     119.  00:56D4  20 00               	dw $0020			; Tone
     120.  00:56D6  3C                  	db $3c			; Info byte: 00111100
     121.  00:56D7  FF                  	db $ff			; Volume -
     122.  00:56D8  20 00               	dw $0020			; Tone
     123.  00:56DA  30                  	db $30			; Info byte: 00110000
     124.  00:56DB  20 00               	dw $0020			; Tone
     125.  00:56DD  3C                  	db $3c			; Info byte: 00111100
     126.  00:56DE  FF                  	db $ff			; Volume -
     127.  00:56DF  20 00               	dw $0020			; Tone
     128.  00:56E1  30                  	db $30			; Info byte: 00110000
     129.  00:56E2  20 00               	dw $0020			; Tone
     130.  00:56E4  3C                  	db $3c			; Info byte: 00111100
     131.  00:56E5  FF                  	db $ff			; Volume -
     132.  00:56E6  20 00               	dw $0020			; Tone
     133.  00:56E8  30                  	db $30			; Info byte: 00110000
     134.  00:56E9  20 00               	dw $0020			; Tone
     135.  00:56EB  30                  	db $30			; Info byte: 00110000
     136.  00:56EC  20 00               	dw $0020			; Tone
     137.  00:56EE  3C                  	db $3c			; Info byte: 00111100
     138.  00:56EF  FF                  	db $ff			; Volume -
     139.  00:56F0  20 00               	dw $0020			; Tone
     140.  00:56F2  3C                  	db $3c			; Info byte: 00111100
     141.  00:56F3  FF                  	db $ff			; Volume -
     142.  00:56F4  20 00               	dw $0020			; Tone
     143.  00:56F6  3C                  	db $3c			; Info byte: 00111100
     144.  00:56F7  FF                  	db $ff			; Volume -
     145.  00:56F8  20 00               	dw $0020			; Tone
     146.  00:56FA  3C                  	db $3c			; Info byte: 00111100
     147.  00:56FB  FF                  	db $ff			; Volume -
     148.  00:56FC  20 00               	dw $0020			; Tone
     149.  00:56FE                      .rst_i02:
     150.  00:56FE  09                  	db $09			; Info byte: 00001001
     151.  00:56FF  00                  	db $00			; Volume _
     152.  00:5700  FE 56               	dw .rst_i02						; Loop address
     153.  00:5702                      .instrument_03:					; GTR CHORDS      
     154.  00:5702  00 04               	db $00,$04					; FM Software Voice 0
     155.  00:5704                      .rst_i03:
     156.  00:5704  29                  	db $29			; Info byte: 00101001
     157.  00:5705  0F                  	db $0f			; Volume _
     158.  00:5706  04 57               	dw .rst_i03						; Loop address
     159.  00:5708                      .instrument_04:					; SC String solo  
     160.  00:5708  00 08               	db $00,$08					; FM Software Voice 1
     161.  00:570A                      .rst_i04:
     162.  00:570A  29                  	db $29			; Info byte: 00101001
     163.  00:570B  0F                  	db $0f			; Volume _
     164.  00:570C  0A 57               	dw .rst_i04						; Loop address
     165.  00:570E                      .instrument_05:					; SC Bass         
     166.  00:570E  E0                  	db $e0					; FM Hardware Voice 14
     167.  00:570F  28                  	db $28			; Info byte: 00101000
     168.  00:5710  0F                  	db $0f			; Volume _
     169.  00:5711  28                  	db $28			; Info byte: 00101000
     170.  00:5712  0F                  	db $0f			; Volume _
     171.  00:5713  28                  	db $28			; Info byte: 00101000
     172.  00:5714  0F                  	db $0f			; Volume _
     173.  00:5715  28                  	db $28			; Info byte: 00101000
     174.  00:5716  0F                  	db $0f			; Volume _
     175.  00:5717                      .rst_i05:
     176.  00:5717  2C                  	db $2c			; Info byte: 00101100
     177.  00:5718  FF                  	db $ff			; Volume -
     178.  00:5719  20                  	db $20			; Info byte: 00100000
     179.  00:571A  20                  	db $20			; Info byte: 00100000
     180.  00:571B  21                  	db $21			; Info byte: 00100001
     181.  00:571C  17 57               	dw .rst_i05						; Loop address
     182.  00:571E                      .instrument_06:					; SC Brass Satan  
     183.  00:571E  00 04               	db $00,$04					; FM Software Voice 0
     184.  00:5720                      .rst_i06:
     185.  00:5720  29                  	db $29			; Info byte: 00101001
     186.  00:5721  0F                  	db $0f			; Volume _
     187.  00:5722  20 57               	dw .rst_i06						; Loop address
     188.  00:5724                      .instrument_07:					; ARP SQ          
     189.  00:5724  C0                  	db $c0					; FM Hardware Voice 12
     190.  00:5725  28                  	db $28			; Info byte: 00101000
     191.  00:5726  0E                  	db $0e			; Volume _
     192.  00:5727  28                  	db $28			; Info byte: 00101000
     193.  00:5728  0E                  	db $0e			; Volume _
     194.  00:5729  28                  	db $28			; Info byte: 00101000
     195.  00:572A  0E                  	db $0e			; Volume _
     196.  00:572B  28                  	db $28			; Info byte: 00101000
     197.  00:572C  0E                  	db $0e			; Volume _
     198.  00:572D  28                  	db $28			; Info byte: 00101000
     199.  00:572E  0E                  	db $0e			; Volume _
     200.  00:572F                      .rst_i07:
     201.  00:572F  09                  	db $09			; Info byte: 00001001
     202.  00:5730  00                  	db $00			; Volume _
     203.  00:5731  2F 57               	dw .rst_i07						; Loop address
     204.  00:5733                      .instrument_08:					; Clarinet low    
     205.  00:5733  50                  	db $50					; FM Hardware Voice 5
     206.  00:5734                      .rst_i08:
     207.  00:5734  29                  	db $29			; Info byte: 00101001
     208.  00:5735  0D                  	db $0d			; Volume _
     209.  00:5736  34 57               	dw .rst_i08						; Loop address
     210.  00:5738                      .instrument_09:					; Response BELL   
     211.  00:5738  D0                  	db $d0					; FM Hardware Voice 13
     212.  00:5739  28                  	db $28			; Info byte: 00101000
     213.  00:573A  0D                  	db $0d			; Volume _
     214.  00:573B  28                  	db $28			; Info byte: 00101000
     215.  00:573C  0B                  	db $0b			; Volume _
     216.  00:573D  28                  	db $28			; Info byte: 00101000
     217.  00:573E  0A                  	db $0a			; Volume _
     218.  00:573F                      .rst_i09:
     219.  00:573F  2C                  	db $2c			; Info byte: 00101100
     220.  00:5740  FF                  	db $ff			; Volume -
     221.  00:5741  20                  	db $20			; Info byte: 00100000
     222.  00:5742  20                  	db $20			; Info byte: 00100000
     223.  00:5743  20                  	db $20			; Info byte: 00100000
     224.  00:5744  20                  	db $20			; Info byte: 00100000
     225.  00:5745  20                  	db $20			; Info byte: 00100000
     226.  00:5746  2C                  	db $2c			; Info byte: 00101100
     227.  00:5747  01                  	db $01			; Volume +
     228.  00:5748  20                  	db $20			; Info byte: 00100000
     229.  00:5749  20                  	db $20			; Info byte: 00100000
     230.  00:574A  20                  	db $20			; Info byte: 00100000
     231.  00:574B  20                  	db $20			; Info byte: 00100000
     232.  00:574C  2D                  	db $2d			; Info byte: 00101101
     233.  00:574D  FF                  	db $ff			; Volume -
     234.  00:574E  3F 57               	dw .rst_i09						; Loop address
     235.  00:5750                      .instrument_10:					; HH OP A8        
     236.  00:5750  01                  	db $01					; FM Hardware Voice was not set
     237.  00:5751  C8                  	db $c8			; Info byte: 11001000
     238.  00:5752  0E                  	db $0e			; Volume _
     239.  00:5753  04                  	db $04			; Noise
     240.  00:5754  08                  	db $08			; Noise volume
     241.  00:5755  CC                  	db $cc			; Info byte: 11001100
     242.  00:5756  FF                  	db $ff			; Volume -
     243.  00:5757  04                  	db $04			; Noise
     244.  00:5758  08                  	db $08			; Noise volume
     245.  00:5759  C0                  	db $c0			; Info byte: 11000000
     246.  00:575A  04                  	db $04			; Noise
     247.  00:575B  07                  	db $07			; Noise volume
     248.  00:575C  C0                  	db $c0			; Info byte: 11000000
     249.  00:575D  04                  	db $04			; Noise
     250.  00:575E  07                  	db $07			; Noise volume
     251.  00:575F  C0                  	db $c0			; Info byte: 11000000
     252.  00:5760  04                  	db $04			; Noise
     253.  00:5761  06                  	db $06			; Noise volume
     254.  00:5762  C8                  	db $c8			; Info byte: 11001000
     255.  00:5763  00                  	db $00			; Volume _
     256.  00:5764  04                  	db $04			; Noise
     257.  00:5765  06                  	db $06			; Noise volume
     258.  00:5766  C8                  	db $c8			; Info byte: 11001000
     259.  00:5767  00                  	db $00			; Volume _
     260.  00:5768  04                  	db $04			; Noise
     261.  00:5769  05                  	db $05			; Noise volume
     262.  00:576A  C8                  	db $c8			; Info byte: 11001000
     263.  00:576B  00                  	db $00			; Volume _
     264.  00:576C  04                  	db $04			; Noise
     265.  00:576D  05                  	db $05			; Noise volume
     266.  00:576E  C8                  	db $c8			; Info byte: 11001000
     267.  00:576F  00                  	db $00			; Volume _
     268.  00:5770  04                  	db $04			; Noise
     269.  00:5771  04                  	db $04			; Noise volume
     270.  00:5772  C8                  	db $c8			; Info byte: 11001000
     271.  00:5773  00                  	db $00			; Volume _
     272.  00:5774  04                  	db $04			; Noise
     273.  00:5775  04                  	db $04			; Noise volume
     274.  00:5776  C8                  	db $c8			; Info byte: 11001000
     275.  00:5777  00                  	db $00			; Volume _
     276.  00:5778  04                  	db $04			; Noise
     277.  00:5779  03                  	db $03			; Noise volume
     278.  00:577A                      .rst_i10:
     279.  00:577A  C9                  	db $c9			; Info byte: 11001001
     280.  00:577B  00                  	db $00			; Volume _
     281.  00:577C  04                  	db $04			; Noise
     282.  00:577D  03                  	db $03			; Noise volume
     283.  00:577E  7A 57               	dw .rst_i10						; Loop address
     284.  00:5780                      .instrument_11:					; SD-MAIN         
     285.  00:5780  10                  	db $10					; FM Hardware Voice 1
     286.  00:5781  28                  	db $28			; Info byte: 00101000
     287.  00:5782  0E                  	db $0e			; Volume _
     288.  00:5783  C8                  	db $c8			; Info byte: 11001000
     289.  00:5784  0C                  	db $0c			; Volume _
     290.  00:5785  06                  	db $06			; Noise
     291.  00:5786  0C                  	db $0c			; Noise volume
     292.  00:5787  C8                  	db $c8			; Info byte: 11001000
     293.  00:5788  0A                  	db $0a			; Volume _
     294.  00:5789  05                  	db $05			; Noise
     295.  00:578A  0A                  	db $0a			; Noise volume
     296.  00:578B  C8                  	db $c8			; Info byte: 11001000
     297.  00:578C  0A                  	db $0a			; Volume _
     298.  00:578D  05                  	db $05			; Noise
     299.  00:578E  0A                  	db $0a			; Noise volume
     300.  00:578F  C8                  	db $c8			; Info byte: 11001000
     301.  00:5790  09                  	db $09			; Volume _
     302.  00:5791  05                  	db $05			; Noise
     303.  00:5792  09                  	db $09			; Noise volume
     304.  00:5793  C8                  	db $c8			; Info byte: 11001000
     305.  00:5794  09                  	db $09			; Volume _
     306.  00:5795  05                  	db $05			; Noise
     307.  00:5796  08                  	db $08			; Noise volume
     308.  00:5797  C8                  	db $c8			; Info byte: 11001000
     309.  00:5798  08                  	db $08			; Volume _
     310.  00:5799  04                  	db $04			; Noise
     311.  00:579A  07                  	db $07			; Noise volume
     312.  00:579B  C8                  	db $c8			; Info byte: 11001000
     313.  00:579C  08                  	db $08			; Volume _
     314.  00:579D  04                  	db $04			; Noise
     315.  00:579E  06                  	db $06			; Noise volume
     316.  00:579F  C8                  	db $c8			; Info byte: 11001000
     317.  00:57A0  07                  	db $07			; Volume _
     318.  00:57A1  04                  	db $04			; Noise
     319.  00:57A2  05                  	db $05			; Noise volume
     320.  00:57A3  C8                  	db $c8			; Info byte: 11001000
     321.  00:57A4  07                  	db $07			; Volume _
     322.  00:57A5  04                  	db $04			; Noise
     323.  00:57A6  04                  	db $04			; Noise volume
     324.  00:57A7                      .rst_i11:
     325.  00:57A7  09                  	db $09			; Info byte: 00001001
     326.  00:57A8  00                  	db $00			; Volume _
     327.  00:57A9  A7 57               	dw .rst_i11						; Loop address
     328.  00:57AB                      
     329.  00:57AB                      ; [ Song track data ]
     330.  00:57AB                      .track_000:
     331.  00:57AB  60                  	db $60			;Release 96
     332.  00:57AC  DF                  	db $df			;Wait 32
     333.  00:57AD  BF                  	db $bf			;[End-Of-Track]
     334.  00:57AE                      .track_002:
     335.  00:57AE  DF                  	db $df			;Wait 32
     336.  00:57AF  BF                  	db $bf			;[End-Of-Track]
     337.  00:57B0                      .track_004:
     338.  00:57B0  52                  	db $52			;Note A#7
     339.  00:57B1  6F                  	db $6f			;Volume 14
     340.  00:57B2  78                  	db $78			;Instrument 7
     341.  00:57B3  C0                  	db $c0			;Wait 1
     342.  00:57B4  4F                  	db $4f			;Note G-7
     343.  00:57B5  9A 02               	db $9a,$02			;CMD Note delay
     344.  00:57B7                      					;Wait Repeat 1
     345.  00:57B7  4D                  	db $4d			;Note F-7
     346.  00:57B8  9A 03               	db $9a,$03			;CMD Note delay
     347.  00:57BA  C1                  	db $c1			;Wait 2
     348.  00:57BB  4A                  	db $4a			;Note D-7
     349.  00:57BC  C0                  	db $c0			;Wait 1
     350.  00:57BD  46                  	db $46			;Note A#6
     351.  00:57BE  9A 02               	db $9a,$02			;CMD Note delay
     352.  00:57C0                      					;Wait Repeat 1
     353.  00:57C0  43                  	db $43			;Note G-6
     354.  00:57C1  9A 03               	db $9a,$03			;CMD Note delay
     355.  00:57C3  C1                  	db $c1			;Wait 2
     356.  00:57C4  52                  	db $52			;Note A#7
     357.  00:57C5  6B                  	db $6b			;Volume 10
     358.  00:57C6  A1 08               	db $a1,$08			;CMD Track detune
     359.  00:57C8  C0                  	db $c0			;Wait 1
     360.  00:57C9  4F                  	db $4f			;Note G-7
     361.  00:57CA  9A 02               	db $9a,$02			;CMD Note delay
     362.  00:57CC                      					;Wait Repeat 1
     363.  00:57CC  4D                  	db $4d			;Note F-7
     364.  00:57CD  9A 03               	db $9a,$03			;CMD Note delay
     365.  00:57CF  C1                  	db $c1			;Wait 2
     366.  00:57D0  4A                  	db $4a			;Note D-7
     367.  00:57D1  C0                  	db $c0			;Wait 1
     368.  00:57D2  46                  	db $46			;Note A#6
     369.  00:57D3  9A 02               	db $9a,$02			;CMD Note delay
     370.  00:57D5                      					;Wait Repeat 1
     371.  00:57D5  43                  	db $43			;Note G-6
     372.  00:57D6  9A 03               	db $9a,$03			;CMD Note delay
     373.  00:57D8  C1                  	db $c1			;Wait 2
     374.  00:57D9  52                  	db $52			;Note A#7
     375.  00:57DA  6B                  	db $6b			;Volume 10
     376.  00:57DB  A6 50               	db $a6,$50			;CMD Channel setup
     377.  00:57DD  C0                  	db $c0			;Wait 1
     378.  00:57DE  4F                  	db $4f			;Note G-7
     379.  00:57DF  9A 02               	db $9a,$02			;CMD Note delay
     380.  00:57E1                      					;Wait Repeat 1
     381.  00:57E1  4D                  	db $4d			;Note F-7
     382.  00:57E2  9A 03               	db $9a,$03			;CMD Note delay
     383.  00:57E4  C1                  	db $c1			;Wait 2
     384.  00:57E5  4A                  	db $4a			;Note D-7
     385.  00:57E6  C0                  	db $c0			;Wait 1
     386.  00:57E7  46                  	db $46			;Note A#6
     387.  00:57E8  9A 02               	db $9a,$02			;CMD Note delay
     388.  00:57EA                      					;Wait Repeat 1
     389.  00:57EA  43                  	db $43			;Note G-6
     390.  00:57EB  9A 03               	db $9a,$03			;CMD Note delay
     391.  00:57ED  C1                  	db $c1			;Wait 2
     392.  00:57EE  52                  	db $52			;Note A#7
     393.  00:57EF  67                  	db $67			;Volume 6
     394.  00:57F0  A1 08               	db $a1,$08			;CMD Track detune
     395.  00:57F2  C0                  	db $c0			;Wait 1
     396.  00:57F3  4F                  	db $4f			;Note G-7
     397.  00:57F4  9A 02               	db $9a,$02			;CMD Note delay
     398.  00:57F6                      					;Wait Repeat 1
     399.  00:57F6  4D                  	db $4d			;Note F-7
     400.  00:57F7  9A 03               	db $9a,$03			;CMD Note delay
     401.  00:57F9  C1                  	db $c1			;Wait 2
     402.  00:57FA  4A                  	db $4a			;Note D-7
     403.  00:57FB  C0                  	db $c0			;Wait 1
     404.  00:57FC  46                  	db $46			;Note A#6
     405.  00:57FD  9A 02               	db $9a,$02			;CMD Note delay
     406.  00:57FF                      					;Wait Repeat 1
     407.  00:57FF  43                  	db $43			;Note G-6
     408.  00:5800  9A 03               	db $9a,$03			;CMD Note delay
     409.  00:5802  C1                  	db $c1			;Wait 2
     410.  00:5803  BF                  	db $bf			;[End-Of-Track]
     411.  00:5804                      .track_005:
     412.  00:5804  60                  	db $60			;Release 96
     413.  00:5805  C2                  	db $c2			;Wait 3
     414.  00:5806  52                  	db $52			;Note A#7
     415.  00:5807  67                  	db $67			;Volume 6
     416.  00:5808  78                  	db $78			;Instrument 7
     417.  00:5809  C0                  	db $c0			;Wait 1
     418.  00:580A  4F                  	db $4f			;Note G-7
     419.  00:580B  9A 02               	db $9a,$02			;CMD Note delay
     420.  00:580D                      					;Wait Repeat 1
     421.  00:580D  4D                  	db $4d			;Note F-7
     422.  00:580E  9A 03               	db $9a,$03			;CMD Note delay
     423.  00:5810  C1                  	db $c1			;Wait 2
     424.  00:5811  4A                  	db $4a			;Note D-7
     425.  00:5812  C0                  	db $c0			;Wait 1
     426.  00:5813  46                  	db $46			;Note A#6
     427.  00:5814  9A 02               	db $9a,$02			;CMD Note delay
     428.  00:5816                      					;Wait Repeat 1
     429.  00:5816  43                  	db $43			;Note G-6
     430.  00:5817  9A 03               	db $9a,$03			;CMD Note delay
     431.  00:5819  C1                  	db $c1			;Wait 2
     432.  00:581A  52                  	db $52			;Note A#7
     433.  00:581B  66                  	db $66			;Volume 5
     434.  00:581C  A1 08               	db $a1,$08			;CMD Track detune
     435.  00:581E  C0                  	db $c0			;Wait 1
     436.  00:581F  4F                  	db $4f			;Note G-7
     437.  00:5820  9A 02               	db $9a,$02			;CMD Note delay
     438.  00:5822                      					;Wait Repeat 1
     439.  00:5822  4D                  	db $4d			;Note F-7
     440.  00:5823  9A 03               	db $9a,$03			;CMD Note delay
     441.  00:5825  C1                  	db $c1			;Wait 2
     442.  00:5826  4A                  	db $4a			;Note D-7
     443.  00:5827  C0                  	db $c0			;Wait 1
     444.  00:5828  46                  	db $46			;Note A#6
     445.  00:5829  9A 02               	db $9a,$02			;CMD Note delay
     446.  00:582B                      					;Wait Repeat 1
     447.  00:582B  43                  	db $43			;Note G-6
     448.  00:582C  9A 03               	db $9a,$03			;CMD Note delay
     449.  00:582E  C1                  	db $c1			;Wait 2
     450.  00:582F  52                  	db $52			;Note A#7
     451.  00:5830  65                  	db $65			;Volume 4
     452.  00:5831  A6 50               	db $a6,$50			;CMD Channel setup
     453.  00:5833  C0                  	db $c0			;Wait 1
     454.  00:5834  4F                  	db $4f			;Note G-7
     455.  00:5835  9A 02               	db $9a,$02			;CMD Note delay
     456.  00:5837                      					;Wait Repeat 1
     457.  00:5837  4D                  	db $4d			;Note F-7
     458.  00:5838  9A 03               	db $9a,$03			;CMD Note delay
     459.  00:583A  C1                  	db $c1			;Wait 2
     460.  00:583B  4A                  	db $4a			;Note D-7
     461.  00:583C  C0                  	db $c0			;Wait 1
     462.  00:583D  46                  	db $46			;Note A#6
     463.  00:583E  9A 02               	db $9a,$02			;CMD Note delay
     464.  00:5840                      					;Wait Repeat 1
     465.  00:5840  43                  	db $43			;Note G-6
     466.  00:5841  9A 03               	db $9a,$03			;CMD Note delay
     467.  00:5843  C1                  	db $c1			;Wait 2
     468.  00:5844  52                  	db $52			;Note A#7
     469.  00:5845  64                  	db $64			;Volume 3
     470.  00:5846  A1 08               	db $a1,$08			;CMD Track detune
     471.  00:5848  C0                  	db $c0			;Wait 1
     472.  00:5849  4F                  	db $4f			;Note G-7
     473.  00:584A  9A 02               	db $9a,$02			;CMD Note delay
     474.  00:584C                      					;Wait Repeat 1
     475.  00:584C  4D                  	db $4d			;Note F-7
     476.  00:584D  9A 03               	db $9a,$03			;CMD Note delay
     477.  00:584F  C1                  	db $c1			;Wait 2
     478.  00:5850  4A                  	db $4a			;Note D-7
     479.  00:5851  BF                  	db $bf			;[End-Of-Track]
     480.  00:5852                      .track_008:
     481.  00:5852  9C 01               	db $9c,$01			;CMD Drum $01
     482.  00:5854  C3                  	db $c3			;Wait 4
     483.  00:5855  5D                  	db $5d			;Note A-8
     484.  00:5856  6D                  	db $6d			;Volume 12
     485.  00:5857  72                  	db $72			;Instrument 1
     486.  00:5858  C1                  	db $c1			;Wait 2
     487.  00:5859  9C 01               	db $9c,$01			;CMD Drum $01
     488.  00:585B                      					;Wait Repeat 2
     489.  00:585B  21                  	db $21			;Note A-3
     490.  00:585C  70                  	db $70			;Volume 15
     491.  00:585D  7C                  	db $7c			;Instrument 11
     492.  00:585E  9C 02               	db $9c,$02			;CMD Drum $02
     493.  00:5860                      					;Wait Repeat 2
     494.  00:5860  5D                  	db $5d			;Note A-8
     495.  00:5861  6D                  	db $6d			;Volume 12
     496.  00:5862  72                  	db $72			;Instrument 1
     497.  00:5863                      					;Wait Repeat 2
     498.  00:5863  9C 01               	db $9c,$01			;CMD Drum $01
     499.  00:5865  C3                  	db $c3			;Wait 4
     500.  00:5866  2F                  	db $2f			;Note B-4
     501.  00:5867  6E                  	db $6e			;Volume 13
     502.  00:5868  73                  	db $73			;Instrument 2
     503.  00:5869  C0                  	db $c0			;Wait 1
     504.  00:586A  2F                  	db $2f			;Note B-4
     505.  00:586B  C3                  	db $c3			;Wait 4
     506.  00:586C  29                  	db $29			;Note F-4
     507.  00:586D  9A 03               	db $9a,$03			;CMD Note delay
     508.  00:586F  C4                  	db $c4			;Wait 5
     509.  00:5870  26                  	db $26			;Note D-4
     510.  00:5871  9A 05               	db $9a,$05			;CMD Note delay
     511.  00:5873  C5                  	db $c5			;Wait 6
     512.  00:5874  9C 01               	db $9c,$01			;CMD Drum $01
     513.  00:5876  C3                  	db $c3			;Wait 4
     514.  00:5877  5D                  	db $5d			;Note A-8
     515.  00:5878  6D                  	db $6d			;Volume 12
     516.  00:5879  72                  	db $72			;Instrument 1
     517.  00:587A  C1                  	db $c1			;Wait 2
     518.  00:587B  9C 01               	db $9c,$01			;CMD Drum $01
     519.  00:587D                      					;Wait Repeat 2
     520.  00:587D  21                  	db $21			;Note A-3
     521.  00:587E  70                  	db $70			;Volume 15
     522.  00:587F  7C                  	db $7c			;Instrument 11
     523.  00:5880  9C 02               	db $9c,$02			;CMD Drum $02
     524.  00:5882                      					;Wait Repeat 2
     525.  00:5882  5D                  	db $5d			;Note A-8
     526.  00:5883  6D                  	db $6d			;Volume 12
     527.  00:5884  72                  	db $72			;Instrument 1
     528.  00:5885                      					;Wait Repeat 2
     529.  00:5885  9C 01               	db $9c,$01			;CMD Drum $01
     530.  00:5887  C3                  	db $c3			;Wait 4
     531.  00:5888  5D                  	db $5d			;Note A-8
     532.  00:5889  6D                  	db $6d			;Volume 12
     533.  00:588A                      					;Wait Repeat 4
     534.  00:588A  9C 01               	db $9c,$01			;CMD Drum $01
     535.  00:588C                      					;Wait Repeat 4
     536.  00:588C  21                  	db $21			;Note A-3
     537.  00:588D  70                  	db $70			;Volume 15
     538.  00:588E  7C                  	db $7c			;Instrument 11
     539.  00:588F  9C 02               	db $9c,$02			;CMD Drum $02
     540.  00:5891  C1                  	db $c1			;Wait 2
     541.  00:5892  5D                  	db $5d			;Note A-8
     542.  00:5893  6D                  	db $6d			;Volume 12
     543.  00:5894  72                  	db $72			;Instrument 1
     544.  00:5895                      					;Wait Repeat 2
     545.  00:5895  5D                  	db $5d			;Note A-8
     546.  00:5896  6F                  	db $6f			;Volume 14
     547.  00:5897  7B                  	db $7b			;Instrument 10
     548.  00:5898  9C 05               	db $9c,$05			;CMD Drum $05
     549.  00:589A                      					;Wait Repeat 2
     550.  00:589A  21                  	db $21			;Note A-3
     551.  00:589B  6D                  	db $6d			;Volume 12
     552.  00:589C  71                  	db $71			;Instrument 0
     553.  00:589D  C1                  	db $c1			;Wait 2
     554.  00:589E  BF                  	db $bf			;[End-Of-Track]
     555.  00:589F                      .track_009:
     556.  00:589F                      			;CMD 8 Unused [WARNING]
     557.  00:589F  C2                  	db $c2			;Wait 3
     558.  00:58A0  47                  	db $47			;Note B-6
     559.  00:58A1  67                  	db $67			;Volume 6
     560.  00:58A2  7A                  	db $7a			;Instrument 9
     561.  00:58A3  A1 08               	db $a1,$08			;CMD Track detune
     562.  00:58A5  C1                  	db $c1			;Wait 2
     563.  00:58A6  42                  	db $42			;Note F#6
     564.  00:58A7                      					;Wait Repeat 2
     565.  00:58A7  3B                  	db $3b			;Note B-5
     566.  00:58A8                      					;Wait Repeat 2
     567.  00:58A8  42                  	db $42			;Note F#6
     568.  00:58A9                      					;Wait Repeat 2
     569.  00:58A9  47                  	db $47			;Note B-6
     570.  00:58AA                      					;Wait Repeat 2
     571.  00:58AA  42                  	db $42			;Note F#6
     572.  00:58AB                      					;Wait Repeat 2
     573.  00:58AB  47                  	db $47			;Note B-6
     574.  00:58AC                      					;Wait Repeat 2
     575.  00:58AC  42                  	db $42			;Note F#6
     576.  00:58AD                      					;Wait Repeat 2
     577.  00:58AD  3B                  	db $3b			;Note B-5
     578.  00:58AE                      					;Wait Repeat 2
     579.  00:58AE  42                  	db $42			;Note F#6
     580.  00:58AF                      					;Wait Repeat 2
     581.  00:58AF  47                  	db $47			;Note B-6
     582.  00:58B0                      					;Wait Repeat 2
     583.  00:58B0  42                  	db $42			;Note F#6
     584.  00:58B1                      					;Wait Repeat 2
     585.  00:58B1  47                  	db $47			;Note B-6
     586.  00:58B2                      					;Wait Repeat 2
     587.  00:58B2  42                  	db $42			;Note F#6
     588.  00:58B3                      					;Wait Repeat 2
     589.  00:58B3  3B                  	db $3b			;Note B-5
     590.  00:58B4                      					;Wait Repeat 2
     591.  00:58B4  42                  	db $42			;Note F#6
     592.  00:58B5                      					;Wait Repeat 2
     593.  00:58B5  47                  	db $47			;Note B-6
     594.  00:58B6                      					;Wait Repeat 2
     595.  00:58B6  42                  	db $42			;Note F#6
     596.  00:58B7                      					;Wait Repeat 2
     597.  00:58B7  3B                  	db $3b			;Note B-5
     598.  00:58B8                      					;Wait Repeat 2
     599.  00:58B8  42                  	db $42			;Note F#6
     600.  00:58B9                      					;Wait Repeat 2
     601.  00:58B9  47                  	db $47			;Note B-6
     602.  00:58BA                      					;Wait Repeat 2
     603.  00:58BA  42                  	db $42			;Note F#6
     604.  00:58BB                      					;Wait Repeat 2
     605.  00:58BB  47                  	db $47			;Note B-6
     606.  00:58BC                      					;Wait Repeat 2
     607.  00:58BC  42                  	db $42			;Note F#6
     608.  00:58BD                      					;Wait Repeat 2
     609.  00:58BD  3B                  	db $3b			;Note B-5
     610.  00:58BE                      					;Wait Repeat 2
     611.  00:58BE  42                  	db $42			;Note F#6
     612.  00:58BF                      					;Wait Repeat 2
     613.  00:58BF  47                  	db $47			;Note B-6
     614.  00:58C0                      					;Wait Repeat 2
     615.  00:58C0  42                  	db $42			;Note F#6
     616.  00:58C1                      					;Wait Repeat 2
     617.  00:58C1  47                  	db $47			;Note B-6
     618.  00:58C2                      					;Wait Repeat 2
     619.  00:58C2  42                  	db $42			;Note F#6
     620.  00:58C3                      					;Wait Repeat 2
     621.  00:58C3  3B                  	db $3b			;Note B-5
     622.  00:58C4  BF                  	db $bf			;[End-Of-Track]
     623.  00:58C5                      .track_010:
     624.  00:58C5  FF                  	db $ff			;Wait 64
     625.  00:58C6  BF                  	db $bf			;[End-Of-Track]
     626.  00:58C7                      .track_011:
     627.  00:58C7  53                  	db $53			;Note B-7
     628.  00:58C8  70                  	db $70			;Volume 15
     629.  00:58C9  78                  	db $78			;Instrument 7
     630.  00:58CA  A1 08               	db $a1,$08			;CMD Track detune
     631.  00:58CC  C1                  	db $c1			;Wait 2
     632.  00:58CD  4E                  	db $4e			;Note F#7
     633.  00:58CE  6F                  	db $6f			;Volume 14
     634.  00:58CF                      					;Wait Repeat 2
     635.  00:58CF  47                  	db $47			;Note B-6
     636.  00:58D0                      					;Wait Repeat 2
     637.  00:58D0  4E                  	db $4e			;Note F#7
     638.  00:58D1                      					;Wait Repeat 2
     639.  00:58D1  53                  	db $53			;Note B-7
     640.  00:58D2                      					;Wait Repeat 2
     641.  00:58D2  4E                  	db $4e			;Note F#7
     642.  00:58D3                      					;Wait Repeat 2
     643.  00:58D3  53                  	db $53			;Note B-7
     644.  00:58D4                      					;Wait Repeat 2
     645.  00:58D4  4E                  	db $4e			;Note F#7
     646.  00:58D5                      					;Wait Repeat 2
     647.  00:58D5  47                  	db $47			;Note B-6
     648.  00:58D6                      					;Wait Repeat 2
     649.  00:58D6  4E                  	db $4e			;Note F#7
     650.  00:58D7                      					;Wait Repeat 2
     651.  00:58D7  53                  	db $53			;Note B-7
     652.  00:58D8                      					;Wait Repeat 2
     653.  00:58D8  4E                  	db $4e			;Note F#7
     654.  00:58D9                      					;Wait Repeat 2
     655.  00:58D9  53                  	db $53			;Note B-7
     656.  00:58DA                      					;Wait Repeat 2
     657.  00:58DA  4E                  	db $4e			;Note F#7
     658.  00:58DB                      					;Wait Repeat 2
     659.  00:58DB  47                  	db $47			;Note B-6
     660.  00:58DC                      					;Wait Repeat 2
     661.  00:58DC  4E                  	db $4e			;Note F#7
     662.  00:58DD                      					;Wait Repeat 2
     663.  00:58DD  53                  	db $53			;Note B-7
     664.  00:58DE                      					;Wait Repeat 2
     665.  00:58DE  4E                  	db $4e			;Note F#7
     666.  00:58DF                      					;Wait Repeat 2
     667.  00:58DF  47                  	db $47			;Note B-6
     668.  00:58E0                      					;Wait Repeat 2
     669.  00:58E0  4E                  	db $4e			;Note F#7
     670.  00:58E1                      					;Wait Repeat 2
     671.  00:58E1  53                  	db $53			;Note B-7
     672.  00:58E2                      					;Wait Repeat 2
     673.  00:58E2  4E                  	db $4e			;Note F#7
     674.  00:58E3                      					;Wait Repeat 2
     675.  00:58E3  53                  	db $53			;Note B-7
     676.  00:58E4                      					;Wait Repeat 2
     677.  00:58E4  4E                  	db $4e			;Note F#7
     678.  00:58E5                      					;Wait Repeat 2
     679.  00:58E5  47                  	db $47			;Note B-6
     680.  00:58E6                      					;Wait Repeat 2
     681.  00:58E6  4E                  	db $4e			;Note F#7
     682.  00:58E7                      					;Wait Repeat 2
     683.  00:58E7  53                  	db $53			;Note B-7
     684.  00:58E8                      					;Wait Repeat 2
     685.  00:58E8  4E                  	db $4e			;Note F#7
     686.  00:58E9                      					;Wait Repeat 2
     687.  00:58E9  53                  	db $53			;Note B-7
     688.  00:58EA                      					;Wait Repeat 2
     689.  00:58EA  4E                  	db $4e			;Note F#7
     690.  00:58EB                      					;Wait Repeat 2
     691.  00:58EB  47                  	db $47			;Note B-6
     692.  00:58EC                      					;Wait Repeat 2
     693.  00:58EC  4E                  	db $4e			;Note F#7
     694.  00:58ED  C1                  	db $c1			;Wait 2
     695.  00:58EE  BF                  	db $bf			;[End-Of-Track]
     696.  00:58EF                      .track_012:
     697.  00:58EF  17                  	db $17			;Note B-2
     698.  00:58F0  6E                  	db $6e			;Volume 13
     699.  00:58F1  76                  	db $76			;Instrument 5
     700.  00:58F2  C3                  	db $c3			;Wait 4
     701.  00:58F3  17                  	db $17			;Note B-2
     702.  00:58F4  C1                  	db $c1			;Wait 2
     703.  00:58F5  17                  	db $17			;Note B-2
     704.  00:58F6                      					;Wait Repeat 2
     705.  00:58F6  23                  	db $23			;Note B-3
     706.  00:58F7  C3                  	db $c3			;Wait 4
     707.  00:58F8  17                  	db $17			;Note B-2
     708.  00:58F9  C1                  	db $c1			;Wait 2
     709.  00:58FA  17                  	db $17			;Note B-2
     710.  00:58FB                      					;Wait Repeat 2
     711.  00:58FB  19                  	db $19			;Note C#3
     712.  00:58FC  C4                  	db $c4			;Wait 5
     713.  00:58FD  21                  	db $21			;Note A-3
     714.  00:58FE  9A 02               	db $9a,$02			;CMD Note delay
     715.  00:5900                      					;Wait Repeat 5
     716.  00:5900  25                  	db $25			;Note C#4
     717.  00:5901  9A 05               	db $9a,$05			;CMD Note delay
     718.  00:5903  C5                  	db $c5			;Wait 6
     719.  00:5904  1A                  	db $1a			;Note D-3
     720.  00:5905  C3                  	db $c3			;Wait 4
     721.  00:5906  1A                  	db $1a			;Note D-3
     722.  00:5907  C1                  	db $c1			;Wait 2
     723.  00:5908  1A                  	db $1a			;Note D-3
     724.  00:5909                      					;Wait Repeat 2
     725.  00:5909  26                  	db $26			;Note D-4
     726.  00:590A  C3                  	db $c3			;Wait 4
     727.  00:590B  1A                  	db $1a			;Note D-3
     728.  00:590C  C1                  	db $c1			;Wait 2
     729.  00:590D  1A                  	db $1a			;Note D-3
     730.  00:590E                      					;Wait Repeat 2
     731.  00:590E  19                  	db $19			;Note C#3
     732.  00:590F  C3                  	db $c3			;Wait 4
     733.  00:5910  19                  	db $19			;Note C#3
     734.  00:5911  C1                  	db $c1			;Wait 2
     735.  00:5912  19                  	db $19			;Note C#3
     736.  00:5913                      					;Wait Repeat 2
     737.  00:5913  25                  	db $25			;Note C#4
     738.  00:5914  C7                  	db $c7			;Wait 8
     739.  00:5915  BF                  	db $bf			;[End-Of-Track]
     740.  00:5916                      .track_013:
     741.  00:5916  39                  	db $39			;Note A-5
     742.  00:5917  6C                  	db $6c			;Volume 11
     743.  00:5918  77                  	db $77			;Instrument 6
     744.  00:5919  CB                  	db $cb			;Wait 12
     745.  00:591A  39                  	db $39			;Note A-5
     746.  00:591B  C1                  	db $c1			;Wait 2
     747.  00:591C  39                  	db $39			;Note A-5
     748.  00:591D                      					;Wait Repeat 2
     749.  00:591D  3B                  	db $3b			;Note B-5
     750.  00:591E  C4                  	db $c4			;Wait 5
     751.  00:591F  3B                  	db $3b			;Note B-5
     752.  00:5920  9A 03               	db $9a,$03			;CMD Note delay
     753.  00:5922                      					;Wait Repeat 5
     754.  00:5922  3B                  	db $3b			;Note B-5
     755.  00:5923  9A 05               	db $9a,$05			;CMD Note delay
     756.  00:5925  C5                  	db $c5			;Wait 6
     757.  00:5926  3D                  	db $3d			;Note C#6
     758.  00:5927  CB                  	db $cb			;Wait 12
     759.  00:5928  3D                  	db $3d			;Note C#6
     760.  00:5929  C1                  	db $c1			;Wait 2
     761.  00:592A  3D                  	db $3d			;Note C#6
     762.  00:592B                      					;Wait Repeat 2
     763.  00:592B  3B                  	db $3b			;Note B-5
     764.  00:592C  C4                  	db $c4			;Wait 5
     765.  00:592D  3B                  	db $3b			;Note B-5
     766.  00:592E  9A 03               	db $9a,$03			;CMD Note delay
     767.  00:5930                      					;Wait Repeat 5
     768.  00:5930  38                  	db $38			;Note G#5
     769.  00:5931  9A 05               	db $9a,$05			;CMD Note delay
     770.  00:5933  C5                  	db $c5			;Wait 6
     771.  00:5934  BF                  	db $bf			;[End-Of-Track]
     772.  00:5935                      .track_014:
     773.  00:5935  3E                  	db $3e			;Note D-6
     774.  00:5936  6C                  	db $6c			;Volume 11
     775.  00:5937  77                  	db $77			;Instrument 6
     776.  00:5938  CB                  	db $cb			;Wait 12
     777.  00:5939  3E                  	db $3e			;Note D-6
     778.  00:593A  C1                  	db $c1			;Wait 2
     779.  00:593B  3E                  	db $3e			;Note D-6
     780.  00:593C                      					;Wait Repeat 2
     781.  00:593C  40                  	db $40			;Note E-6
     782.  00:593D  C4                  	db $c4			;Wait 5
     783.  00:593E  40                  	db $40			;Note E-6
     784.  00:593F  9A 03               	db $9a,$03			;CMD Note delay
     785.  00:5941                      					;Wait Repeat 5
     786.  00:5941  40                  	db $40			;Note E-6
     787.  00:5942  9A 05               	db $9a,$05			;CMD Note delay
     788.  00:5944  C5                  	db $c5			;Wait 6
     789.  00:5945  42                  	db $42			;Note F#6
     790.  00:5946  CB                  	db $cb			;Wait 12
     791.  00:5947  42                  	db $42			;Note F#6
     792.  00:5948  C1                  	db $c1			;Wait 2
     793.  00:5949  42                  	db $42			;Note F#6
     794.  00:594A                      					;Wait Repeat 2
     795.  00:594A  40                  	db $40			;Note E-6
     796.  00:594B  C4                  	db $c4			;Wait 5
     797.  00:594C  40                  	db $40			;Note E-6
     798.  00:594D  9A 03               	db $9a,$03			;CMD Note delay
     799.  00:594F                      					;Wait Repeat 5
     800.  00:594F  3B                  	db $3b			;Note B-5
     801.  00:5950  9A 05               	db $9a,$05			;CMD Note delay
     802.  00:5952  C5                  	db $c5			;Wait 6
     803.  00:5953  BF                  	db $bf			;[End-Of-Track]
     804.  00:5954                      .track_015:
     805.  00:5954  42                  	db $42			;Note F#6
     806.  00:5955  6C                  	db $6c			;Volume 11
     807.  00:5956  77                  	db $77			;Instrument 6
     808.  00:5957  C2                  	db $c2			;Wait 3
     809.  00:5958  94 66               	db $94,$66		;CMD Vibrato
     810.  00:595A  C8                  	db $c8			;Wait 9
     811.  00:595B  42                  	db $42			;Note F#6
     812.  00:595C  9B                  	db $9b			;CMD End 
     813.  00:595D  C1                  	db $c1			;Wait 2
     814.  00:595E  42                  	db $42			;Note F#6
     815.  00:595F                      					;Wait Repeat 2
     816.  00:595F  44                  	db $44			;Note G#6
     817.  00:5960  C4                  	db $c4			;Wait 5
     818.  00:5961  45                  	db $45			;Note A-6
     819.  00:5962  9A 03               	db $9a,$03			;CMD Note delay
     820.  00:5964                      					;Wait Repeat 5
     821.  00:5964  47                  	db $47			;Note B-6
     822.  00:5965  9A 05               	db $9a,$05			;CMD Note delay
     823.  00:5967  C5                  	db $c5			;Wait 6
     824.  00:5968  45                  	db $45			;Note A-6
     825.  00:5969  C3                  	db $c3			;Wait 4
     826.  00:596A  94 66               	db $94,$66		;CMD Vibrato
     827.  00:596C  C7                  	db $c7			;Wait 8
     828.  00:596D  45                  	db $45			;Note A-6
     829.  00:596E  9B                  	db $9b			;CMD End 
     830.  00:596F  C1                  	db $c1			;Wait 2
     831.  00:5970  45                  	db $45			;Note A-6
     832.  00:5971                      					;Wait Repeat 2
     833.  00:5971  44                  	db $44			;Note G#6
     834.  00:5972  C4                  	db $c4			;Wait 5
     835.  00:5973  42                  	db $42			;Note F#6
     836.  00:5974  9A 03               	db $9a,$03			;CMD Note delay
     837.  00:5976                      					;Wait Repeat 5
     838.  00:5976  40                  	db $40			;Note E-6
     839.  00:5977  9A 05               	db $9a,$05			;CMD Note delay
     840.  00:5979  C5                  	db $c5			;Wait 6
     841.  00:597A  BF                  	db $bf			;[End-Of-Track]
     842.  00:597B                      .track_016:
     843.  00:597B  9C 01               	db $9c,$01			;CMD Drum $01
     844.  00:597D  C3                  	db $c3			;Wait 4
     845.  00:597E  5D                  	db $5d			;Note A-8
     846.  00:597F  6D                  	db $6d			;Volume 12
     847.  00:5980  72                  	db $72			;Instrument 1
     848.  00:5981  C1                  	db $c1			;Wait 2
     849.  00:5982  9C 01               	db $9c,$01			;CMD Drum $01
     850.  00:5984                      					;Wait Repeat 2
     851.  00:5984  21                  	db $21			;Note A-3
     852.  00:5985  70                  	db $70			;Volume 15
     853.  00:5986  7C                  	db $7c			;Instrument 11
     854.  00:5987  9C 02               	db $9c,$02			;CMD Drum $02
     855.  00:5989                      					;Wait Repeat 2
     856.  00:5989  5D                  	db $5d			;Note A-8
     857.  00:598A  6D                  	db $6d			;Volume 12
     858.  00:598B  72                  	db $72			;Instrument 1
     859.  00:598C                      					;Wait Repeat 2
     860.  00:598C  9C 01               	db $9c,$01			;CMD Drum $01
     861.  00:598E  C3                  	db $c3			;Wait 4
     862.  00:598F  5D                  	db $5d			;Note A-8
     863.  00:5990  6D                  	db $6d			;Volume 12
     864.  00:5991                      					;Wait Repeat 4
     865.  00:5991  9C 01               	db $9c,$01			;CMD Drum $01
     866.  00:5993                      					;Wait Repeat 4
     867.  00:5993  21                  	db $21			;Note A-3
     868.  00:5994  70                  	db $70			;Volume 15
     869.  00:5995  7C                  	db $7c			;Instrument 11
     870.  00:5996  9C 02               	db $9c,$02			;CMD Drum $02
     871.  00:5998  C1                  	db $c1			;Wait 2
     872.  00:5999  5D                  	db $5d			;Note A-8
     873.  00:599A  6D                  	db $6d			;Volume 12
     874.  00:599B  72                  	db $72			;Instrument 1
     875.  00:599C                      					;Wait Repeat 2
     876.  00:599C  5D                  	db $5d			;Note A-8
     877.  00:599D  6F                  	db $6f			;Volume 14
     878.  00:599E  7B                  	db $7b			;Instrument 10
     879.  00:599F                      					;Wait Repeat 2
     880.  00:599F  21                  	db $21			;Note A-3
     881.  00:59A0  6D                  	db $6d			;Volume 12
     882.  00:59A1  71                  	db $71			;Instrument 0
     883.  00:59A2                      					;Wait Repeat 2
     884.  00:59A2  9C 01               	db $9c,$01			;CMD Drum $01
     885.  00:59A4  C3                  	db $c3			;Wait 4
     886.  00:59A5  5D                  	db $5d			;Note A-8
     887.  00:59A6  6D                  	db $6d			;Volume 12
     888.  00:59A7  72                  	db $72			;Instrument 1
     889.  00:59A8  C1                  	db $c1			;Wait 2
     890.  00:59A9  9C 01               	db $9c,$01			;CMD Drum $01
     891.  00:59AB                      					;Wait Repeat 2
     892.  00:59AB  21                  	db $21			;Note A-3
     893.  00:59AC  70                  	db $70			;Volume 15
     894.  00:59AD  7C                  	db $7c			;Instrument 11
     895.  00:59AE  9C 02               	db $9c,$02			;CMD Drum $02
     896.  00:59B0                      					;Wait Repeat 2
     897.  00:59B0  5D                  	db $5d			;Note A-8
     898.  00:59B1  6D                  	db $6d			;Volume 12
     899.  00:59B2  72                  	db $72			;Instrument 1
     900.  00:59B3                      					;Wait Repeat 2
     901.  00:59B3  9C 01               	db $9c,$01			;CMD Drum $01
     902.  00:59B5  C3                  	db $c3			;Wait 4
     903.  00:59B6  5D                  	db $5d			;Note A-8
     904.  00:59B7  6D                  	db $6d			;Volume 12
     905.  00:59B8  C1                  	db $c1			;Wait 2
     906.  00:59B9  5D                  	db $5d			;Note A-8
     907.  00:59BA  6D                  	db $6d			;Volume 12
     908.  00:59BB                      					;Wait Repeat 2
     909.  00:59BB  5D                  	db $5d			;Note A-8
     910.  00:59BC  6E                  	db $6e			;Volume 13
     911.  00:59BD  7B                  	db $7b			;Instrument 10
     912.  00:59BE  9C 05               	db $9c,$05			;CMD Drum $05
     913.  00:59C0                      					;Wait Repeat 2
     914.  00:59C0  9C 01               	db $9c,$01			;CMD Drum $01
     915.  00:59C2                      					;Wait Repeat 2
     916.  00:59C2  21                  	db $21			;Note A-3
     917.  00:59C3  70                  	db $70			;Volume 15
     918.  00:59C4  7C                  	db $7c			;Instrument 11
     919.  00:59C5  9C 02               	db $9c,$02			;CMD Drum $02
     920.  00:59C7  C3                  	db $c3			;Wait 4
     921.  00:59C8  5D                  	db $5d			;Note A-8
     922.  00:59C9  6F                  	db $6f			;Volume 14
     923.  00:59CA  7B                  	db $7b			;Instrument 10
     924.  00:59CB  9C 05               	db $9c,$05			;CMD Drum $05
     925.  00:59CD  C1                  	db $c1			;Wait 2
     926.  00:59CE  21                  	db $21			;Note A-3
     927.  00:59CF  6D                  	db $6d			;Volume 12
     928.  00:59D0  71                  	db $71			;Instrument 0
     929.  00:59D1  C1                  	db $c1			;Wait 2
     930.  00:59D2  BF                  	db $bf			;[End-Of-Track]
     931.  00:59D3                      .track_017:
     932.  00:59D3                      			;CMD 8 Unused [WARNING]
     933.  00:59D3  C2                  	db $c2			;Wait 3
     934.  00:59D4  47                  	db $47			;Note B-6
     935.  00:59D5  69                  	db $69			;Volume 8
     936.  00:59D6  7A                  	db $7a			;Instrument 9
     937.  00:59D7  A1 08               	db $a1,$08			;CMD Track detune
     938.  00:59D9  C1                  	db $c1			;Wait 2
     939.  00:59DA  42                  	db $42			;Note F#6
     940.  00:59DB                      					;Wait Repeat 2
     941.  00:59DB  3B                  	db $3b			;Note B-5
     942.  00:59DC                      					;Wait Repeat 2
     943.  00:59DC  42                  	db $42			;Note F#6
     944.  00:59DD                      					;Wait Repeat 2
     945.  00:59DD  47                  	db $47			;Note B-6
     946.  00:59DE                      					;Wait Repeat 2
     947.  00:59DE  42                  	db $42			;Note F#6
     948.  00:59DF                      					;Wait Repeat 2
     949.  00:59DF  47                  	db $47			;Note B-6
     950.  00:59E0                      					;Wait Repeat 2
     951.  00:59E0  42                  	db $42			;Note F#6
     952.  00:59E1                      					;Wait Repeat 2
     953.  00:59E1  3B                  	db $3b			;Note B-5
     954.  00:59E2                      					;Wait Repeat 2
     955.  00:59E2  42                  	db $42			;Note F#6
     956.  00:59E3                      					;Wait Repeat 2
     957.  00:59E3  47                  	db $47			;Note B-6
     958.  00:59E4                      					;Wait Repeat 2
     959.  00:59E4  42                  	db $42			;Note F#6
     960.  00:59E5                      					;Wait Repeat 2
     961.  00:59E5  47                  	db $47			;Note B-6
     962.  00:59E6                      					;Wait Repeat 2
     963.  00:59E6  42                  	db $42			;Note F#6
     964.  00:59E7                      					;Wait Repeat 2
     965.  00:59E7  3B                  	db $3b			;Note B-5
     966.  00:59E8                      					;Wait Repeat 2
     967.  00:59E8  42                  	db $42			;Note F#6
     968.  00:59E9                      					;Wait Repeat 2
     969.  00:59E9  47                  	db $47			;Note B-6
     970.  00:59EA                      					;Wait Repeat 2
     971.  00:59EA  42                  	db $42			;Note F#6
     972.  00:59EB                      					;Wait Repeat 2
     973.  00:59EB  3B                  	db $3b			;Note B-5
     974.  00:59EC                      					;Wait Repeat 2
     975.  00:59EC  42                  	db $42			;Note F#6
     976.  00:59ED                      					;Wait Repeat 2
     977.  00:59ED  47                  	db $47			;Note B-6
     978.  00:59EE                      					;Wait Repeat 2
     979.  00:59EE  42                  	db $42			;Note F#6
     980.  00:59EF                      					;Wait Repeat 2
     981.  00:59EF  47                  	db $47			;Note B-6
     982.  00:59F0                      					;Wait Repeat 2
     983.  00:59F0  42                  	db $42			;Note F#6
     984.  00:59F1                      					;Wait Repeat 2
     985.  00:59F1  3B                  	db $3b			;Note B-5
     986.  00:59F2                      					;Wait Repeat 2
     987.  00:59F2  42                  	db $42			;Note F#6
     988.  00:59F3                      					;Wait Repeat 2
     989.  00:59F3  47                  	db $47			;Note B-6
     990.  00:59F4                      					;Wait Repeat 2
     991.  00:59F4  42                  	db $42			;Note F#6
     992.  00:59F5                      					;Wait Repeat 2
     993.  00:59F5  47                  	db $47			;Note B-6
     994.  00:59F6                      					;Wait Repeat 2
     995.  00:59F6  42                  	db $42			;Note F#6
     996.  00:59F7                      					;Wait Repeat 2
     997.  00:59F7  3B                  	db $3b			;Note B-5
     998.  00:59F8  BF                  	db $bf			;[End-Of-Track]
     999.  00:59F9                      .track_021:
    1000.  00:59F9  32                  	db $32			;Note D-5
    1001.  00:59FA  6C                  	db $6c			;Volume 11
    1002.  00:59FB  74                  	db $74			;Instrument 3
    1003.  00:59FC  C1                  	db $c1			;Wait 2
    1004.  00:59FD  32                  	db $32			;Note D-5
    1005.  00:59FE                      					;Wait Repeat 2
    1006.  00:59FE  32                  	db $32			;Note D-5
    1007.  00:59FF                      					;Wait Repeat 2
    1008.  00:59FF  32                  	db $32			;Note D-5
    1009.  00:5A00  C5                  	db $c5			;Wait 6
    1010.  00:5A01  32                  	db $32			;Note D-5
    1011.  00:5A02  C1                  	db $c1			;Wait 2
    1012.  00:5A03  32                  	db $32			;Note D-5
    1013.  00:5A04                      					;Wait Repeat 2
    1014.  00:5A04  34                  	db $34			;Note E-5
    1015.  00:5A05                      					;Wait Repeat 2
    1016.  00:5A05  34                  	db $34			;Note E-5
    1017.  00:5A06  C5                  	db $c5			;Wait 6
    1018.  00:5A07  34                  	db $34			;Note E-5
    1019.  00:5A08  C1                  	db $c1			;Wait 2
    1020.  00:5A09  34                  	db $34			;Note E-5
    1021.  00:5A0A  C5                  	db $c5			;Wait 6
    1022.  00:5A0B  36                  	db $36			;Note F#5
    1023.  00:5A0C  C1                  	db $c1			;Wait 2
    1024.  00:5A0D  36                  	db $36			;Note F#5
    1025.  00:5A0E                      					;Wait Repeat 2
    1026.  00:5A0E  36                  	db $36			;Note F#5
    1027.  00:5A0F                      					;Wait Repeat 2
    1028.  00:5A0F  36                  	db $36			;Note F#5
    1029.  00:5A10  C5                  	db $c5			;Wait 6
    1030.  00:5A11  36                  	db $36			;Note F#5
    1031.  00:5A12  C1                  	db $c1			;Wait 2
    1032.  00:5A13  36                  	db $36			;Note F#5
    1033.  00:5A14                      					;Wait Repeat 2
    1034.  00:5A14  34                  	db $34			;Note E-5
    1035.  00:5A15  6E                  	db $6e			;Volume 13
    1036.  00:5A16  75                  	db $75			;Instrument 4
    1037.  00:5A17  C7                  	db $c7			;Wait 8
    1038.  00:5A18  2C                  	db $2c			;Note G#4
    1039.  00:5A19  C7                  	db $c7			;Wait 8
    1040.  00:5A1A  BF                  	db $bf			;[End-Of-Track]
    1041.  00:5A1B                      .track_022:
    1042.  00:5A1B  34                  	db $34			;Note E-5
    1043.  00:5A1C  70                  	db $70			;Volume 15
    1044.  00:5A1D  79                  	db $79			;Instrument 8
    1045.  00:5A1E  A1 08               	db $a1,$08			;CMD Track detune
    1046.  00:5A20  C0                  	db $c0			;Wait 1
    1047.  00:5A21  36                  	db $36			;Note F#5
    1048.  00:5A22  90 0A               	db $90,$0a			;CMD Portamento tone
    1049.  00:5A24  C3                  	db $c3			;Wait 4
    1050.  00:5A25  94 26               	db $94,$26		;CMD Vibrato
    1051.  00:5A27  C4                  	db $c4			;Wait 5
    1052.  00:5A28  34                  	db $34			;Note E-5
    1053.  00:5A29  9B                  	db $9b			;CMD End 
    1054.  00:5A2A  C1                  	db $c1			;Wait 2
    1055.  00:5A2B  32                  	db $32			;Note D-5
    1056.  00:5A2C                      					;Wait Repeat 2
    1057.  00:5A2C  36                  	db $36			;Note F#5
    1058.  00:5A2D                      					;Wait Repeat 2
    1059.  00:5A2D  38                  	db $38			;Note G#5
    1060.  00:5A2E                      					;Wait Repeat 2
    1061.  00:5A2E  34                  	db $34			;Note E-5
    1062.  00:5A2F  9A 03               	db $9a,$03			;CMD Note delay
    1063.  00:5A31  C2                  	db $c2			;Wait 3
    1064.  00:5A32  2F                  	db $2f			;Note B-4
    1065.  00:5A33  9A 02               	db $9a,$02			;CMD Note delay
    1066.  00:5A35                      					;Wait Repeat 3
    1067.  00:5A35  34                  	db $34			;Note E-5
    1068.  00:5A36  C1                  	db $c1			;Wait 2
    1069.  00:5A37  38                  	db $38			;Note G#5
    1070.  00:5A38  9A 03               	db $9a,$03			;CMD Note delay
    1071.  00:5A3A  C2                  	db $c2			;Wait 3
    1072.  00:5A3B  3B                  	db $3b			;Note B-5
    1073.  00:5A3C  9A 02               	db $9a,$02			;CMD Note delay
    1074.  00:5A3E                      					;Wait Repeat 3
    1075.  00:5A3E  38                  	db $38			;Note G#5
    1076.  00:5A3F  C0                  	db $c0			;Wait 1
    1077.  00:5A40  39                  	db $39			;Note A-5
    1078.  00:5A41  90 04               	db $90,$04			;CMD Portamento tone
    1079.  00:5A43  C3                  	db $c3			;Wait 4
    1080.  00:5A44  94 36               	db $94,$36		;CMD Vibrato
    1081.  00:5A46                      					;Wait Repeat 4
    1082.  00:5A46  9B                  	db $9b			;CMD End 
    1083.  00:5A47  C0                  	db $c0			;Wait 1
    1084.  00:5A48  38                  	db $38			;Note G#5
    1085.  00:5A49  C1                  	db $c1			;Wait 2
    1086.  00:5A4A  39                  	db $39			;Note A-5
    1087.  00:5A4B                      					;Wait Repeat 2
    1088.  00:5A4B  3B                  	db $3b			;Note B-5
    1089.  00:5A4C                      					;Wait Repeat 2
    1090.  00:5A4C  3E                  	db $3e			;Note D-6
    1091.  00:5A4D  C0                  	db $c0			;Wait 1
    1092.  00:5A4E  3D                  	db $3d			;Note C#6
    1093.  00:5A4F  9A 02               	db $9a,$02			;CMD Note delay
    1094.  00:5A51                      					;Wait Repeat 1
    1095.  00:5A51  3B                  	db $3b			;Note B-5
    1096.  00:5A52  9A 03               	db $9a,$03			;CMD Note delay
    1097.  00:5A54  C1                  	db $c1			;Wait 2
    1098.  00:5A55  39                  	db $39			;Note A-5
    1099.  00:5A56  C0                  	db $c0			;Wait 1
    1100.  00:5A57  38                  	db $38			;Note G#5
    1101.  00:5A58  9A 02               	db $9a,$02			;CMD Note delay
    1102.  00:5A5A                      					;Wait Repeat 1
    1103.  00:5A5A  36                  	db $36			;Note F#5
    1104.  00:5A5B  9A 03               	db $9a,$03			;CMD Note delay
    1105.  00:5A5D  C1                  	db $c1			;Wait 2
    1106.  00:5A5E  34                  	db $34			;Note E-5
    1107.  00:5A5F  A1 08               	db $a1,$08			;CMD Track detune
    1108.  00:5A61  C0                  	db $c0			;Wait 1
    1109.  00:5A62  36                  	db $36			;Note F#5
    1110.  00:5A63  9A 02               	db $9a,$02			;CMD Note delay
    1111.  00:5A65                      					;Wait Repeat 1
    1112.  00:5A65  38                  	db $38			;Note G#5
    1113.  00:5A66  9A 03               	db $9a,$03			;CMD Note delay
    1114.  00:5A68  C1                  	db $c1			;Wait 2
    1115.  00:5A69  39                  	db $39			;Note A-5
    1116.  00:5A6A  C0                  	db $c0			;Wait 1
    1117.  00:5A6B  34                  	db $34			;Note E-5
    1118.  00:5A6C  9A 02               	db $9a,$02			;CMD Note delay
    1119.  00:5A6E                      					;Wait Repeat 1
    1120.  00:5A6E  31                  	db $31			;Note C#5
    1121.  00:5A6F  9A 03               	db $9a,$03			;CMD Note delay
    1122.  00:5A71  C1                  	db $c1			;Wait 2
    1123.  00:5A72  BF                  	db $bf			;[End-Of-Track]
    1124.  00:5A73                      .track_023:
    1125.  00:5A73  C2                  	db $c2			;Wait 3
    1126.  00:5A74  34                  	db $34			;Note E-5
    1127.  00:5A75  68                  	db $68			;Volume 7
    1128.  00:5A76  79                  	db $79			;Instrument 8
    1129.  00:5A77  A1 09               	db $a1,$09			;CMD Track detune
    1130.  00:5A79  C0                  	db $c0			;Wait 1
    1131.  00:5A7A  36                  	db $36			;Note F#5
    1132.  00:5A7B  90 0A               	db $90,$0a			;CMD Portamento tone
    1133.  00:5A7D  C3                  	db $c3			;Wait 4
    1134.  00:5A7E  94 26               	db $94,$26		;CMD Vibrato
    1135.  00:5A80  C4                  	db $c4			;Wait 5
    1136.  00:5A81  34                  	db $34			;Note E-5
    1137.  00:5A82  9B                  	db $9b			;CMD End 
    1138.  00:5A83  C1                  	db $c1			;Wait 2
    1139.  00:5A84  32                  	db $32			;Note D-5
    1140.  00:5A85                      					;Wait Repeat 2
    1141.  00:5A85  36                  	db $36			;Note F#5
    1142.  00:5A86                      					;Wait Repeat 2
    1143.  00:5A86  38                  	db $38			;Note G#5
    1144.  00:5A87                      					;Wait Repeat 2
    1145.  00:5A87  34                  	db $34			;Note E-5
    1146.  00:5A88  9A 03               	db $9a,$03			;CMD Note delay
    1147.  00:5A8A  C2                  	db $c2			;Wait 3
    1148.  00:5A8B  2F                  	db $2f			;Note B-4
    1149.  00:5A8C  9A 02               	db $9a,$02			;CMD Note delay
    1150.  00:5A8E                      					;Wait Repeat 3
    1151.  00:5A8E  34                  	db $34			;Note E-5
    1152.  00:5A8F  C1                  	db $c1			;Wait 2
    1153.  00:5A90  38                  	db $38			;Note G#5
    1154.  00:5A91  9A 03               	db $9a,$03			;CMD Note delay
    1155.  00:5A93  C2                  	db $c2			;Wait 3
    1156.  00:5A94  3B                  	db $3b			;Note B-5
    1157.  00:5A95  9A 02               	db $9a,$02			;CMD Note delay
    1158.  00:5A97                      					;Wait Repeat 3
    1159.  00:5A97  38                  	db $38			;Note G#5
    1160.  00:5A98  C0                  	db $c0			;Wait 1
    1161.  00:5A99  39                  	db $39			;Note A-5
    1162.  00:5A9A  90 04               	db $90,$04			;CMD Portamento tone
    1163.  00:5A9C  C3                  	db $c3			;Wait 4
    1164.  00:5A9D  94 36               	db $94,$36		;CMD Vibrato
    1165.  00:5A9F                      					;Wait Repeat 4
    1166.  00:5A9F  9B                  	db $9b			;CMD End 
    1167.  00:5AA0  C0                  	db $c0			;Wait 1
    1168.  00:5AA1  38                  	db $38			;Note G#5
    1169.  00:5AA2  C1                  	db $c1			;Wait 2
    1170.  00:5AA3  39                  	db $39			;Note A-5
    1171.  00:5AA4                      					;Wait Repeat 2
    1172.  00:5AA4  3B                  	db $3b			;Note B-5
    1173.  00:5AA5                      					;Wait Repeat 2
    1174.  00:5AA5  3E                  	db $3e			;Note D-6
    1175.  00:5AA6  C0                  	db $c0			;Wait 1
    1176.  00:5AA7  3D                  	db $3d			;Note C#6
    1177.  00:5AA8  9A 02               	db $9a,$02			;CMD Note delay
    1178.  00:5AAA                      					;Wait Repeat 1
    1179.  00:5AAA  3B                  	db $3b			;Note B-5
    1180.  00:5AAB  9A 03               	db $9a,$03			;CMD Note delay
    1181.  00:5AAD  C1                  	db $c1			;Wait 2
    1182.  00:5AAE  39                  	db $39			;Note A-5
    1183.  00:5AAF  C0                  	db $c0			;Wait 1
    1184.  00:5AB0  38                  	db $38			;Note G#5
    1185.  00:5AB1  9A 02               	db $9a,$02			;CMD Note delay
    1186.  00:5AB3                      					;Wait Repeat 1
    1187.  00:5AB3  36                  	db $36			;Note F#5
    1188.  00:5AB4  9A 03               	db $9a,$03			;CMD Note delay
    1189.  00:5AB6  C1                  	db $c1			;Wait 2
    1190.  00:5AB7  34                  	db $34			;Note E-5
    1191.  00:5AB8  A1 08               	db $a1,$08			;CMD Track detune
    1192.  00:5ABA  C0                  	db $c0			;Wait 1
    1193.  00:5ABB  36                  	db $36			;Note F#5
    1194.  00:5ABC  9A 02               	db $9a,$02			;CMD Note delay
    1195.  00:5ABE                      					;Wait Repeat 1
    1196.  00:5ABE  38                  	db $38			;Note G#5
    1197.  00:5ABF  9A 03               	db $9a,$03			;CMD Note delay
    1198.  00:5AC1  C1                  	db $c1			;Wait 2
    1199.  00:5AC2  39                  	db $39			;Note A-5
    1200.  00:5AC3  BF                  	db $bf			;[End-Of-Track]
    1201.  00:5AC4                      .track_024:
    1202.  00:5AC4  9C 01               	db $9c,$01			;CMD Drum $01
    1203.  00:5AC6  C0                  	db $c0			;Wait 1
    1204.  00:5AC7  97 8C               	db $97,$8c			;CMD Volume slide up
    1205.  00:5AC9  C6                  	db $c6			;Wait 7
    1206.  00:5ACA  60                  	db $60			;Release 96
    1207.  00:5ACB  F7                  	db $f7			;Wait 56
    1208.  00:5ACC  BF                  	db $bf			;[End-Of-Track]
    1209.  00:5ACD                      .track_025:
    1210.  00:5ACD                      			;CMD 8 Unused [WARNING]
    1211.  00:5ACD  C0                  	db $c0			;Wait 1
    1212.  00:5ACE  97 8C               	db $97,$8c			;CMD Volume slide up
    1213.  00:5AD0  C6                  	db $c6			;Wait 7
    1214.  00:5AD1  60                  	db $60			;Release 96
    1215.  00:5AD2  F7                  	db $f7			;Wait 56
    1216.  00:5AD3  BF                  	db $bf			;[End-Of-Track]
    1217.  00:5AD4                      .track_027:
    1218.  00:5AD4  53                  	db $53			;Note B-7
    1219.  00:5AD5  6E                  	db $6e			;Volume 13
    1220.  00:5AD6  78                  	db $78			;Instrument 7
    1221.  00:5AD7  A1 08               	db $a1,$08			;CMD Track detune
    1222.  00:5AD9  C0                  	db $c0			;Wait 1
    1223.  00:5ADA  97 8C               	db $97,$8c			;CMD Volume slide up
    1224.  00:5ADC  FE                  	db $fe			;Wait 63
    1225.  00:5ADD  BF                  	db $bf			;[End-Of-Track]
    1226.  00:5ADE                      .track_028:
    1227.  00:5ADE  17                  	db $17			;Note B-2
    1228.  00:5ADF  6E                  	db $6e			;Volume 13
    1229.  00:5AE0  76                  	db $76			;Instrument 5
    1230.  00:5AE1  97 8A               	db $97,$8a			;CMD Volume slide up
    1231.  00:5AE3  FF                  	db $ff			;Wait 64
    1232.  00:5AE4  BF                  	db $bf			;[End-Of-Track]
    1233.  00:5AE5                      .track_029:
    1234.  00:5AE5  2D                  	db $2d			;Note A-4
    1235.  00:5AE6  6C                  	db $6c			;Volume 11
    1236.  00:5AE7  77                  	db $77			;Instrument 6
    1237.  00:5AE8  97 86               	db $97,$86			;CMD Volume slide up
    1238.  00:5AEA  FF                  	db $ff			;Wait 64
    1239.  00:5AEB  BF                  	db $bf			;[End-Of-Track]
    1240.  00:5AEC                      .track_030:
    1241.  00:5AEC  32                  	db $32			;Note D-5
    1242.  00:5AED  6C                  	db $6c			;Volume 11
    1243.  00:5AEE  77                  	db $77			;Instrument 6
    1244.  00:5AEF  97 86               	db $97,$86			;CMD Volume slide up
    1245.  00:5AF1  FF                  	db $ff			;Wait 64
    1246.  00:5AF2  BF                  	db $bf			;[End-Of-Track]
    1247.  00:5AF3                      .track_031:
    1248.  00:5AF3  36                  	db $36			;Note F#5
    1249.  00:5AF4  6C                  	db $6c			;Volume 11
    1250.  00:5AF5  77                  	db $77			;Instrument 6
    1251.  00:5AF6  97 86               	db $97,$86			;CMD Volume slide up
    1252.  00:5AF8  FF                  	db $ff			;Wait 64
    1253.  00:5AF9  BF                  	db $bf			;[End-Of-Track]
    1254.  00:5AFA                      
     566   00:5AFA                      	
     567   00:5AFA                      TEXT_Title:
     568   00:5AFA                      	db	"TriloTracker FM Re-player Debug info",0	
     568   00:5AFA  54 72 69 6C 6F 54 72 61 63 6B 65 72 20 46 4D 20 
     568   00:5B0A  52 65 2D 70 6C 61 79 65 72 20 44 65 62 75 67 20 
     568   00:5B1A  69 6E 66 6F 00 
     569   00:5B1F                      TEXT_Step:
     570   00:5B1F  53 74 65 70 3A 00   	db	"Step:",0	
     571   00:5B25                      TEXT_Header_Data:
     572   00:5B25                      	db	"C# Nt In FM Vl Cm Flags",0
     572   00:5B25  43 23 20 4E 74 20 49 6E 20 46 4D 20 56 6C 20 43 
     572   00:5B35  6D 20 46 6C 61 67 73 00 
     573   00:5B3D                      TEXT_Register_Header:
     574   00:5B3D                      	db 	"Tone Vl  Tone Vl  Nois Mx  Env  Sh",0
     574   00:5B3D  54 6F 6E 65 20 56 6C 20 20 54 6F 6E 65 20 56 6C 
     574   00:5B4D  20 20 4E 6F 69 73 20 4D 78 20 20 45 6E 76 20 20 
     574   00:5B5D  53 68 00 
     575   00:5B60                      TEXT_Register_Drum:
     576   00:5B60                      	db 	"Macr Drm Tone Vl",0	
     576   00:5B60  4D 61 63 72 20 44 72 6D 20 54 6F 6E 65 20 56 6C 
     576   00:5B70  00 
     577   00:5B71                      TEXT_Legend_Data:
     578   00:5B71                      	db	"Legend: Psg, Fm, Voice, Env, Keyon, Command, Active(note)",0
     578   00:5B71  4C 65 67 65 6E 64 3A 20 50 73 67 2C 20 46 6D 2C 
     578   00:5B81  20 56 6F 69 63 65 2C 20 45 6E 76 2C 20 4B 65 79 
     578   00:5B91  6F 6E 2C 20 43 6F 6D 6D 61 6E 64 2C 20 41 63 74 
     578   00:5BA1  69 76 65 28 6E 6F 74 65 29 00 
     579   00:5BAB                      
     580   00:5BAB                      	
     581   00:5BAB                      	
     582   00:5BAB                      font_data:
     583   00:5BAB  (0800)              	incbin	".\fontpat.bin"
     584   00:63AB                      
     585   00:63AB                      ;	include ".\sfx.asm"
     586   00:63AB                      	
     587   00:63AB                      ;sfx_PSG_STREAMS:
     588   00:63AB                      ;sfx_SCC_STREAMS:
     589   00:63AB                      ;	dw	sfx1
     590   00:63AB                      ;	dw	sfx2
     591   00:63AB                      ;	dw	sfx3
     592   00:63AB                      ;	dw	sfx4
     593   00:63AB                      ;	dw	sfx5
     594   00:63AB                      ;
     595   00:63AB                      ;
     596   00:63AB                      ;
     597   00:63AB                      ;sfx1:
     598   00:63AB                      ;	db	1,4*8
     599   00:63AB                      ;	incbin	"..\ttsfxplay\sfx\menu1.afx"
     600   00:63AB                      ;sfx2:
     601   00:63AB                      ;	db	1,2*8
     602   00:63AB                      ;	incbin	"..\ttsfxplay\sfx\menu2.afx"	
     603   00:63AB                      ;sfx3:
     604   00:63AB                      ;	db	1,3*8
     605   00:63AB                      ;	incbin	"..\ttsfxplay\sfx\menu3.afx"
     606   00:63AB                      ;sfx4:
     607   00:63AB                      ;	db	1,5*8
     608   00:63AB                      ;	incbin	"..\ttsfxplay\sfx\menu4.afx"
     609   00:63AB                      ;sfx5:
     610   00:63AB                      ;	db	1,6*8
     611   00:63AB                      ;	incbin	"..\ttsfxplay\sfx\menu5.afx"
     612   00:63AB                      ;
     613   00:63AB                      	
     614   00:63AB                      	
     615   00:63AB  (C000)              	map	0xc000
     616   00:63AB                      	include	"..\code\ttreplaySMSRAM.asm"
       1.  00:63AB                      ;================================
       2.  00:63AB                      ; The new replayer.
       3.  00:63AB                      ;
       4.  00:63AB                      ; Persistent RAM unswappable
       5.  00:63AB                      ;
       6.  00:63AB                      ;================================
       7.  00:63AB                      
       8.  00:63AB  (00:FFFFFFEF)       TRACK_Instrument		equ 0-17
       9.  00:63AB  (00:FFFFFFF0)       TRACK_Command			equ 1-17
      10.  00:63AB  (00:FFFFFFF1)       TRACK_MacroPointer		equ 2-17
      11.  00:63AB  (00:FFFFFFF3)       TRACK_MacroStart		equ 4-17
      12.  00:63AB  (00:FFFFFFF5)       TRACK_MacroRestart 		equ 6-17		; no longer needed
      13.  00:63AB  (00:FFFFFFF6)       TRACK_Note				equ 7-17
      14.  00:63AB  (00:FFFFFFF7)       TRACK_Volume			equ 8-17
      15.  00:63AB  (00:FFFFFFF8)       TRACK_Voice				equ 9-17
      16.  00:63AB  (00:FFFFFFF9)       TRACK_Flags				equ 10-17
      17.  00:63AB                      	; 0 = note trigger
      18.  00:63AB                      	; 1 = note active
      19.  00:63AB                      	; 4 = morph active		;-< for SCC when 1 then waveform is following morph buffer
      20.  00:63AB                      	; 3 = command trigger
      21.  00:63AB                      	; 2 = envelope trigger
      22.  00:63AB                      	; 5 = instrument trigger
      23.  00:63AB                      	; 6 = waveform trigger
      24.  00:63AB                      	; 7 = PSG/SCC
      25.  00:63AB  (00:FFFFFFFA)       TRACK_empty				equ 11-17		; needed for pushing 0 at note start
      26.  00:63AB  (00:FFFFFFFB)       TRACK_ToneAdd			equ 12-17		; reset after note set
      27.  00:63AB  (00:FFFFFFFD)       TRACK_VolumeAdd			equ 14-17		; reset after note set
      28.  00:63AB  (00:FFFFFFFE)       TRACK_Noise				equ 15-17	;[OBSOLETE]	; reset after note set
      29.  00:63AB  (00:FFFFFFFF)       TRACK_cmd_VolumeAdd		equ 16-17		; reset after note set
      30.  00:63AB  (00:0000)           TRACK_cmd_ToneSlideAdd		equ 17-17		; reset after note set
      31.  00:63AB  (00:0002)           TRACK_cmd_ToneAdd			equ 19-17		; reset after note set
      32.  00:63AB  (00:0004)           TRACK_cmd_detune			equ 21-17
      33.  00:63AB  (00:0006)           TRACK_cmd_0				equ 23-17
      34.  00:63AB  (00:0007)           TRACK_cmd_1				equ 24-17
      35.  00:63AB  (00:0008)           TRACK_cmd_2				equ 25-17
      36.  00:63AB  (00:0009)           TRACK_cmd_3				equ 26-17
      37.  00:63AB  (00:000A)           TRACK_cmd_4_depth			equ 27-17
      38.  00:63AB  (00:000C)           TRACK_cmd_4_step			equ 29-17
      39.  00:63AB  (00:000D)           TRACK_cmd_NoteAdd			equ 30-17		;x reset after note set
      40.  00:63AB  (00:000E)           TRACK_cmd_A				equ 31-17		
      41.  00:63AB  (00:000F)           TRACK_cmd_B				equ 32-17		
      42.  00:63AB  (00:0010)           TRACK_cmd_E				equ 33-17
      43.  00:63AB  (00:0011)           TRACK_Timer				equ 34-17		; used for timing by all cmd's
      44.  00:63AB  (00:0012)           TRACK_Step				equ 35-17		; only for VIBRATO???
      45.  00:63AB  (00:0013)           TRACK_Delay				equ 36-17		; rows to wait till next data
      46.  00:63AB                      ;TRACK_Retrig			equ 35-17		; rows to retrigger command
      47.  00:63AB  (00:0014)           TRACK_prevDelay			equ 37-17
      48.  00:63AB  (00:0015)           TRACK_cmd_A_add			equ 38-17		;<< Still in use???
      49.  00:63AB                      
      50.  00:63AB  (00:0027)           TRACK_REC_SIZE			equ 39
      51.  00:63AB                      
      52.  00:63AB                      
      53.  00:63AB  (00:0000)           B_TRGNOT				equ 0			; note trigger
      54.  00:63AB  (00:0001)           B_ACTNOT				equ 1			; note active
      55.  00:63AB  (00:0002)           B_TRGENV				equ 2			; envelope trigger
      56.  00:63AB  (00:0003)           B_TRGCMD				equ 3			; command active
      57.  00:63AB  (00:0004)           B_KEYON					equ 4			; for fm note trigger
      58.  00:63AB  (00:0005)           B_SUST					equ 5			; for fm note sustain
      59.  00:63AB  (00:0006)           B_TRGVOI				equ 6			; custom voice trigger	
      60.  00:63AB  (00:0007)           B_PSGFM					equ 7			; chip type (PSG or FM)	
      61.  00:63AB                      
      62.  00:63AB                      ;B_ACTMOR			equ 4			; morph active
      63.  00:63AB                      ;B_TRGINS			equ 5			; instrument trigger
      64.  00:63AB                      ;B_TRGWAV			equ 6			; waveform trigger
      65.  00:63AB                      
      66.  00:63AB                      
      67.  00:63AB  (00:C000)           _SP_Storage				#2			; to store the SP
      68.  00:63AB                      
      69.  00:63AB  (00:C002)           replay_trigger			#1			; trigger byte.
      70.  00:63AB  (00:C003)           replay_mainPSGvol		#2			; volume mixer for PSG SCC balance
      71.  00:63AB  (00:C005)           replay_mainSCCvol		#2			; volume mixer for PSG SCC balance
      72.  00:63AB                      ;replay_songbase:		#2			; pointer to song data
      73.  00:63AB                      
      74.  00:63AB                      ; Do not move these
      75.  00:63AB  (00:C007)           replay_voicebase:		#2			; pointer to custom voice data
      76.  00:63AB  (00:C009)           replay_drumbase:		#2			; pointer to drum macro data
      77.  00:63AB  (00:C00B)           replay_insbase:			#2			; pointer to instrument data
      78.  00:63AB  (00:C00D)           TRACK_pointer1			#2
      79.  00:63AB  (00:C00F)           TRACK_pointer2			#2
      80.  00:63AB  (00:C011)           TRACK_pointer3			#2
      81.  00:63AB  (00:C013)           TRACK_pointer4			#2
      82.  00:63AB  (00:C015)           TRACK_pointer5			#2
      83.  00:63AB  (00:C017)           TRACK_pointer6			#2
      84.  00:63AB  (00:C019)           TRACK_pointer7			#2
      85.  00:63AB  (00:C01B)           TRACK_pointer8			#2
      86.  00:63AB                      ; / Do not move above
      87.  00:63AB                      
      88.  00:63AB                      
      89.  00:63AB                      
      90.  00:63AB  (00:C01D)           replay_orderpointer:	#2			; pointer to the order track list pointers
      91.  00:63AB                      
      92.  00:63AB  (00:C01F)           replay_speed 			#1			; speed to replay (get from song)
      93.  00:63AB  (00:C020)           replay_speed_subtimer 	#1			; counter for finer speed
      94.  00:63AB  (00:C021)           replay_speed_timer 		#1 			; counter for speed
      95.  00:63AB  (00:C022)           replay_mode 			#1			; Replayer status
      96.  00:63AB                      ; mode 0  = no sound output
      97.  00:63AB                      ; mode 1  = replay song 
      98.  00:63AB  (00:C023)           replay_chan_setup		#1			; 0 = 2 psg+ 6 fm, 1 = 3psg + 5 fm
      99.  00:63AB  (00:C024)           replay_arp_speed		#1			; arpeggio speed ( 0 = fast, $f = slowest)
     100.  00:63AB  (00:C025)           replay_fade				#1			; Fade active (value = fade speed)
     101.  00:63AB  (00:C026)           replay_fade_timer		#1			; Timer for fade
     102.  00:63AB  (00:C027)           replay_fade_vol			#1			; fade volume to lower the channel volume.
     103.  00:63AB                      
     104.  00:63AB  (00:C028)           replay_previous_note	#1			; previous note played
     105.  00:63AB  (00:C029)           replay_mainvol			#2			; the volume correction.
     106.  00:63AB                      
     107.  00:63AB  (00:C02B)           replay_vib_table		#2			; pointer to the vibrato table
     108.  00:63AB                      ;replay_tonetable_PSG	#2			; ToneTable (affected by transpose);
     109.  00:63AB                      ;replay_tonetable_FM	#2			; ToneTable (affected by transpose);
     110.  00:63AB  (00:C02D)           replay_tonetable		#2			; Current tonetable to read from
     111.  00:63AB                      
     112.  00:63AB  (00:C02F)           equalization_freq:		#1	; vdp type for correct playback on 60hz 0=50Hx, >0=60Hz
     113.  00:63AB  (00:C030)           equalization_cnt:		#1	; counter for correct playback on 60hz
     114.  00:63AB  (00:C031)           equalization_flag:		#1	; flag indicating if only instruments need to be processed.
     115.  00:63AB                      
     116.  00:63AB                      
     117.  00:63AB                      
     118.  00:63AB  (00:C032)           TRACK_Chan1				#TRACK_REC_SIZE
     119.  00:63AB  (00:C059)           TRACK_Chan2				#TRACK_REC_SIZE
     120.  00:63AB  (00:C080)           TRACK_Chan3				#TRACK_REC_SIZE
     121.  00:63AB  (00:C0A7)           TRACK_Chan4				#TRACK_REC_SIZE
     122.  00:63AB  (00:C0CE)           TRACK_Chan5				#TRACK_REC_SIZE
     123.  00:63AB  (00:C0F5)           TRACK_Chan6				#TRACK_REC_SIZE
     124.  00:63AB  (00:C11C)           TRACK_Chan7				#TRACK_REC_SIZE
     125.  00:63AB  (00:C143)           TRACK_Chan8				#TRACK_REC_SIZE
     126.  00:63AB                      
     127.  00:63AB                      
     128.  00:63AB                      
     129.  00:63AB                      ;--- AY SPECIFIC
     130.  00:63AB  (00:C16A)           PSG_registers			#0 
     131.  00:63AB  (00:C16A)           PSG_regToneA 			#2	; Tone A freq low (8bit)
     132.  00:63AB                      						; Tone A freq high (4bit)
     133.  00:63AB  (00:C16C)           PSG_regToneB 			#2	; Tone B freq low
     134.  00:63AB                      						; Tone B freq high
     135.  00:63AB  (00:C16E)           PSG_regToneC 			#2	; Tone C freq low
     136.  00:63AB                      						; Tone C freq high
     137.  00:63AB  (00:C170)           PSG_regNOISE 			#1	; Noise freq (5bit)
     138.  00:63AB  (00:C171)           PSG_regMIXER 			#1	;0x38	;x3f	; Mixer control (1 = off, 0 = on)
     139.  00:63AB  (00:C172)           PSG_regVOLA 			#1	; Chan A volume
     140.  00:63AB  (00:C173)           PSG_regVOLB 			#1	; Chan B volume
     141.  00:63AB  (00:C174)           PSG_regVOLC  			#1	; Chan C volume
     142.  00:63AB  (00:C175)           PSG_regVOLN				#1
     143.  00:63AB  (00:C176)           PSG_regNOISEold			#1
     144.  00:63AB  (00:C177)           GG_panning				#1
     145.  00:63AB                      ;PSG_regEnvL 			#1	; Volume Env Freq low (8bit)	
     146.  00:63AB                      ;PSG_regEnvH 			#1	; Volume Env Freq high (4bit)
     147.  00:63AB                      ;PSG_regEnvShape 		#1	; Volume Env Shape (4bit)
     148.  00:63AB                      
     149.  00:63AB                      ;--- SCC SPECIFIC
     150.  00:63AB                      ;
     151.  00:63AB                      ;_0x9800:	#32			; Waveform data
     152.  00:63AB                      ;_0x9820:	#32
     153.  00:63AB                      ;_0x9840:	#32
     154.  00:63AB                      ;_0x9860:	#32
     155.  00:63AB                      
     156.  00:63AB  (00:C178)           FM_Registers: 	#0	; contains the registers values to write and value previously written
     157.  00:63AB  (00:C178)           FM_regToneA 	#2	; Tone A freq low (8bit)			; Tone A freq high (1bit)
     158.  00:63AB  (00:C17A)           FM_regToneAb 	#2	; Tone A freq low (8bit)			; Tone A freq high (1bit)
     159.  00:63AB  (00:C17C)           FM_regVOLA		#1	; Chan A volume
     160.  00:63AB  (00:C17D)           FM_regVOLAb		#1	; Chan A volume
     161.  00:63AB  (00:C17E)           FM_regToneB 	#2	; Tone B freq low					; Tone B freq high
     162.  00:63AB  (00:C180)           FM_regToneBb 	#2	; Tone B freq low					; Tone B freq high
     163.  00:63AB  (00:C182)           FM_regVOLB		#1	; Chan B volume
     164.  00:63AB  (00:C183)           FM_regVOLBb		#1	; Chan B volume
     165.  00:63AB  (00:C184)           FM_regToneC 	#2	; Tone C freq low					; Tone C freq high
     166.  00:63AB  (00:C186)           FM_regToneCb 	#2	; Tone C freq low					; Tone C freq high
     167.  00:63AB  (00:C188)           FM_regVOLC	 	#1	; Chan C volume
     168.  00:63AB  (00:C189)           FM_regVOLCb	 	#1	; Chan C volume
     169.  00:63AB  (00:C18A)           FM_regToneD 	#2	; Tone D freq low					; Tone D freq high
     170.  00:63AB  (00:C18C)           FM_regToneDb 	#2	; Tone D freq low					; Tone D freq high
     171.  00:63AB  (00:C18E)           FM_regVOLD		#1	; Chan D volume
     172.  00:63AB  (00:C18F)           FM_regVOLDb		#1	; Chan D volume
     173.  00:63AB  (00:C190)           FM_regToneE 	#2	; Tone E freq low					; Tone E freq high
     174.  00:63AB  (00:C192)           FM_regToneEb 	#2	; Tone E freq low					; Tone E freq high
     175.  00:63AB  (00:C194)           FM_regVOLE	  	#1	; Chan E volume
     176.  00:63AB  (00:C195)           FM_regVOLEb	  	#1	; Chan E volume
     177.  00:63AB  (00:C196)           FM_regToneF 	#2	; Tone E freq low					; Tone F freq high
     178.  00:63AB  (00:C198)           FM_regToneFb 	#2	; Tone E freq low					; Tone F freq high
     179.  00:63AB  (00:C19A)           FM_regVOLF	  	#1	; Chan F volume
     180.  00:63AB  (00:C19B)           FM_regVOLFb	  	#1	; Chan F volume
     181.  00:63AB                      
     182.  00:63AB  (00:C19C)           DRUM_regToneBD	#2
     183.  00:63AB  (00:C19E)           DRUM_regToneBDb	#2
     184.  00:63AB  (00:C1A0)           DRUM_regVolBD	#1
     185.  00:63AB  (00:C1A1)           DRUM_regVolBDb	#1
     186.  00:63AB  (00:C1A2)           DRUM_regToneSH	#2
     187.  00:63AB  (00:C1A4)           DRUM_regToneSHb	#2
     188.  00:63AB  (00:C1A6)           DRUM_regVolSH	#1
     189.  00:63AB  (00:C1A7)           DRUM_regVolSHb	#1
     190.  00:63AB  (00:C1A8)           DRUM_regToneCT	#2
     191.  00:63AB  (00:C1AA)           DRUM_regToneCTb	#2
     192.  00:63AB  (00:C1AC)           DRUM_regVolCT	#1
     193.  00:63AB  (00:C1AD)           DRUM_regVolCTb	#1
     194.  00:63AB  (00:C1AE)           FM_DRUM		#1	; Percussion bits
     195.  00:63AB  (00:C1AF)           FM_DRUM_Flags		#1	; 7, percusion, 6,4,2 = tone update, 5,3,1 = vol update
     196.  00:63AB  (00:C1B0)           FM_freqreg1			#2	; Base drum
     197.  00:63AB  (00:C1B2)           FM_volreg1			#1	; Drum (low)
     198.  00:63AB  (00:C1B3)           FM_freqreg2			#2	; Snare + HiHat
     199.  00:63AB  (00:C1B5)           FM_volreg2			#1	; Snare(low) Hihat(High)
     200.  00:63AB  (00:C1B6)           FM_freqreg3			#2	; Cymbal + TomTom
     201.  00:63AB  (00:C1B8)           FM_volreg3			#1	; Cymbal(low) TomTom (High)
     202.  00:63AB                      
     203.  00:63AB  (00:C1B9)           FM_DRUM_LEN			#1	; Length of drum macro
     204.  00:63AB  (00:C1BA)           FM_DRUM_MACRO		#2	; Pointer to drum macro data
     205.  00:63AB                      
     206.  00:63AB  (00:C1BC)           FM_softvoice_req		#1	; Software voice requested
     207.  00:63AB  (00:C1BD)           FM_softvoice_set 		#1	; Software voice currently loaded
     208.  00:63AB                      
     209.  00:63AB                      
     210.  00:63AB                      ; DEze lijkt niet meer nodig
     211.  00:63AB  (00:C1BE)           FM_regMIXER 		#1	; x3f	; Mixer control (1 = off, 0 = on)
     212.  00:63AB                      
     213.  00:63AB                      
     214.  00:63AB                      
     215.  00:63AB                      
     216.  00:63AB                      ;/// see to remove this.
     217.  00:63AB                      ;-- SCC registers
     218.  00:63AB  (00:C1BF)           oldregs:	#(32*4)+(3*5)+1		; a way to int the SCC
     219.  00:63AB                      
     220.  00:63AB                      
     617   00:63AB                      	
     618   00:63AB                      
     619   00:63AB  (00:C24F)           debug_pointer1:	#2
     620   00:63AB  (00:C251)           debug_pointer2:	#2	
     621   00:63AB  (00:C253)           debug_pnt:		#8*80
     622   00:63AB  (00:C4D3)           TEXT_Chan		#40
     623   00:63AB                      
     624   00:63AB                      	
     625   00:63AB                      ;	include	"..\ttsfxplay\ttsfxplay_RAM.asm"
     626   00:63AB  (00:C4FB)           pattern	#1

    LABELS
-------------------------------------------------
00:00004010   initmain
00:000040B2   infinite
00:000040D2   isr
00:000040F6   write_debug
00:00004103   _wd_loop
00:0000410C   clear_debug
00:0000411A   debuginfo
00:00004123   debuginfo.loop
00:00004165   step_debug
00:00004190   register_debug
00:000041CA   register_debug_loop
00:000041F1   REG_list
00:0000422D   clear_TEXT
00:00004239   debug_flags
00:000042A4   init_vdp
00:00000082   _UPLEFT
00:00000081   _HORIZONTAL
00:00000083   _UPRIGHT
00:00000080   _VERTICAL
00:00000087 X _VERTICAL_SMALL
00:00000086 X _VERTICAL_DOUBLE
00:0000008B X _VERTICAL_STEP
00:000000B0 X _ARROWLEFT
00:000000B1 X _ARROWRIGHT
00:000000AE X _LOOPSIGN
00:000000F1 X _TONE_OFF_SIGN
00:000000F2 X _TONE_ON_SIGN
00:000000F3 X _NOISE_OFF_SIGN
00:000000F4 X _NOISE_ON_SIGN
00:000000F5 X _ENV_OFF_SIGN
00:000000F6 X _ENV_ON_SIGN
00:000000BF X _CMD_SIGN
00:000000FE X _CURSOR
00:000000FC X MOUSE_CHR
00:00002000   _PNT
00:00002A00   _CNT
00:000042F0   clear_screen
00:00004305 X clear_cnt
00:0000431C X clear_files
00:00004337   draw_label
00:0000433F   draw_label_loop
00:00004349   draw_label_end
00:0000434B   draw_label_fast
00:0000435C X draw_fake_hex_sp
00:00004372 X draw_fake_hex_sp_small
00:0000437D X draw_hex_sp_small
00:00004385   draw_hex
00:00004387 X draw_fakehex
00:00004390   draw_hex_small
00:00004395   draw_hex2
00:000043A4 X conv_decimal
00:000043A5   draw_decimal
00:000043B2   _dd_Num1
00:000043B4   _dd_Num2
00:000043BC   draw_decimal3
00:000043C4 X draw_box
00:000043CE   draw_box_loop1
00:000043CF   draw_box_loop0
00:00004408   draw_box_end
00:0000440A X draw_colorbox
00:00004417   _dc_maskleft_loop
00:00004432   _dc_maskright_loop
00:00004455   _dc_start_loop
00:00004474   _cb_copyloop_main
00:00004499   _cb_copyloop
00:000044BA   _cp_clip_copy
00:000044DC X erase_colorbox
00:000044E9   _ecb_maskleft_loop
00:00004506   _ecb_maskright_loop
00:0000452B   _ecb_start_loop
00:0000454A   _ecb_copyloop_main
00:0000456F   _ecb_copyloop
00:00004590   _ecb_clip_copy
00:000045B2   set_vdpwrite
00:000045CF   set_vdpread
00:00000000   cb_maskleft
00:00000001   cb_maskright
00:00000002   cb_fullbytes
00:00000003 X cb_status
00:000045EA   init_font
00:000045F9   _fontloop
00:0000007C   FM_WRITE
00:0000007D   FM_DATA
00:00000060   _REL
00:00000061   _SUS
00:00000062   _VOL
00:00000071   _INS
00:00000090   _CMD
00:000000B8 X _SPC
00:000000BF   _EOT
00:000000C0   _WAIT
00:00004602   replay_init
00:0000461E   replay_pause
00:00004625 X _r_pause_enable
00:0000462B   _r_pause_disable
00:00004647   _r_pause_loop
00:0000464C X replay_fade_out
00:00004657   replay_set_FM_balance
00:0000465E   replay_set_PSG_balance
00:00004665   _getnewbalancebase
00:00004673   replay_loadsong
00:00004721   replay_play
00:0000472C X replay_play.NTSC
00:00004740   replay_play.PAL
00:00004757 X decode_data
00:0000475D X decode_data.decode1
00:0000477E   decode_data.decode2
00:000047A2   decode_data.decode3
00:000047C0   decode_data.decode4
00:000047DE   decode_data.decode5
00:000047FC   decode_data.decode6
00:0000481A   decode_data.decode7
00:00004838   decode_data.decode8
00:00004856   decode_data.decode_end
00:00004856   process_data
00:000048A9 X _rdd_3psg_5fm
00:000048DC   _rdd_2psg_6fm
00:00004911   _rdd_cont
00:000049B4   _rdd_cont.cont_fadeing
00:000049BA   _rdd_cont.no_new_step
00:000049CE   _rdd_cont.calc_vol
00:000049D4   _rdd_cont.no_carry
00:000049D9   _replay_check_patternend
00:000049FD   _replay_check_patternend.no_restart
00:00004A0B   decode_data_chan
00:00004A1F   _rdn2
00:00004A24   _rdv2
00:00004A29   _rdi2
00:00004A31   _rdn
00:00004A39   _rdi
00:00004A41   _rdv
00:00004A49   _rdc
00:00004A4A   _rdc_noinc
00:00004A53   _rd_delay
00:00004A5C   _rd_eot
00:00004A63   _replay_decode_delay
00:00004A6F   _replay_decode_trigger_porttone_check
00:00004A87   _replay_decode_note
00:00004A93   _replay_decode_release
00:00004A9E   _replay_decode_sustain
00:00004AA9   _replay_decode_ins
00:00004ABE   _replay_decode_ins.skip
00:00004ACE   _replay_decode_ins.skip_soft
00:00004ADD   _replay_decode_ins.skip_ins
00:00004AE2   _replay_decode_vol
00:00004AF7   _replaydecode_cmd
00:00004B0B   _replaydecode_cmd.skip
00:00004B12   DECODE_CMDLIST
00:00004B40   decode_cmd0_arpeggio
00:00004B53   decode_cmd1_port_up
00:00004B5E   decode_cmd2_port_down
00:00004B69   decode_cmd3_port_tone
00:00004B86   decode_cmd3_port_tone_new_note
00:00004B97   decode_cmd3_port_tone_new_note.skip
00:00004BAF   decode_cmd3_port_tone_new_note.skip2
00:00004BCA   decode_cmd8_tremelo
00:00004BCA   decode_cmd4_vibrato
00:00004BDB   decode_cmd4_vibrato.depth
00:00004BF5   decode_cmd4_vibrato.end
00:00004BFA   decode_cmd5_vibrato_port_tone
00:00004C11   decode_cmd6_vibrato_vol
00:00004C11   decode_cmd7_vol_slide
00:00004C21   decode_cmd9_note_cut
00:00004C2C   decode_cmd10_note_delay
00:00004C4A   decode_cmd11_command_end
00:00004C4F   decode_cmd12_drum
00:00004C75   decode_cmd13_arp_speed
00:00004C7B   decode_cmd14_fine_up
00:00004C85   decode_cmd15_fine_down
00:00004C90   decode_cmd16_notelink
00:00004C97   decode_cmd17_track_detune
00:00004CAC   decode_cmd17_track_detune.pos
00:00004CB6   decode_cmd18_trigger
00:00004CBC   decode_cmd19_speed
00:00004CCF   decode_cmd20_tone_panning
00:00004CD2   decode_cmd21_noise_panning
00:00004CD5   decode_cmd22_chan_setup
00:00004CD8   process_data_chan
00:00004CF4   process_data_chan.skip
00:00004CF9   process_commandEND
00:00004CF9   process_note
00:00004CFE X process_triggerNote
00:00004D20   process_noNoteTrigger
00:00004D38   _vol_change
00:00004D3F X _vol_rel
00:00004D51   _vol_rel.skip
00:00004D52   _vol_base
00:00004D55   _noVolumeChange
00:00004D65   _noVolumeChange.skip2
00:00004D65 X _Vadd
00:00004D6F   _Vadd.skip
00:00004D79   _Vadd.skip2
00:00004D7E X _noVolume
00:00004D8D   _noNoise
00:00004DA6   _noNoise.skip
00:00004DAD   _noNoiseVol
00:00004DBB   _noLink
00:00004DD1   _noLink.skip
00:00004DD8   process_noToneAdd
00:00004DE1   process_noToneAdd.noend
00:00004DEE   process_noToneBit
00:00004E04   process_noToneBit.skip
00:00004E27 X _wrap_highcheck
00:00004E4E   _wrap_lowcheck
00:00004E71   _wrap_skip
00:00004E81   process_noNoteActive
00:00004E94   PROCESS_CMDLIST
00:00004EAA   process_cmd0_arpeggio
00:00004ECE   process_cmd0_arpeggio.nextNote
00:00004F1B   process_cmd1_port_up
00:00004F2F   process_cmd2_port_down
00:00004F43   process_cmd3_port_tone
00:00004F51 X process_cmd3_add
00:00004F59   process_cmd3_add.skip
00:00004F64   process_cmd3_sub
00:00004F79   process_cmd3_stop
00:00004F84   process_cmd8_tremelo
00:00004FAA   process_cmd4_vibrato
00:00004FC0 X process_cmd4_vibrato.neg
00:00004FD8   process_cmd4_vibrato.pos
00:00004FDF   process_cmd4_vibrato.zero
00:00004FE9   process_cmd5_vibrato_port_tone
00:00004FEF   process_cmd6_vibrato_vol
00:00004FF5   process_cmd7_vol_slide
00:00004FFB   process_cmdasub
00:00005010 X process_cmda_dec
00:00005018   process_cmda_inc
00:00005021   process_cmd9_note_cut
00:0000502E   process_cmd10_note_delay
00:00005041   replay_route
00:00005041 X route_SN
00:000050E2 X route_gg
00:000050E5 X route_FM
00:000050F2   route_FM.noVoice
00:000050FC   route_FM.channel_loop
00:0000512F X _route_FM_drum_update
00:0000514B   _route_FM_reg8_update
00:00005150   _route_FM_reg16_update
00:00005153   _rfr_cont
00:00005161   _route_FM_keyOff_update
00:00005170   load_softwarevoice
00:00005179   load_softwarevoice.voiceupd_loop
00:00005210   _VOLUME_TABLE
00:00005310   TRACK_ToneTable_PSG
00:000053D0   TRACK_ToneTable_FM
00:00005490   TRACK_Vibrato_sine
00:00005610   demo_song
00:00005617   demo_song.restart
00:0000566B   demo_song.customvoice_start
00:0000567B X demo_song.waveform_start
00:0000567B   demo_song.drummacro_start
00:00005681   demo_song.drum_00
00:00005681   demo_song.drum_01
00:00005681   demo_song.drum_04
00:00005681   demo_song.instrument_start
00:00005699   demo_song.instrument_00
00:000056C0   demo_song.rst_i00
00:000056C4   demo_song.instrument_01
00:000056C9   demo_song.rst_i01
00:000056CD   demo_song.instrument_02
00:000056FE   demo_song.rst_i02
00:00005702   demo_song.instrument_03
00:00005704   demo_song.rst_i03
00:00005708   demo_song.instrument_04
00:0000570A   demo_song.rst_i04
00:0000570E   demo_song.instrument_05
00:00005717   demo_song.rst_i05
00:0000571E   demo_song.instrument_06
00:00005720   demo_song.rst_i06
00:00005724   demo_song.instrument_07
00:0000572F   demo_song.rst_i07
00:00005733   demo_song.instrument_08
00:00005734   demo_song.rst_i08
00:00005738   demo_song.instrument_09
00:0000573F   demo_song.rst_i09
00:00005750   demo_song.instrument_10
00:0000577A   demo_song.rst_i10
00:00005780   demo_song.instrument_11
00:000057A7   demo_song.rst_i11
00:000057AB X demo_song.track_000
00:000057AE X demo_song.track_002
00:000057B0 X demo_song.track_004
00:00005804 X demo_song.track_005
00:00005852   demo_song.track_008
00:0000589F   demo_song.track_009
00:000058C5   demo_song.track_010
00:000058C7   demo_song.track_011
00:000058EF   demo_song.track_012
00:00005916   demo_song.track_013
00:00005935   demo_song.track_014
00:00005954   demo_song.track_015
00:0000597B   demo_song.track_016
00:000059D3   demo_song.track_017
00:000059F9   demo_song.track_021
00:00005A1B   demo_song.track_022
00:00005A73   demo_song.track_023
00:00005AC4 X demo_song.track_024
00:00005ACD X demo_song.track_025
00:00005AD4 X demo_song.track_027
00:00005ADE X demo_song.track_028
00:00005AE5 X demo_song.track_029
00:00005AEC X demo_song.track_030
00:00005AF3 X demo_song.track_031
00:00005AFA   TEXT_Title
00:00005B1F   TEXT_Step
00:00005B25   TEXT_Header_Data
00:00005B3D   TEXT_Register_Header
00:00005B60   TEXT_Register_Drum
00:00005B71   TEXT_Legend_Data
00:00005BAB   font_data
00:FFFFFFEF   TRACK_Instrument
00:FFFFFFF0   TRACK_Command
00:FFFFFFF1   TRACK_MacroPointer
00:FFFFFFF3   TRACK_MacroStart
00:FFFFFFF5 X TRACK_MacroRestart
00:FFFFFFF6   TRACK_Note
00:FFFFFFF7   TRACK_Volume
00:FFFFFFF8   TRACK_Voice
00:FFFFFFF9   TRACK_Flags
00:FFFFFFFA X TRACK_empty
00:FFFFFFFB   TRACK_ToneAdd
00:FFFFFFFD   TRACK_VolumeAdd
00:FFFFFFFE X TRACK_Noise
00:FFFFFFFF   TRACK_cmd_VolumeAdd
00:00000000   TRACK_cmd_ToneSlideAdd
00:00000002   TRACK_cmd_ToneAdd
00:00000004   TRACK_cmd_detune
00:00000006   TRACK_cmd_0
00:00000007   TRACK_cmd_1
00:00000008   TRACK_cmd_2
00:00000009   TRACK_cmd_3
00:0000000A   TRACK_cmd_4_depth
00:0000000C   TRACK_cmd_4_step
00:0000000D   TRACK_cmd_NoteAdd
00:0000000E   TRACK_cmd_A
00:0000000F X TRACK_cmd_B
00:00000010   TRACK_cmd_E
00:00000011   TRACK_Timer
00:00000012   TRACK_Step
00:00000013   TRACK_Delay
00:00000014   TRACK_prevDelay
00:00000015 X TRACK_cmd_A_add
00:00000027   TRACK_REC_SIZE
00:00000000   B_TRGNOT
00:00000001   B_ACTNOT
00:00000002 X B_TRGENV
00:00000003   B_TRGCMD
00:00000004   B_KEYON
00:00000005   B_SUST
00:00000006   B_TRGVOI
00:00000007   B_PSGFM
00:0000C000   _SP_Storage
00:0000C002   replay_trigger
00:0000C003   replay_mainPSGvol
00:0000C005   replay_mainSCCvol
00:0000C007   replay_voicebase
00:0000C009   replay_drumbase
00:0000C00B   replay_insbase
00:0000C00D   TRACK_pointer1
00:0000C00F   TRACK_pointer2
00:0000C011   TRACK_pointer3
00:0000C013   TRACK_pointer4
00:0000C015   TRACK_pointer5
00:0000C017   TRACK_pointer6
00:0000C019   TRACK_pointer7
00:0000C01B   TRACK_pointer8
00:0000C01D   replay_orderpointer
00:0000C01F   replay_speed
00:0000C020   replay_speed_subtimer
00:0000C021   replay_speed_timer
00:0000C022   replay_mode
00:0000C023   replay_chan_setup
00:0000C024   replay_arp_speed
00:0000C025   replay_fade
00:0000C026   replay_fade_timer
00:0000C027   replay_fade_vol
00:0000C028   replay_previous_note
00:0000C029   replay_mainvol
00:0000C02B X replay_vib_table
00:0000C02D   replay_tonetable
00:0000C02F   equalization_freq
00:0000C030   equalization_cnt
00:0000C031   equalization_flag
00:0000C032   TRACK_Chan1
00:0000C059   TRACK_Chan2
00:0000C080   TRACK_Chan3
00:0000C0A7   TRACK_Chan4
00:0000C0CE   TRACK_Chan5
00:0000C0F5   TRACK_Chan6
00:0000C11C   TRACK_Chan7
00:0000C143   TRACK_Chan8
00:0000C16A X PSG_registers
00:0000C16A   PSG_regToneA
00:0000C16C   PSG_regToneB
00:0000C16E   PSG_regToneC
00:0000C170   PSG_regNOISE
00:0000C171   PSG_regMIXER
00:0000C172   PSG_regVOLA
00:0000C173   PSG_regVOLB
00:0000C174   PSG_regVOLC
00:0000C175   PSG_regVOLN
00:0000C176   PSG_regNOISEold
00:0000C177   GG_panning
00:0000C178   FM_Registers
00:0000C178   FM_regToneA
00:0000C17A X FM_regToneAb
00:0000C17C   FM_regVOLA
00:0000C17D X FM_regVOLAb
00:0000C17E   FM_regToneB
00:0000C180 X FM_regToneBb
00:0000C182   FM_regVOLB
00:0000C183 X FM_regVOLBb
00:0000C184   FM_regToneC
00:0000C186 X FM_regToneCb
00:0000C188   FM_regVOLC
00:0000C189 X FM_regVOLCb
00:0000C18A   FM_regToneD
00:0000C18C X FM_regToneDb
00:0000C18E   FM_regVOLD
00:0000C18F X FM_regVOLDb
00:0000C190   FM_regToneE
00:0000C192 X FM_regToneEb
00:0000C194   FM_regVOLE
00:0000C195 X FM_regVOLEb
00:0000C196   FM_regToneF
00:0000C198 X FM_regToneFb
00:0000C19A   FM_regVOLF
00:0000C19B X FM_regVOLFb
00:0000C19C X DRUM_regToneBD
00:0000C19E X DRUM_regToneBDb
00:0000C1A0 X DRUM_regVolBD
00:0000C1A1 X DRUM_regVolBDb
00:0000C1A2 X DRUM_regToneSH
00:0000C1A4 X DRUM_regToneSHb
00:0000C1A6 X DRUM_regVolSH
00:0000C1A7 X DRUM_regVolSHb
00:0000C1A8 X DRUM_regToneCT
00:0000C1AA X DRUM_regToneCTb
00:0000C1AC X DRUM_regVolCT
00:0000C1AD X DRUM_regVolCTb
00:0000C1AE   FM_DRUM
00:0000C1AF X FM_DRUM_Flags
00:0000C1B0   FM_freqreg1
00:0000C1B2   FM_volreg1
00:0000C1B3   FM_freqreg2
00:0000C1B5   FM_volreg2
00:0000C1B6   FM_freqreg3
00:0000C1B8   FM_volreg3
00:0000C1B9   FM_DRUM_LEN
00:0000C1BA   FM_DRUM_MACRO
00:0000C1BC   FM_softvoice_req
00:0000C1BD   FM_softvoice_set
00:0000C1BE   FM_regMIXER
00:0000C1BF X oldregs
00:0000C24F   debug_pointer1
00:0000C251 X debug_pointer2
00:0000C253   debug_pnt
00:0000C4D3   TEXT_Chan
00:0000C4FB   pattern


 Output: main.rom
-------------------------------------------------

 Page: 00
  Org: 00004000  Size: 00008000  Used: 000023AB

   Address   Length Align   Label
   00004000    9131         initmain
   000063AB   23637       <empty>
