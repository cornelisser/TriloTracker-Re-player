Sjasm Z80 Assembler v0.42b8 - www.xl2s.tk             [2021.04.16 - 22:01:56]

main.asm
Errors: 0

       1   00:0000                      	defpage	0,0x4000, 0x8000		; page 0 contains main code + far call routines
       2   00:0000                      
       3   00:0000                      ; -----------------------------
       4   00:0000                      ; TT-replayer example
       5   00:0000                      ; 
       6   00:0000                      ; This example plays compiled PSG+SCC songs
       7   00:0000                      ; ------------------------------
       8   00:0000                      
       9   00:0000                      ;	include	".\code\variables.asm"
      10   00:0000                      
      11   00:0000  (00)                	page 0
      12   00:4000                      	code page 0
      13   00:4000                      	
      14   00:4000                      	org	04000h
      15   00:4000  41 42               	db	041h,042h
      16   00:4002  10 40               	dw	initmain
      17   00:4004                      	dz 	'TTDEMO'
      17   00:4004  54 54 44 45 4D 4F 00 
      18   00:400B  00 (5)              	ds	5
      19   00:4010                      		
      20   00:4010                      initmain:
      21   00:4010                      
      22   00:4010                      ;	ei
      23   00:4010                      ;	halt
      24   00:4010  F3                  	di
      25   00:4011                      		
      26   00:4011                      ;; set pages and subslot
      27   00:4011                      ;;
      28   00:4011  CD 38 01            	call    0x138
      29   00:4014  0F                  	rrca
      30   00:4015  0F                  	rrca
      31   00:4016  E6 03               	and     0x03
      32   00:4018  4F                  	ld      c,a
      33   00:4019  06 00               	ld      b,0
      34   00:401B  21 C1 FC            	ld      hl,0xfcc1
      35   00:401E  09                  	add     hl,bc
      36   00:401F  B6                  	or      (hl)
      37   00:4020  47                  	ld      b,a
      38   00:4021  23                  	inc     hl
      39   00:4022  23                  	inc     hl
      40   00:4023  23                  	inc     hl
      41   00:4024  23                  	inc     hl
      42   00:4025  7E                  	ld      a,(hl)
      43   00:4026  E6 0C               	and     0x0c
      44   00:4028  B0                  	or      b
      45   00:4029                          
      46   00:4029  26 80               	ld      h,0x80
      47   00:402B  CD 24 00            	call    0x24        
      48   00:402E                      	
      49   00:402E                      	;clear RAM (first kb only)
      50   00:402E  01 00 04            	ld	bc,1024
      51   00:4031  21 00 C0            	ld	hl,0xc000
      52   00:4034  11 01 C0            	ld	de,0xc001
      53   00:4037                      
      54   00:4037  36 00               	ld	(hl),0
      55   00:4039  ED B0               	ldir	
      56   00:403B                      
      57   00:403B                      	;--- place replayer on hook
      58   00:403B  3E C3               	ld	a,0xc3
      59   00:403D  21 D2 40            	ld	hl,isr
      60   00:4040  32 9A FD            	ld	(0xFD9A),a
      61   00:4043  22 9B FD            	ld	(0xFD9B),hl	
      62   00:4046                      	
      63   00:4046                      	
      64   00:4046                      	;--- Set speed equalization
      65   00:4046  3A E8 FF            	ld	a,($FFE8)	; get mirror of VDP reg# 9
      66   00:4049  E6 02               	and	2
      67   00:404B  CA 50 40            	jp	z,99f
      68   00:404E  3E FF               	ld	a,-1
      69   00:4050                      99:
      70   00:4050  3C                  	inc	a			; 1 = 60hz
      71   00:4051  32 2F C0            	ld	(equalization_freq),a
      72   00:4054  32 30 C0            	ld	(equalization_cnt),a
      73   00:4057                      	
      74   00:4057                      	;--- Init screen
      75   00:4057  CD A4 42            	call 	init_vdp
      76   00:405A  FB                  	ei
      77   00:405B  76                  	halt
      78   00:405C  F3                  	di
      79   00:405D  CD EA 45            	call	init_font		; set the new font
      80   00:4060                      	
      81   00:4060                      	;--- initialise replayer
      82   00:4060  CD 02 46            	call	replay_init
      83   00:4063                      ;	call	ttsfx_init
      84   00:4063  3E 01               	ld	a,1
      85   00:4065  32 2F C0            	ld	(equalization_freq),a
      86   00:4068  32 30 C0            	ld	(equalization_cnt),a	
      87   00:406B                      	;--- initialise demo song
      88   00:406B  21 56 57            	ld	hl,demo_song
      89   00:406E  CD 73 46            	call	replay_loadsong
      90   00:4071                      	
      91   00:4071                      	;--- initialise sfx pointers
      92   00:4071                      	
      93   00:4071                      	
      94   00:4071  CD 0C 41            	call	clear_debug
      95   00:4074                      	
      96   00:4074  FB                  	ei
      97   00:4075                      	
      98   00:4075  CD F0 42            	call	clear_screen
      99   00:4078  21 56 01            	ld	hl,80*4+22
     100   00:407B  11 93 5C            	ld	de,TEXT_Title
     101   00:407E  CD 37 43            	call	draw_label
     102   00:4081  21 04 02            	ld	hl,80*6+36
     103   00:4084  11 B8 5C            	ld	de,TEXT_Step
     104   00:4087  CD 37 43            	call	draw_label
     105   00:408A  21 84 02            	ld	hl,80*8+4
     106   00:408D  11 BE 5C            	ld	de,TEXT_Header_Data
     107   00:4090  CD 37 43            	call	draw_label	
     108   00:4093                      	
     109   00:4093  21 A6 02            	ld	hl,80*8+38
     110   00:4096  11 D6 5C            	ld	de,TEXT_Register_Header
     111   00:4099  CD 37 43            	call	draw_label		
     112   00:409C                      
     113   00:409C  21 48 04            	ld 	hl,80*13+56
     114   00:409F  11 F9 5C            	ld	de,TEXT_Register_Drum
     115   00:40A2  CD 37 43            	call	draw_label	
     116   00:40A5                      
     117   00:40A5  21 A4 05            	ld 	hl,80*18+4
     118   00:40A8  11 0A 5D            	ld	de,TEXT_Legend_Data
     119   00:40AB  CD 37 43            	call	draw_label	
     120   00:40AE                      
     121   00:40AE                      
     122   00:40AE                      	
     123   00:40AE  AF                  	xor	a
     124   00:40AF  32 61 C4            	ld	(pattern),a
     125   00:40B2                      
     126   00:40B2                      ;	call	replay_pause
     127   00:40B2                      ;	ld	bc,$0001
     128   00:40B2                      ;	call	ttsfx_start
     129   00:40B2                      	
     130   00:40B2                      infinite:
     131   00:40B2  76                  	halt	
     132   00:40B3                      ;	call	register_debug
     133   00:40B3                      
     134   00:40B3                      	
     135   00:40B3                      ;	ld	a,$f0 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     136   00:40B3                      ;	out	(0x99),a
     137   00:40B3                      ;	ld	a,7+128
     138   00:40B3                      ;	out	(0x99),a	
     139   00:40B3                      
     140   00:40B3                      
     141   00:40B3                      	
     142   00:40B3                      ;	ld	a,$f3 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     143   00:40B3                      ;	out	(0x99),a
     144   00:40B3                      ;	ld	a,7+128
     145   00:40B3                      ;	out	(0x99),a
     146   00:40B3                      	
     147   00:40B3                      ;	ld	a,$f0
     148   00:40B3                      ;	out	(0x99),a
     149   00:40B3                      ;	ld	a,7+128
     150   00:40B3                      ;	out	(0x99),a	
     151   00:40B3                      	;--- display debug info
     152   00:40B3  CD 1A 41            	call	debuginfo	
     153   00:40B6  CD 90 41            	call	register_debug
     154   00:40B9  CD 65 41            	call	step_debug
     155   00:40BC                      	
     156   00:40BC                      	
     157   00:40BC                      	
     158   00:40BC                      	
     159   00:40BC                      	;---- Test for space
     160   00:40BC  AF                  	xor	a
     161   00:40BD  CD D8 00            	call	$00D8
     162   00:40C0  A7                  	and	a
     163   00:40C1  CA B2 40            	jp	z,infinite
     164   00:40C4                      
     165   00:40C4                      ;	call	replay_pause
     166   00:40C4  01 01 00            	ld	bc,$0001
     167   00:40C7                      ;	call	ttsfx_start
     168   00:40C7                      ;	ld	a,0
     169   00:40C7                      ;	call	replay_set_SCC_balance
     170   00:40C7                      ;	ld	de,-2
     171   00:40C7                      ;	call	replay_transpose	
     172   00:40C7                      ;	ld	a,32
     173   00:40C7                      ;	call	replay_fade_out
     174   00:40C7                      ;	call	replay_pause
     175   00:40C7                      	; wait_key_release
     176   00:40C7                      99:	
     177   00:40C7  AF                  	xor	a
     178   00:40C8  CD D8 00            	call	$00D8
     179   00:40CB  A7                  	and	a
     180   00:40CC  C2 C7 40            	jp	nz,99b
     181   00:40CF                      	
     182   00:40CF  C3 B2 40            	jp	infinite
     183   00:40D2                      
     184   00:40D2                      	
     185   00:40D2                      	
     186   00:40D2                      isr:
     187   00:40D2  DB 99               	in	a,(0x99)
     188   00:40D4  CD F6 40            	call	write_debug
     189   00:40D7  3E FC               	ld	a,$fc ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     190   00:40D9  D3 99               	out	(0x99),a
     191   00:40DB  3E 87               	ld	a,7+128
     192   00:40DD  D3 99               	out	(0x99),a	
     193   00:40DF  CD 86 51            	call	replay_route		; first outout data
     194   00:40E2  3E F4               	ld	a,$f4 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     195   00:40E4  D3 99               	out	(0x99),a
     196   00:40E6  3E 87               	ld	a,7+128
     197   00:40E8  D3 99               	out	(0x99),a		
     198   00:40EA  CD 1E 47            	call	replay_play			; calculate next output
     199   00:40ED  3E F0               	ld	a,$f0 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     200   00:40EF  D3 99               	out	(0x99),a
     201   00:40F1  3E 87               	ld	a,7+128
     202   00:40F3  D3 99               	out	(0x99),a	
     203   00:40F5                      ;	call	ttsfx_play
     204   00:40F5                      
     205   00:40F5                      
     206   00:40F5                      
     207   00:40F5  C9                  	ret
     208   00:40F6                      	
     209   00:40F6                      write_debug:
     210   00:40F6  21 D0 22            	ld 	hl,_PNT+(80*9)
     211   00:40F9  CD B2 45            	call	set_vdpwrite	
     212   00:40FC                      
     213   00:40FC  21 B9 C1            	ld 	hl,debug_pnt
     214   00:40FF  3E 08               	ld	a,8
     215   00:4101  0E 98               	ld	c,$98
     216   00:4103                      _wd_loop:
     217   00:4103  06 50               	ld	b,80
     218   00:4105  ED B3               	otir
     219   00:4107                      	
     220   00:4107  3D                  	dec	a
     221   00:4108  C2 03 41            	jp	nz,_wd_loop
     222   00:410B                      
     223   00:410B  C9                  	ret
     224   00:410C                      	
     225   00:410C                      clear_debug:
     226   00:410C  21 B9 C1            	ld	hl,debug_pnt
     227   00:410F  11 BA C1            	ld	de,debug_pnt+1
     228   00:4112  36 20               	ld	(hl),32
     229   00:4114  01 7F 02            	ld	bc,(8*80)-1
     230   00:4117  ED B0               	ldir
     231   00:4119  C9                  	ret
     232   00:411A                      
     233   00:411A                      debuginfo:
     234   00:411A                      ;	ld	bc,40
     235   00:411A                      ;	call	clear_TEXT
     236   00:411A                      	
     237   00:411A  06 08               	ld	b,8
     238   00:411C  DD 21 43 C0         	ld	ix,TRACK_Chan1+17
     239   00:4120  11 BD C1            	ld	de,debug_pnt+4
     240   00:4123                      .loop	
     241   00:4123  C5                  	push	bc
     242   00:4124  D5                  	push	de
     243   00:4125                      	
     244   00:4125  3E 09               	ld	a,9
     245   00:4127  90                  	sub	b
     246   00:4128  CD A5 43            	call	draw_decimal
     247   00:412B  13                  	inc	de
     248   00:412C  DD 7E F6            	ld	a,(ix+TRACK_Note)
     249   00:412F  CD 95 43            	call	draw_hex2
     250   00:4132  13                  	inc 	de
     251   00:4133  DD 7E EF            	ld	a,(ix+TRACK_Instrument)
     252   00:4136  CD 95 43            	call	draw_hex2
     253   00:4139  13                  	inc 	de
     254   00:413A  DD 7E F8            	ld	a,(ix+TRACK_Voice)
     255   00:413D  CD 95 43            	call	draw_hex2
     256   00:4140  13                  	inc 	de	
     257   00:4141  DD 7E F7            	ld	a,(ix+TRACK_Volume)
     258   00:4144  CD 95 43            	call	draw_hex2
     259   00:4147  13                  	inc 	de
     260   00:4148  DD 7E F0            	ld	a,(ix+TRACK_Command)
     261   00:414B  CD 95 43            	call	draw_hex2	
     262   00:414E  13                  	inc 	de
     263   00:414F                      
     264   00:414F  EB                  	ex	de,hl
     265   00:4150  DD 46 F9            	ld	b,(ix+TRACK_Flags)
     266   00:4153  CD 39 42            	call 	debug_flags
     267   00:4156                      
     268   00:4156                      
     269   00:4156                      	; next line
     270   00:4156  E1                  	pop	hl
     271   00:4157  11 50 00            	ld	de,80
     272   00:415A  19                  	add	hl,de
     273   00:415B  EB                  	ex	de,hl
     274   00:415C                      	
     275   00:415C                      
     276   00:415C                      	;--- Next track
     277   00:415C  01 27 00            	ld	bc,TRACK_REC_SIZE
     278   00:415F  DD 09               	add	ix,bc
     279   00:4161                      	
     280   00:4161  C1                  	pop	bc
     281   00:4162  10 BF               	djnz	.loop
     282   00:4164  C9                  	ret
     283   00:4165                      
     284   00:4165                      step_debug:
     285   00:4165  01 07 00            	ld	bc,7
     286   00:4168  CD 2D 42            	call	clear_TEXT
     287   00:416B  2A 1D C0            	ld	hl,(replay_orderpointer)
     288   00:416E  11 5D 57            	ld	de,demo_song+7
     289   00:4171  AF                  	xor 	a
     290   00:4172  ED 52               	sbc	hl,de
     291   00:4174  29                  	add	hl,hl		;X2
     292   00:4175  29                  	add	hl,hl		;X4	
     293   00:4176  29                  	add	hl,hl		;X8
     294   00:4177  29                  	add	hl,hl		;X16
     295   00:4178  7C                  	ld	a,h
     296   00:4179  3D                  	dec	a
     297   00:417A  21 B5 C1            	ld	hl,debug_pointer1
     298   00:417D  77                  	ld	(hl),a
     299   00:417E  11 39 C4            	ld	de,TEXT_Chan
     300   00:4181  CD BC 43            	call	draw_decimal3
     301   00:4184                      	
     302   00:4184  21 09 02            	ld	hl,80*6+41
     303   00:4187  11 39 C4            	ld	de,TEXT_Chan
     304   00:418A  06 03               	ld	b,3
     305   00:418C  CD 4B 43            	call	draw_label_fast
     306   00:418F  C9                  	ret
     307   00:4190                      	
     308   00:4190                      
     309   00:4190                      register_debug:
     310   00:4190                      ;	ld	bc,7
     311   00:4190                      ;	call	clear_TEXT
     312   00:4190  21 F1 41            	ld	hl,REG_list
     313   00:4193                      	
     314   00:4193                      	;	DRAW PSG Tone vol	
     315   00:4193  FD 2E 03            	ld	iyl,3
     316   00:4196  11 E8 C1            	ld 	de,debug_pnt+47
     317   00:4199                      ;	ld	(debug_pointer1),bc
     318   00:4199  CD CA 41            	call	register_debug_loop
     319   00:419C                      
     320   00:419C                      	;	DRAW PSG Noise and mixer	
     321   00:419C  FD 2E 01            	ld	iyl,1
     322   00:419F  11 F1 C1            	ld 	de,debug_pnt+56
     323   00:41A2                      ;	ld	(debug_pointer1),bc
     324   00:41A2  CD CA 41            	call	register_debug_loop	
     325   00:41A5                      	
     326   00:41A5                      	;	DRAW PSG Envelop + shape
     327   00:41A5  FD 2E 01            	ld	iyl,1
     328   00:41A8  11 FA C1            	ld 	de,debug_pnt+65
     329   00:41AB                      ;	ld	(debug_pointer1),bc
     330   00:41AB  CD CA 41            	call	register_debug_loop		
     331   00:41AE                      
     332   00:41AE                      	;	DRAW FM Tone Vol	
     333   00:41AE  FD 2E 06            	ld	iyl,6
     334   00:41B1  11 7F C2            	ld 	de,debug_pnt+(80*2)+38
     335   00:41B4                      ;	ld	(debug_pointer1),bc
     336   00:41B4  CD CA 41            	call	register_debug_loop
     337   00:41B7                      	
     338   00:41B7                      	
     339   00:41B7                      	;	DRAW FM Drum macro + percusion
     340   00:41B7  FD 2E 01            	ld	iyl,1
     341   00:41BA  11 81 C3            	ld 	de,debug_pnt+(80*5)+56
     342   00:41BD                      ;	ld	(debug_pointer1),bc
     343   00:41BD  CD CA 41            	call	register_debug_loop
     344   00:41C0                      
     345   00:41C0                      	;	DRAW FM Drum tone + vol
     346   00:41C0  FD 2E 03            	ld	iyl,3
     347   00:41C3  11 8A C3            	ld 	de,debug_pnt+(80*5)+65
     348   00:41C6                      ;	ld	(debug_pointer1),bc
     349   00:41C6  CD CA 41            	call	register_debug_loop
     350   00:41C9                      	
     351   00:41C9  C9                  	ret
     352   00:41CA                      
     353   00:41CA                      register_debug_loop:
     354   00:41CA  D5                  	push 	de
     355   00:41CB                      ;	ld	de,TEXT_Chan
     356   00:41CB  4E                  	ld	c,(hl)
     357   00:41CC  23                  	inc	hl
     358   00:41CD  46                  	ld	b,(hl)
     359   00:41CE  23                  	inc	hl
     360   00:41CF                      	
     361   00:41CF  03                  	inc	bc
     362   00:41D0  0A                  	ld	a,(bc)
     363   00:41D1  0B                  	dec	bc
     364   00:41D2  CD 95 43            	call	draw_hex2		; tone
     365   00:41D5  0A                  	ld	a,(bc)
     366   00:41D6  CD 95 43            	call	draw_hex2
     367   00:41D9                      	
     368   00:41D9  13                  	inc 	de	
     369   00:41DA                      	
     370   00:41DA  4E                  	ld	c,(hl)
     371   00:41DB  23                  	inc	hl
     372   00:41DC  46                  	ld	b,(hl)
     373   00:41DD  23                  	inc	hl	
     374   00:41DE                      	
     375   00:41DE  0A                  	ld	a,(bc)
     376   00:41DF  CD 95 43            	call	draw_hex2		; vol
     377   00:41E2                      	
     378   00:41E2                      	;-- next line
     379   00:41E2  D1                  	pop 	de
     380   00:41E3  3E 50               	ld	a,80
     381   00:41E5  83                  	add	a,e
     382   00:41E6  5F                  	ld	e,a
     383   00:41E7  D2 EB 41            	jp	nc,99f
     384   00:41EA  14                  	inc	d
     385   00:41EB                      99:	
     386   00:41EB  FD 2D               	dec	iyl
     387   00:41ED  C2 CA 41            	jp	nz,register_debug_loop
     388   00:41F0  C9                  	ret
     389   00:41F1                      
     390   00:41F1                      REG_list:
     391   00:41F1  6A C1 72 C1         	dw	PSG_regToneA,PSG_regVOLA
     392   00:41F5  6C C1 73 C1         	dw	PSG_regToneB,PSG_regVOLB
     393   00:41F9  6E C1 74 C1         	dw	PSG_regToneC,PSG_regVOLC
     394   00:41FD  70 C1 71 C1         	dw	PSG_regNOISE,PSG_regMIXER
     395   00:4201  00 00 00 00         	dw	0,0;PSG_regEnvL,PSG_regEnvShape 	
     396   00:4205  78 C1 7C C1         	dw	FM_regToneA,FM_regVOLA 
     397   00:4209  7E C1 82 C1         	dw	FM_regToneB,FM_regVOLB 
     398   00:420D  84 C1 88 C1         	dw	FM_regToneC,FM_regVOLC 
     399   00:4211  8A C1 8E C1         	dw	FM_regToneD,FM_regVOLD 
     400   00:4215  90 C1 94 C1         	dw	FM_regToneE,FM_regVOLE 
     401   00:4219  96 C1 9A C1         	dw	FM_regToneF,FM_regVOLF 
     402   00:421D  B1 C1 AE C1         	dw	FM_DRUM_MACRO,FM_DRUM
     403   00:4221  9C C1 A0 C1         	dw	DRUM_regToneBD,DRUM_regVolBD
     404   00:4225  A2 C1 A6 C1         	dw	DRUM_regToneSH,DRUM_regVolSH	
     405   00:4229  A8 C1 AC C1         	dw	DRUM_regToneCT,DRUM_regVolCT	
     406   00:422D                      
     407   00:422D                      
     408   00:422D                      
     409   00:422D                      
     410   00:422D                      ; input BC length to clear
     411   00:422D                      clear_TEXT:
     412   00:422D  0B                  	dec	bc
     413   00:422E  21 39 C4            	ld	hl,TEXT_Chan
     414   00:4231  11 3A C4            	ld	de,TEXT_Chan+1
     415   00:4234  36 20               	ld	(hl),' '
     416   00:4236  ED B0               	ldir
     417   00:4238  C9                  	ret
     418   00:4239                      
     419   00:4239                      debug_flags:
     420   00:4239  CB 78               	bit	7,b
     421   00:423B  CA 43 42            	jp	z,1f
     422   00:423E  36 46               	ld	(hl),'F'
     423   00:4240  C3 45 42            	jp	2f
     424   00:4243                      1:
     425   00:4243  36 50               	ld	(hl),'P'
     426   00:4245                      	
     427   00:4245                      2:
     428   00:4245  23                  	inc	hl
     429   00:4246  CB 70               	bit	6,b
     430   00:4248  CA 50 42            	jp	z,1f
     431   00:424B  36 56               	ld	(hl),'V'
     432   00:424D  C3 52 42            	jp	2f
     433   00:4250                      1:
     434   00:4250  36 20               	ld	(hl),' '
     435   00:4252                      	
     436   00:4252                      2:	
     437   00:4252  23                  	inc	hl
     438   00:4253  CB 68               	bit	5,b
     439   00:4255  CA 5D 42            	jp	z,1f
     440   00:4258  36 53               	ld	(hl),'S'
     441   00:425A  C3 5F 42            	jp	2f
     442   00:425D                      1:
     443   00:425D  36 20               	ld	(hl),' '
     444   00:425F                      	
     445   00:425F                      2:	
     446   00:425F  23                  	inc	hl
     447   00:4260  CB 60               	bit	4,b
     448   00:4262  C2 6A 42            	jp	nz,1f
     449   00:4265  36 4B               	ld	(hl),'K'
     450   00:4267  C3 6C 42            	jp	2f
     451   00:426A                      1:
     452   00:426A  36 20               	ld	(hl),' '
     453   00:426C                      	
     454   00:426C                      2:	
     455   00:426C  23                  	inc	hl
     456   00:426D  CB 58               	bit	3,b
     457   00:426F  CA 77 42            	jp	z,1f
     458   00:4272  36 43               	ld	(hl),'C'
     459   00:4274  C3 79 42            	jp	2f
     460   00:4277                      1:
     461   00:4277  36 20               	ld	(hl),' '
     462   00:4279                      	
     463   00:4279                      2:	
     464   00:4279  23                  	inc	hl
     465   00:427A  CB 50               	bit	2,b
     466   00:427C  CA 84 42            	jp	z,1f
     467   00:427F  36 45               	ld	(hl),'E'
     468   00:4281  C3 86 42            	jp	2f
     469   00:4284                      1:
     470   00:4284  36 20               	ld	(hl),' '
     471   00:4286                      	
     472   00:4286                      2:	
     473   00:4286  23                  	inc	hl	
     474   00:4287  CB 48               	bit	1,b
     475   00:4289  CA 91 42            	jp	z,1f
     476   00:428C  36 41               	ld	(hl),'A'
     477   00:428E  C3 93 42            	jp	2f
     478   00:4291                      1:
     479   00:4291  36 20               	ld	(hl),' '
     480   00:4293                      	
     481   00:4293                      2:	
     482   00:4293  23                  	inc	hl	
     483   00:4294  CB 40               	bit	0,b
     484   00:4296  CA 9E 42            	jp	z,1f
     485   00:4299  36 4E               	ld	(hl),'N'
     486   00:429B  C3 A0 42            	jp	2f
     487   00:429E                      1:
     488   00:429E  36 20               	ld	(hl),' '
     489   00:42A0                      	
     490   00:42A0                      2:	
     491   00:42A0  23                  	inc	hl		
     492   00:42A1  EB                  	ex	de,hl
     493   00:42A2                      
     494   00:42A2  13                  	inc 	de
     495   00:42A3  C9                  	ret
     496   00:42A4                      
     497   00:42A4                      
     498   00:42A4                      
     499   00:42A4                      
     500   00:42A4                      	
     501   00:42A4                      	; --- init_vdp
     502   00:42A4                      	; 
     503   00:42A4                      	; Initial init of the vdp
     504   00:42A4                      init_vdp:
     505   00:42A4                      
     506   00:42A4  3E 04               	ld	a,00000100b ; Reg#0 [ 0 ][DG ][IE2][IE1][M5 ][M4 ][M3 ][ 0 ]
     507   00:42A6  D3 99               	out	(0x99),a
     508   00:42A8  3E 80               	ld	a,0+128
     509   00:42AA  D3 99               	out	(0x99),a
     510   00:42AC                      
     511   00:42AC  3E 70               	ld	a,01110000b ; Reg#1 [ 0 ][BL ][IE0][M1 ][M2 ][ 0 ][SIZ][MAG]
     512   00:42AE                      
     513   00:42AE  D3 99               	out	(0x99),a
     514   00:42B0  3E 81               	ld	a,1+128
     515   00:42B2  D3 99               	out	(0x99),a	
     516   00:42B4                      
     517   00:42B4  3E 0B               	ld	a,00001011b ; REG#2[ 0 ][A16][A15][A14][A13][A12][ 1 ][ 1 ]  - Pattern layout table
     518   00:42B6                      
     519   00:42B6  D3 99               	out	(0x99),a
     520   00:42B8  3E 82               	ld	a,2+128
     521   00:42BA  D3 99               	out	(0x99),a	
     522   00:42BC                      
     523   00:42BC  3E AF               	ld	a,10101111b ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     524   00:42BE                      
     525   00:42BE  D3 99               	out	(0x99),a
     526   00:42C0  3E 83               	ld	a,3+128
     527   00:42C2  D3 99               	out	(0x99),a	
     528   00:42C4                      	
     529   00:42C4  3E 12               	ld	a,00010010b ; Reg#4 [ 0 ][ 0 ][A16][A15][A14][A13][A12][A11]  - Pattern generator table
     530   00:42C6                      
     531   00:42C6  D3 99               	out	(0x99),a
     532   00:42C8  3E 84               	ld	a,4+128
     533   00:42CA  D3 99               	out	(0x99),a	
     534   00:42CC                      	
     535   00:42CC  3A E8 FF            	ld	a,($FFE8)
     536   00:42CF  F6 80               	or	10000000b ; Reg#9 [LN ][ 0 ][S1 ][S0 ][IL ][EO ][NT ][DC ]
     537   00:42D1  D3 99               	out	(0x99),a
     538   00:42D3  3E 89               	ld	a,9+128
     539   00:42D5  D3 99               	out	(0x99),a	
     540   00:42D7                      
     541   00:42D7                      
     542   00:42D7  3E F0               	ld	a,$f0
     543   00:42D9  D3 99               	out	(0x99),a
     544   00:42DB  3E 87               	ld	a,7+128
     545   00:42DD  D3 99               	out	(0x99),a
     546   00:42DF  3E E1               	ld	a,$e1
     547   00:42E1  D3 99               	out	(0x99),a
     548   00:42E3  3E 8C               	ld	a,12+128
     549   00:42E5  D3 99               	out	(0x99),a
     550   00:42E7  3E F0               	ld	a,0xF0	;reg#13
     551   00:42E9  D3 99               	out	(0x99),a
     552   00:42EB  3E 8D               	ld	a,13+128
     553   00:42ED  D3 99               	out	(0x99),a		
     554   00:42EF                      	
     555   00:42EF                      	
     556   00:42EF                      
     557   00:42EF  C9                  	ret		
     558   00:42F0                      	include	".\screen.asm"
       1.  00:42F0  (00:0082)           _UPLEFT			equ	130
       2.  00:42F0  (00:0081)           _HORIZONTAL			equ	129
       3.  00:42F0  (00:0083)           _UPRIGHT			equ	131
       4.  00:42F0  (00:0080)           _VERTICAL			equ	128
       5.  00:42F0  (00:0087)           _VERTICAL_SMALL		equ	135
       6.  00:42F0  (00:0086)           _VERTICAL_DOUBLE		equ	134
       7.  00:42F0  (00:008B)           _VERTICAL_STEP		equ	139
       8.  00:42F0  (00:00B0)           _ARROWLEFT			equ	176
       9.  00:42F0  (00:00B1)           _ARROWRIGHT			equ	177
      10.  00:42F0  (00:00AE)           _LOOPSIGN			equ	174
      11.  00:42F0  (00:00F1)           _TONE_OFF_SIGN		equ	241
      12.  00:42F0  (00:00F2)           _TONE_ON_SIGN		equ	242
      13.  00:42F0  (00:00F3)           _NOISE_OFF_SIGN		equ	243
      14.  00:42F0  (00:00F4)           _NOISE_ON_SIGN		equ	244
      15.  00:42F0  (00:00F5)           _ENV_OFF_SIGN		equ	245
      16.  00:42F0  (00:00F6)           _ENV_ON_SIGN		equ	246
      17.  00:42F0  (00:00BF)           _CMD_SIGN			equ	6*32-1
      18.  00:42F0  (00:00FE)           _CURSOR			equ	254
      19.  00:42F0                      
      20.  00:42F0  (00:00FC)           MOUSE_CHR			equ 	252
      21.  00:42F0                      
      22.  00:42F0  (00:2000)           _PNT		equ	0x2000		; pnt
      23.  00:42F0  (00:2A00)           _CNT		equ	0x2a00		; cnt
      24.  00:42F0                      
      25.  00:42F0                      
      26.  00:42F0                      
      27.  00:42F0                      ; ==========================================================	
      28.  00:42F0                      	; --- clear_window
      29.  00:42F0                      	; 
      30.  00:42F0                      	; Clears the current screen (pnt and cnt)
      31.  00:42F0                      	;
      32.  00:42F0                      ; ==========================================================	
      33.  00:42F0                      clear_screen:
      34.  00:42F0  21 00 20            	ld 	hl,_PNT
      35.  00:42F3  CD B2 45            	call	set_vdpwrite	
      36.  00:42F6                      
      37.  00:42F6  1E 1B               	ld	e,27
      38.  00:42F8  3E 20               	ld	a,32
      39.  00:42FA  F3                  	di
      40.  00:42FB                      0:	;-- main loop
      41.  00:42FB  01 98 50            	ld	bc,0x5098
      42.  00:42FE                      1:	;--- sub loop
      43.  00:42FE  ED 79               		out	(c),a
      44.  00:4300  10 FC               		djnz 	1b
      45.  00:4302                      	; -- end sub loop
      46.  00:4302  1D                  	dec	e
      47.  00:4303  20 F6               	jr	nz,0b
      48.  00:4305                      	; -- end main loop	
      49.  00:4305                      
      50.  00:4305                      clear_cnt:
      51.  00:4305  21 00 2A            	ld 	hl,_CNT
      52.  00:4308  CD B2 45            	call	set_vdpwrite	
      53.  00:430B                      	
      54.  00:430B  1E 1B               	ld	e,27
      55.  00:430D  3E 00               	ld	a,0
      56.  00:430F  F3                  	di
      57.  00:4310                      0:	;-- main loop
      58.  00:4310  01 98 0A            	ld	bc,0x0a98
      59.  00:4313                      1:	;--- sub loop
      60.  00:4313  ED 79               		out	(c),a
      61.  00:4315  10 FC               		djnz 	1b
      62.  00:4317                      	; -- end sub loop
      63.  00:4317  1D                  	dec	e
      64.  00:4318  20 F6               	jr	nz,0b
      65.  00:431A                      	; -- end main loop	
      66.  00:431A                      	
      67.  00:431A  FB                  	ei
      68.  00:431B  C9                  	ret
      69.  00:431C                      
      70.  00:431C                      ; ==========================================================	
      71.  00:431C                      	; --- clear_files
      72.  00:431C                      	; 
      73.  00:431C                      	; Clears the files area in the file dialog 
      74.  00:431C                      	;
      75.  00:431C                      ; ==========================================================	
      76.  00:431C                      clear_files:
      77.  00:431C                      
      78.  00:431C  06 14               	ld	b,20
      79.  00:431E  21 E0 21            	ld	hl,_PNT+(80*6)
      80.  00:4321                      
      81.  00:4321  C5                  0:	push	bc
      82.  00:4322  E5                  	push	hl
      83.  00:4323  CD B2 45            	call	set_vdpwrite	
      84.  00:4326                      
      85.  00:4326  06 38               	ld	b,56
      86.  00:4328  3E 20               	ld	a,32
      87.  00:432A                      
      88.  00:432A                      1:	;--- sub loop
      89.  00:432A  D3 98               		out	(0x98),a
      90.  00:432C  10 FC               		djnz 	1b
      91.  00:432E                      	; -- end sub loop
      92.  00:432E  E1                  	pop	hl
      93.  00:432F  01 50 00            	ld	bc,80
      94.  00:4332  09                  	add	hl,bc
      95.  00:4333                      	
      96.  00:4333  C1                  	pop	bc
      97.  00:4334  10 EB               	djnz	0b
      98.  00:4336                      
      99.  00:4336  C9                  	ret	
     100.  00:4337                      
     101.  00:4337                      
     102.  00:4337                      
     103.  00:4337                      
     104.  00:4337                      ; ==========================================================	
     105.  00:4337                      	; --- draw_label
     106.  00:4337                      	; 
     107.  00:4337                      	; Draw box 
     108.  00:4337                      	; HL = position in PNT (relative)
     109.  00:4337                      	; DE = pointer to the label text
     110.  00:4337                      ; ==========================================================
     111.  00:4337                      draw_label:
     112.  00:4337  F3                  	di
     113.  00:4338                      ;	ld	a,$f3 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     114.  00:4338                      ;	out	(0x99),a
     115.  00:4338                      ;	ld	a,7+128
     116.  00:4338                      ;	out	(0x99),a	
     117.  00:4338                      
     118.  00:4338                      	
     119.  00:4338  01 00 20            	ld 	bc,_PNT
     120.  00:433B  09                  	add	hl,bc
     121.  00:433C  CD B2 45            	call	set_vdpwrite			
     122.  00:433F                      	
     123.  00:433F                      draw_label_loop:
     124.  00:433F  1A                  	ld	a,(de)
     125.  00:4340  FE 00               	cp	0
     126.  00:4342  28 05               	jr.	z,draw_label_end	
     127.  00:4344  D3 98               	out	(0x98),a
     128.  00:4346                      	
     129.  00:4346  13                  	inc	de
     130.  00:4347  18 F6               	jr.	draw_label_loop
     131.  00:4349                      	
     132.  00:4349                      draw_label_end:
     133.  00:4349                      ;	ld	a,$f0 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     134.  00:4349                      ;	out	(0x99),a
     135.  00:4349                      ;	ld	a,7+128
     136.  00:4349                      ;	out	(0x99),a	
     137.  00:4349  FB                  	ei
     138.  00:434A  C9                  	ret
     139.  00:434B                      
     140.  00:434B                      ; ==========================================================	
     141.  00:434B                      	; --- draw_label_fast
     142.  00:434B                      	; 
     143.  00:434B                      	; Draw box 
     144.  00:434B                      	; HL = position in PNT (relative)
     145.  00:434B                      	; DE = pointer to the label text
     146.  00:434B                      	; BC = number of bytes to copy to vram
     147.  00:434B                      ; ==========================================================
     148.  00:434B                      draw_label_fast:
     149.  00:434B  F3                  	di
     150.  00:434C                      ;	ld	a,$f5 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     151.  00:434C                      ;	out	(0x99),a
     152.  00:434C                      ;	ld	a,7+128
     153.  00:434C                      ;	out	(0x99),a		
     154.  00:434C                      	
     155.  00:434C  C5                  	push	bc
     156.  00:434D  01 00 20            	ld 	bc,_PNT
     157.  00:4350  09                  	add	hl,bc	
     158.  00:4351  CD B2 45            	call	set_vdpwrite	
     159.  00:4354                      			
     160.  00:4354  EB                  	ex	de,hl
     161.  00:4355  C1                  	pop	bc
     162.  00:4356  0E 98               	ld	c,0x98
     163.  00:4358                      	
     164.  00:4358  ED B3               	otir
     165.  00:435A                      		
     166.  00:435A                      		
     167.  00:435A                      ;	ld	a,$f0 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     168.  00:435A                      ;	out	(0x99),a
     169.  00:435A                      ;	ld	a,7+128
     170.  00:435A                      ;	out	(0x99),a			
     171.  00:435A  FB                  	ei
     172.  00:435B                      	
     173.  00:435B  C9                  	ret
     174.  00:435C                      
     175.  00:435C                      ; ==========================================================	
     176.  00:435C                      	; --- draw_fake_hex_sp
     177.  00:435C                      	; 
     178.  00:435C                      	; Prints the value at an address as 1 digit decimal value 
     179.  00:435C                      	; But value 0 is printed as '.'
     180.  00:435C                      	; Values can be larger than F
     181.  00:435C                      	; A = the value
     182.  00:435C                      	; DE = position (relative) to put the value in PNT
     183.  00:435C                      	; 
     184.  00:435C                      ; ==========================================================
     185.  00:435C                      draw_fake_hex_sp:
     186.  00:435C  A7                  	and	a
     187.  00:435D  20 05               	jr.	nz,0f
     188.  00:435F  3E 2E               	ld	a,'.'
     189.  00:4361  12                  	ld	(de),a
     190.  00:4362  13                  	inc	de
     191.  00:4363  C9                  	ret
     192.  00:4364                      0:	
     193.  00:4364  FE 0A               	cp	10
     194.  00:4366  30 05               	jr.	nc,1f
     195.  00:4368  C6 30               	add	48
     196.  00:436A  12                  	ld	(de),a
     197.  00:436B  13                  	inc	de
     198.  00:436C  C9                  	ret
     199.  00:436D                      1:
     200.  00:436D  C6 37               	add 	55
     201.  00:436F  12                  	ld	(de),a
     202.  00:4370  13                  	inc	de	
     203.  00:4371  C9                  	ret
     204.  00:4372                      	
     205.  00:4372                      ; ==========================================================	
     206.  00:4372                      	; --- draw_fake_hex_sp_small
     207.  00:4372                      	; 
     208.  00:4372                      	; Prints the value at an address as 1 digit decimal value 
     209.  00:4372                      	; But value 0 is printed as '.'
     210.  00:4372                      	; Values can be larger than F
     211.  00:4372                      	; A = the value
     212.  00:4372                      	; DE = position (relative) to put the value in PNT
     213.  00:4372                      	; 
     214.  00:4372                      ; ==========================================================
     215.  00:4372                      draw_fake_hex_sp_small:
     216.  00:4372  A7                  	and	a
     217.  00:4373  20 05               	jr.	nz,0f
     218.  00:4375  3E 2E               	ld	a,'.'
     219.  00:4377  12                  	ld	(de),a
     220.  00:4378  13                  	inc	de
     221.  00:4379  C9                  	ret
     222.  00:437A                      0:	
     223.  00:437A  12                  	ld	(de),a
     224.  00:437B  13                  	inc	de	
     225.  00:437C  C9                  	ret
     226.  00:437D                      	
     227.  00:437D                      	
     228.  00:437D                      	
     229.  00:437D                      ; ==========================================================	
     230.  00:437D                      	; --- draw_hex_sp
     231.  00:437D                      	; 
     232.  00:437D                      	; Prints the value at an address as 1 digit decimal value 
     233.  00:437D                      	; But value 0 is printed as '.'
     234.  00:437D                      	; A = the value
     235.  00:437D                      	; DE = position (relative) to put the value in PNT
     236.  00:437D                      	; 
     237.  00:437D                      ; ==========================================================
     238.  00:437D                      ;draw_hex_sp:
     239.  00:437D                      ;	and	a
     240.  00:437D                      ;	jr.	nz,draw_hex
     241.  00:437D                      ;	ld	a,"."
     242.  00:437D                      ;	ld	(de),a
     243.  00:437D                      ;	inc	de
     244.  00:437D                      ;	ret
     245.  00:437D                      
     246.  00:437D                      ; ==========================================================	
     247.  00:437D                      	; --- draw_hex_sp_small
     248.  00:437D                      	; 
     249.  00:437D                      	; Prints the value at an address as 1 digit decimal value 
     250.  00:437D                      	; But value 0 is printed as '.'
     251.  00:437D                      	; A = the value
     252.  00:437D                      	; DE = position (relative) to put the value in PNT
     253.  00:437D                      	; 
     254.  00:437D                      ; ==========================================================
     255.  00:437D                      draw_hex_sp_small:
     256.  00:437D  A7                  	and	a
     257.  00:437E  20 10               	jr.	nz,draw_hex_small
     258.  00:4380  3E 2E               	ld	a,"."
     259.  00:4382  12                  	ld	(de),a
     260.  00:4383  13                  	inc	de
     261.  00:4384  C9                  	ret
     262.  00:4385                      
     263.  00:4385                      ; ==========================================================	
     264.  00:4385                      	; --- draw_hex2_cmd
     265.  00:4385                      	; 
     266.  00:4385                      	; Prints the value at an address as 2 digit decimal value 
     267.  00:4385                      	; A =  the value
     268.  00:4385                      	; DE = position (relative) to put the value in PNT
     269.  00:4385                      	; 
     270.  00:4385                      	; Changes: AF
     271.  00:4385                      ; ==========================================================
     272.  00:4385                      ;draw_hex2_cmd:
     273.  00:4385                      ;	push	af
     274.  00:4385                      ;	and	0xf0
     275.  00:4385                      ;	rrca
     276.  00:4385                      ;	rrca
     277.  00:4385                      ;	rrca
     278.  00:4385                      ;	rrca	
     279.  00:4385                      ;	call	draw_hex_small
     280.  00:4385                      ;	pop	af
     281.  00:4385                      ;	call	draw_hex_small
     282.  00:4385                      ;	ret
     283.  00:4385                      
     284.  00:4385                      
     285.  00:4385                      ; ==========================================================	
     286.  00:4385                      	; --- draw_hex
     287.  00:4385                      	; 
     288.  00:4385                      	; Prints the value at an address as 1 digit decimal value 
     289.  00:4385                      	; A = the value
     290.  00:4385                      	; DE = position (relative) to put the value in PNT
     291.  00:4385                      	; 
     292.  00:4385                      ; ==========================================================
     293.  00:4385                      draw_hex:
     294.  00:4385  E6 0F               	and	0x0f
     295.  00:4387                      draw_fakehex:	
     296.  00:4387  C6 90               	add	a,0x90
     297.  00:4389  27                  	daa
     298.  00:438A  CE 40               	adc	a,0x40
     299.  00:438C  27                  	daa
     300.  00:438D  12                  	ld	(de),a
     301.  00:438E  13                  	inc	de
     302.  00:438F  C9                  	ret
     303.  00:4390                      	
     304.  00:4390                      	
     305.  00:4390                      ; ==========================================================	
     306.  00:4390                      	; --- draw_hex_small
     307.  00:4390                      	; 
     308.  00:4390                      	; Prints the value at an address as 1 digit decimal value 
     309.  00:4390                      	; A = the value
     310.  00:4390                      	; DE = position (relative) to put the value in PNT
     311.  00:4390                      	; 
     312.  00:4390                      ; ==========================================================
     313.  00:4390                      draw_hex_small:
     314.  00:4390  E6 0F               	and	0x0f
     315.  00:4392  12                  	ld	(de),a
     316.  00:4393  13                  	inc	de
     317.  00:4394  C9                  	ret	
     318.  00:4395                      	
     319.  00:4395                      	
     320.  00:4395                      ; ==========================================================	
     321.  00:4395                      	; --- draw_hex2
     322.  00:4395                      	; 
     323.  00:4395                      	; Prints the value at an address as 2 digit decimal value 
     324.  00:4395                      	; A =  the value
     325.  00:4395                      	; DE = position (relative) to put the value in PNT
     326.  00:4395                      	; 
     327.  00:4395                      	; Changes: AF
     328.  00:4395                      ; ==========================================================
     329.  00:4395                      draw_hex2:
     330.  00:4395  F5                  	push	af
     331.  00:4396  E6 F0               	and	0xf0
     332.  00:4398  0F                  	rrca
     333.  00:4399  0F                  	rrca
     334.  00:439A  0F                  	rrca
     335.  00:439B  0F                  	rrca	
     336.  00:439C  CD 85 43            	call	draw_hex
     337.  00:439F  F1                  	pop	af
     338.  00:43A0  CD 85 43            	call	draw_hex
     339.  00:43A3  C9                  	ret
     340.  00:43A4                      	
     341.  00:43A4                      	
     342.  00:43A4                      	
     343.  00:43A4                      	
     344.  00:43A4                      
     345.  00:43A4                      ; ==========================================================	
     346.  00:43A4                      ; --- conv_decimal
     347.  00:43A4                      ; 
     348.  00:43A4                      ; converts the value at HL into a 2 digit decimal at DE 
     349.  00:43A4                      ; HL = position of the value
     350.  00:43A4                      ; DE = postion  to put the 2 digit value value 
     351.  00:43A4                      ; 
     352.  00:43A4                      ; ==========================================================	
     353.  00:43A4                      
     354.  00:43A4                      conv_decimal:
     355.  00:43A4                      
     356.  00:43A4  7E                  	ld	a,(hl)
     357.  00:43A5                      draw_decimal:
     358.  00:43A5  EB                  	ex	de,hl
     359.  00:43A6                      ;	ld	hl,_dd_tmpstring
     360.  00:43A6                      	
     361.  00:43A6  06 F6               1:	ld	b,-10
     362.  00:43A8  CD B2 43            	call	_dd_Num1
     363.  00:43AB  06 FF               	ld	b,-1
     364.  00:43AD  CD B2 43            	call	_dd_Num1
     365.  00:43B0                      
     366.  00:43B0  EB                  	ex	de,hl
     367.  00:43B1                      ;	ld	hl,_dd_tmpstring
     368.  00:43B1                      
     369.  00:43B1  C9                  	ret	
     370.  00:43B2                      _dd_Num1:	
     371.  00:43B2  0E 2F               	ld	c,"0"-1
     372.  00:43B4                      _dd_Num2:	
     373.  00:43B4  0C                  	inc	c
     374.  00:43B5  80                  	add	a,b
     375.  00:43B6  38 FC               	jr	c,_dd_Num2
     376.  00:43B8  98                  	sbc	a,b
     377.  00:43B9  71                  	ld	(hl),c
     378.  00:43BA  23                  	inc	hl
     379.  00:43BB  C9                  	ret 
     380.  00:43BC                      
     381.  00:43BC                      draw_decimal3:
     382.  00:43BC  EB                  	ex	de,hl
     383.  00:43BD  06 9C               	ld	b,-100
     384.  00:43BF  CD B2 43            	call	_dd_Num1
     385.  00:43C2  18 E2               	jr.	1b
     386.  00:43C4                      	
     387.  00:43C4                      	
     388.  00:43C4                      ;_dd_tmpstring:		
     389.  00:43C4                      ;	db	"XX",0		; temporary + delimiter
     390.  00:43C4                      
     391.  00:43C4                      ; ==========================================================	
     392.  00:43C4                      	; --- draw_box
     393.  00:43C4                      	; 
     394.  00:43C4                      	; Draw box 
     395.  00:43C4                      	; HL = position in PNT (relative)
     396.  00:43C4                      	; D = width
     397.  00:43C4                      	; E = height
     398.  00:43C4                      ; ==========================================================
     399.  00:43C4                      draw_box:
     400.  00:43C4  F3                  	di
     401.  00:43C5                      
     402.  00:43C5  01 00 20            	ld 	bc,_PNT
     403.  00:43C8  09                  	add	hl,bc
     404.  00:43C9  CD B2 45            	call	set_vdpwrite		
     405.  00:43CC                      	
     406.  00:43CC  3E 82               	ld	a,_UPLEFT		; upperleft corner
     407.  00:43CE                      
     408.  00:43CE                      draw_box_loop1:
     409.  00:43CE  42                  	ld	b,d	
     410.  00:43CF                      draw_box_loop0:
     411.  00:43CF                      
     412.  00:43CF                      	; change on last pos
     413.  00:43CF  05                  	dec	b
     414.  00:43D0  20 10               	jr.	nz,1f
     415.  00:43D2  FE 81               	cp	_HORIZONTAL
     416.  00:43D4  20 04               	jr.	nz,0f
     417.  00:43D6  3E 83               	ld	a,_UPRIGHT
     418.  00:43D8  18 08               	jr.	1f
     419.  00:43DA                      0:
     420.  00:43DA  FE 20               	cp	32
     421.  00:43DC  20 04               	jr.	nz,1f
     422.  00:43DE  3E 80               	ld	a,_VERTICAL
     423.  00:43E0  18 00               	jr.	1f
     424.  00:43E2                      	
     425.  00:43E2                      1:
     426.  00:43E2  04                  	inc	b	
     427.  00:43E3                      
     428.  00:43E3                      
     429.  00:43E3                      
     430.  00:43E3  D3 98               	out	(0x98),a
     431.  00:43E5                      	
     432.  00:43E5                      	; changed on pos > 1
     433.  00:43E5  FE 82               	cp	_UPLEFT		; if is upleftcorner thern	
     434.  00:43E7  20 04               	jr.	nz,0f
     435.  00:43E9  3E 81               	ld	a,_HORIZONTAL
     436.  00:43EB  18 08               	jr.	1f
     437.  00:43ED                      0:	
     438.  00:43ED  FE 80               	cp	_VERTICAL	; if is vertical line then space
     439.  00:43EF  20 04               	jr.	nz,0f
     440.  00:43F1  3E 20               	ld	a,32			; space	
     441.  00:43F3  18 00               	jr.	1f
     442.  00:43F5                      0:
     443.  00:43F5                      1:
     444.  00:43F5                      
     445.  00:43F5  10 D8               	djnz	draw_box_loop0
     446.  00:43F7                      
     447.  00:43F7                      
     448.  00:43F7                      	;loop lines
     449.  00:43F7  1D                  	dec	e
     450.  00:43F8  28 0E               	jr.	z,draw_box_end
     451.  00:43FA                      	
     452.  00:43FA  01 50 00            	ld	bc,80
     453.  00:43FD  09                  	add	hl,bc
     454.  00:43FE  01 00 20            	ld 	bc,_PNT
     455.  00:4401  CD B2 45            	call	set_vdpwrite
     456.  00:4404  3E 80               	ld	a,_VERTICAL			
     457.  00:4406  18 C6               	jr.	draw_box_loop1
     458.  00:4408                      
     459.  00:4408                      
     460.  00:4408                      draw_box_end:
     461.  00:4408  FB                  	ei
     462.  00:4409  C9                  	ret
     463.  00:440A                      
     464.  00:440A                      
     465.  00:440A                      
     466.  00:440A                      
     467.  00:440A                      ; ==========================================================	
     468.  00:440A                      	; --- draw_colorbox
     469.  00:440A                      	; 
     470.  00:440A                      	; Draw box 
     471.  00:440A                      	; H = x pos
     472.  00:440A                      	; L = y pos
     473.  00:440A                      	; D = width
     474.  00:440A                      	; E = height
     475.  00:440A                      ; ==========================================================
     476.  00:440A                      draw_colorbox:
     477.  00:440A                      	; --- get maskleft
     478.  00:440A  7C                  	ld	a,h
     479.  00:440B  E6 07               	and	0x07
     480.  00:440D  A7                  	and	a
     481.  00:440E  20 04               	jr.	nz,0f
     482.  00:4410  3E FF               	ld	a,255
     483.  00:4412  18 07               	jr.	1f
     484.  00:4414                      0:	
     485.  00:4414  47                  	ld	b,a
     486.  00:4415  3E FF               	ld	a,255
     487.  00:4417                      	
     488.  00:4417                      _dc_maskleft_loop:
     489.  00:4417  CB 3F               		srl	a
     490.  00:4419  10 FC               		djnz	_dc_maskleft_loop
     491.  00:441B  32 00 00            1:	ld	(cb_maskleft),a
     492.  00:441E                      
     493.  00:441E                      	; --- get maskright (7-(x+(w-1)) & 0x07)	
     494.  00:441E  7A                  	ld	a,d
     495.  00:441F  3D                  	dec	a
     496.  00:4420  84                  	add	h
     497.  00:4421  E6 07               	and	0x07
     498.  00:4423  FE 07               	cp	7
     499.  00:4425  20 04               	jr.	nz,0f
     500.  00:4427  3E 00               	ld	a,0
     501.  00:4429  18 0B               	jr.	1f
     502.  00:442B  47                  0:	ld	b,a
     503.  00:442C  3E 07               	ld	a,7
     504.  00:442E  90                  	sub	b
     505.  00:442F                      
     506.  00:442F                      
     507.  00:442F  47                  	ld	b,a
     508.  00:4430  3E FF               	ld	a,255	
     509.  00:4432                      	
     510.  00:4432                      _dc_maskright_loop:
     511.  00:4432  CB 27               		sla	a
     512.  00:4434  10 FC               		djnz	_dc_maskright_loop
     513.  00:4436  32 01 00            1:	ld	(cb_maskright),a
     514.  00:4439                      	
     515.  00:4439                      	; --- calculate the full cnt bytes to copy
     516.  00:4439  7C                  	ld	a,h
     517.  00:443A  E6 F8               	and	0xf8
     518.  00:443C  47                  	ld	b,a		; store in b the full bytes
     519.  00:443D  7C                  	ld	a,h
     520.  00:443E  82                  	add	d
     521.  00:443F  E6 F8               	and	0xf8
     522.  00:4441  90                  	sub	b
     523.  00:4442  CB 3F CB 3F CB 3F   [3]	srl	a		; divide by 8
     524.  00:4448  3D                  	dec	a		; 255 is begin and end in same byte
     525.  00:4449                      				; 0 is no full bytes to copy
     526.  00:4449                      				; >0 full bytes to copy inbetween masks
     527.  00:4449  32 02 00            	ld	(cb_fullbytes),a	
     528.  00:444C                      
     529.  00:444C                      	; --- Calculate start address
     530.  00:444C  4C                  	ld	c,h		; x in c
     531.  00:444D  45                  	ld	b,l		; y in b
     532.  00:444E  21 00 2A            	ld	hl,_CNT
     533.  00:4451  78                  	ld	a,b
     534.  00:4452  A7                  	and	a
     535.  00:4453  28 09               	jr.	z,0f
     536.  00:4455                      
     537.  00:4455                      _dc_start_loop:
     538.  00:4455  7D                  	ld	a,l
     539.  00:4456  C6 0A               	add	10		; every line adds 10 bytes to the addres
     540.  00:4458  6F                  	ld	l,a
     541.  00:4459  30 01               	jr.	nc,1f
     542.  00:445B  24                  	inc	h
     543.  00:445C                      1:
     544.  00:445C  10 F7               	djnz	_dc_start_loop	
     545.  00:445E                      0:
     546.  00:445E  79                  	ld	a,c		; add the x pos.
     547.  00:445F  E6 F8               	and	0xf8
     548.  00:4461  CB 3F CB 3F CB 3F   [3]	srl	a	
     549.  00:4467  85                  	add	l
     550.  00:4468  6F                  	ld	l,a
     551.  00:4469  30 01               	jr.	nc,1f
     552.  00:446B  24                  	inc	h
     553.  00:446C                      1:
     554.  00:446C                      	; now we have start addres in the cnt in HL
     555.  00:446C  4B                  	ld	c,e	; # lines to plot
     556.  00:446D                      	
     557.  00:446D                      	; --- get way to copy
     558.  00:446D  3A 02 00            	ld	a,(cb_fullbytes)
     559.  00:4470  FE FF               	cp	255
     560.  00:4472  28 46               	jr.	z,_cp_clip_copy
     561.  00:4474                      	
     562.  00:4474                      	; --- 'normal' copy
     563.  00:4474                      _cb_copyloop_main:	
     564.  00:4474  E5                  	push	hl
     565.  00:4475  CD CF 45            	call	set_vdpread
     566.  00:4478  DB 98               	in	a,(0x98)
     567.  00:447A  47                  	ld	b,a
     568.  00:447B  3A 00 00            	ld	a,(cb_maskleft)
     569.  00:447E  B0                  	or	b
     570.  00:447F  47                  	ld	b,a
     571.  00:4480                      	
     572.  00:4480  E1                  	pop	hl
     573.  00:4481  E5                  	push	hl
     574.  00:4482  CD B2 45            	call	set_vdpwrite
     575.  00:4485                      	
     576.  00:4485  78                  	ld	a,b
     577.  00:4486  D3 98               	out	(0x98),a
     578.  00:4488  3A 02 00            	ld	a,(cb_fullbytes)
     579.  00:448B  A7                  	and	a
     580.  00:448C  47                  	ld	b,a
     581.  00:448D  E1                  	pop	hl
     582.  00:448E  E5                  	push	hl
     583.  00:448F  23                  	inc	hl
     584.  00:4490  28 0B               	jr.	z,0f
     585.  00:4492                      
     586.  00:4492  85                  	add	a,l
     587.  00:4493  6F                  	ld	l,a
     588.  00:4494  30 01               	jr.	nc,9f
     589.  00:4496  24                  	inc	h
     590.  00:4497                      9:
     591.  00:4497  3E FF               	ld	a,255
     592.  00:4499                      _cb_copyloop:
     593.  00:4499  D3 98               	out	(0x98),a
     594.  00:449B  10 FC               	djnz	_cb_copyloop
     595.  00:449D                      0:	
     596.  00:449D  54                  	ld	d,h
     597.  00:449E  5D                  	ld	e,l
     598.  00:449F  CD CF 45            	call	set_vdpread
     599.  00:44A2  DB 98               	in	a,(0x98)
     600.  00:44A4  47                  	ld	b,a
     601.  00:44A5  3A 01 00            	ld	a,(cb_maskright)
     602.  00:44A8  B0                  	or	b
     603.  00:44A9  47                  	ld	b,a
     604.  00:44AA                      	
     605.  00:44AA  EB                  	ex	de,hl	
     606.  00:44AB  CD B2 45            	call	set_vdpwrite
     607.  00:44AE  78                  	ld	a,b	
     608.  00:44AF  D3 98               	out	(0x98),a
     609.  00:44B1                      	
     610.  00:44B1  E1                  	pop 	hl
     611.  00:44B2  11 0A 00            	ld	de,10
     612.  00:44B5  19                  	add	hl,de
     613.  00:44B6                      	
     614.  00:44B6  0D                  	dec	c
     615.  00:44B7  20 BB               	jr.	nz,_cb_copyloop_main
     616.  00:44B9                      	
     617.  00:44B9  C9                  	ret
     618.  00:44BA                      	
     619.  00:44BA                      
     620.  00:44BA                      _cp_clip_copy:
     621.  00:44BA  E5                  	push	hl
     622.  00:44BB                      
     623.  00:44BB  3A 00 00            	ld	a,(cb_maskleft)
     624.  00:44BE  47                  	ld	b,a
     625.  00:44BF  3A 01 00            	ld	a,(cb_maskright)
     626.  00:44C2  A0                  	and	b
     627.  00:44C3  47                  	ld	b,a
     628.  00:44C4                      
     629.  00:44C4  CD CF 45            	call	set_vdpread
     630.  00:44C7  DB 98               	in	a,(0x98)
     631.  00:44C9                      
     632.  00:44C9  B0                  	or	b
     633.  00:44CA  47                  	ld	b,a
     634.  00:44CB                      	
     635.  00:44CB  E1                  	pop	hl
     636.  00:44CC  E5                  	push	hl
     637.  00:44CD  CD B2 45            	call	set_vdpwrite
     638.  00:44D0                      	
     639.  00:44D0  78                  	ld	a,b
     640.  00:44D1  D3 98               	out	(0x98),a	
     641.  00:44D3                      
     642.  00:44D3  E1                  	pop 	hl
     643.  00:44D4  11 0A 00            	ld	de,10
     644.  00:44D7  19                  	add	hl,de
     645.  00:44D8                      	
     646.  00:44D8  0D                  	dec	c
     647.  00:44D9  20 DF               	jr.	nz,_cp_clip_copy	
     648.  00:44DB                      	
     649.  00:44DB  C9                  	ret
     650.  00:44DC                      
     651.  00:44DC                      ; ==========================================================	
     652.  00:44DC                      	; --- erase_colorbox
     653.  00:44DC                      	; 
     654.  00:44DC                      	; Draw box 
     655.  00:44DC                      	; H = x pos
     656.  00:44DC                      	; L = y pos
     657.  00:44DC                      	; D = width
     658.  00:44DC                      	; E = height
     659.  00:44DC                      ; ==========================================================
     660.  00:44DC                      erase_colorbox:
     661.  00:44DC                      	; --- get maskleft
     662.  00:44DC  7C                  	ld	a,h
     663.  00:44DD  E6 07               	and	0x07
     664.  00:44DF  A7                  	and	a
     665.  00:44E0  20 04               	jr.	nz,0f
     666.  00:44E2  3E FF               	ld	a,255
     667.  00:44E4  18 07               	jr.	1f
     668.  00:44E6                      0:	
     669.  00:44E6  47                  	ld	b,a
     670.  00:44E7  3E FF               	ld	a,255
     671.  00:44E9                      	
     672.  00:44E9                      _ecb_maskleft_loop:
     673.  00:44E9  CB 3F               		srl	a
     674.  00:44EB  10 FC               		djnz	_ecb_maskleft_loop
     675.  00:44ED                      1:	
     676.  00:44ED  EE FF               	xor	255
     677.  00:44EF  32 00 00            	ld	(cb_maskleft),a
     678.  00:44F2                      
     679.  00:44F2                      	; --- get maskright (7-(x+(w-1)) & 0x07)	
     680.  00:44F2  7A                  	ld	a,d
     681.  00:44F3  3D                  	dec	a
     682.  00:44F4  84                  	add	h
     683.  00:44F5  E6 07               	and	0x07
     684.  00:44F7  FE 07               	cp	7
     685.  00:44F9  20 04               	jr.	nz,0f
     686.  00:44FB  3E 00               	ld	a,0
     687.  00:44FD  18 0B               	jr.	1f
     688.  00:44FF  47                  0:	ld	b,a
     689.  00:4500  3E 07               	ld	a,7
     690.  00:4502  90                  	sub	b
     691.  00:4503                      
     692.  00:4503                      
     693.  00:4503  47                  	ld	b,a
     694.  00:4504  3E FF               	ld	a,255	
     695.  00:4506                      	
     696.  00:4506                      _ecb_maskright_loop:
     697.  00:4506  CB 27               		sla	a
     698.  00:4508  10 FC               		djnz	_ecb_maskright_loop
     699.  00:450A                      1:	
     700.  00:450A  EE FF               	xor	255
     701.  00:450C  32 01 00            	ld	(cb_maskright),a
     702.  00:450F                      	
     703.  00:450F                      	; --- calculate the full cnt bytes to copy
     704.  00:450F  7C                  	ld	a,h
     705.  00:4510  E6 F8               	and	0xf8
     706.  00:4512  47                  	ld	b,a		; store in b the full bytes
     707.  00:4513  7C                  	ld	a,h
     708.  00:4514  82                  	add	d
     709.  00:4515  E6 F8               	and	0xf8
     710.  00:4517  90                  	sub	b
     711.  00:4518  CB 3F CB 3F CB 3F   [3]	srl	a		; divide by 8
     712.  00:451E  3D                  	dec	a		; 255 is begin and end in same byte
     713.  00:451F                      				; 0 is no full bytes to copy
     714.  00:451F                      				; >0 full bytes to copy inbetween masks
     715.  00:451F  32 02 00            	ld	(cb_fullbytes),a	
     716.  00:4522                      
     717.  00:4522                      	; --- Calculate start address
     718.  00:4522  4C                  	ld	c,h		; x in c
     719.  00:4523  45                  	ld	b,l		; y in b
     720.  00:4524  21 00 2A            	ld	hl,_CNT
     721.  00:4527  78                  	ld	a,b
     722.  00:4528  A7                  	and	a
     723.  00:4529  28 09               	jr.	z,0f
     724.  00:452B                      
     725.  00:452B                      _ecb_start_loop:
     726.  00:452B  7D                  	ld	a,l
     727.  00:452C  C6 0A               	add	10		; every line adds 10 bytes to the addres
     728.  00:452E  6F                  	ld	l,a
     729.  00:452F  30 01               	jr.	nc,1f
     730.  00:4531  24                  	inc	h
     731.  00:4532                      1:
     732.  00:4532  10 F7               	djnz	_ecb_start_loop	
     733.  00:4534                      0:
     734.  00:4534  79                  	ld	a,c		; add the x pos.
     735.  00:4535  E6 F8               	and	0xf8
     736.  00:4537  CB 3F CB 3F CB 3F   [3]	srl	a	
     737.  00:453D  85                  	add	l
     738.  00:453E  6F                  	ld	l,a
     739.  00:453F  30 01               	jr.	nc,1f
     740.  00:4541  24                  	inc	h
     741.  00:4542                      1:
     742.  00:4542                      	; now we have start addres in the cnt in HL
     743.  00:4542  4B                  	ld	c,e	; # lines to plot
     744.  00:4543                      	
     745.  00:4543                      	; --- get way to copy
     746.  00:4543  3A 02 00            	ld	a,(cb_fullbytes)
     747.  00:4546  FE FF               	cp	255
     748.  00:4548  28 46               	jr.	z,_ecb_clip_copy
     749.  00:454A                      	
     750.  00:454A                      	; --- 'normal' copy
     751.  00:454A                      _ecb_copyloop_main:	
     752.  00:454A  E5                  	push	hl
     753.  00:454B  CD CF 45            	call	set_vdpread
     754.  00:454E  DB 98               	in	a,(0x98)
     755.  00:4550  47                  	ld	b,a
     756.  00:4551  3A 00 00            	ld	a,(cb_maskleft)
     757.  00:4554  A0                  	and	b
     758.  00:4555  47                  	ld	b,a
     759.  00:4556                      	
     760.  00:4556  E1                  	pop	hl
     761.  00:4557  E5                  	push	hl
     762.  00:4558  CD B2 45            	call	set_vdpwrite
     763.  00:455B                      	
     764.  00:455B  78                  	ld	a,b
     765.  00:455C  D3 98               	out	(0x98),a
     766.  00:455E  3A 02 00            	ld	a,(cb_fullbytes)
     767.  00:4561  A7                  	and	a
     768.  00:4562  47                  	ld	b,a
     769.  00:4563  E1                  	pop	hl
     770.  00:4564  E5                  	push	hl
     771.  00:4565  23                  	inc	hl
     772.  00:4566  28 0B               	jr.	z,0f
     773.  00:4568                      
     774.  00:4568  85                  	add	a,l
     775.  00:4569  6F                  	ld	l,a
     776.  00:456A  30 01               	jr.	nc,9f
     777.  00:456C  24                  	inc	h
     778.  00:456D                      9:
     779.  00:456D  3E 00               	ld	a,0
     780.  00:456F                      _ecb_copyloop:
     781.  00:456F  D3 98               	out	(0x98),a
     782.  00:4571  10 FC               	djnz	_ecb_copyloop
     783.  00:4573                      0:	
     784.  00:4573  54                  	ld	d,h
     785.  00:4574  5D                  	ld	e,l
     786.  00:4575  CD CF 45            	call	set_vdpread
     787.  00:4578  DB 98               	in	a,(0x98)
     788.  00:457A  47                  	ld	b,a
     789.  00:457B  3A 01 00            	ld	a,(cb_maskright)
     790.  00:457E  A0                  	and	b
     791.  00:457F  47                  	ld	b,a
     792.  00:4580                      	
     793.  00:4580  EB                  	ex	de,hl	
     794.  00:4581  CD B2 45            	call	set_vdpwrite
     795.  00:4584  78                  	ld	a,b	
     796.  00:4585  D3 98               	out	(0x98),a
     797.  00:4587                      	
     798.  00:4587  E1                  	pop 	hl
     799.  00:4588  11 0A 00            	ld	de,10
     800.  00:458B  19                  	add	hl,de
     801.  00:458C                      	
     802.  00:458C  0D                  	dec	c
     803.  00:458D  20 BB               	jr.	nz,_ecb_copyloop_main
     804.  00:458F                      	
     805.  00:458F  C9                  	ret
     806.  00:4590                      	
     807.  00:4590                      
     808.  00:4590                      _ecb_clip_copy:
     809.  00:4590  E5                  	push	hl
     810.  00:4591                      
     811.  00:4591  3A 00 00            	ld	a,(cb_maskleft)
     812.  00:4594  47                  	ld	b,a
     813.  00:4595  3A 01 00            	ld	a,(cb_maskright)
     814.  00:4598  B0                  	or	b
     815.  00:4599  47                  	ld	b,a
     816.  00:459A                      
     817.  00:459A  CD CF 45            	call	set_vdpread
     818.  00:459D  DB 98               	in	a,(0x98)
     819.  00:459F                      
     820.  00:459F  A0                  	and	b
     821.  00:45A0  47                  	ld	b,a
     822.  00:45A1                      	
     823.  00:45A1  E1                  	pop	hl
     824.  00:45A2  E5                  	push	hl
     825.  00:45A3  CD B2 45            	call	set_vdpwrite
     826.  00:45A6                      	
     827.  00:45A6  78                  	ld	a,b
     828.  00:45A7  D3 98               	out	(0x98),a	
     829.  00:45A9                      
     830.  00:45A9  E1                  	pop 	hl
     831.  00:45AA  11 0A 00            	ld	de,10
     832.  00:45AD  19                  	add	hl,de
     833.  00:45AE                      	
     834.  00:45AE  0D                  	dec	c
     835.  00:45AF  20 DF               	jr.	nz,_ecb_clip_copy	
     836.  00:45B1                      	
     837.  00:45B1  C9                  	ret
     838.  00:45B2                      
     839.  00:45B2                      	; --- set_vdpwrite
     840.  00:45B2                      	; sets up the vdp address in HL to write to
     841.  00:45B2                      	; enables ISR and changes a
     842.  00:45B2                      
     843.  00:45B2                      set_vdpwrite:
     844.  00:45B2  AF                  	xor	a
     845.  00:45B3  CB 04               	rlc	h
     846.  00:45B5  17                  	rla
     847.  00:45B6  CB 04               	rlc	h
     848.  00:45B8  17                  	rla
     849.  00:45B9  CB 3C               	srl	h
     850.  00:45BB  CB 3C               	srl	h
     851.  00:45BD  F3                  	di
     852.  00:45BE  D3 99               	out	(#99),a
     853.  00:45C0  3E 8E               	ld	a,14+128
     854.  00:45C2  D3 99               	out	(#99),a
     855.  00:45C4  7D                  	ld	a,l
     856.  00:45C5  00                  	nop
     857.  00:45C6  D3 99               	out	(#99),a
     858.  00:45C8  7C                  	ld	a,h
     859.  00:45C9  F6 40               	or	64
     860.  00:45CB  FB                  	ei
     861.  00:45CC  D3 99               	out	(#99),a
     862.  00:45CE  C9                  	ret
     863.  00:45CF                      
     864.  00:45CF                      
     865.  00:45CF                      	; --- set_vdpwrite
     866.  00:45CF                      	; sets up the vdp address in HL to write to
     867.  00:45CF                      	; enables ISR and changes a
     868.  00:45CF                      
     869.  00:45CF                      set_vdpread:
     870.  00:45CF  AF                  	xor	a
     871.  00:45D0  CB 04               	rlc	h
     872.  00:45D2  17                  	rla
     873.  00:45D3  CB 04               	rlc	h
     874.  00:45D5  17                  	rla
     875.  00:45D6  CB 3C               	srl	h
     876.  00:45D8  CB 3C               	srl	h
     877.  00:45DA  F3                  	di
     878.  00:45DB  D3 99               	out	(#99),a
     879.  00:45DD  3E 8E               	ld	a,14+128
     880.  00:45DF  D3 99               	out	(#99),a
     881.  00:45E1  7D                  	ld	a,l
     882.  00:45E2  00                  	nop
     883.  00:45E3  D3 99               	out	(#99),a
     884.  00:45E5  7C                  	ld	a,h
     885.  00:45E6  D3 99               	out	(#99),a
     886.  00:45E8  FB                  	ei
     887.  00:45E9  C9                  	ret
     888.  00:45EA                      
     889.  00:45EA                      
     890.  00:45EA                      ; --- Colorbox function variables
     891.  00:45EA  (00:0000)           cb_maskleft:	#1
     892.  00:45EA  (00:0001)           cb_maskright:	#1
     893.  00:45EA  (00:0002)           cb_fullbytes:	#1
     894.  00:45EA  (00:0003)           cb_status:		#1
     895.  00:45EA                      
     896.  00:45EA                      
     897.  00:45EA                      	; --- init_font
     898.  00:45EA                      	;
     899.  00:45EA                      	; Init the font in the PGT.
     900.  00:45EA                      
     901.  00:45EA                      init_font:
     902.  00:45EA                      
     903.  00:45EA  F3                  	di
     904.  00:45EB                      	; relocate the PGT (old is at 0x1000)
     905.  00:45EB                      	; new is at 0x9000
     906.  00:45EB                      ;	ld	a,00010010b
     907.  00:45EB                      ;	out	(0x99),a
     908.  00:45EB                      ;	ld	a,128+4	
     909.  00:45EB                      ;	out	(0x99),a
     910.  00:45EB                      
     911.  00:45EB  21 00 90            	ld	hl,0x9000
     912.  00:45EE  CD B2 45            	call	set_vdpwrite
     913.  00:45F1                      	
     914.  00:45F1  F3                  	di
     915.  00:45F2  3E 08               	ld a,8		; loop 8 times
     916.  00:45F4  0E 98               	ld c,0x98
     917.  00:45F6                      
     918.  00:45F6  21 44 5D            	ld hl,font_data
     919.  00:45F9                      
     920.  00:45F9                      _fontloop:
     921.  00:45F9  06 FF               		ld b,255		; subloop 255 times
     922.  00:45FB  ED B3               		otir
     923.  00:45FD  3D                  	dec a
     924.  00:45FE  20 F9               	jr. nz,_fontloop
     925.  00:4600                      	
     926.  00:4600  FB                  	ei
     927.  00:4601  C9                  	ret
     559   00:4602                      	include	"..\code\ttreplaySMS.asm"
       1.  00:4602                      ;=================================
       2.  00:4602                      ; TriloTracker Re-player SMS
       3.  00:4602                      ; 
       4.  00:4602                      ; Functions:
       5.  00:4602                      ; 	replay_init
       6.  00:4602                      ;	replay_pause
       7.  00:4602                      ;	replay_fade_out
       8.  00:4602                      ;================================
       9.  00:4602  (00:007C)           FM_WRITE:	equ	0x7c	; port to set fm reg nr.
      10.  00:4602  (00:007D)           FM_DATA:	equ	0x7d	; port to set fm data for reg	
      11.  00:4602                      ;===============================
      12.  00:4602  (00:0060)           _REL:		equ	96	; = release
      13.  00:4602  (00:0061)           _SUS:		equ	97	; = sustain
      14.  00:4602  (00:0062)           _VOL:		equ	98	; = volume 1
      15.  00:4602  (00:0071)           _INS:		equ	113	; = instrument 1
      16.  00:4602  (00:0090)           _CMD:		equ	144	; = effect 0
      17.  00:4602  (00:00B8)           _SPC:		equ	184	; = special commands
      18.  00:4602  (00:00BF)           _EOT:		equ	191	; = end of track
      19.  00:4602  (00:00C0)           _WAIT:	equ	192	; = wait 1
      20.  00:4602                      
      21.  00:4602                      	
      22.  00:4602                      ;===========================================================
      23.  00:4602                      ; ---	replay_init
      24.  00:4602                      ; Initialize re-player data
      25.  00:4602                      ; Only call this on start-up
      26.  00:4602                      ; Input: none
      27.  00:4602                      ;===========================================================
      28.  00:4602                      replay_init:
      29.  00:4602  3E 07               	ld	a,7
      30.  00:4604  CD 57 46            	call	replay_set_FM_balance
      31.  00:4607  3E 07               	ld	a,7
      32.  00:4609  CD 5E 46            	call	replay_set_PSG_balance
      33.  00:460C                      
      34.  00:460C  AF                  	xor	a
      35.  00:460D  32 22 C0            	ld	(replay_mode),a	
      36.  00:4610  32 30 C0            	ld	(equalization_cnt),a
      37.  00:4613  32 31 C0            	ld	(equalization_flag),a	
      38.  00:4616  32 2F C0            	ld	(equalization_freq),a
      39.  00:4619  3C                  	inc	a
      40.  00:461A  32 23 C0            	ld	(replay_chan_setup),a	
      41.  00:461D                      	
      42.  00:461D  C9                  	ret
      43.  00:461E                      
      44.  00:461E                      ;===========================================================
      45.  00:461E                      ; ---	replay_pause
      46.  00:461E                      ; Stop/Restart music playback
      47.  00:461E                      ; 
      48.  00:461E                      ; Input: none
      49.  00:461E                      ;===========================================================
      50.  00:461E                      replay_pause:
      51.  00:461E  3A 22 C0            	ld	a,(replay_mode)
      52.  00:4621  A7                  	and	a
      53.  00:4622  CA 2B 46            	jp	z,_r_pause_disable
      54.  00:4625                      _r_pause_enable:
      55.  00:4625                      	;-- re-enable music decoding and processing
      56.  00:4625  3E 01               	ld	a,1
      57.  00:4627  32 22 C0            	ld	(replay_mode),a
      58.  00:462A  C9                  	ret
      59.  00:462B                      	
      60.  00:462B                      _r_pause_disable:
      61.  00:462B                      	;-- stop decoding and processing music data
      62.  00:462B  AF                  	xor	a
      63.  00:462C  32 22 C0            	ld	(replay_mode),a	
      64.  00:462F  32 AE C1            	ld	(FM_DRUM),a
      65.  00:4632                      	;--- Silence the SN7 PSG
      66.  00:4632  32 72 C1            	ld	(PSG_regVOLA),a
      67.  00:4635  32 73 C1            	ld	(PSG_regVOLB),a
      68.  00:4638  32 74 C1            	ld	(PSG_regVOLC),a
      69.  00:463B  32 75 C1            	ld	(PSG_regVOLN),a
      70.  00:463E                      	; release key on all FM channels
      71.  00:463E  06 09               	ld	b,9
      72.  00:4640  21 79 C1            	ld	hl,FM_Registers+1
      73.  00:4643  11 06 00            	ld	de,6
      74.  00:4646  AF                  	xor	a
      75.  00:4647                      _r_pause_loop:
      76.  00:4647  77                  	ld	(hl),a
      77.  00:4648  19                  	add	hl,de
      78.  00:4649  10 FC               	djnz	_r_pause_loop
      79.  00:464B  C9                  	ret	
      80.  00:464C                      	
      81.  00:464C                      
      82.  00:464C                      ;===========================================================
      83.  00:464C                      ; ---	replay_fade_out
      84.  00:464C                      ; Fade out the music. 
      85.  00:464C                      ; Once the sound is silence the replayer is paused.
      86.  00:464C                      ;
      87.  00:464C                      ; in: [A] fade speed (1 - 255)
      88.  00:464C                      ;===========================================================	
      89.  00:464C                      replay_fade_out:
      90.  00:464C  32 25 C0            	ld	(replay_fade),a
      91.  00:464F  32 26 C0            	ld	(replay_fade_timer),a
      92.  00:4652  AF                  	xor	a
      93.  00:4653  32 27 C0            	ld	(replay_fade_vol),a
      94.  00:4656  C9                  	ret
      95.  00:4657                      
      96.  00:4657                      
      97.  00:4657                      	
      98.  00:4657                      ;===========================================================
      99.  00:4657                      ; ---	replay_set_FM_balance
     100.  00:4657                      ; Set the main volume for the SCC chip. This enables for
     101.  00:4657                      ; setting the balance between SCC en PSG as some MSX models 
     102.  00:4657                      ; default balance differs. 
     103.  00:4657                      ;
     104.  00:4657                      ; in: [A] master volume (0-7) 0=halve volume, 7=full volume. 
     105.  00:4657                      ;===========================================================	
     106.  00:4657                      replay_set_FM_balance:
     107.  00:4657  CD 65 46            	call	_getnewbalancebase
     108.  00:465A  22 05 C0            	ld	(replay_mainSCCvol),hl	
     109.  00:465D  C9                  	ret
     110.  00:465E                      	
     111.  00:465E                      ;===========================================================
     112.  00:465E                      ; ---	replay_set_PSG_balance
     113.  00:465E                      ; Set the main volume for the PSG chip. This enables for
     114.  00:465E                      ; setting the balance between SCC en PSG as some MSX models 
     115.  00:465E                      ; default balance differs. 
     116.  00:465E                      ;
     117.  00:465E                      ; in: [A] master volume (0-7) 0=halve volume, 7=full volume. 
     118.  00:465E                      ;===========================================================	
     119.  00:465E                      replay_set_PSG_balance:
     120.  00:465E  CD 65 46            	call	_getnewbalancebase
     121.  00:4661  22 03 C0            	ld	(replay_mainPSGvol),hl	
     122.  00:4664  C9                  	ret
     123.  00:4665                      	
     124.  00:4665                      _getnewbalancebase:
     125.  00:4665  07                  	rlca
     126.  00:4666  07                  	rlca
     127.  00:4667  07                  	rlca
     128.  00:4668  07                  	rlca
     129.  00:4669  21 D6 52            	ld	hl,_VOLUME_TABLE-128
     130.  00:466C  E6 F0               	and	$f0
     131.  00:466E  85                  	add	a,l
     132.  00:466F  6F                  	ld	l,a
     133.  00:4670  D0                  	ret nc
     134.  00:4671  24                  	inc	h
     135.  00:4672  C9                  	ret
     136.  00:4673                      	
     137.  00:4673                      	
     138.  00:4673                      	
     139.  00:4673                      ;===========================================================
     140.  00:4673                      ; ---	replay_loadsong
     141.  00:4673                      ; Initialize a song for playback
     142.  00:4673                      ; 
     143.  00:4673                      ; Input [HL] points to start song
     144.  00:4673                      ;===========================================================
     145.  00:4673                      replay_loadsong:
     146.  00:4673                      	;--- Get the start speed.
     147.  00:4673  7E                  	ld	a,(hl)	
     148.  00:4674  23                  	inc	hl
     149.  00:4675  32 1F C0            	ld	(replay_speed),a
     150.  00:4678                      
     151.  00:4678                      	;--- Set voice base, drum base, instrument base and track pointers
     152.  00:4678  11 07 C0            	ld 	de,replay_voicebase
     153.  00:467B  01 16 00            	ld	bc,22
     154.  00:467E  ED B0               	ldir
     155.  00:4680  22 1D C0            	ld	(replay_orderpointer),hl		; store pointer for next set
     156.  00:4683                      										; of track pointers
     157.  00:4683                      	;--- Initialize re-player variables.
     158.  00:4683  AF                  	xor	a
     159.  00:4684  32 20 C0            	ld	(replay_speed_subtimer),a
     160.  00:4687                      	
     161.  00:4687                      	;--- Erase channel data	in RAM
     162.  00:4687  01 37 01            	ld	bc,TRACK_REC_SIZE*8-1
     163.  00:468A  21 32 C0            	ld	hl,TRACK_Chan1
     164.  00:468D  11 33 C0            	ld	de,TRACK_Chan1+1
     165.  00:4690  77                  	ld	(hl),a
     166.  00:4691  ED B0               	ldir
     167.  00:4693                      	
     168.  00:4693  32 24 C0            	ld	(replay_arp_speed),a
     169.  00:4696  32 B0 C1            	ld	(FM_DRUM_ACTIVE),a
     170.  00:4699  32 AE C1            	ld	(FM_DRUM),a	
     171.  00:469C                      	
     172.  00:469C  32 72 C1            	ld	(PSG_regVOLA),a
     173.  00:469F  32 73 C1            	ld	(PSG_regVOLB),a	
     174.  00:46A2  32 74 C1            	ld	(PSG_regVOLC),a
     175.  00:46A5  32 70 C1            	ld	(PSG_regNOISE),a
     176.  00:46A8                      
     177.  00:46A8                      
     178.  00:46A8                      ;	;--- Set the tone table base
     179.  00:46A8                      ;	ld	hl,TRACK_ToneTable_PSG
     180.  00:46A8                      ;	ld	(replay_tonetable_PSG),hl
     181.  00:46A8                      ;	ld	hl,TRACK_ToneTable_FM
     182.  00:46A8                      ;	ld	(replay_tonetable_FM),hl
     183.  00:46A8                      
     184.  00:46A8  3E 01               	ld	a,1
     185.  00:46AA  32 21 C0            	ld	(replay_speed_timer),a
     186.  00:46AD  32 56 C0            	ld	(TRACK_Chan1+17+TRACK_Delay),a	
     187.  00:46B0  32 7D C0            	ld	(TRACK_Chan2+17+TRACK_Delay),a		
     188.  00:46B3  32 A4 C0            	ld	(TRACK_Chan3+17+TRACK_Delay),a	
     189.  00:46B6  32 CB C0            	ld	(TRACK_Chan4+17+TRACK_Delay),a	
     190.  00:46B9  32 F2 C0            	ld	(TRACK_Chan5+17+TRACK_Delay),a		
     191.  00:46BC  32 19 C1            	ld	(TRACK_Chan6+17+TRACK_Delay),a		
     192.  00:46BF  32 40 C1            	ld	(TRACK_Chan7+17+TRACK_Delay),a		
     193.  00:46C2  32 67 C1            	ld	(TRACK_Chan8+17+TRACK_Delay),a	
     194.  00:46C5                      	
     195.  00:46C5  3E FE               	ld	a,254
     196.  00:46C7  32 32 C0            	ld	(TRACK_Chan1+17+TRACK_Instrument),a	
     197.  00:46CA  32 59 C0            	ld	(TRACK_Chan2+17+TRACK_Instrument),a		
     198.  00:46CD  32 80 C0            	ld	(TRACK_Chan3+17+TRACK_Instrument),a	
     199.  00:46D0  32 A7 C0            	ld	(TRACK_Chan4+17+TRACK_Instrument),a	
     200.  00:46D3  32 CE C0            	ld	(TRACK_Chan5+17+TRACK_Instrument),a		
     201.  00:46D6  32 F5 C0            	ld	(TRACK_Chan6+17+TRACK_Instrument),a		
     202.  00:46D9  32 1C C1            	ld	(TRACK_Chan7+17+TRACK_Instrument),a		
     203.  00:46DC  32 43 C1            	ld	(TRACK_Chan8+17+TRACK_Instrument),a	
     204.  00:46DF  32 B3 C1            	ld	(FM_softvoice_req),a	
     205.  00:46E2                      ;	ld	(FM_softvoice_set),a
     206.  00:46E2                      
     207.  00:46E2  3E 10               	ld	a,16
     208.  00:46E4  32 89 C0            	ld	(TRACK_Chan3+17+TRACK_Voice),a
     209.  00:46E7  32 B0 C0            	ld	(TRACK_Chan4+17+TRACK_Voice),a
     210.  00:46EA  32 D7 C0            	ld	(TRACK_Chan5+17+TRACK_Voice),a
     211.  00:46ED  32 FE C0            	ld	(TRACK_Chan6+17+TRACK_Voice),a	
     212.  00:46F0  32 25 C1            	ld	(TRACK_Chan7+17+TRACK_Voice),a	
     213.  00:46F3  32 4C C1            	ld	(TRACK_Chan8+17+TRACK_Voice),a
     214.  00:46F6  3E 80               	ld	a,128
     215.  00:46F8  32 8A C0            	ld	(TRACK_Chan3+17+TRACK_Flags),a
     216.  00:46FB  32 B1 C0            	ld	(TRACK_Chan4+17+TRACK_Flags),a
     217.  00:46FE  32 D8 C0            	ld	(TRACK_Chan5+17+TRACK_Flags),a
     218.  00:4701  32 FF C0            	ld	(TRACK_Chan6+17+TRACK_Flags),a	
     219.  00:4704  32 26 C1            	ld	(TRACK_Chan7+17+TRACK_Flags),a
     220.  00:4707  32 4D C1            	ld	(TRACK_Chan8+17+TRACK_Flags),a	
     221.  00:470A                      	
     222.  00:470A                      	;--- Check if there are 3 psg chans.
     223.  00:470A  3A 23 C0            	ld	a,(replay_chan_setup)
     224.  00:470D  A7                  	and	a
     225.  00:470E  CA 15 47            	jp	z,99f
     226.  00:4711  AF                  	xor 	a
     227.  00:4712  32 8A C0            	ld	(TRACK_Chan3+17+TRACK_Flags),a	
     228.  00:4715                      99:	
     229.  00:4715                      
     230.  00:4715  CD 86 51            	call	replay_route
     231.  00:4718                      	
     232.  00:4718                      	; end	is here
     233.  00:4718  3E 01               	ld	a,1
     234.  00:471A  32 22 C0            	ld	(replay_mode),a	
     235.  00:471D  C9                  	ret
     236.  00:471E                      
     237.  00:471E                      ;===========================================================
     238.  00:471E                      ; ---	replay_play
     239.  00:471E                      ; Decode music data and process instruments and effects. 
     240.  00:471E                      ; Music chip registers will be prepared for replay_route 
     241.  00:471E                      ;
     242.  00:471E                      ; Input none
     243.  00:471E                      ;===========================================================	
     244.  00:471E                      replay_play:
     245.  00:471E  3A 22 C0            	ld	a,(replay_mode)
     246.  00:4721  A7                  	and	a
     247.  00:4722  C8                  	ret	z		; replay mode = 0	; halted
     248.  00:4723                      				; replay mode = 1	; active
     249.  00:4723                      	
     250.  00:4723                      	;---- SPEED EQUALIZATION 
     251.  00:4723  3A 2F C0            	ld	a,(equalization_freq)		; 0 = 50Hz, otherwise 60Hz
     252.  00:4726  A7                  	and	a
     253.  00:4727  28 14               	jr.	z,.PAL               		; if PAL process at any interrupt;
     254.  00:4729                      
     255.  00:4729                      .NTSC:
     256.  00:4729  21 30 C0            	ld	hl,equalization_cnt  		; if NTSC call 5 times out of 6
     257.  00:472C  35                  	dec	(hl)
     258.  00:472D  20 0E               	jr.	nz,.PAL               		; skip music data processing one tic out of 6
     259.  00:472F                      
     260.  00:472F                      	;--- Reset timer and raise equalization flag
     261.  00:472F  3E 06               	ld	a,6
     262.  00:4731  77                  	ld	(hl),a						
     263.  00:4732  32 31 C0             	ld	(equalization_flag),a		
     264.  00:4735                      
     265.  00:4735  CD 68 48            	call	process_data	
     266.  00:4738  AF                  	xor	a
     267.  00:4739  32 31 C0            	ld	(equalization_flag),a
     268.  00:473C  C9                  	ret
     269.  00:473D                      .PAL:                             
     270.  00:473D                      	;---- END SPEED EQUALIZATION	
     271.  00:473D                      
     272.  00:473D                      		
     273.  00:473D                      	;--- The speed timer
     274.  00:473D  21 21 C0            	ld	hl,replay_speed_timer
     275.  00:4740  35                  	dec	(hl)
     276.  00:4741                      
     277.  00:4741  C2 F6 49            	jp	nz,_replay_check_patternend	
     278.  00:4744                      
     279.  00:4744                      	;--- Re-init Timer == 0
     280.  00:4744  AF                  	xor	a
     281.  00:4745  ED 4B 1F C0         	ld	bc,(replay_speed)		; [b]	sub-timer [c] speed
     282.  00:4749  CB 39               	srl	c				; bit	0 is halve speed step
     283.  00:474B  8F                  	adc	a,a
     284.  00:474C  A8                  	xor	b				; alternate	speed	to have halve speed.
     285.  00:474D  32 20 C0            	ld	(replay_speed_subtimer),a
     286.  00:4750  81                  	add	c
     287.  00:4751  32 21 C0            	ld	(replay_speed_timer),a
     288.  00:4754                      		
     289.  00:4754                      ;===========================================================
     290.  00:4754                      ; ---	replay_decodedata
     291.  00:4754                      ; Process the pattern data 
     292.  00:4754                      ;===========================================================
     293.  00:4754                      decode_data:
     294.  00:4754                      	;--- process the channels (tracks)
     295.  00:4754  21 56 54            	ld	hl,TRACK_ToneTable_PSG			; Set the PSG note table
     296.  00:4757  22 2D C0            	ld	(replay_tonetable),hl	
     297.  00:475A                      	
     298.  00:475A                      .decode1:	
     299.  00:475A  21 56 C0            	ld 	hl,TRACK_Chan1+17+TRACK_Delay
     300.  00:475D  35                  	dec	(hl)
     301.  00:475E  C2 7B 47            	jp	nz,.decode2
     302.  00:4761                      
     303.  00:4761  3A 3C C0            	ld	a,(TRACK_Chan1+17+TRACK_Flags)
     304.  00:4764  57                  	ld	d,a
     305.  00:4765  3A 39 C0            	ld	a,(TRACK_Chan1+17+TRACK_Note)	
     306.  00:4768  DD 21 43 C0         	ld	ix,TRACK_Chan1+17
     307.  00:476C  ED 4B 0D C0         	ld	bc,(TRACK_pointer1)
     308.  00:4770  CD 28 4A            	call	decode_data_chan
     309.  00:4773  ED 43 0D C0         	ld	(TRACK_pointer1),bc
     310.  00:4777  7A                  	ld	a,d
     311.  00:4778  32 3C C0            	ld	(TRACK_Chan1+17+TRACK_Flags),a	
     312.  00:477B                      
     313.  00:477B                      .decode2:	
     314.  00:477B  21 7D C0            	ld 	hl,TRACK_Chan2+17+TRACK_Delay
     315.  00:477E  35                  	dec	(hl)
     316.  00:477F  C2 A2 47            	jp	nz,.decode3
     317.  00:4782                      
     318.  00:4782  3A 63 C0            	ld	a,(TRACK_Chan2+17+TRACK_Flags)
     319.  00:4785  57                  	ld	d,a
     320.  00:4786  3A 60 C0            	ld	a,(TRACK_Chan2+17+TRACK_Note)	
     321.  00:4789  DD 21 6A C0         	ld	ix,TRACK_Chan2+17
     322.  00:478D  ED 4B 0F C0         	ld	bc,(TRACK_pointer2)
     323.  00:4791  CD 28 4A            	call	decode_data_chan
     324.  00:4794  ED 43 0F C0         	ld	(TRACK_pointer2),bc
     325.  00:4798  7A                  	ld	a,d				;'
     326.  00:4799  32 63 C0            	ld	(TRACK_Chan2+17+TRACK_Flags),a	
     327.  00:479C                      
     328.  00:479C                      	;--- Set FM Tone table
     329.  00:479C  21 16 55            	ld	hl,TRACK_ToneTable_FM
     330.  00:479F  22 2D C0            	ld	(replay_tonetable),hl
     331.  00:47A2                      
     332.  00:47A2                      
     333.  00:47A2                      .decode3:
     334.  00:47A2  21 A4 C0            	ld 	hl,TRACK_Chan3+17+TRACK_Delay
     335.  00:47A5  35                  	dec	(hl)
     336.  00:47A6  C2 C3 47            	jp	nz,.decode4
     337.  00:47A9                      
     338.  00:47A9  3A 8A C0            	ld	a,(TRACK_Chan3+17+TRACK_Flags)
     339.  00:47AC  57                  	ld	d,a		;'
     340.  00:47AD  3A 87 C0            	ld	a,(TRACK_Chan3+17+TRACK_Note)	
     341.  00:47B0  DD 21 91 C0         	ld	ix,TRACK_Chan3+17
     342.  00:47B4  ED 4B 11 C0         	ld	bc,(TRACK_pointer3)
     343.  00:47B8  CD 28 4A            	call	decode_data_chan
     344.  00:47BB  ED 43 11 C0         	ld	(TRACK_pointer3),bc
     345.  00:47BF  7A                  	ld	a,d				;'
     346.  00:47C0  32 8A C0            	ld	(TRACK_Chan3+17+TRACK_Flags),a	
     347.  00:47C3                      
     348.  00:47C3                      .decode4:
     349.  00:47C3  21 CB C0            	ld 	hl,TRACK_Chan4+17+TRACK_Delay
     350.  00:47C6  35                  	dec	(hl)
     351.  00:47C7  C2 E4 47            	jp	nz,.decode5
     352.  00:47CA                      
     353.  00:47CA  3A B1 C0            	ld	a,(TRACK_Chan4+17+TRACK_Flags)
     354.  00:47CD  57                  	ld 	d,a		;'
     355.  00:47CE  3A AE C0            	ld	a,(TRACK_Chan4+17+TRACK_Note)	
     356.  00:47D1  DD 21 B8 C0         	ld	ix,TRACK_Chan4+17
     357.  00:47D5  ED 4B 13 C0         	ld	bc,(TRACK_pointer4)
     358.  00:47D9  CD 28 4A            	call	decode_data_chan
     359.  00:47DC  ED 43 13 C0         	ld	(TRACK_pointer4),bc
     360.  00:47E0  7A                  	ld	a,d			;'
     361.  00:47E1  32 B1 C0            	ld	(TRACK_Chan4+17+TRACK_Flags),a	
     362.  00:47E4                      
     363.  00:47E4                      .decode5:
     364.  00:47E4  21 F2 C0            	ld 	hl,TRACK_Chan5+17+TRACK_Delay
     365.  00:47E7  35                  	dec	(hl)
     366.  00:47E8  C2 05 48            	jp	nz,.decode6
     367.  00:47EB                      
     368.  00:47EB  3A D8 C0            	ld	a,(TRACK_Chan5+17+TRACK_Flags)
     369.  00:47EE  57                  	ld	d,a		;'
     370.  00:47EF  3A D5 C0            	ld	a,(TRACK_Chan5+17+TRACK_Note)	
     371.  00:47F2  DD 21 DF C0         	ld	ix,TRACK_Chan5+17
     372.  00:47F6  ED 4B 15 C0         	ld	bc,(TRACK_pointer5)
     373.  00:47FA  CD 28 4A            	call	decode_data_chan
     374.  00:47FD  ED 43 15 C0         	ld	(TRACK_pointer5),bc
     375.  00:4801  7A                  	ld	a,d			;'
     376.  00:4802  32 D8 C0            	ld	(TRACK_Chan5+17+TRACK_Flags),a	
     377.  00:4805                      
     378.  00:4805                      .decode6:
     379.  00:4805  21 19 C1            	ld 	hl,TRACK_Chan6+17+TRACK_Delay
     380.  00:4808  35                  	dec	(hl)
     381.  00:4809  C2 26 48            	jp	nz,.decode7
     382.  00:480C                      
     383.  00:480C  3A FF C0            	ld	a,(TRACK_Chan6+17+TRACK_Flags)
     384.  00:480F  57                  	ld	d,a		;'
     385.  00:4810  3A FC C0            	ld	a,(TRACK_Chan6+17+TRACK_Note)	
     386.  00:4813  DD 21 06 C1         	ld	ix,TRACK_Chan6+17
     387.  00:4817  ED 4B 17 C0         	ld	bc,(TRACK_pointer6)
     388.  00:481B  CD 28 4A            	call	decode_data_chan
     389.  00:481E  ED 43 17 C0         	ld	(TRACK_pointer6),bc
     390.  00:4822  7A                  	ld	a,d				;'
     391.  00:4823  32 FF C0            	ld	(TRACK_Chan6+17+TRACK_Flags),a	
     392.  00:4826                      
     393.  00:4826                      .decode7:
     394.  00:4826  21 40 C1            	ld 	hl,TRACK_Chan7+17+TRACK_Delay
     395.  00:4829  35                  	dec	(hl)
     396.  00:482A  C2 47 48            	jp	nz,.decode8
     397.  00:482D                      
     398.  00:482D  3A 26 C1            	ld	a,(TRACK_Chan7+17+TRACK_Flags)
     399.  00:4830  57                  	ld	d,a		;'
     400.  00:4831  3A 23 C1            	ld	a,(TRACK_Chan7+17+TRACK_Note)	
     401.  00:4834  DD 21 2D C1         	ld	ix,TRACK_Chan7+17
     402.  00:4838  ED 4B 19 C0         	ld	bc,(TRACK_pointer7)
     403.  00:483C  CD 28 4A            	call	decode_data_chan
     404.  00:483F  ED 43 19 C0         	ld	(TRACK_pointer7),bc
     405.  00:4843  7A                  	ld	a,d				;'
     406.  00:4844  32 26 C1            	ld	(TRACK_Chan7+17+TRACK_Flags),a	
     407.  00:4847                      
     408.  00:4847                      .decode8:
     409.  00:4847  21 67 C1            	ld 	hl,TRACK_Chan8+17+TRACK_Delay
     410.  00:484A  35                  	dec	(hl)
     411.  00:484B  C2 68 48            	jp	nz,.decode_end
     412.  00:484E                      
     413.  00:484E  3A 4D C1            	ld	a,(TRACK_Chan8+17+TRACK_Flags)
     414.  00:4851  57                  	ld	d,a		;'
     415.  00:4852  3A 4A C1            	ld	a,(TRACK_Chan8+17+TRACK_Note)	
     416.  00:4855  DD 21 54 C1         	ld	ix,TRACK_Chan8+17
     417.  00:4859  ED 4B 1B C0         	ld	bc,(TRACK_pointer8)
     418.  00:485D  CD 28 4A            	call	decode_data_chan
     419.  00:4860  ED 43 1B C0         	ld	(TRACK_pointer8),bc
     420.  00:4864  7A                  	ld	a,d				;'
     421.  00:4865  32 4D C1            	ld	(TRACK_Chan8+17+TRACK_Flags),a
     422.  00:4868                      		
     423.  00:4868                      .decode_end:
     424.  00:4868                      	; continue to process data
     425.  00:4868                      ;===========================================================
     426.  00:4868                      ; ---	replay_decodedata_NO
     427.  00:4868                      ; Process changes.
     428.  00:4868                      ; 
     429.  00:4868                      ; 
     430.  00:4868                      ;===========================================================
     431.  00:4868                      process_data:
     432.  00:4868  3E FA               	ld	a,$fa ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     433.  00:486A  D3 99               	out	(0x99),a
     434.  00:486C  3E 87               	ld	a,7+128
     435.  00:486E  D3 99               	out	(0x99),a	
     436.  00:4870                      
     437.  00:4870                      
     438.  00:4870                      
     439.  00:4870                      	; Set tone table
     440.  00:4870  21 56 54            	ld	hl,TRACK_ToneTable_PSG
     441.  00:4873  22 2D C0            	ld	(replay_tonetable),hl
     442.  00:4876                      
     443.  00:4876                      	;--- Initialize PSG Mixer and volume
     444.  00:4876  AF                  	xor	a
     445.  00:4877  32 B4 C1            	ld	(FM_regMIXER),a
     446.  00:487A  32 75 C1            	ld	(PSG_regVOLN),a
     447.  00:487D  32 72 C1            	ld	(PSG_regVOLA),a
     448.  00:4880  32 73 C1            	ld	(PSG_regVOLB),a
     449.  00:4883  32 74 C1            	ld	(PSG_regVOLC),a
     450.  00:4886                      	
     451.  00:4886                      	;--- PSG balance
     452.  00:4886  2A 03 C0            	ld	hl,(replay_mainPSGvol)
     453.  00:4889  22 29 C0            	ld	(replay_mainvol),hl
     454.  00:488C                      	
     455.  00:488C                      	;--------------------
     456.  00:488C                      	;--- Process track 1
     457.  00:488C                      	;--------------------
     458.  00:488C  DD 21 43 C0         	ld	ix,TRACK_Chan1+17
     459.  00:4890  3A 3C C0            	ld	a,(TRACK_Chan1+17+TRACK_Flags)
     460.  00:4893  57                  	ld	d,a
     461.  00:4894  21 6A C1            	ld	hl,PSG_regToneA
     462.  00:4897  CD E5 4C            	call	process_data_chan
     463.  00:489A  3A 9A C1            	ld	a,(FM_regVOLF)
     464.  00:489D  32 72 C1            	ld	(PSG_regVOLA),a	
     465.  00:48A0                      
     466.  00:48A0                      	;--------------------
     467.  00:48A0                      	;--- Process track 2
     468.  00:48A0                      	;--------------------
     469.  00:48A0  DD 21 6A C0         	ld	ix,TRACK_Chan2+17
     470.  00:48A4  3A 63 C0            	ld	a,(TRACK_Chan2+17+TRACK_Flags)
     471.  00:48A7  57                  	ld	d,a
     472.  00:48A8  21 6C C1            	ld	hl,PSG_regToneB
     473.  00:48AB  CD E5 4C            	call	process_data_chan
     474.  00:48AE  3A 9A C1            	ld	a,(FM_regVOLF)
     475.  00:48B1  32 73 C1            	ld	(PSG_regVOLB),a	
     476.  00:48B4                      
     477.  00:48B4  3A 23 C0            	ld	a,(replay_chan_setup)
     478.  00:48B7  A7                  	and	a
     479.  00:48B8  CA EE 48            	jp	z,_rdd_2psg_6fm
     480.  00:48BB                      
     481.  00:48BB                      _rdd_3psg_5fm:
     482.  00:48BB                      	;--------------------
     483.  00:48BB                      	;--- Process track 3	
     484.  00:48BB                      	;--------------------
     485.  00:48BB  DD 21 91 C0         	ld	ix,TRACK_Chan3+17
     486.  00:48BF  3A 8A C0            	ld	a,(TRACK_Chan3+17+TRACK_Flags)
     487.  00:48C2  57                  	ld	d,a
     488.  00:48C3  21 6E C1            	ld	hl,PSG_regToneC
     489.  00:48C6  CD E5 4C            	call	process_data_chan
     490.  00:48C9  3A 9A C1            	ld	a,(FM_regVOLF)
     491.  00:48CC  32 74 C1            	ld	(PSG_regVOLC),a
     492.  00:48CF                      
     493.  00:48CF                      	;-- Convert mixer to AY
     494.  00:48CF  3A B4 C1            	ld	a,(FM_regMIXER)		
     495.  00:48D2  CB 3F               	srl	a
     496.  00:48D4  CB 3F               	srl	a
     497.  00:48D6  EE 3F               	xor	0x3f
     498.  00:48D8  32 71 C1            	ld	(PSG_regMIXER),a
     499.  00:48DB  AF                  	xor	a
     500.  00:48DC  32 B4 C1            	ld	(FM_regMIXER),a
     501.  00:48DF                      
     502.  00:48DF                      	; Set tone table
     503.  00:48DF  21 16 55            	ld	hl,TRACK_ToneTable_FM
     504.  00:48E2  22 2D C0            	ld	(replay_tonetable),hl
     505.  00:48E5                      	;--- set SCC balance
     506.  00:48E5  2A 05 C0            	ld	hl,(replay_mainSCCvol)
     507.  00:48E8  22 29 C0            	ld	(replay_mainvol),hl
     508.  00:48EB                      	
     509.  00:48EB  C3 23 49            	jp	_rdd_cont
     510.  00:48EE                      	
     511.  00:48EE                      	
     512.  00:48EE                      _rdd_2psg_6fm:
     513.  00:48EE                      	;-- Convert mixer to AY
     514.  00:48EE  3A B4 C1            	ld	a,(FM_regMIXER)		
     515.  00:48F1  CB 3F               	srl	a
     516.  00:48F3  CB 3F               	srl	a
     517.  00:48F5  CB 3F               	srl	a
     518.  00:48F7  EE 3F               	xor	0x3f
     519.  00:48F9  32 71 C1            	ld	(PSG_regMIXER),a
     520.  00:48FC                      
     521.  00:48FC                      	; Set tone table
     522.  00:48FC  21 16 55            	ld	hl,TRACK_ToneTable_FM
     523.  00:48FF  22 2D C0            	ld	(replay_tonetable),hl
     524.  00:4902                      	;--- set SCC balance
     525.  00:4902  2A 05 C0            	ld	hl,(replay_mainSCCvol)
     526.  00:4905  22 29 C0            	ld	(replay_mainvol),hl
     527.  00:4908                      
     528.  00:4908                      	;--------------------
     529.  00:4908                      	;--- Process track 3
     530.  00:4908                      	;--------------------
     531.  00:4908  DD 21 91 C0         	ld	ix,TRACK_Chan3+17
     532.  00:490C  3A 8A C0            	ld	a,(TRACK_Chan3+17+TRACK_Flags)
     533.  00:490F  57                  	ld	d,a
     534.  00:4910  21 78 C1            	ld	hl,FM_regToneA
     535.  00:4913  CD E5 4C            	call	process_data_chan
     536.  00:4916                      
     537.  00:4916  3A 9A C1            	ld	a,(FM_regVOLF)
     538.  00:4919  57                  	ld	d,a
     539.  00:491A  3A 89 C0            	ld	a,(TRACK_Chan3+17+TRACK_Voice)
     540.  00:491D  E6 F0               	and	$f0
     541.  00:491F  B2                  	or	d
     542.  00:4920  32 7C C1            	ld	(FM_regVOLA),a	
     543.  00:4923                      
     544.  00:4923                      
     545.  00:4923                      _rdd_cont:
     546.  00:4923                      	;--------------------
     547.  00:4923                      	;--- Process track 4
     548.  00:4923                      	;--------------------
     549.  00:4923  DD 21 B8 C0         	ld	ix,TRACK_Chan4+17
     550.  00:4927  3A B1 C0            	ld	a,(TRACK_Chan4+17+TRACK_Flags)
     551.  00:492A  57                  	ld	d,a
     552.  00:492B  21 7E C1            	ld	hl,FM_regToneB
     553.  00:492E  CD E5 4C            	call	process_data_chan
     554.  00:4931  3A 9A C1            	ld	a,(FM_regVOLF)
     555.  00:4934  57                  	ld	d,a
     556.  00:4935  3A B0 C0            	ld	a,(TRACK_Chan4+17+TRACK_Voice)
     557.  00:4938  E6 F0               	and	$f0
     558.  00:493A  B2                  	or	d
     559.  00:493B  32 82 C1            	ld	(FM_regVOLB),a	
     560.  00:493E                      
     561.  00:493E                      	;--------------------
     562.  00:493E                      	;--- Process track 5
     563.  00:493E                      	;--------------------	
     564.  00:493E  DD 21 DF C0         	ld	ix,TRACK_Chan5+17
     565.  00:4942  3A D8 C0            	ld	a,(TRACK_Chan5+17+TRACK_Flags)
     566.  00:4945  57                  	ld	d,a
     567.  00:4946  21 84 C1            	ld	hl,FM_regToneC
     568.  00:4949  CD E5 4C            	call	process_data_chan
     569.  00:494C  3A 9A C1            	ld	a,(FM_regVOLF)
     570.  00:494F  57                  	ld	d,a
     571.  00:4950  3A D7 C0            	ld	a,(TRACK_Chan5+17+TRACK_Voice)
     572.  00:4953  E6 F0               	and	$f0
     573.  00:4955  B2                  	or	d
     574.  00:4956  32 88 C1            	ld	(FM_regVOLC),a	
     575.  00:4959                      
     576.  00:4959                      	;--------------------
     577.  00:4959                      	;--- Process track 6
     578.  00:4959                      	;--------------------
     579.  00:4959                      		
     580.  00:4959  DD 21 06 C1         	ld	ix,TRACK_Chan6+17
     581.  00:495D  3A FF C0            	ld	a,(TRACK_Chan6+17+TRACK_Flags)
     582.  00:4960  57                  	ld	d,a
     583.  00:4961  21 8A C1            	ld	hl,FM_regToneD
     584.  00:4964  CD E5 4C            	call	process_data_chan
     585.  00:4967  3A 9A C1            	ld	a,(FM_regVOLF)
     586.  00:496A  57                  	ld	d,a
     587.  00:496B  3A FE C0            	ld	a,(TRACK_Chan6+17+TRACK_Voice)
     588.  00:496E  E6 F0               	and	$f0
     589.  00:4970  B2                  	or	d
     590.  00:4971  32 8E C1            	ld	(FM_regVOLD),a	
     591.  00:4974                      
     592.  00:4974                      	;--------------------
     593.  00:4974                      	;--- Process track 7
     594.  00:4974                      	;--------------------
     595.  00:4974  DD 21 2D C1         	ld	ix,TRACK_Chan7+17
     596.  00:4978  3A 26 C1            	ld	a,(TRACK_Chan7+17+TRACK_Flags)
     597.  00:497B  57                  	ld	d,a
     598.  00:497C  21 90 C1            	ld	hl,FM_regToneE
     599.  00:497F  CD E5 4C            	call	process_data_chan
     600.  00:4982  3A 9A C1            	ld	a,(FM_regVOLF)
     601.  00:4985  57                  	ld	d,a
     602.  00:4986  3A 25 C1            	ld	a,(TRACK_Chan7+17+TRACK_Voice)
     603.  00:4989  E6 F0               	and	$f0
     604.  00:498B  B2                  	or	d
     605.  00:498C  32 94 C1            	ld	(FM_regVOLE),a		
     606.  00:498F                      
     607.  00:498F                      	;--------------------
     608.  00:498F                      	;--- Process track 8
     609.  00:498F                      	;--------------------		
     610.  00:498F  DD 21 54 C1         	ld	ix,TRACK_Chan8+17
     611.  00:4993  3A 4D C1            	ld	a,(TRACK_Chan8+17+TRACK_Flags)
     612.  00:4996  57                  	ld	d,a
     613.  00:4997  21 96 C1            	ld	hl,FM_regToneF
     614.  00:499A  CD E5 4C            	call	process_data_chan
     615.  00:499D  3A 9A C1            	ld	a,(FM_regVOLF)
     616.  00:49A0  57                  	ld	d,a
     617.  00:49A1  3A 4C C1            	ld	a,(TRACK_Chan8+17+TRACK_Voice)
     618.  00:49A4  E6 F0               	and	$f0
     619.  00:49A6  B2                  	or	d	
     620.  00:49A7  32 9A C1            	ld	(FM_regVOLF),a
     621.  00:49AA                      
     622.  00:49AA  3E F6               	ld	a,$f6 ; Reg#3 [A13][A12][A11][A10][A09][ 1 ][ 1 ][ 1 ]  - Color table  [HIGH]
     623.  00:49AC  D3 99               	out	(0x99),a
     624.  00:49AE  3E 87               	ld	a,7+128
     625.  00:49B0  D3 99               	out	(0x99),a	
     626.  00:49B2                      
     627.  00:49B2                      	;--------------------
     628.  00:49B2                      	;--- Process Drums
     629.  00:49B2                      	;--------------------
     630.  00:49B2  CD 91 50            	call	process_drum
     631.  00:49B5                      
     632.  00:49B5                      
     633.  00:49B5                      
     634.  00:49B5                      
     635.  00:49B5                      	
     636.  00:49B5                      
     637.  00:49B5                      	;--------------------
     638.  00:49B5                      	; Fade out processing
     639.  00:49B5                      	;--------------------
     640.  00:49B5  3A 25 C0            	ld	a,(replay_fade)
     641.  00:49B8  A7                  	and	a
     642.  00:49B9  C8                  	ret	z	; if replay fade = 0 then no fade active
     643.  00:49BA                      	
     644.  00:49BA                      	; decrease fade timer
     645.  00:49BA  3A 26 C0            	ld	a,(replay_fade_timer)
     646.  00:49BD  3D                  	dec	a
     647.  00:49BE  C2 D7 49            	jp	nz,.no_new_step
     648.  00:49C1                      
     649.  00:49C1  3A 27 C0            	ld	a,(replay_fade_vol)
     650.  00:49C4  3C                  	inc	a
     651.  00:49C5  FE 10               	cp	16
     652.  00:49C7  DA D1 49            	jp	c,.cont_fadeing
     653.  00:49CA  AF                  	xor	a
     654.  00:49CB  32 25 C0            	ld	(replay_fade),a
     655.  00:49CE  C3 1E 46            	jp	replay_pause
     656.  00:49D1                      .cont_fadeing:	
     657.  00:49D1  32 27 C0            	ld	(replay_fade_vol),a
     658.  00:49D4  3A 25 C0            	ld	a,(replay_fade)
     659.  00:49D7                      .no_new_step:
     660.  00:49D7  32 26 C0            	ld	(replay_fade_timer),a
     661.  00:49DA                      
     662.  00:49DA  3A 27 C0            	ld	a,(replay_fade_vol)
     663.  00:49DD  4F                  	ld	c,a
     664.  00:49DE  06 03               	ld	b,3
     665.  00:49E0  21 72 C1            	ld	hl,PSG_regVOLA
     666.  00:49E3  CD EB 49            	call	.calc_vol
     667.  00:49E6  06 06               	ld	b,6
     668.  00:49E8  21 7C C1            	ld	hl,FM_regVOLA
     669.  00:49EB                      
     670.  00:49EB                      .calc_vol:	
     671.  00:49EB  7E                  	ld	a,(hl)
     672.  00:49EC  91                  	sub	c
     673.  00:49ED  D2 F1 49            	jp	nc,.no_carry
     674.  00:49F0  AF                  	xor	a
     675.  00:49F1                      .no_carry:	
     676.  00:49F1  77                  	ld	(hl),a
     677.  00:49F2  23                  	inc	hl
     678.  00:49F3  10 F6               	djnz	.calc_vol
     679.  00:49F5  C9                  	ret
     680.  00:49F6                      
     681.  00:49F6                      
     682.  00:49F6                      
     683.  00:49F6                      ;--------------------
     684.  00:49F6                      	
     685.  00:49F6                      	
     686.  00:49F6                      ;--------------------
     687.  00:49F6                      _replay_check_patternend:
     688.  00:49F6  3A 56 C0            	ld 	a,(TRACK_Chan1+17+TRACK_Delay)
     689.  00:49F9  3D                  	dec	a
     690.  00:49FA  C2 68 48            	jp	nz,process_data
     691.  00:49FD                      	
     692.  00:49FD                      
     693.  00:49FD                      
     694.  00:49FD  2A 0D C0            	ld	hl,(TRACK_pointer1)
     695.  00:4A00  7E                  	ld	a,(hl)
     696.  00:4A01                      	
     697.  00:4A01                      	;--- check for end of pattern
     698.  00:4A01  FE BF               	cp	191	
     699.  00:4A03  C2 68 48            	jp	nz,process_data
     700.  00:4A06                      
     701.  00:4A06                      
     702.  00:4A06                      	;--- Set track pointers to start
     703.  00:4A06  2A 1D C0            	ld	hl,(replay_orderpointer)
     704.  00:4A09  AF                  	xor	a
     705.  00:4A0A  BE                  	cp	(hl)
     706.  00:4A0B  C2 1A 4A            	jp	nz,.no_restart
     707.  00:4A0E  23                  	inc	hl
     708.  00:4A0F  BE                  	cp	(hl)
     709.  00:4A10  2B                  	dec	hl
     710.  00:4A11  C2 1A 4A            	jp	nz,.no_restart
     711.  00:4A14                      	;--- next is restart order
     712.  00:4A14  23                  	inc	hl
     713.  00:4A15  23                  	inc	hl
     714.  00:4A16  7E                  	ld	a,(hl)
     715.  00:4A17  23                  	inc	hl
     716.  00:4A18  66                  	ld	h,(hl)
     717.  00:4A19  6F                  	ld	l,a
     718.  00:4A1A                      .no_restart:	
     719.  00:4A1A  11 0D C0            	ld	de,TRACK_pointer1
     720.  00:4A1D  01 10 00            	ld	bc,16
     721.  00:4A20  ED B0               	ldir
     722.  00:4A22  22 1D C0            	ld	(replay_orderpointer),hl		; store pointer for next set
     723.  00:4A25                      								; of strack pointers
     724.  00:4A25  C3 68 48            	jp	process_data
     725.  00:4A28                      
     726.  00:4A28                      
     727.  00:4A28                      
     728.  00:4A28                      
     729.  00:4A28                      
     730.  00:4A28                      
     731.  00:4A28                      
     732.  00:4A28                      
     733.  00:4A28                      
     734.  00:4A28                      
     735.  00:4A28                      
     736.  00:4A28                      
     737.  00:4A28                      ;===========================================================
     738.  00:4A28                      ; ---	decode_data_chan
     739.  00:4A28                      ; Process the channel data
     740.  00:4A28                      ; 
     741.  00:4A28                      ; in BC is the pointer to the	data
     742.  00:4A28                      ;    D contains flags.
     743.  00:4A28                      ;===========================================================	
     744.  00:4A28                      decode_data_chan:
     745.  00:4A28                      	;--- initialize data
     746.  00:4A28  DD 7E F6            	ld	a,(ix+TRACK_Note)
     747.  00:4A2B  32 28 C0            	ld	(replay_previous_note),a
     748.  00:4A2E                      
     749.  00:4A2E                      	;=============
     750.  00:4A2E                      	; Note 
     751.  00:4A2E                      	;=============
     752.  00:4A2E  0A                  	ld	a,(bc)
     753.  00:4A2F  FE 60               	cp	_REL
     754.  00:4A31  DA A4 4A            	jp	c,_replay_decode_note
     755.  00:4A34  FE 61               	cp	_SUS
     756.  00:4A36  DA B0 4A            	jp	c,_replay_decode_release
     757.  00:4A39  CA BB 4A            	jp	z,_replay_decode_sustain
     758.  00:4A3C                      _rdn2:
     759.  00:4A3C  FE 71               	cp	_INS
     760.  00:4A3E  DA FD 4A            	jp	c,_replay_decode_vol
     761.  00:4A41                      _rdv2:
     762.  00:4A41  FE 90               	cp	_CMD
     763.  00:4A43  DA C4 4A            	jp	c,_replay_decode_ins
     764.  00:4A46                      _rdi2:
     765.  00:4A46  FE BF               	cp	_EOT
     766.  00:4A48  DA 12 4B            	jp	c,_replaydecode_cmd
     767.  00:4A4B  C3 80 4A            	jp	_replay_decode_delay
     768.  00:4A4E                      
     769.  00:4A4E                      _rdn:
     770.  00:4A4E  FE 62               	cp	_SUS+1		
     771.  00:4A50  DA 70 4A            	jp	c,_rd_delay
     772.  00:4A53  C3 3C 4A            	jp	_rdn2
     773.  00:4A56                      
     774.  00:4A56                      _rdi:
     775.  00:4A56  FE 90               	cp	_CMD
     776.  00:4A58  DA 70 4A            	jp	c,_rd_delay
     777.  00:4A5B  C3 46 4A            	jp	_rdi2
     778.  00:4A5E                      
     779.  00:4A5E                      _rdv:
     780.  00:4A5E  FE 71               	cp	_INS
     781.  00:4A60  DA 70 4A            	jp	c,_rd_delay
     782.  00:4A63  C3 41 4A            	jp	_rdv2
     783.  00:4A66                      _rdc:
     784.  00:4A66  03                  	inc	bc
     785.  00:4A67                      _rdc_noinc:	
     786.  00:4A67  0A                  	ld	a,(bc)
     787.  00:4A68  FE BF               	cp	_EOT
     788.  00:4A6A  DA 70 4A            	jp	c,_rd_delay
     789.  00:4A6D  C3 80 4A            	jp	_replay_decode_delay
     790.  00:4A70                      
     791.  00:4A70                      	;--- re-init previous delay
     792.  00:4A70                      _rd_delay:
     793.  00:4A70  DD 7E 14            	ld	a,(ix+TRACK_prevDelay)
     794.  00:4A73  DD 77 13            	ld	(ix+TRACK_Delay),a
     795.  00:4A76  C3 8C 4A            	jp	_replay_decode_trigger_porttone_check
     796.  00:4A79                      
     797.  00:4A79                      _rd_eot:
     798.  00:4A79  3C                  	inc	a
     799.  00:4A7A  DD 77 13            	ld	(ix+TRACK_Delay),a
     800.  00:4A7D  C3 8C 4A            	jp	_replay_decode_trigger_porttone_check
     801.  00:4A80                      
     802.  00:4A80                      _replay_decode_delay:
     803.  00:4A80  D6 BF               	sub	_WAIT-1
     804.  00:4A82  CA 79 4A            	jp	z,_rd_eot		; EOT found
     805.  00:4A85  DD 77 13            	ld	(ix+TRACK_Delay),a
     806.  00:4A88  DD 77 14            	ld	(ix+TRACK_prevDelay),a
     807.  00:4A8B  03                  	inc	bc
     808.  00:4A8C                      	
     809.  00:4A8C                      _replay_decode_trigger_porttone_check:	
     810.  00:4A8C                      	;--- Check cmd active and note trigger?
     811.  00:4A8C  CB 42               	bit 	B_TRGNOT,d
     812.  00:4A8E  C8                  	ret	z
     813.  00:4A8F  CB 5A               	bit	B_TRGCMD,d
     814.  00:4A91  C8                  	ret	z
     815.  00:4A92                      	;--- Check for cmd3 or cmd5 (value 0 or 1) to continue
     816.  00:4A92  DD 7E F0            	ld	a,(ix+TRACK_Command)
     817.  00:4A95  FE 02               	cp	2
     818.  00:4A97  D0                  	ret	nc
     819.  00:4A98                      	;-- trigger CMD
     820.  00:4A98  CB 82               	res	B_TRGNOT,d
     821.  00:4A9A  3E 12               	ld	a,0010010b		;B_ACTNOT B_KEYON
     822.  00:4A9C  B2                  	or	d
     823.  00:4A9D  57                  	ld 	d,a
     824.  00:4A9E  DD 7E 09            	ld	a,(ix+TRACK_cmd_3)
     825.  00:4AA1  C3 A1 4B            	jp	decode_cmd3_port_tone_new_note	
     826.  00:4AA4                      	;ret
     827.  00:4AA4                      
     828.  00:4AA4                      _replay_decode_note:
     829.  00:4AA4  DD 77 F6            	ld	(ix+TRACK_Note),a
     830.  00:4AA7  CB C2               	set 	B_TRGNOT,d
     831.  00:4AA9  CB E2               	set 	B_KEYON,d
     832.  00:4AAB                      
     833.  00:4AAB  03                  	inc	bc
     834.  00:4AAC  0A                  	ld	a,(bc)
     835.  00:4AAD  C3 4E 4A            	jp	_rdn
     836.  00:4AB0                      	
     837.  00:4AB0                      
     838.  00:4AB0                      
     839.  00:4AB0                      _replay_decode_release:
     840.  00:4AB0  CB 8A               	res	B_ACTNOT,d				; reset note bit to	0
     841.  00:4AB2  CB AA               	res	B_SUST,d				; rest sustain
     842.  00:4AB4  CB A2               	res	B_KEYON,d				; reset Key on
     843.  00:4AB6                      
     844.  00:4AB6  03                  	inc	bc
     845.  00:4AB7  0A                  	ld	a,(bc)
     846.  00:4AB8  C3 4E 4A            	jp	_rdn	
     847.  00:4ABB                      	
     848.  00:4ABB                      
     849.  00:4ABB                      
     850.  00:4ABB                      _replay_decode_sustain:
     851.  00:4ABB                      ;	res	B_ACTNOT,d				; reset note bit to	0
     852.  00:4ABB  CB EA               	set	B_SUST,d				; rest sustain
     853.  00:4ABD  CB A2               	res	B_KEYON,d				; reset Key on
     854.  00:4ABF                      
     855.  00:4ABF  03                  	inc	bc
     856.  00:4AC0  0A                  	ld	a,(bc)
     857.  00:4AC1  C3 4E 4A            	jp	_rdn
     858.  00:4AC4                      
     859.  00:4AC4                      
     860.  00:4AC4                      
     861.  00:4AC4                      _replay_decode_ins:
     862.  00:4AC4  D6 71               	sub	_INS
     863.  00:4AC6  DD BE EF            	cp	(ix+TRACK_Instrument)
     864.  00:4AC9  CA F8 4A            	jp	z,.skip_ins
     865.  00:4ACC                      	
     866.  00:4ACC                      	;--- instrument change found	
     867.  00:4ACC  DD 77 EF            	ld	(ix+TRACK_Instrument),a
     868.  00:4ACF                      
     869.  00:4ACF                      	;--- set instrument pointer
     870.  00:4ACF  87                  	add	a
     871.  00:4AD0  2A 0B C0            	ld	hl,(replay_insbase)
     872.  00:4AD3  85                  	add	a,l
     873.  00:4AD4  6F                  	ld	l,a
     874.  00:4AD5  D2 D9 4A            	jp	nc,.skip
     875.  00:4AD8  24                  	inc	h
     876.  00:4AD9                      .skip:
     877.  00:4AD9  7E                  	ld	a,(hl)
     878.  00:4ADA  23                  	inc	hl
     879.  00:4ADB  66                  	ld	h,(hl)
     880.  00:4ADC  6F                  	ld	l,a
     881.  00:4ADD                      
     882.  00:4ADD                      	;-- get voice
     883.  00:4ADD  7E                  	ld	a,(hl)
     884.  00:4ADE  23                  	inc	hl
     885.  00:4ADF                      		
     886.  00:4ADF                      	;--- Set the software voice (if needed)
     887.  00:4ADF  A7                  	and	a
     888.  00:4AE0  C2 E9 4A            	jp	nz,.skip_soft
     889.  00:4AE3                      	;--- software voice found
     890.  00:4AE3                      	
     891.  00:4AE3  7E                  	ld	a,(hl)		; value is the offset in the soft voice data (8bytes)
     892.  00:4AE4  23                  	inc	hl
     893.  00:4AE5  32 B3 C1            	ld 	(FM_softvoice_req),a
     894.  00:4AE8  AF                  	xor 	a
     895.  00:4AE9                      
     896.  00:4AE9                      .skip_soft:
     897.  00:4AE9  DD 77 F8            	ld	(ix+TRACK_Voice),a
     898.  00:4AEC                      
     899.  00:4AEC                      	;--- Store the macro start
     900.  00:4AEC  DD 75 F1            	ld	(ix+TRACK_MacroPointer),l
     901.  00:4AEF  DD 74 F2            	ld	(ix+TRACK_MacroPointer+1),h	
     902.  00:4AF2                      	;--- Store the macro re-start
     903.  00:4AF2  DD 75 F3            	ld	(ix+TRACK_MacroStart),l
     904.  00:4AF5  DD 74 F4            	ld	(ix+TRACK_MacroStart+1),h
     905.  00:4AF8                      
     906.  00:4AF8                      .skip_ins:	
     907.  00:4AF8  03                  	inc	bc
     908.  00:4AF9  0A                  	ld	a,(bc)
     909.  00:4AFA  C3 56 4A            	jp	_rdi
     910.  00:4AFD                      
     911.  00:4AFD                      
     912.  00:4AFD                      
     913.  00:4AFD                      _replay_decode_vol:
     914.  00:4AFD  D6 61               	sub	_VOL-1
     915.  00:4AFF  87                  	add	a
     916.  00:4B00  87                  	add	a
     917.  00:4B01  87                  	add	a
     918.  00:4B02  87                  	add	a
     919.  00:4B03                      	
     920.  00:4B03                      	;--- Set new base	volume (high byte) but keep relative offset (low byte)
     921.  00:4B03  5F                  	ld	e,a
     922.  00:4B04  DD 7E F7            	ld	a,(ix+TRACK_Volume)
     923.  00:4B07  E6 0F               	and	0xf
     924.  00:4B09  B3                  	or	e
     925.  00:4B0A  DD 77 F7            	ld	(ix+TRACK_Volume),a
     926.  00:4B0D                      
     927.  00:4B0D  03                  	inc	bc
     928.  00:4B0E  0A                  	ld	a,(bc)
     929.  00:4B0F  C3 5E 4A            	jp	_rdv
     930.  00:4B12                      
     931.  00:4B12                      
     932.  00:4B12                      
     933.  00:4B12                      _replaydecode_cmd:
     934.  00:4B12  D6 90               	sub	_CMD
     935.  00:4B14                      	
     936.  00:4B14                      	;[Debug]
     937.  00:4B14  FE 17               	cp	23
     938.  00:4B16  DA 1B 4B            	jp	c,99f
     939.  00:4B19  F3                  	di
     940.  00:4B1A  76                  	halt
     941.  00:4B1B                      99:
     942.  00:4B1B                      	;[Debug end]
     943.  00:4B1B                      	
     944.  00:4B1B  5F                  	ld	e,a				; store command for later
     945.  00:4B1C  21 2D 4B            	ld	hl,DECODE_CMDLIST
     946.  00:4B1F  87                  	add	a,a
     947.  00:4B20  85                  	add	a,l
     948.  00:4B21  6F                  	ld	l,a
     949.  00:4B22  D2 26 4B            	jp	nc,.skip
     950.  00:4B25  24                  	inc	h
     951.  00:4B26                      .skip:
     952.  00:4B26  7E                  	ld	a,(hl)
     953.  00:4B27  23                  	inc	hl
     954.  00:4B28  66                  	ld	h,(hl)
     955.  00:4B29  6F                  	ld	l,a
     956.  00:4B2A                      	
     957.  00:4B2A  03                  	inc	bc
     958.  00:4B2B  0A                  	ld	a,(bc)
     959.  00:4B2C  E9                  	jp	(hl)
     960.  00:4B2D                      
     961.  00:4B2D                      
     962.  00:4B2D                      DECODE_CMDLIST:
     963.  00:4B2D                      	; Primary
     964.  00:4B2D  84 4B               	dw	decode_cmd3_port_tone
     965.  00:4B2F  15 4C               	dw	decode_cmd5_vibrato_port_tone
     966.  00:4B31  79 4B               	dw	decode_cmd2_port_down
     967.  00:4B33  5B 4B               	dw	decode_cmd0_arpeggio
     968.  00:4B35  E5 4B               	dw	decode_cmd4_vibrato
     969.  00:4B37  6E 4B               	dw	decode_cmd1_port_up
     970.  00:4B39  2C 4C               	dw	decode_cmd6_vibrato_vol	
     971.  00:4B3B  2C 4C               	dw	decode_cmd7_vol_slide
     972.  00:4B3D  E5 4B               	dw	decode_cmd8_tremolo
     973.  00:4B3F  3C 4C               	dw	decode_cmd9_note_cut
     974.  00:4B41  47 4C               	dw	decode_cmd10_note_delay
     975.  00:4B43                      	; Secondary
     976.  00:4B43  65 4C               	dw	decode_cmd11_command_end
     977.  00:4B45  6A 4C               	dw	decode_cmd12_drum
     978.  00:4B47  82 4C               	dw	decode_cmd13_arp_speed
     979.  00:4B49  88 4C               	dw	decode_cmd14_fine_up
     980.  00:4B4B  92 4C               	dw	decode_cmd15_fine_down
     981.  00:4B4D  9D 4C               	dw	decode_cmd16_notelink
     982.  00:4B4F  A4 4C               	dw	decode_cmd17_track_detune
     983.  00:4B51  C3 4C               	dw	decode_cmd18_trigger
     984.  00:4B53  C9 4C               	dw	decode_cmd19_speed
     985.  00:4B55                      	; SoundChip Specific
     986.  00:4B55  DC 4C               	dw	decode_cmd20_tone_panning
     987.  00:4B57  DF 4C               	dw	decode_cmd21_noise_panning
     988.  00:4B59  E2 4C               	dw	decode_cmd22_chan_setup	
     989.  00:4B5B                      	
     990.  00:4B5B                      
     991.  00:4B5B                      decode_cmd0_arpeggio:
     992.  00:4B5B                      	; in:	[A] contains the paramvalue
     993.  00:4B5B                      	; 
     994.  00:4B5B                      	; ! do not change	[BC] this is the data pointer
     995.  00:4B5B                      	;--------------------------------------------------
     996.  00:4B5B  DD 77 06            	ld	(ix+TRACK_cmd_0),a
     997.  00:4B5E  DD 73 F0            	ld	(ix+TRACK_Command),e
     998.  00:4B61  CB DA               	set	B_TRGCMD,d
     999.  00:4B63  DD 36 11 00         	ld	(ix+TRACK_Timer),0
    1000.  00:4B67  DD 36 12 02         	ld	(ix+TRACK_Step),2
    1001.  00:4B6B  C3 66 4A            	jp	_rdc
    1002.  00:4B6E                      
    1003.  00:4B6E                      
    1004.  00:4B6E                      	
    1005.  00:4B6E                      decode_cmd1_port_up:
    1006.  00:4B6E                      	; in:	[A] contains the paramvalue
    1007.  00:4B6E                      	; 
    1008.  00:4B6E                      	; ! do not change	[BC] this is the data pointer
    1009.  00:4B6E                      	;--------------------------------------------------
    1010.  00:4B6E  DD 73 F0            	ld	(ix+TRACK_Command),e
    1011.  00:4B71  DD 77 07            	ld	(ix+TRACK_cmd_1),a
    1012.  00:4B74  CB DA               	set	B_TRGCMD,d
    1013.  00:4B76  C3 66 4A            	jp	_rdc
    1014.  00:4B79                      	
    1015.  00:4B79                      	 
    1016.  00:4B79                      	 
    1017.  00:4B79                      decode_cmd2_port_down:
    1018.  00:4B79                      	; in:	[A] contains the paramvalue
    1019.  00:4B79                      	; 
    1020.  00:4B79                      	; ! do not change	[BC] this is the data pointer
    1021.  00:4B79                      	;--------------------------------------------------
    1022.  00:4B79  DD 73 F0            	ld	(ix+TRACK_Command),e
    1023.  00:4B7C  DD 77 08            	ld	(ix+TRACK_cmd_2),a
    1024.  00:4B7F  CB DA               	set	B_TRGCMD,d
    1025.  00:4B81  C3 66 4A            	jp	_rdc
    1026.  00:4B84                      
    1027.  00:4B84                      
    1028.  00:4B84                      decode_cmd3_port_tone:
    1029.  00:4B84                      	; in:	[A] contains the param value
    1030.  00:4B84                      	; 
    1031.  00:4B84                      	; ! do not change	[BC] this is the data pointer
    1032.  00:4B84                      	;--------------------------------------------------
    1033.  00:4B84  DD 73 F0            	ld	(ix+TRACK_Command),e
    1034.  00:4B87  CB DA               	set	B_TRGCMD,d
    1035.  00:4B89  CB CA               	set	B_ACTNOT,d
    1036.  00:4B8B                      	
    1037.  00:4B8B  DD 77 09            	ld	(ix+TRACK_cmd_3),a
    1038.  00:4B8E  DD 36 11 02         	ld	(ix+TRACK_Timer),2
    1039.  00:4B92                      
    1040.  00:4B92                      ;decode_cmd3_port_tone_cont:
    1041.  00:4B92                      	;--- Check if we have a	note on the	same event
    1042.  00:4B92  CB 42               	bit	B_TRGNOT,d
    1043.  00:4B94  CA 66 4A            	jp	z,_rdc
    1044.  00:4B97                      
    1045.  00:4B97  CB E2               	set	B_KEYON,d
    1046.  00:4B99  CB 82               	res 	B_TRGNOT,d
    1047.  00:4B9B                      	
    1048.  00:4B9B  CD A1 4B            	call	decode_cmd3_port_tone_new_note
    1049.  00:4B9E  C3 66 4A            	jp	_rdc
    1050.  00:4BA1                      	
    1051.  00:4BA1                      decode_cmd3_port_tone_new_note:
    1052.  00:4BA1                      	;-- remove deviation from parameter
    1053.  00:4BA1  E6 7F               	and 	$7f
    1054.  00:4BA3  08                  	ex	af,af'		;'
    1055.  00:4BA4  D9                  	exx
    1056.  00:4BA5                      
    1057.  00:4BA5                      	;-- get the	previous note freq
    1058.  00:4BA5  3A 28 C0            	ld	a,(replay_previous_note)
    1059.  00:4BA8  87                  	add	a
    1060.  00:4BA9  2A 2D C0            	ld	hl,(replay_tonetable)
    1061.  00:4BAC  85                  	add	a,l
    1062.  00:4BAD  6F                  	ld	l,a
    1063.  00:4BAE  D2 B2 4B            	jp	nc,.skip
    1064.  00:4BB1  24                  	inc	h
    1065.  00:4BB2                      .skip:
    1066.  00:4BB2  5E                  	ld	e,(hl)
    1067.  00:4BB3  23                  	inc	hl
    1068.  00:4BB4  56                  	ld	d,(hl)
    1069.  00:4BB5                      
    1070.  00:4BB5                      	; add	the toneadd
    1071.  00:4BB5  DD 6E 00            	ld	l,(ix+TRACK_cmd_ToneSlideAdd)
    1072.  00:4BB8  DD 66 01            	ld	h,(ix+TRACK_cmd_ToneSlideAdd+1)
    1073.  00:4BBB                      
    1074.  00:4BBB  19                  	add	hl,de	
    1075.  00:4BBC  EB                  	ex	de,hl				; store current freq in	[de]
    1076.  00:4BBD                      	;--- get the current note freq
    1077.  00:4BBD  DD 7E F6            	ld	a,(ix+TRACK_Note)
    1078.  00:4BC0  87                  	add	a
    1079.  00:4BC1  2A 2D C0            	ld	hl,(replay_tonetable)	;TRACK_ToneTable
    1080.  00:4BC4  85                  	add	a,l
    1081.  00:4BC5  6F                  	ld	l,a
    1082.  00:4BC6  D2 CA 4B            	jp	nc,.skip2
    1083.  00:4BC9  24                  	inc	h
    1084.  00:4BCA                      .skip2:
    1085.  00:4BCA  7E                  	ld	a,(hl)
    1086.  00:4BCB  23                  	inc	hl
    1087.  00:4BCC  66                  	ld	h,(hl)
    1088.  00:4BCD  6F                  	ld	l,a				; destination freq in [hl]
    1089.  00:4BCE                      	
    1090.  00:4BCE                      	;--- Calculate the delta
    1091.  00:4BCE  AF                  	xor	a
    1092.  00:4BCF  EB                  	ex	de,hl
    1093.  00:4BD0  ED 52               	sbc	hl,de				; results in pos/neg delta
    1094.  00:4BD2                      	
    1095.  00:4BD2  DD 75 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),l
    1096.  00:4BD5  DD 74 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),h
    1097.  00:4BD8                      	
    1098.  00:4BD8                      	;--- re-apply deviation
    1099.  00:4BD8  08                  	ex	af,af'			;'
    1100.  00:4BD9  CB 7C               	bit	7,h
    1101.  00:4BDB  C2 E0 4B            	jp	nz,99f
    1102.  00:4BDE  F6 80               	or 	128
    1103.  00:4BE0                      99:
    1104.  00:4BE0  DD 77 09            	ld 	(ix+TRACK_cmd_3),a
    1105.  00:4BE3                      	
    1106.  00:4BE3  D9                  	exx					; restore flags in D
    1107.  00:4BE4  C9                  	ret
    1108.  00:4BE5                      	
    1109.  00:4BE5                      	
    1110.  00:4BE5                      decode_cmd8_tremolo:
    1111.  00:4BE5                      	; in:	[A] contains the paramvalue
    1112.  00:4BE5                      	; 
    1113.  00:4BE5                      	; ! do not change	[BC] this is the data pointer
    1114.  00:4BE5                      	;--------------------------------------------------
    1115.  00:4BE5                      decode_cmd4_vibrato:
    1116.  00:4BE5                      	; in:	[A] contains the paramvalue
    1117.  00:4BE5                      	; 
    1118.  00:4BE5                      	; ! do not change	[BC] this is the data pointer
    1119.  00:4BE5                      	;--------------------------------------------------
    1120.  00:4BE5                      	; Vibrato with speed x and depth y.	This command 
    1121.  00:4BE5                      	; will oscillate the frequency of the current note
    1122.  00:4BE5                      	; with a sine wave. 
    1123.  00:4BE5                      	;
    1124.  00:4BE5                      	; high 3 bits is depth (0-7) (direct offset in sinetable)
    1125.  00:4BE5                      	; low 5 bits is the speed. 1-16
    1126.  00:4BE5                      	;--- Init values
    1127.  00:4BE5  DD 73 F0            	ld	(ix+TRACK_Command),e
    1128.  00:4BE8  5F                  	ld	e,a
    1129.  00:4BE9                      	
    1130.  00:4BE9                      	;--- Set the speed
    1131.  00:4BE9  E6 0F               	and	$0f
    1132.  00:4BEB  CA F6 4B            	jp	z,.depth
    1133.  00:4BEE  DD 77 0C            	ld	(ix+TRACK_cmd_4_step),a	
    1134.  00:4BF1  ED 44               	neg	
    1135.  00:4BF3  DD 77 12            	ld	(ix+TRACK_Step),a	
    1136.  00:4BF6                      	
    1137.  00:4BF6                      .depth:
    1138.  00:4BF6                      	;-- set the depth
    1139.  00:4BF6  7B                  	ld	a,e
    1140.  00:4BF7  E6 F0               	and	$f0
    1141.  00:4BF9  CA 10 4C            	jp	z,.end		; set depth when 0 only when command was not active.
    1142.  00:4BFC                      
    1143.  00:4BFC                      ;	sub	16
    1144.  00:4BFC  21 C6 55            	ld	hl,TRACK_Vibrato_sine-16
    1145.  00:4BFF  87                  	add	a,a
    1146.  00:4C00  D2 04 4C            	jp	nc,99f
    1147.  00:4C03  24                  	inc	h
    1148.  00:4C04                      99:	
    1149.  00:4C04  85                  	add	a,l
    1150.  00:4C05  6F                  	ld 	l,a
    1151.  00:4C06  D2 0A 4C            	jp	nc,99f
    1152.  00:4C09  24                  	inc	h
    1153.  00:4C0A                      99:
    1154.  00:4C0A  DD 75 0A            	ld	(ix+TRACK_cmd_4_depth),l
    1155.  00:4C0D  DD 74 0B            	ld	(ix+TRACK_cmd_4_depth+1),h
    1156.  00:4C10                      	
    1157.  00:4C10                      .end:	
    1158.  00:4C10  CB DA               	set	B_TRGCMD,d
    1159.  00:4C12  C3 66 4A            	jp	_rdc	
    1160.  00:4C15                      
    1161.  00:4C15                      
    1162.  00:4C15                      decode_cmd5_vibrato_port_tone:
    1163.  00:4C15                      	; in:	[A] contains the paramvalue
    1164.  00:4C15                      	; 
    1165.  00:4C15                      	; ! do not change	[BC] this is the data pointer
    1166.  00:4C15                      	;--------------------------------------------------
    1167.  00:4C15                      	; portTone	+ volumeslide
    1168.  00:4C15                      	;--- Init values
    1169.  00:4C15  DD 73 F0            	ld	(ix+TRACK_Command),e
    1170.  00:4C18  DD 77 0E            	ld	(ix+TRACK_cmd_A),a
    1171.  00:4C1B  CB DA               	set	B_TRGCMD,d
    1172.  00:4C1D                      	
    1173.  00:4C1D                      	;-- Check if new note
    1174.  00:4C1D  CB 42               	bit	B_TRGNOT,d
    1175.  00:4C1F  CA 66 4A            	jp	z,_rdc
    1176.  00:4C22                      	
    1177.  00:4C22                      	;-- Set new port tone value
    1178.  00:4C22  CB E2               	set	B_KEYON,d
    1179.  00:4C24  CB 82               	res	B_TRGNOT,d
    1180.  00:4C26  DD 7E 09            	ld	a,(ix+TRACK_cmd_3)
    1181.  00:4C29  C3 A1 4B            	jp	decode_cmd3_port_tone_new_note
    1182.  00:4C2C                      	
    1183.  00:4C2C                      	
    1184.  00:4C2C                      	
    1185.  00:4C2C                      decode_cmd6_vibrato_vol:
    1186.  00:4C2C                      	; in:	[A] contains the paramvalue
    1187.  00:4C2C                      	; 
    1188.  00:4C2C                      	; ! do not change	[BC] this is the data pointer
    1189.  00:4C2C                      	;--------------------------------------------------
    1190.  00:4C2C                      decode_cmd7_vol_slide:
    1191.  00:4C2C                      	; in:	[A] contains the paramvalue
    1192.  00:4C2C                      	; 
    1193.  00:4C2C                      	; ! do not change	[BC] this is the data pointer
    1194.  00:4C2C                      	;--------------------------------------------------
    1195.  00:4C2C  DD 73 F0            	ld	(ix+TRACK_Command),e	
    1196.  00:4C2F  DD 77 0E            	ld	(ix+TRACK_cmd_A),a
    1197.  00:4C32  E6 7F               	and  	$7f
    1198.  00:4C34  DD 77 11            	ld	(ix+TRACK_Timer),a
    1199.  00:4C37  CB DA               	set	B_TRGCMD,d
    1200.  00:4C39  C3 66 4A            	jp	_rdc
    1201.  00:4C3C                      
    1202.  00:4C3C                      
    1203.  00:4C3C                      decode_cmd9_note_cut:
    1204.  00:4C3C  CB DA               	set	B_TRGCMD,d
    1205.  00:4C3E  DD 73 F0            	ld	(ix+TRACK_Command),e
    1206.  00:4C41  DD 77 11            	ld	(ix+TRACK_Timer),a		; set	the timer to param y
    1207.  00:4C44  C3 66 4A            	jp 	_rdc
    1208.  00:4C47                      
    1209.  00:4C47                      
    1210.  00:4C47                      decode_cmd10_note_delay:
    1211.  00:4C47  CB 42               	bit	B_TRGNOT,d		; is there a note	in this eventstep?
    1212.  00:4C49  CA 66 4A            	jp	z,_rdc
    1213.  00:4C4C                      
    1214.  00:4C4C  CB DA               	set	B_TRGCMD,d					; command active
    1215.  00:4C4E  CB 82               	res	B_TRGNOT,d					; reset any	trigger note
    1216.  00:4C50  DD 73 F0            	ld	(ix+TRACK_Command),e
    1217.  00:4C53                      	
    1218.  00:4C53  DD 77 11            	ld	(ix+TRACK_Timer),a			; set	the timer to param y
    1219.  00:4C56  DD 7E F6            	ld	a,(ix+TRACK_Note)
    1220.  00:4C59  DD 77 10            	ld	(ix+TRACK_cmd_E),a			; store the	new note
    1221.  00:4C5C  3A 28 C0            	ld	a,(replay_previous_note)
    1222.  00:4C5F  DD 77 F6            	ld	(ix+TRACK_Note),a				; restore the old	note
    1223.  00:4C62  C3 66 4A            	jp	_rdc	
    1224.  00:4C65                      
    1225.  00:4C65                      
    1226.  00:4C65                      decode_cmd11_command_end:
    1227.  00:4C65                      	; in:	[A] contains the paramvalue
    1228.  00:4C65                      	; 
    1229.  00:4C65                      	; ! do not change	[BC] this is the data pointer
    1230.  00:4C65                      	;--------------------------------------------------
    1231.  00:4C65  CB 9A               	res	B_TRGCMD,d
    1232.  00:4C67  C3 67 4A            	jp	_rdc_noinc
    1233.  00:4C6A                      	
    1234.  00:4C6A                      
    1235.  00:4C6A                      decode_cmd12_drum:
    1236.  00:4C6A                      ;	and 	a		; drum reset not supported
    1237.  00:4C6A                      ;	jr 	z,0f
    1238.  00:4C6A                      	
    1239.  00:4C6A                      
    1240.  00:4C6A                      	; Get the base addres of the drum list
    1241.  00:4C6A                      	;add 	a 
    1242.  00:4C6A  2A 09 C0            	ld	hl,(replay_drumbase)
    1243.  00:4C6D  85                  	add	a,l 
    1244.  00:4C6E  6F                  	ld	l,a
    1245.  00:4C6F  D2 73 4C            	jp	nc,99f
    1246.  00:4C72  24                  	inc	h 
    1247.  00:4C73                      99:
    1248.  00:4C73  6F                  	ld	l,a
    1249.  00:4C74                      	; Get the start of the drum macro
    1250.  00:4C74  7E                  	ld	a,(hl)
    1251.  00:4C75  23                  	inc	hl
    1252.  00:4C76  66                  	ld	h,(hl)
    1253.  00:4C77  6F                  	ld	l,a
    1254.  00:4C78                      	
    1255.  00:4C78                      	; Store the address
    1256.  00:4C78  22 B1 C1            	ld 	(FM_DRUM_MACRO),hl
    1257.  00:4C7B  7C                  	ld	a,h
    1258.  00:4C7C  32 B0 C1            	ld	(FM_DRUM_ACTIVE),a
    1259.  00:4C7F  C3 66 4A            	jp	_rdc		
    1260.  00:4C82                      		
    1261.  00:4C82                      	
    1262.  00:4C82                      
    1263.  00:4C82                      
    1264.  00:4C82                      decode_cmd13_arp_speed:
    1265.  00:4C82  32 24 C0            	ld	(replay_arp_speed),a		; store the halve not to add
    1266.  00:4C85  C3 66 4A            	jp	_rdc	
    1267.  00:4C88                      	
    1268.  00:4C88                      	
    1269.  00:4C88                      
    1270.  00:4C88                      decode_cmd14_fine_up:
    1271.  00:4C88  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    1272.  00:4C8B  AF                  	xor	a
    1273.  00:4C8C  DD 77 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),a
    1274.  00:4C8F  C3 66 4A            	jp	_rdc
    1275.  00:4C92                      	
    1276.  00:4C92                      decode_cmd15_fine_down:
    1277.  00:4C92  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    1278.  00:4C95  3E FF               	ld	a,$ff
    1279.  00:4C97  DD 77 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),a
    1280.  00:4C9A  C3 66 4A            	jp	_rdc
    1281.  00:4C9D                      
    1282.  00:4C9D                      
    1283.  00:4C9D                      decode_cmd16_notelink:
    1284.  00:4C9D  CB 82               	res	B_TRGNOT,d
    1285.  00:4C9F  CB E2               	set 	B_KEYON,d
    1286.  00:4CA1  C3 67 4A            	jp	_rdc_noinc	
    1287.  00:4CA4                      
    1288.  00:4CA4                      decode_cmd17_track_detune:
    1289.  00:4CA4                      	; This command sets the	detune of the track.
    1290.  00:4CA4  5F                  	ld	e,a
    1291.  00:4CA5  E6 07               	and	0x07		; low	4 bits is value
    1292.  00:4CA7  CB 5B               	bit	3,e		; Center around 8
    1293.  00:4CA9  CA B9 4C            	jp	z,.pos
    1294.  00:4CAC  3C                  	inc	a
    1295.  00:4CAD  ED 44               	neg			; make correct value
    1296.  00:4CAF  DD 77 04            	ld	(ix+TRACK_cmd_detune),a
    1297.  00:4CB2  DD 36 05 FF         	ld	(ix+TRACK_cmd_detune+1),0xff
    1298.  00:4CB6                      
    1299.  00:4CB6  C3 66 4A            	jp	_rdc	
    1300.  00:4CB9                      
    1301.  00:4CB9                      .pos:
    1302.  00:4CB9  DD 77 04            	ld	(ix+TRACK_cmd_detune),a
    1303.  00:4CBC  DD 36 05 00         	ld	(ix+TRACK_cmd_detune+1),0x00	
    1304.  00:4CC0                      
    1305.  00:4CC0  C3 66 4A            	jp	_rdc	
    1306.  00:4CC3                      
    1307.  00:4CC3                      
    1308.  00:4CC3                      
    1309.  00:4CC3                      decode_cmd18_trigger:
    1310.  00:4CC3  32 02 C0            	ld	(replay_trigger),a
    1311.  00:4CC6  C3 66 4A            	jp	_rdc		
    1312.  00:4CC9                      
    1313.  00:4CC9                      
    1314.  00:4CC9                      decode_cmd19_speed:
    1315.  00:4CC9  32 1F C0            	ld	(replay_speed),a
    1316.  00:4CCC                      	;--- Reset Timer == 0
    1317.  00:4CCC  CB 3F               	srl	a				; divide speed with 2
    1318.  00:4CCE  5F                  	ld	e,a
    1319.  00:4CCF  3E 00               	ld	a,0				
    1320.  00:4CD1  8F                  	adc	a				; store carry of shift as subtimer
    1321.  00:4CD2  32 20 C0            	ld	(replay_speed_subtimer),a
    1322.  00:4CD5  83                  	add	a,e
    1323.  00:4CD6  32 21 C0            	ld	(replay_speed_timer),a
    1324.  00:4CD9                      
    1325.  00:4CD9  C3 66 4A            	jp	_rdc	
    1326.  00:4CDC                      	
    1327.  00:4CDC                      decode_cmd20_tone_panning:
    1328.  00:4CDC  C3 66 4A            	jp	_rdc	
    1329.  00:4CDF                      
    1330.  00:4CDF                      decode_cmd21_noise_panning:
    1331.  00:4CDF  C3 66 4A            	jp	_rdc
    1332.  00:4CE2                      
    1333.  00:4CE2                      decode_cmd22_chan_setup:
    1334.  00:4CE2  C3 66 4A            	jp	_rdc
    1335.  00:4CE5                      
    1336.  00:4CE5                      
    1337.  00:4CE5                      
    1338.  00:4CE5                      ;===========================================================
    1339.  00:4CE5                      ; ---process_data_chan
    1340.  00:4CE5                      ; Process the cmd/instrument/note and vol data 
    1341.  00:4CE5                      ; 
    1342.  00:4CE5                      ; in HL is the current tone freq
    1343.  00:4CE5                      ; in D is TRACK_FLAGS  
    1344.  00:4CE5                      ;===========================================================
    1345.  00:4CE5                      process_data_chan:
    1346.  00:4CE5  E5                  	push	hl
    1347.  00:4CE6                      
    1348.  00:4CE6                      	;-- set the	mixer	right
    1349.  00:4CE6  21 B4 C1            	ld	hl,FM_regMIXER   
    1350.  00:4CE9  CB 0E               	rrc	(hl)
    1351.  00:4CEB                      
    1352.  00:4CEB                      
    1353.  00:4CEB                      	;===== 
    1354.  00:4CEB                      	; Speed equalization check
    1355.  00:4CEB                      	;=====
    1356.  00:4CEB                      ;	ld	a,(equalization_flag)			; check for speed equalization
    1357.  00:4CEB                      ;	and	a
    1358.  00:4CEB                      ;	jp	nz,process_noNoteTrigger		; Only process instruments macro
    1359.  00:4CEB                      	
    1360.  00:4CEB                      	
    1361.  00:4CEB                      	;=====
    1362.  00:4CEB                      	; COMMAND
    1363.  00:4CEB                      	;=====
    1364.  00:4CEB  DD 36 0D 00         	ld	(ix+TRACK_cmd_NoteAdd),0			; Always reset note add
    1365.  00:4CEF  CB 5A               	bit	B_TRGCMD,d	;(ix+TRACK_Flags)
    1366.  00:4CF1  CA 06 4D            	jp	z,process_note
    1367.  00:4CF4                      
    1368.  00:4CF4  21 E0 4E            	ld	hl,PROCESS_CMDLIST
    1369.  00:4CF7  DD 7E F0            	ld	a,(ix+TRACK_Command)
    1370.  00:4CFA                      
    1371.  00:4CFA  87                  	add	a
    1372.  00:4CFB  85                  	add	a,l
    1373.  00:4CFC  6F                  	ld	l,a
    1374.  00:4CFD  D2 01 4D            	jp	nc,.skip
    1375.  00:4D00  24                  	inc	h
    1376.  00:4D01                      .skip:
    1377.  00:4D01  7E                  	ld	a,(hl)
    1378.  00:4D02  23                  	inc	hl
    1379.  00:4D03  66                  	ld	h,(hl)
    1380.  00:4D04  6F                  	ld	l,a	
    1381.  00:4D05  E9                  	jp	(hl)
    1382.  00:4D06                      
    1383.  00:4D06                      
    1384.  00:4D06                      process_commandEND:
    1385.  00:4D06                      process_note:
    1386.  00:4D06                      
    1387.  00:4D06                      	;=====
    1388.  00:4D06                      	; NOTE
    1389.  00:4D06                      	;=====
    1390.  00:4D06                      	;--- Check if we need to trigger a new note
    1391.  00:4D06  CB 42               	bit	B_TRGNOT,d	;(ix+TRACK_Flags)
    1392.  00:4D08  CA 34 4D            	jp	z,process_noNoteTrigger
    1393.  00:4D0B                      	
    1394.  00:4D0B                      
    1395.  00:4D0B                      process_triggerNote:	
    1396.  00:4D0B                      	;--- get new Note
    1397.  00:4D0B                      
    1398.  00:4D0B  CB 7A               	bit	B_PSGFM,d		; Only reset note trigger for PSG
    1399.  00:4D0D  C2 12 4D            	jp	nz,99f
    1400.  00:4D10  CB 82               	res	B_TRGNOT,d		;(ix+TRACK_Flags)		; reset trigger note flag
    1401.  00:4D12                      99:
    1402.  00:4D12  CB CA               	set	B_ACTNOT,d		;(ix+TRACK_Flags)		; set	note active	flag
    1403.  00:4D14                      
    1404.  00:4D14                      
    1405.  00:4D14  DD 6E F3            	ld	l,(ix+TRACK_MacroStart)
    1406.  00:4D17  DD 66 F4            	ld	h,(ix+TRACK_MacroStart+1)
    1407.  00:4D1A                      	;--- Store the macro start	
    1408.  00:4D1A  DD 75 F1            	ld	(ix+TRACK_MacroPointer),l
    1409.  00:4D1D  DD 74 F2            	ld	(ix+TRACK_MacroPointer+1),h	
    1410.  00:4D20                      
    1411.  00:4D20  21 00 00            	ld	hl,0
    1412.  00:4D23  ED 73 00 C0         	ld	(_SP_Storage),sp
    1413.  00:4D27  DD F9               	ld	sp,ix
    1414.  00:4D29  F1                  	pop	af
    1415.  00:4D2A  F1                  	pop	af
    1416.  00:4D2B  E5                  	push	hl
    1417.  00:4D2C  E5                  	push	hl		
    1418.  00:4D2D  E5                  	push	hl
    1419.  00:4D2E  E5                  	push	hl
    1420.  00:4D2F  E5                  	push	hl
    1421.  00:4D30  ED 7B 00 C0         	ld	sp,(_SP_Storage)
    1422.  00:4D34                      
    1423.  00:4D34                      ;	ld	(ix+TRACK_ToneAdd),0
    1424.  00:4D34                      ;	ld	(ix+TRACK_ToneAdd+1),0
    1425.  00:4D34                      ;	ld	(ix+TRACK_VolumeAdd),0	
    1426.  00:4D34                      ;	ld	(ix+TRACK_cmd_ToneAdd),0
    1427.  00:4D34                      ;	ld	(ix+TRACK_cmd_ToneAdd+1),0
    1428.  00:4D34                      ;	ld	(ix+TRACK_cmd_VolumeAdd),0
    1429.  00:4D34                      ;	ld	(ix+TRACK_Noise),0
    1430.  00:4D34                      ;	ld	(ix+TRACK_cmd_ToneSlideAdd),0
    1431.  00:4D34                      ;	ld	(ix+TRACK_cmd_ToneSlideAdd+1),0
    1432.  00:4D34                      
    1433.  00:4D34                      process_noNoteTrigger:
    1434.  00:4D34                      	;Get note freq
    1435.  00:4D34                      ;	ld	a,(ix+TRACK_Note)
    1436.  00:4D34                      ;	add	a,(ix+TRACK_cmd_NoteAdd)
    1437.  00:4D34                      ;	add	a
    1438.  00:4D34                      ;	ex	af,af'			;'store the	note offset
    1439.  00:4D34                      
    1440.  00:4D34                      
    1441.  00:4D34                      	;==============
    1442.  00:4D34                      	; Macro instrument
    1443.  00:4D34                      	;==============
    1444.  00:4D34  CB 4A               	bit	B_ACTNOT,d			
    1445.  00:4D36  CA CD 4E            	jp	z,process_noNoteActive
    1446.  00:4D39                      	
    1447.  00:4D39                      	;--- Get the macro len and loop
    1448.  00:4D39  DD 6E F1            	ld	l,(ix+TRACK_MacroPointer)
    1449.  00:4D3C  DD 66 F2            	ld	h,(ix+TRACK_MacroPointer+1)
    1450.  00:4D3F                      
    1451.  00:4D3F  5E                  	ld	e,(hl)				; info byte
    1452.  00:4D40  23                  	inc	hl
    1453.  00:4D41  CB 5B               	bit	3,e					; Volume change
    1454.  00:4D43  C2 4C 4D            	jp	nz,_vol_change
    1455.  00:4D46  DD 7E FD            	ld	a,(ix+TRACK_VolumeAdd)
    1456.  00:4D49  C3 69 4D            	jp	_noVolumeChange
    1457.  00:4D4C                      	
    1458.  00:4D4C                      	;--- Volume change
    1459.  00:4D4C                      _vol_change:
    1460.  00:4D4C  7E                  	ld	a,(hl)
    1461.  00:4D4D  23                  	inc	hl
    1462.  00:4D4E                      	
    1463.  00:4D4E  CB 53               	bit	2,e
    1464.  00:4D50  CA 66 4D            	jp	z,_vol_base
    1465.  00:4D53                      _vol_rel:
    1466.  00:4D53  DD 86 FD            	add	 (ix+TRACK_VolumeAdd)
    1467.  00:4D56  FE 10               	cp	16
    1468.  00:4D58  DA 66 4D            	jp	c,_vol_base
    1469.  00:4D5B  FE 80               	cp	128
    1470.  00:4D5D  D2 65 4D            	jp	nc,.skip
    1471.  00:4D60  3E 0F               	ld	a,$0f
    1472.  00:4D62  C3 66 4D            	jp	_vol_base
    1473.  00:4D65                      .skip:	
    1474.  00:4D65  AF                  	xor	a
    1475.  00:4D66                      	
    1476.  00:4D66                      _vol_base:
    1477.  00:4D66  DD 77 FD            	ld	(ix+TRACK_VolumeAdd),a
    1478.  00:4D69                      
    1479.  00:4D69                      	;---- envelope check
    1480.  00:4D69                      	; is done here to be able to continue
    1481.  00:4D69                      	; macro volume values.
    1482.  00:4D69                      ;	bit	B_TRGENV,d		;'(IX+TRACK_Flags)
    1483.  00:4D69                      ;	jp	z,_noEnv		; if not set then normal volume calculation
    1484.  00:4D69                      ;	ld	a,16			; set volume to 16 == envelope
    1485.  00:4D69                      ;	ld	(FM_regVOLF),a
    1486.  00:4D69                      ;	jp	_noVolume	
    1487.  00:4D69                      	
    1488.  00:4D69                      _noVolumeChange:
    1489.  00:4D69                      	; Apply Tone bit to volume (as SN7 and opll have no mixer)
    1490.  00:4D69                      	; Check only for SMS PSG and FM!
    1491.  00:4D69  CB 6B               	bit	5,e		; do we have tone?
    1492.  00:4D6B  C2 7C 4D            	jp	nz,_tone_on
    1493.  00:4D6E                      
    1494.  00:4D6E  CB 7A               	bit 	B_PSGFM,d
    1495.  00:4D70  C2 77 4D            	jp	nz,99f
    1496.  00:4D73                      ;psg:
    1497.  00:4D73  AF                  	xor	a
    1498.  00:4D74  C3 A0 4D            	jp	_tone_off
    1499.  00:4D77                      99:
    1500.  00:4D77  3E 0F               	ld	a,15
    1501.  00:4D79  C3 A0 4D            	jp	_tone_off
    1502.  00:4D7C                      
    1503.  00:4D7C                      _tone_on:
    1504.  00:4D7C  DD B6 F7            	or	(ix+TRACK_Volume)
    1505.  00:4D7F  4F                  	ld	c,a			; store volume add
    1506.  00:4D80  DD 46 FF            	ld 	b,(ix+TRACK_cmd_VolumeAdd)
    1507.  00:4D83                      ;	ld	b,a
    1508.  00:4D83                      ;	ld	a,c
    1509.  00:4D83  90                  	sub	a,b
    1510.  00:4D84  D2 8A 4D            	jp 	nc,.skip2
    1511.  00:4D87  79                  	ld	a,c
    1512.  00:4D88  E6 0F                	and	0x0f
    1513.  00:4D8A                      .skip2:
    1514.  00:4D8A                      
    1515.  00:4D8A                      _Vadd:
    1516.  00:4D8A                      	;--- apply main volume balance
    1517.  00:4D8A  ED 4B 29 C0         	ld	bc,(replay_mainvol)
    1518.  00:4D8E  81                  	add	a,c
    1519.  00:4D8F  4F                  	ld	c,a
    1520.  00:4D90  D2 94 4D            	jp	nc,.skip
    1521.  00:4D93  04                  	inc	b
    1522.  00:4D94                      .skip:
    1523.  00:4D94  0A                  	ld	a,(bc)	
    1524.  00:4D95                      	; Test which CHIP.
    1525.  00:4D95  CB 7A               	bit	B_PSGFM,d		;(ix+TRACK_Flags)
    1526.  00:4D97  C2 9E 4D            	jp	nz,.skip2
    1527.  00:4D9A  1F                  	rra
    1528.  00:4D9B  1F                  	rra
    1529.  00:4D9C  1F                  	rra
    1530.  00:4D9D  1F                  	rra
    1531.  00:4D9E                      .skip2:
    1532.  00:4D9E  E6 0F               	and	0x0f
    1533.  00:4DA0                      _tone_off:
    1534.  00:4DA0  32 9A C1            	ld	(FM_regVOLF),a
    1535.  00:4DA3                      
    1536.  00:4DA3                      _noVolume:
    1537.  00:4DA3                      	;-------------------------------
    1538.  00:4DA3                      	;
    1539.  00:4DA3                      	; NOISE
    1540.  00:4DA3                      	;
    1541.  00:4DA3                      	;-------------------------------
    1542.  00:4DA3  CB 7B               	bit 	7,e			; test if noise value
    1543.  00:4DA5  CA B2 4D            	jp	z,_noNoise
    1544.  00:4DA8                      
    1545.  00:4DA8                      	;--- prevent FM and noise
    1546.  00:4DA8  7E                  	ld	a,(hl)		; get the value	
    1547.  00:4DA9  23                  	inc	hl	
    1548.  00:4DAA                      	
    1549.  00:4DAA  CB 7A               	bit	B_PSGFM,d		;(ix+TRACK_Flags)
    1550.  00:4DAC  C2 B2 4D            	jp	nz,_noNoise		; Noise and Link not at the same time
    1551.  00:4DAF                      	
    1552.  00:4DAF                      	;--- Set the mixer for noise
    1553.  00:4DAF                      ;	ld	a,(FM_regMIXER)
    1554.  00:4DAF                      ;	or	128
    1555.  00:4DAF                      ;	ld	(FM_regMIXER),a
    1556.  00:4DAF                      
    1557.  00:4DAF                      ;	bit	5,e
    1558.  00:4DAF                      ;	jp	z,_noLink
    1559.  00:4DAF                      ;	ld	a,(hl)	; get the deviation	
    1560.  00:4DAF                      ;	inc	hl
    1561.  00:4DAF                      ;	bit	6,e
    1562.  00:4DAF                      ;	jp	z,.skip
    1563.  00:4DAF                      ;	add	(ix+TRACK_Noise)
    1564.  00:4DAF                      ;.skip:	
    1565.  00:4DAF  32 70 C1            	ld	(PSG_regNOISE),a
    1566.  00:4DB2                      	
    1567.  00:4DB2                      	
    1568.  00:4DB2                      _noNoise:
    1569.  00:4DB2                      	;-------------------------------
    1570.  00:4DB2                      	;
    1571.  00:4DB2                      	; NOISE volume
    1572.  00:4DB2                      	;
    1573.  00:4DB2                      	;-------------------------------
    1574.  00:4DB2  CB 73               	bit 	6,e			; test if noise volume
    1575.  00:4DB4  CA F9 4D            	jp	z,_noNoiseVol
    1576.  00:4DB7                      	
    1577.  00:4DB7                      	;--- prevent FM and noise
    1578.  00:4DB7  7E                  	ld	a,(hl)		; get the volume	
    1579.  00:4DB8  23                  	inc	hl
    1580.  00:4DB9                      	
    1581.  00:4DB9  CB 7A               	bit	B_PSGFM,d		;(ix+TRACK_Flags)
    1582.  00:4DBB  C2 07 4E            	jp	nz,_noLink		; Noise and Link not at the same time
    1583.  00:4DBE                      
    1584.  00:4DBE                      
    1585.  00:4DBE                      
    1586.  00:4DBE                      	;--- calculate end volume
    1587.  00:4DBE  DD B6 F7            	or	(ix+TRACK_Volume)
    1588.  00:4DC1  4F                  	ld	c,a			; store volume add
    1589.  00:4DC2  DD 7E FF            	ld 	a,(ix+TRACK_cmd_VolumeAdd)
    1590.  00:4DC5  47                  	ld	b,a
    1591.  00:4DC6  79                  	ld	a,c
    1592.  00:4DC7  90                  	sub	a,b
    1593.  00:4DC8  D2 CE 4D            	jp 	nc,.skip2
    1594.  00:4DCB  79                  	ld	a,c
    1595.  00:4DCC  E6 0F                	and	0x0f
    1596.  00:4DCE                      .skip2:
    1597.  00:4DCE                      
    1598.  00:4DCE                      _NVadd:
    1599.  00:4DCE                      	;--- apply main volume balance
    1600.  00:4DCE  ED 4B 29 C0         	ld	bc,(replay_mainvol)
    1601.  00:4DD2  81                  	add	a,c
    1602.  00:4DD3  4F                  	ld	c,a
    1603.  00:4DD4  D2 D8 4D            	jp	nc,.skip
    1604.  00:4DD7  04                  	inc	b
    1605.  00:4DD8                      .skip:
    1606.  00:4DD8  0A                  	ld	a,(bc)	
    1607.  00:4DD9  1F                  	rra
    1608.  00:4DDA  1F                  	rra
    1609.  00:4DDB  1F                  	rra
    1610.  00:4DDC  1F                  	rra
    1611.  00:4DDD                      .skip2:
    1612.  00:4DDD  E6 0F               	and	0x0f
    1613.  00:4DDF  32 75 C1            	ld	(PSG_regVOLN),a
    1614.  00:4DE2  C3 07 4E            	jp	_noLink
    1615.  00:4DE5                      
    1616.  00:4DE5  DD B6 F7            	or	(ix+TRACK_Volume)
    1617.  00:4DE8                      	;--- apply main volume balance
    1618.  00:4DE8  ED 4B 29 C0         	ld	bc,(replay_mainvol)
    1619.  00:4DEC  81                  	add	a,c
    1620.  00:4DED  4F                  	ld	c,a
    1621.  00:4DEE  D2 F2 4D            	jp	nc,.skip3
    1622.  00:4DF1  04                  	inc	b
    1623.  00:4DF2                      .skip3:
    1624.  00:4DF2  0A                  	ld	a,(bc)
    1625.  00:4DF3  32 75 C1            	ld	(PSG_regVOLN),a
    1626.  00:4DF6  C3 07 4E            	jp	_noLink
    1627.  00:4DF9                      
    1628.  00:4DF9                      
    1629.  00:4DF9                      _noNoiseVol
    1630.  00:4DF9                      	;-------------------------------
    1631.  00:4DF9                      	;
    1632.  00:4DF9                      	; VoiceLink
    1633.  00:4DF9                      	;
    1634.  00:4DF9                      	;-------------------------------
    1635.  00:4DF9  CB 4B               	bit 	1,e
    1636.  00:4DFB  CA 07 4E            	jp	z,_noLink
    1637.  00:4DFE                      
    1638.  00:4DFE  7E                  	ld	a,(hl)					; get the new hw voice	
    1639.  00:4DFF  23                  	inc	hl
    1640.  00:4E00                      	
    1641.  00:4E00  DD CB F9 F6         	set 	B_TRGVOI,(ix+TRACK_Flags)
    1642.  00:4E04  DD 77 F8            	ld	(ix+TRACK_Voice),a			; set new voice to be loaded
    1643.  00:4E07                      
    1644.  00:4E07                      
    1645.  00:4E07                      
    1646.  00:4E07                      _noLink
    1647.  00:4E07                      	;-------------------------------
    1648.  00:4E07                      	;
    1649.  00:4E07                      	; TONE 
    1650.  00:4E07                      	;
    1651.  00:4E07                      	;-------------------------------
    1652.  00:4E07  DD 46 FB            	ld	b,(ix+TRACK_ToneAdd)	; get	the current	deviation	
    1653.  00:4E0A  DD 4E FC            	ld	c,(ix+TRACK_ToneAdd+1)
    1654.  00:4E0D                      
    1655.  00:4E0D  CB 63               	bit 	4,e
    1656.  00:4E0F  CA 24 4E            	jp	z,process_noToneAdd
    1657.  00:4E12                      	
    1658.  00:4E12  7E                  	ld	a,(hl)
    1659.  00:4E13  23                  	inc	hl
    1660.  00:4E14  81                  	add	c
    1661.  00:4E15  4F                  	ld	c,a
    1662.  00:4E16  DD 71 FC            	ld	(ix+TRACK_ToneAdd+1),c
    1663.  00:4E19  D2 1D 4E            	jp	nc,.skip
    1664.  00:4E1C  04                  	inc	b
    1665.  00:4E1D                      .skip:
    1666.  00:4E1D  7E                  	ld	a,(hl)
    1667.  00:4E1E  23                  	inc	hl
    1668.  00:4E1F  80                  	add	b
    1669.  00:4E20  47                  	ld	b,a
    1670.  00:4E21  DD 70 FB            	ld	(ix+TRACK_ToneAdd),b
    1671.  00:4E24                      	
    1672.  00:4E24                      	
    1673.  00:4E24                      process_noToneAdd:	
    1674.  00:4E24                      	;---- check for macro end
    1675.  00:4E24  CB 43               	bit	0,e		
    1676.  00:4E26  CA 2D 4E            	jp	z,.noend
    1677.  00:4E29                      	
    1678.  00:4E29  7E                  	ld	a,(hl)
    1679.  00:4E2A  23                  	inc	hl
    1680.  00:4E2B  66                  	ld	h,(hl)
    1681.  00:4E2C  6F                  	ld	l,a
    1682.  00:4E2D                      
    1683.  00:4E2D                      .noend:
    1684.  00:4E2D                      	;--- Set the mixer bit (T)
    1685.  00:4E2D  CB 6B               	bit	5,e		; do we have tone?
    1686.  00:4E2F  CA 3A 4E            	jp	z,process_noToneBit
    1687.  00:4E32                      
    1688.  00:4E32                      	;-- enable tone output
    1689.  00:4E32  3A B4 C1            	ld	a,(FM_regMIXER)
    1690.  00:4E35  F6 10               	or	16
    1691.  00:4E37  32 B4 C1            	ld	(FM_regMIXER),a
    1692.  00:4E3A                      	
    1693.  00:4E3A                      process_noToneBit:	
    1694.  00:4E3A  DD 75 F1            	ld	(ix+TRACK_MacroPointer),l	;--- store pointer for next time
    1695.  00:4E3D  DD 74 F2            	ld	(ix+TRACK_MacroPointer+1),h	
    1696.  00:4E40                      
    1697.  00:4E40                      	;-- Get current note
    1698.  00:4E40  DD 7E F6            	ld	a,(ix+TRACK_Note)
    1699.  00:4E43  DD 86 0D            	add	a,(ix+TRACK_cmd_NoteAdd)
    1700.  00:4E46  87                  	add	a
    1701.  00:4E47                      
    1702.  00:4E47  2A 2D C0            	ld	hl,(replay_tonetable)
    1703.  00:4E4A  85                  	add	a,l
    1704.  00:4E4B  6F                  	ld	l,a
    1705.  00:4E4C  D2 50 4E            	jp	nc,.skip
    1706.  00:4E4F  24                  	inc	h
    1707.  00:4E50                      .skip:
    1708.  00:4E50  7E                  	ld	a,(hl)	;--- Store the note tone value in hl
    1709.  00:4E51  23                  	inc	hl
    1710.  00:4E52  66                  	ld	h,(hl)
    1711.  00:4E53  6F                  	ld	l,a
    1712.  00:4E54                      		
    1713.  00:4E54  09                  	add	hl,bc		;--- Store tone deviation		
    1714.  00:4E55                      
    1715.  00:4E55  7A                  	ld	a,d
    1716.  00:4E56  DD 72 F9            	ld	(ix+TRACK_Flags),d
    1717.  00:4E59                      	; set	the detune.
    1718.  00:4E59  ED 73 00 C0         	ld	(_SP_Storage),sp
    1719.  00:4E5D  DD F9               	ld	sp,ix
    1720.  00:4E5F  D1                  	pop	de		; cmd detune
    1721.  00:4E60  19                  	add	hl,de
    1722.  00:4E61  C1                  	pop	bc		; cmd toneadd
    1723.  00:4E62  09                  	add	hl,bc
    1724.  00:4E63  C1                  	pop	bc		; cmd tone slide add
    1725.  00:4E64  09                  	add	hl,bc
    1726.  00:4E65  ED 7B 00 C0         	ld	sp,(_SP_Storage)
    1727.  00:4E69                      
    1728.  00:4E69                      	;-----------------
    1729.  00:4E69                      	; FM Octave wrapper
    1730.  00:4E69                      	; enable slides over multiple octaves.
    1731.  00:4E69                      	; [DE] still contains tone slide add.
    1732.  00:4E69                      	;-----------------
    1733.  00:4E69  CB 7F               	bit	B_PSGFM,a			;(ix+TRACK_Flags)
    1734.  00:4E6B  CA BD 4E            	jp	z,_wrap_skip		; skip wrapper for PSG
    1735.  00:4E6E                      
    1736.  00:4E6E  CB 44               	bit	0,h
    1737.  00:4E70  CA 9A 4E            	jp	z,_wrap_lowcheck
    1738.  00:4E73                      _wrap_highcheck:
    1739.  00:4E73  7D                  	ld	a,l
    1740.  00:4E74  FE 5A               	cp	$5a				; $5a is the strict limit
    1741.  00:4E76  DA BD 4E            	jp	c,_wrap_skip		; stop if smaller	
    1742.  00:4E79                      	
    1743.  00:4E79  E5                  	push	hl
    1744.  00:4E7A  D5                  	push	de
    1745.  00:4E7B                      	
    1746.  00:4E7B                      	;--- Set new tone value for same note 1 octave lower
    1747.  00:4E7B  CB 3F               	srl	a
    1748.  00:4E7D  CB 44               	bit 	0,h		; test 9th bit
    1749.  00:4E7F  CA 84 4E            	jp	z,99f
    1750.  00:4E82  C6 80               	add	128
    1751.  00:4E84                      99:
    1752.  00:4E84  5F                  	ld	e,a
    1753.  00:4E85                      ;	ld	d,0
    1754.  00:4E85                      	;--- set octave higher
    1755.  00:4E85  7C                  	ld	a,h
    1756.  00:4E86  E6 FE               	and	$fe
    1757.  00:4E88  C6 02               	add	$02
    1758.  00:4E8A                      ;	add	d		; merge with tone value
    1759.  00:4E8A  57                  	ld	d,a
    1760.  00:4E8B                      	;--- get difference between now and new
    1761.  00:4E8B  EB                  	ex	de,hl
    1762.  00:4E8C  AF                  	xor	a		; reset carry flag
    1763.  00:4E8D  ED 52               	sbc	hl,de
    1764.  00:4E8F                      	;--- add difference to current slide
    1765.  00:4E8F  D1                  	pop	de		; restore slide
    1766.  00:4E90  19                  	add	hl,de
    1767.  00:4E91  DD 75 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),l
    1768.  00:4E94  DD 74 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),h	
    1769.  00:4E97  E1                  	pop	hl	
    1770.  00:4E98  18 23               	jr.	_wrap_skip
    1771.  00:4E9A                      	
    1772.  00:4E9A                      _wrap_lowcheck:
    1773.  00:4E9A  7D                  	ld	a,l
    1774.  00:4E9B  FE 3B               	cp	$3b		; $ad is the strict limit
    1775.  00:4E9D  30 1E               	jr.	nc,_wrap_skip		; stop if smaller
    1776.  00:4E9F                      
    1777.  00:4E9F                      
    1778.  00:4E9F  E5                  	push 	hl		; store freq
    1779.  00:4EA0  D5                  	push	de		; store slide
    1780.  00:4EA1                      	;--- set new tone value for same note (but octave lower)
    1781.  00:4EA1  87                  	add	a,a		; multiply by 2 in de 
    1782.  00:4EA2  5F                  	ld	e,a
    1783.  00:4EA3  16 00               	ld	d,0
    1784.  00:4EA5  D2 A9 4E            	jp	nc,99f
    1785.  00:4EA8  14                  	inc	d	
    1786.  00:4EA9                      99:
    1787.  00:4EA9                      	;--- set octave higher
    1788.  00:4EA9  7C                  	ld	a,h
    1789.  00:4EAA  E6 FE               	and	$fe
    1790.  00:4EAC  D6 02               	sub	$02
    1791.  00:4EAE  82                  	add	d		; merge with tone value
    1792.  00:4EAF  57                  	ld	d,a
    1793.  00:4EB0                      	;--- get difference between now and new
    1794.  00:4EB0  EB                  	ex	de,hl
    1795.  00:4EB1  AF                  	xor	a		; reset carry flag
    1796.  00:4EB2  ED 52               	sbc	hl,de
    1797.  00:4EB4                      	;--- add difference to current slide
    1798.  00:4EB4  D1                  	pop	de		; restore slide
    1799.  00:4EB5  19                  	add	hl,de	
    1800.  00:4EB6                      	
    1801.  00:4EB6  DD 75 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),l
    1802.  00:4EB9  DD 74 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),h	
    1803.  00:4EBC  E1                  	pop	hl	
    1804.  00:4EBD                      	
    1805.  00:4EBD                      _wrap_skip:
    1806.  00:4EBD                      	; replace the last pushed value on stack
    1807.  00:4EBD  D1                  	pop	de
    1808.  00:4EBE  EB                  	ex	de,hl
    1809.  00:4EBF  73                  	ld	(hl),e
    1810.  00:4EC0  23                  	inc	hl
    1811.  00:4EC1  7A                  	ld	a,d	; reset key on and sustain
    1812.  00:4EC2  E6 0F               	and	$0f
    1813.  00:4EC4  57                  	ld	d,a
    1814.  00:4EC5  DD 7E F9            	ld	a,(ix+TRACK_Flags)	; Add the sustain and key bits.
    1815.  00:4EC8  E6 30               	and	16+32	
    1816.  00:4ECA  B2                  	or	d
    1817.  00:4ECB  77                  	ld	(hl),a
    1818.  00:4ECC  C9                  	ret
    1819.  00:4ECD                      
    1820.  00:4ECD                      	
    1821.  00:4ECD                      process_noNoteActive:
    1822.  00:4ECD  E1                  	pop	hl
    1823.  00:4ECE                      	
    1824.  00:4ECE                      	;-- for FM add key and sustain bits to tone
    1825.  00:4ECE  23                  	inc	hl
    1826.  00:4ECF  7A                  	ld	a,d
    1827.  00:4ED0  E6 30               	and	16+32	; keep key and sustain flags
    1828.  00:4ED2  47                  	ld	b,a
    1829.  00:4ED3  7E                  	ld	a,(hl)
    1830.  00:4ED4  E6 0F               	and 	$0f
    1831.  00:4ED6  B0                  	or 	b
    1832.  00:4ED7  77                  	ld	(hl),a
    1833.  00:4ED8                      	
    1834.  00:4ED8                      	;-- Silence
    1835.  00:4ED8  AF                  	xor	a
    1836.  00:4ED9  32 9A C1            	ld	(FM_regVOLF),a
    1837.  00:4EDC  DD 72 F9            	ld	(ix+TRACK_Flags),d
    1838.  00:4EDF  C9                  	ret	
    1839.  00:4EE0                      
    1840.  00:4EE0                      PROCESS_CMDLIST:
    1841.  00:4EE0                      	; This list only contains the primary commands.
    1842.  00:4EE0  8F 4F               	dw	process_cmd3_port_tone
    1843.  00:4EE2  35 50               	dw	process_cmd5_vibrato_port_tone
    1844.  00:4EE4  7B 4F               	dw	process_cmd2_port_down		
    1845.  00:4EE6  F6 4E               	dw	process_cmd0_arpeggio			
    1846.  00:4EE8  F6 4F               	dw	process_cmd4_vibrato		
    1847.  00:4EEA  67 4F               	dw	process_cmd1_port_up	
    1848.  00:4EEC  3B 50               	dw	process_cmd6_vibrato_vol		
    1849.  00:4EEE  41 50               	dw	process_cmd7_vol_slide
    1850.  00:4EF0  D0 4F               	dw	process_cmd8_tremolo
    1851.  00:4EF2  6D 50               	dw	process_cmd9_note_cut		
    1852.  00:4EF4  7A 50               	dw	process_cmd10_note_delay		
    1853.  00:4EF6                      
    1854.  00:4EF6                      			
    1855.  00:4EF6                      process_cmd0_arpeggio:
    1856.  00:4EF6  DD 7E 11            	ld	a,(ix+TRACK_Timer)
    1857.  00:4EF9  A7                  	and	a
    1858.  00:4EFA  CA 1A 4F            	jp	z,.nextNote
    1859.  00:4EFD                      	
    1860.  00:4EFD  3D                  	dec	a
    1861.  00:4EFE  DD 77 11            	ld	(IX+TRACK_Timer),a
    1862.  00:4F01  DD 7E 12            	ld	a,(ix+TRACK_Step)
    1863.  00:4F04  A7                  	and	a
    1864.  00:4F05  CA 13 4F            	jp	z,99f
    1865.  00:4F08  DD 7E 06            	ld	a,(IX+TRACK_cmd_0)
    1866.  00:4F0B  E6 0F               	and	$0f
    1867.  00:4F0D  DD 77 0D            	ld	(ix+TRACK_cmd_NoteAdd),a	
    1868.  00:4F10  C3 06 4D            	jr.	process_commandEND
    1869.  00:4F13                      99:
    1870.  00:4F13  DD 36 0D 00         	ld	(ix+TRACK_cmd_NoteAdd),0	
    1871.  00:4F17  C3 06 4D            	jr.	process_commandEND
    1872.  00:4F1A                      	
    1873.  00:4F1A                      
    1874.  00:4F1A                      .nextNote:
    1875.  00:4F1A                      	; re-init the speed.
    1876.  00:4F1A  3A 24 C0            	ld	a,(replay_arp_speed)
    1877.  00:4F1D  DD 77 11            	ld	(IX+TRACK_Timer),a
    1878.  00:4F20                      	
    1879.  00:4F20  DD 7E 12            	ld	a,(ix+TRACK_Step)
    1880.  00:4F23  A7                  	and	a
    1881.  00:4F24  20 16               	jr.	nz,99f
    1882.  00:4F26                      
    1883.  00:4F26                      	;--- set x
    1884.  00:4F26  DD 36 12 01         		ld	(ix+TRACK_Step),1
    1885.  00:4F2A  DD 7E 06            		ld	a,(ix+TRACK_cmd_0)
    1886.  00:4F2D  07                  		rlca
    1887.  00:4F2E  07                  		rlca
    1888.  00:4F2F  07                  		rlca
    1889.  00:4F30  07                  		rlca		
    1890.  00:4F31  DD 77 06            		ld	(ix+TRACK_cmd_0),a	
    1891.  00:4F34  E6 0F               		and	$0f
    1892.  00:4F36  DD 77 0D            		ld	(ix+TRACK_cmd_NoteAdd),a
    1893.  00:4F39  C3 06 4D            		jr.	process_commandEND
    1894.  00:4F3C                      	
    1895.  00:4F3C                      99:
    1896.  00:4F3C  3D                  	dec	a
    1897.  00:4F3D  20 1D               	jr.	nz,99f
    1898.  00:4F3F                      
    1899.  00:4F3F                      	;--- set y
    1900.  00:4F3F  DD 36 12 02         		ld	(ix+TRACK_Step),2
    1901.  00:4F43  DD 7E 06            		ld	a,(ix+TRACK_cmd_0)
    1902.  00:4F46  07                  		rlca
    1903.  00:4F47  07                  		rlca
    1904.  00:4F48  07                  		rlca
    1905.  00:4F49  07                  		rlca		
    1906.  00:4F4A  DD 77 06            		ld	(ix+TRACK_cmd_0),a			
    1907.  00:4F4D  E6 0F               		and	0x0f
    1908.  00:4F4F  C2 56 4F            		jp	nz,0f
    1909.  00:4F52                      		;--- if zero then skip this note and set step to start
    1910.  00:4F52  DD 36 12 00         		ld	(ix+TRACK_Step),0
    1911.  00:4F56                      0:		
    1912.  00:4F56  DD 77 0D            		ld	(ix+TRACK_cmd_NoteAdd),a	
    1913.  00:4F59  C3 06 4D            		jr.	process_commandEND
    1914.  00:4F5C                      	
    1915.  00:4F5C                      99:
    1916.  00:4F5C                      	;--- set none
    1917.  00:4F5C  DD 36 12 00         	ld	(ix+TRACK_Step),0
    1918.  00:4F60  DD 36 0D 00         	ld	(ix+TRACK_cmd_NoteAdd),0		
    1919.  00:4F64  C3 06 4D            	jr.	process_commandEND
    1920.  00:4F67                      		
    1921.  00:4F67                      
    1922.  00:4F67                      	
    1923.  00:4F67                      
    1924.  00:4F67                      	
    1925.  00:4F67                      process_cmd1_port_up:
    1926.  00:4F67  DD 7E 07            	ld	a,(ix+TRACK_cmd_1)	
    1927.  00:4F6A                      
    1928.  00:4F6A  47                  	ld	b,a
    1929.  00:4F6B  DD 7E 00            	ld	a,(ix+TRACK_cmd_ToneSlideAdd)
    1930.  00:4F6E  90                  	sub	b
    1931.  00:4F6F  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    1932.  00:4F72  D2 06 4D            	jp	nc,process_commandEND
    1933.  00:4F75  DD 34 01            	inc	(ix+TRACK_cmd_ToneSlideAdd+1)
    1934.  00:4F78  C3 06 4D            	jp	process_commandEND
    1935.  00:4F7B                      
    1936.  00:4F7B                      	
    1937.  00:4F7B                      process_cmd2_port_down:	
    1938.  00:4F7B  DD 7E 08            	ld	a,(ix+TRACK_cmd_2)
    1939.  00:4F7E  47                  	ld	b,a
    1940.  00:4F7F  DD 7E 00            	ld	a,(ix+TRACK_cmd_ToneSlideAdd)
    1941.  00:4F82  80                  	add	b
    1942.  00:4F83  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    1943.  00:4F86  D2 06 4D            	jp	nc,process_commandEND
    1944.  00:4F89  DD 35 01            	dec	(ix+TRACK_cmd_ToneSlideAdd+1)
    1945.  00:4F8C  C3 06 4D            	jp	process_commandEND
    1946.  00:4F8F                      	
    1947.  00:4F8F                      
    1948.  00:4F8F                      process_cmd3_port_tone:
    1949.  00:4F8F  DD 7E 09            	ld	a,(ix+TRACK_cmd_3)
    1950.  00:4F92  DD 6E 00            	ld	l,(ix+TRACK_cmd_ToneSlideAdd)
    1951.  00:4F95  DD 66 01            	ld	h,(ix+TRACK_cmd_ToneSlideAdd+1)
    1952.  00:4F98  CB 7C               	bit	7,h
    1953.  00:4F9A  CA B0 4F            	jp	z,process_cmd3_sub
    1954.  00:4F9D                      process_cmd3_add:
    1955.  00:4F9D                      	;pos slide
    1956.  00:4F9D  85                  	add	a,l
    1957.  00:4F9E  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    1958.  00:4FA1  D2 A5 4F            	jp	nc,.skip
    1959.  00:4FA4  24                  	inc	h					
    1960.  00:4FA5                      .skip:
    1961.  00:4FA5  CB 7C               	bit	7,h
    1962.  00:4FA7  CA C5 4F            	jp	z,process_cmd3_stop			; delta turned pos ?
    1963.  00:4FAA  DD 74 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),h
    1964.  00:4FAD  C3 06 4D            	jp	process_commandEND
    1965.  00:4FB0                      process_cmd3_sub:
    1966.  00:4FB0                      	;negative slide	
    1967.  00:4FB0  E6 7F               	and	$7f
    1968.  00:4FB2  4F                  	ld	c,a
    1969.  00:4FB3  AF                  	xor	a
    1970.  00:4FB4  47                  	ld	b,a
    1971.  00:4FB5  ED 42               	sbc	hl,bc
    1972.  00:4FB7  CB 7C               	bit	7,h
    1973.  00:4FB9  C2 C5 4F            	jp	nz,process_cmd3_stop			; delta turned neg ?
    1974.  00:4FBC  DD 75 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),l
    1975.  00:4FBF  DD 74 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),h
    1976.  00:4FC2  C3 06 4D            	jp	process_commandEND
    1977.  00:4FC5                      process_cmd3_stop:	
    1978.  00:4FC5                      ;	res	B_TRGCMD,d		;(ix+TRACK_Flags)
    1979.  00:4FC5  DD 36 00 00         	ld	(ix+TRACK_cmd_ToneSlideAdd),0
    1980.  00:4FC9  DD 36 01 00         	ld	(ix+TRACK_cmd_ToneSlideAdd+1),0	
    1981.  00:4FCD  C3 06 4D            	jp	process_commandEND
    1982.  00:4FD0                      
    1983.  00:4FD0                      
    1984.  00:4FD0                      process_cmd8_tremolo:
    1985.  00:4FD0                      	;=================================
    1986.  00:4FD0                      	;
    1987.  00:4FD0                      	; tremolo	
    1988.  00:4FD0                      	;
    1989.  00:4FD0                      	;=================================	
    1990.  00:4FD0  DD 6E 0A            	ld	l,(ix+TRACK_cmd_4_depth)
    1991.  00:4FD3  DD 66 0B            	ld	h,(ix+TRACK_cmd_4_depth+1)
    1992.  00:4FD6                      
    1993.  00:4FD6                      	;--- Get next step
    1994.  00:4FD6  DD 7E 12            	ld	a,(IX+TRACK_Step)
    1995.  00:4FD9  DD 86 0C            	add	(ix+TRACK_cmd_4_step)
    1996.  00:4FDC  E6 1F               	and	$1F			; max	32
    1997.  00:4FDE  DD 77 12            	ld	(ix+TRACK_Step),a
    1998.  00:4FE1                      
    1999.  00:4FE1  85                  	add	a,l
    2000.  00:4FE2  6F                  	ld	l,a
    2001.  00:4FE3  D2 E7 4F            	jp	nc,99f
    2002.  00:4FE6  24                  	inc	h
    2003.  00:4FE7                      99:
    2004.  00:4FE7  7E                  	ld	a,(hl)
    2005.  00:4FE8  CB 27               	sla	a
    2006.  00:4FEA  CB 27               	sla	a	
    2007.  00:4FEC  CB 27               	sla	a	
    2008.  00:4FEE  CB 27               	sla	a
    2009.  00:4FF0  DD 77 FF            	ld	(ix+TRACK_cmd_VolumeAdd),a
    2010.  00:4FF3  C3 06 4D            	jp	process_commandEND	
    2011.  00:4FF6                      
    2012.  00:4FF6                      
    2013.  00:4FF6                      	;=================================
    2014.  00:4FF6                      	;
    2015.  00:4FF6                      	; Vibrato	
    2016.  00:4FF6                      	;
    2017.  00:4FF6                      	;=================================
    2018.  00:4FF6                      process_cmd4_vibrato:
    2019.  00:4FF6  DD 6E 0A            	ld	l,(ix+TRACK_cmd_4_depth)
    2020.  00:4FF9  DD 66 0B            	ld	h,(ix+TRACK_cmd_4_depth+1)
    2021.  00:4FFC                      
    2022.  00:4FFC                      	;--- Get next step
    2023.  00:4FFC  DD 7E 12            	ld	a,(IX+TRACK_Step)
    2024.  00:4FFF  DD 86 0C            	add	(ix+TRACK_cmd_4_step)
    2025.  00:5002  E6 3F               	and	$3F			; max	64
    2026.  00:5004  DD 77 12            	ld	(ix+TRACK_Step),a
    2027.  00:5007                      	
    2028.  00:5007  CB 6F               	bit	5,a			; step 32-63 the neg	
    2029.  00:5009  CA 24 50            	jp	z,.pos	
    2030.  00:500C                      	
    2031.  00:500C                      .neg:
    2032.  00:500C  E6 1F               	and	$1f	; make it 32 steps again
    2033.  00:500E  85                  	add	a,l
    2034.  00:500F  6F                  	ld	l,a
    2035.  00:5010  D2 14 50            	jp	nc,99f
    2036.  00:5013  24                  	inc	h
    2037.  00:5014                      99:
    2038.  00:5014  7E                  	ld	a,(hl)
    2039.  00:5015  ED 44               	neg
    2040.  00:5017  CA 2B 50            	jp	z,.zero			; $ff00 gives strange result ;)	
    2041.  00:501A  DD 77 02            	ld	(ix+TRACK_cmd_ToneAdd),a
    2042.  00:501D  DD 36 03 FF         	ld	(ix+TRACK_cmd_ToneAdd+1),0xff
    2043.  00:5021  C3 06 4D            	jp	process_commandEND	
    2044.  00:5024                      
    2045.  00:5024                      .pos:
    2046.  00:5024  85                  	add	a,l
    2047.  00:5025  6F                  	ld	l,a
    2048.  00:5026  D2 2A 50            	jp	nc,99f
    2049.  00:5029  24                  	inc	h
    2050.  00:502A                      99:
    2051.  00:502A  7E                  	ld	a,(hl)
    2052.  00:502B                      .zero:	
    2053.  00:502B  DD 77 02            	ld	(ix+TRACK_cmd_ToneAdd),a
    2054.  00:502E  DD 36 03 00         	ld	(ix+TRACK_cmd_ToneAdd+1),0
    2055.  00:5032  C3 06 4D            	jp	process_commandEND	
    2056.  00:5035                      
    2057.  00:5035                      
    2058.  00:5035                      ;	ld	hl,(replay_vib_table)
    2059.  00:5035                      ;	;--- Get next step
    2060.  00:5035                      ;	ld	a,(IX+TRACK_Step)
    2061.  00:5035                      ;	add	(ix+TRACK_cmd_4_step)
    2062.  00:5035                      ;	and	$3F			; max	64
    2063.  00:5035                      ;	ld	(ix+TRACK_Step),a
    2064.  00:5035                      ;	
    2065.  00:5035                      ;	bit	5,a			; step 32-63 the neg	
    2066.  00:5035                      ;	jp	z,process_cmd4pos
    2067.  00:5035                      ;
    2068.  00:5035                      ;; neg	
    2069.  00:5035                      ;	and	$1f
    2070.  00:5035                      ;	add	a,l
    2071.  00:5035                      ;	ld	l,a
    2072.  00:5035                      ;	jp	nc,.skip
    2073.  00:5035                      ;	inc	h
    2074.  00:5035                      ;.skip:
    2075.  00:5035                      ;	ld	a,(hl)
    2076.  00:5035                      ;	;apply depth
    2077.  00:5035                      ;	ld	b,(ix+TRACK_cmd_4_depth)
    2078.  00:5035                      ;.loop:
    2079.  00:5035                      ;	srl	a
    2080.  00:5035                      ;	djnz	.loop
    2081.  00:5035                      ;;	and	$0f
    2082.  00:5035                      ;
    2083.  00:5035                      ;	neg
    2084.  00:5035                      ;	jp	z,process_cmd4_zero			; $ff00 gives strange result ;)	
    2085.  00:5035                      ;	ld	(ix+TRACK_cmd_ToneAdd),a
    2086.  00:5035                      ;	ld	(ix+TRACK_cmd_ToneAdd+1),0xff
    2087.  00:5035                      ;	jp	process_commandEND
    2088.  00:5035                      ;
    2089.  00:5035                      ;process_cmd4pos:	
    2090.  00:5035                      ;;	and	$1f
    2091.  00:5035                      ;	add	a,l
    2092.  00:5035                      ;	ld	l,a
    2093.  00:5035                      ;	jp	nc,.skip
    2094.  00:5035                      ;	inc	h
    2095.  00:5035                      ;.skip:
    2096.  00:5035                      ;	ld	a,(hl)
    2097.  00:5035                      ;	;apply depth
    2098.  00:5035                      ;	ld	b,(ix+TRACK_cmd_4_depth)
    2099.  00:5035                      ;.loop:
    2100.  00:5035                      ;	srl	a
    2101.  00:5035                      ;	djnz	.loop
    2102.  00:5035                      ;process_cmd4_zero:
    2103.  00:5035                      ;	ld	(ix+TRACK_cmd_ToneAdd),a
    2104.  00:5035                      ;	ld	(ix+TRACK_cmd_ToneAdd+1),0
    2105.  00:5035                      ;	jp	process_commandEND
    2106.  00:5035                      		
    2107.  00:5035                      	
    2108.  00:5035                      
    2109.  00:5035                      process_cmd5_vibrato_port_tone:
    2110.  00:5035  CD 47 50            	call	process_cmdasub
    2111.  00:5038  C3 8F 4F            	jp	process_cmd3_port_tone
    2112.  00:503B                      	
    2113.  00:503B                      process_cmd6_vibrato_vol:
    2114.  00:503B  CD 47 50            	call	process_cmdasub
    2115.  00:503E  C3 F6 4F            	jp	process_cmd4_vibrato	
    2116.  00:5041                      
    2117.  00:5041                      process_cmd7_vol_slide:
    2118.  00:5041  CD 47 50            	call	process_cmdasub
    2119.  00:5044  C3 06 4D            	jp	process_commandEND
    2120.  00:5047                      
    2121.  00:5047                      
    2122.  00:5047                      process_cmdasub:
    2123.  00:5047  DD 35 11            	dec	(ix+TRACK_Timer)
    2124.  00:504A  C0                  	ret	nz
    2125.  00:504B                      		
    2126.  00:504B                      	; vol	slide
    2127.  00:504B  DD 7E 0E            	ld	a,(ix+TRACK_cmd_A)
    2128.  00:504E  4F                  	ld	c,a
    2129.  00:504F  E6 7F               	and	$7f
    2130.  00:5051  DD 77 11            	ld	(ix+TRACK_Timer),a
    2131.  00:5054                      
    2132.  00:5054  DD 7E F7            	ld	a,(ix+TRACK_Volume)
    2133.  00:5057  CB 79               	bit	7,c
    2134.  00:5059  CA 64 50            	jp	z,process_cmda_inc
    2135.  00:505C                      process_cmda_dec:
    2136.  00:505C  A7                  	and	a
    2137.  00:505D  C8                  	ret	z
    2138.  00:505E  D6 10               	sub	$10
    2139.  00:5060  DD 77 F7            	ld	(ix+TRACK_Volume),a
    2140.  00:5063  C9                  	ret
    2141.  00:5064                      	
    2142.  00:5064                      process_cmda_inc:
    2143.  00:5064  FE F0               	cp	$f0
    2144.  00:5066  D0                  	ret	nc
    2145.  00:5067  C6 10               	add	$10	
    2146.  00:5069  DD 77 F7            	ld	(ix+TRACK_Volume),a
    2147.  00:506C  C9                  	ret
    2148.  00:506D                      
    2149.  00:506D                      
    2150.  00:506D                      
    2151.  00:506D                      process_cmd9_note_cut:
    2152.  00:506D  DD 35 11            	dec	(ix+TRACK_Timer)
    2153.  00:5070  C2 06 4D            	jp	nz,process_commandEND
    2154.  00:5073                      	
    2155.  00:5073                      	; stop note
    2156.  00:5073  CB 9A               	res	B_TRGCMD,d	; set	note bit to	0
    2157.  00:5075  CB 8A               	res	B_ACTNOT,d
    2158.  00:5077  C3 06 4D            	jp	process_commandEND		
    2159.  00:507A                      	
    2160.  00:507A                      process_cmd10_note_delay:
    2161.  00:507A                      	; note delay
    2162.  00:507A  DD 35 11            	dec	(ix+TRACK_Timer)
    2163.  00:507D  C2 06 4D            	jp	nz,process_commandEND	; no delay yet
    2164.  00:5080                      
    2165.  00:5080                      	; trigger note
    2166.  00:5080  DD 7E 10            	ld	a,(ix+TRACK_cmd_E)		
    2167.  00:5083  DD 77 F6            	ld	(ix+TRACK_Note),a		; set	the note val
    2168.  00:5086  CB C2               	set	B_TRGNOT,d	;(ix+TRACK_Flags)		; set	trigger note flag
    2169.  00:5088  CB 9A               	res	B_TRGCMD,d	;(ix+TRACK_Flags)		; reset trigger cmd flag
    2170.  00:508A                      	
    2171.  00:508A  C3 06 4D            	jp	process_commandEND	
    2172.  00:508D                      
    2173.  00:508D                      
    2174.  00:508D                      
    2175.  00:508D                      
    2176.  00:508D                      
    2177.  00:508D                      _process_drum_none:
    2178.  00:508D  32 B0 C1            	ld	(FM_DRUM_ACTIVE),a
    2179.  00:5090  C9                  	ret
    2180.  00:5091                      ;============================================================================
    2181.  00:5091                      ; process_drum
    2182.  00:5091                      ;
    2183.  00:5091                      ;
    2184.  00:5091                      ;
    2185.  00:5091                      ;============================================================================
    2186.  00:5091                      process_drum:
    2187.  00:5091  3A B0 C1            	ld	a,(FM_DRUM_ACTIVE)
    2188.  00:5094  A7                  	and	a
    2189.  00:5095                      	;jp	z,_process_drum_none
    2190.  00:5095  C8                  	ret	z
    2191.  00:5096                      	;-- Retrieve the next action
    2192.  00:5096  ED 4B B1 C1         	ld	bc,(FM_DRUM_MACRO)
    2193.  00:509A                      
    2194.  00:509A                      _process_drum_loop:
    2195.  00:509A  21 B1 50            	ld	hl,DRUM_MACRO_LIST-2
    2196.  00:509D  0A                  	ld	a,(bc)
    2197.  00:509E  03                  	inc	bc
    2198.  00:509F  A7                  	and	a
    2199.  00:50A0  CA AE 50            	jp	z,.end
    2200.  00:50A3  85                  	add	a,l
    2201.  00:50A4  6F                  	ld	l,a
    2202.  00:50A5  D2 A9 50            	jp	nc,99f
    2203.  00:50A8  24                  	inc	h
    2204.  00:50A9                      99:
    2205.  00:50A9  7E                  	ld	a,(hl)
    2206.  00:50AA  23                  	inc	hl
    2207.  00:50AB  66                  	ld	h,(hl)
    2208.  00:50AC  6F                  	ld	l,a
    2209.  00:50AD  E9                  	jp	(hl)
    2210.  00:50AE                      
    2211.  00:50AE                      .end:
    2212.  00:50AE  ED 43 B1 C1         	ld	(FM_DRUM_MACRO),bc
    2213.  00:50B2  C9                  	ret
    2214.  00:50B3                      
    2215.  00:50B3                      
    2216.  00:50B3                      DRUM_MACRO_LIST:
    2217.  00:50B3  D1 50               	dw	_drum_stop		;2
    2218.  00:50B5  D6 50               	dw	_drum_vol_bd	;4
    2219.  00:50B7  DE 50               	dw	_drum_vol_sn	;6
    2220.  00:50B9  ED 50               	dw	_drum_vol_hh	;8
    2221.  00:50BB  FC 50               	dw	_drum_vol_snhh	;a
    2222.  00:50BD  04 51               	dw	_drum_vol_cy	;c
    2223.  00:50BF  13 51               	dw	_drum_vol_tt	;e
    2224.  00:50C1  22 51               	dw	_drum_vol_cytt	;10
    2225.  00:50C3  2A 51               	dw	_drum_note_bd	;12
    2226.  00:50C5  37 51               	dw	_drum_tone_bd	;14
    2227.  00:50C7  44 51               	dw	_drum_note_snhh	;16
    2228.  00:50C9  51 51               	dw	_drum_tone_snhh	;18
    2229.  00:50CB  61 51               	dw	_drum_note_cytt	;1a
    2230.  00:50CD  6E 51               	dw	_drum_tone_cytt	;1c
    2231.  00:50CF  7E 51               	dw	_drum_percussion	;1e
    2232.  00:50D1                      
    2233.  00:50D1                      _drum_stop:			;2
    2234.  00:50D1  AF                  	xor	a
    2235.  00:50D2  32 B0 C1            	ld	(FM_DRUM_ACTIVE),a
    2236.  00:50D5  C9                  	ret
    2237.  00:50D6                      
    2238.  00:50D6                      _drum_vol_bd:		;4
    2239.  00:50D6  0A                  	ld	a,(bc)
    2240.  00:50D7  03                  	inc	bc
    2241.  00:50D8  32 A0 C1            	ld	(DRUM_regVolBD),a
    2242.  00:50DB  C3 9A 50            	jp	_process_drum_loop
    2243.  00:50DE                      
    2244.  00:50DE                      _drum_vol_sn:		;6
    2245.  00:50DE  3A A6 C1            	ld	a,(DRUM_regVolSH)
    2246.  00:50E1  E6 F0               	and	0xf0
    2247.  00:50E3  57                  	ld	d,a
    2248.  00:50E4  0A                  	ld	a,(bc)
    2249.  00:50E5  03                  	inc	bc
    2250.  00:50E6  B2                  	or	d
    2251.  00:50E7  32 A6 C1            	ld	(DRUM_regVolSH),a
    2252.  00:50EA  C3 9A 50            	jp	_process_drum_loop
    2253.  00:50ED                      
    2254.  00:50ED                      _drum_vol_hh:		;8
    2255.  00:50ED  3A A6 C1            	ld	a,(DRUM_regVolSH)
    2256.  00:50F0  E6 0F               	and	0x0f
    2257.  00:50F2  57                  	ld	d,a
    2258.  00:50F3  0A                  	ld	a,(bc)
    2259.  00:50F4  03                  	inc	bc
    2260.  00:50F5  B2                  	or	d
    2261.  00:50F6  32 A6 C1            	ld	(DRUM_regVolSH),a
    2262.  00:50F9  C3 9A 50            	jp	_process_drum_loop
    2263.  00:50FC                      
    2264.  00:50FC                      _drum_vol_snhh:	;a
    2265.  00:50FC  0A                  	ld	a,(bc)
    2266.  00:50FD  03                  	inc	bc
    2267.  00:50FE  32 A6 C1            	ld	(DRUM_regVolSH),a
    2268.  00:5101  C3 9A 50            	jp	_process_drum_loop
    2269.  00:5104                      
    2270.  00:5104                      
    2271.  00:5104                      _drum_vol_cy:		;6
    2272.  00:5104  3A AC C1            	ld	a,(DRUM_regVolCT)
    2273.  00:5107  E6 F0               	and	0xf0
    2274.  00:5109  57                  	ld	d,a
    2275.  00:510A  0A                  	ld	a,(bc)
    2276.  00:510B  03                  	inc	bc
    2277.  00:510C  B2                  	or	d
    2278.  00:510D  32 AC C1            	ld	(DRUM_regVolCT),a
    2279.  00:5110  C3 9A 50            	jp	_process_drum_loop
    2280.  00:5113                      
    2281.  00:5113                      _drum_vol_tt:		;8
    2282.  00:5113  3A AC C1            	ld	a,(DRUM_regVolCT)
    2283.  00:5116  E6 0F               	and	0x0f
    2284.  00:5118  57                  	ld	d,a
    2285.  00:5119  0A                  	ld	a,(bc)
    2286.  00:511A  03                  	inc	bc
    2287.  00:511B  B2                  	or	d
    2288.  00:511C  32 AC C1            	ld	(DRUM_regVolCT),a
    2289.  00:511F  C3 9A 50            	jp	_process_drum_loop
    2290.  00:5122                      
    2291.  00:5122                      _drum_vol_cytt:	;a
    2292.  00:5122  0A                  	ld	a,(bc)
    2293.  00:5123  03                  	inc	bc
    2294.  00:5124  32 AC C1            	ld	(DRUM_regVolCT),a
    2295.  00:5127  C3 9A 50            	jp	_process_drum_loop
    2296.  00:512A                      
    2297.  00:512A                      _drum_note_bd:	;12
    2298.  00:512A  0A                  	ld	a,(bc)
    2299.  00:512B  03                  	inc	bc
    2300.  00:512C  32 9C C1            	ld	(DRUM_regToneBD),a
    2301.  00:512F  0A                  	ld	a,(bc)
    2302.  00:5130  03                  	inc	bc
    2303.  00:5131  32 9D C1            	ld	(DRUM_regToneBD+1),a
    2304.  00:5134  C3 9A 50            	jp	_process_drum_loop
    2305.  00:5137                      
    2306.  00:5137                      _drum_tone_bd:	;14
    2307.  00:5137  2A 9C C1            	ld	hl,(DRUM_regToneBD)
    2308.  00:513A  0A                  	ld	a,(bc)
    2309.  00:513B  5F                  	ld	e,a
    2310.  00:513C  03                  	inc	bc
    2311.  00:513D  0A                  	ld	a,(bc)
    2312.  00:513E  03                  	inc	bc
    2313.  00:513F  57                  	ld	d,a
    2314.  00:5140  19                  	add	hl,de
    2315.  00:5141                      ;	ld	(DRUM_regToneBD),hl
    2316.  00:5141  C3 9A 50            	jp	_process_drum_loop
    2317.  00:5144                      
    2318.  00:5144                      _drum_note_snhh:	;16
    2319.  00:5144  0A                  	ld	a,(bc)
    2320.  00:5145  03                  	inc	bc
    2321.  00:5146  32 A2 C1            	ld	(DRUM_regToneSH),a
    2322.  00:5149  0A                  	ld	a,(bc)
    2323.  00:514A  03                  	inc	bc
    2324.  00:514B  32 A3 C1            	ld	(DRUM_regToneSH+1),a
    2325.  00:514E  C3 9A 50            	jp	_process_drum_loop
    2326.  00:5151                      
    2327.  00:5151                      _drum_tone_snhh:	;18
    2328.  00:5151  2A A2 C1            	ld	hl,(DRUM_regToneSH)
    2329.  00:5154  0A                  	ld	a,(bc)
    2330.  00:5155  5F                  	ld	e,a
    2331.  00:5156  03                  	inc	bc
    2332.  00:5157  0A                  	ld	a,(bc)
    2333.  00:5158  03                  	inc	bc
    2334.  00:5159  57                  	ld	d,a
    2335.  00:515A  19                  	add	hl,de
    2336.  00:515B  22 A2 C1            	ld	(DRUM_regToneSH),hl
    2337.  00:515E  C3 9A 50            	jp	_process_drum_loop
    2338.  00:5161                      
    2339.  00:5161                      _drum_note_cytt:	;1a
    2340.  00:5161  0A                  	ld	a,(bc)
    2341.  00:5162  03                  	inc	bc
    2342.  00:5163  32 A8 C1            	ld	(DRUM_regToneCT),a
    2343.  00:5166  0A                  	ld	a,(bc)
    2344.  00:5167  03                  	inc	bc
    2345.  00:5168  32 A9 C1            	ld	(DRUM_regToneCT+1),a
    2346.  00:516B  C3 9A 50            	jp	_process_drum_loop
    2347.  00:516E                      
    2348.  00:516E                      _drum_tone_cytt:	;1c
    2349.  00:516E  2A A8 C1            	ld	hl,(DRUM_regToneCT)
    2350.  00:5171  0A                  	ld	a,(bc)
    2351.  00:5172  5F                  	ld	e,a
    2352.  00:5173  03                  	inc	bc
    2353.  00:5174  0A                  	ld	a,(bc)
    2354.  00:5175  03                  	inc	bc
    2355.  00:5176  57                  	ld	d,a
    2356.  00:5177  19                  	add	hl,de
    2357.  00:5178  22 A8 C1            	ld	(DRUM_regToneCT),hl
    2358.  00:517B  C3 9A 50            	jp	_process_drum_loop
    2359.  00:517E                      
    2360.  00:517E                      _drum_percussion:	;1e
    2361.  00:517E  0A                  	ld	a,(bc)
    2362.  00:517F  03                  	inc	bc
    2363.  00:5180  32 AE C1            	ld	(FM_DRUM),a
    2364.  00:5183  C3 9A 50            	jp	_process_drum_loop
    2365.  00:5186                      	
    2366.  00:5186                      
    2367.  00:5186                      
    2368.  00:5186                      
    2369.  00:5186                      
    2370.  00:5186                      
    2371.  00:5186                      
    2372.  00:5186                      
    2373.  00:5186                      
    2374.  00:5186                      
    2375.  00:5186                      
    2376.  00:5186                      ;===========================================================
    2377.  00:5186                      ; ---replay_route
    2378.  00:5186                      ; Output the data	to the CHIP	registers
    2379.  00:5186                      ; 
    2380.  00:5186                      ; 
    2381.  00:5186                      ;===========================================================
    2382.  00:5186                      replay_route:
    2383.  00:5186                      ;---------------
    2384.  00:5186                      ; P S	G 
    2385.  00:5186                      ;---------------
    2386.  00:5186                      route_SN:
    2387.  00:5186                      ;	ld	a,(_CONFIG_PSGPORT)
    2388.  00:5186  0E 3F               	ld	c,$3f
    2389.  00:5188                      99:	
    2390.  00:5188                      	; vol chan 1
    2391.  00:5188  3A 72 C1            	ld	a,(PSG_regVOLA)
    2392.  00:518B  3C                  	inc	a
    2393.  00:518C  ED 44               	neg
    2394.  00:518E  E6 0F               	and	$0f
    2395.  00:5190  F6 90               	or	10010000b
    2396.  00:5192  ED 79               	out	(c),a	
    2397.  00:5194                      	
    2398.  00:5194                      	; vol chan 2
    2399.  00:5194  3A 73 C1            	ld	a,(PSG_regVOLB)
    2400.  00:5197  3C                  	inc	a
    2401.  00:5198  ED 44               	neg
    2402.  00:519A  E6 0F               	and	$0f
    2403.  00:519C  F6 B0               	or	10110000b
    2404.  00:519E  ED 79               	out	(c),a		
    2405.  00:51A0                      		
    2406.  00:51A0                      ;	;-- check if we need 3rd psg
    2407.  00:51A0                      ;	ld	a,10110000b
    2408.  00:51A0                      ;	cp	b
    2409.  00:51A0                      ;	jp	z,99f
    2410.  00:51A0                      		
    2411.  00:51A0                      	; vol chan 3
    2412.  00:51A0  3A 74 C1            	ld	a,(PSG_regVOLC)
    2413.  00:51A3  3C                  	inc	a
    2414.  00:51A4  ED 44               	neg
    2415.  00:51A6  E6 0F               	and	$0f
    2416.  00:51A8  F6 D0               	or	11010000b 
    2417.  00:51AA  ED 79               	out	(c),a			
    2418.  00:51AC                      
    2419.  00:51AC                      ;99:	
    2420.  00:51AC                      	;--- next reg
    2421.  00:51AC                      	; vol noise
    2422.  00:51AC  3A 75 C1            	ld	a,(PSG_regVOLN)
    2423.  00:51AF  3C                  	inc	a
    2424.  00:51B0  ED 44               	neg
    2425.  00:51B2  E6 0F               	and	$0f
    2426.  00:51B4  F6 F0               	or	11110000b
    2427.  00:51B6                      
    2428.  00:51B6  ED 79               	out	(c),a	
    2429.  00:51B8                      
    2430.  00:51B8                      	; noise chan 
    2431.  00:51B8  21 76 C1            	ld	hl,PSG_regNOISEold
    2432.  00:51BB  3A 70 C1            	ld	a,(PSG_regNOISE)
    2433.  00:51BE  BE                  	cp	(hl)
    2434.  00:51BF  CA C7 51            	jp	z,0f
    2435.  00:51C2  77                  	ld	(hl),a
    2436.  00:51C3  F6 E0               	or	11100000b
    2437.  00:51C5                      	;or	11100000b
    2438.  00:51C5  D3 3F               	out	($3f),a
    2439.  00:51C7                      0:
    2440.  00:51C7                      	; tone chan a
    2441.  00:51C7  ED 4B 6A C1         	ld	bc,(PSG_regToneA)
    2442.  00:51CB  79                  	ld	a,c
    2443.  00:51CC  E6 0F               	and	$0f
    2444.  00:51CE  F6 80               	or	10000000b
    2445.  00:51D0  D3 3F               	out	($3f),a	
    2446.  00:51D2  CB 11               	rl	c
    2447.  00:51D4  CB 10               	rl	b
    2448.  00:51D6  CB 11               	rl	c
    2449.  00:51D8  CB 10               	rl	b
    2450.  00:51DA  CB 11               	rl	c
    2451.  00:51DC  CB 10               	rl	b
    2452.  00:51DE  CB 11               	rl	c
    2453.  00:51E0  CB 10               	rl	b
    2454.  00:51E2  3E 3F               	ld	a,00111111b
    2455.  00:51E4  A0                  	and	b
    2456.  00:51E5  D3 3F               	out	($3f),a		
    2457.  00:51E7                      	
    2458.  00:51E7                      	
    2459.  00:51E7                      	; tone chan b
    2460.  00:51E7  ED 4B 6C C1         	ld	bc,(PSG_regToneB)
    2461.  00:51EB  79                  	ld	a,c
    2462.  00:51EC  E6 0F               	and	$0f
    2463.  00:51EE  F6 A0               	or	10100000b
    2464.  00:51F0  D3 3F               	out	($3f),a	
    2465.  00:51F2  CB 11               	rl	c
    2466.  00:51F4  CB 10               	rl	b
    2467.  00:51F6  CB 11               	rl	c
    2468.  00:51F8  CB 10               	rl	b
    2469.  00:51FA  CB 11               	rl	c
    2470.  00:51FC  CB 10               	rl	b
    2471.  00:51FE  CB 11               	rl	c
    2472.  00:5200  CB 10               	rl	b
    2473.  00:5202  3E 3F               	ld	a,00111111b
    2474.  00:5204  A0                  	and	b
    2475.  00:5205  D3 3F               	out	($3f),a	
    2476.  00:5207                      	
    2477.  00:5207                      	; tone chan c
    2478.  00:5207  ED 4B 6E C1         	ld	bc,(PSG_regToneC)
    2479.  00:520B  79                  	ld	a,c
    2480.  00:520C  E6 0F               	and	$0f
    2481.  00:520E  F6 C0               	or	11000000b
    2482.  00:5210  D3 3F               	out	($3f),a	
    2483.  00:5212  CB 11               	rl	c
    2484.  00:5214  CB 10               	rl	b
    2485.  00:5216  CB 11               	rl	c
    2486.  00:5218  CB 10               	rl	b
    2487.  00:521A  CB 11               	rl	c
    2488.  00:521C  CB 10               	rl	b
    2489.  00:521E  CB 11               	rl	c
    2490.  00:5220  CB 10               	rl	b
    2491.  00:5222  3E 3F               	ld	a,00111111b
    2492.  00:5224  A0                  	and	b
    2493.  00:5225  D3 3F               	out	($3f),a	
    2494.  00:5227                      
    2495.  00:5227                      route_gg:
    2496.  00:5227                      	;==== output the GG stereo panning
    2497.  00:5227  3A 77 C1            	ld	a,(GG_panning)
    2498.  00:522A                      ;	out	($06),a
    2499.  00:522A                      
    2500.  00:522A                      
    2501.  00:522A                      
    2502.  00:522A                      
    2503.  00:522A                      
    2504.  00:522A                      
    2505.  00:522A                      
    2506.  00:522A                      
    2507.  00:522A                      ;---------------
    2508.  00:522A                      ; F M
    2509.  00:522A                      ;---------------
    2510.  00:522A                      route_FM:
    2511.  00:522A                      	; Check if we need to load a software voice
    2512.  00:522A  21 B3 C1            	ld	hl,FM_softvoice_req
    2513.  00:522D  7E                  	ld	a,(hl)
    2514.  00:522E  23                  	inc	hl
    2515.  00:522F  BE                  	cp	(hl)
    2516.  00:5230  CA 37 52            	jp	z,.noVoice
    2517.  00:5233                      	
    2518.  00:5233  77                  	ld	(hl),a
    2519.  00:5234                      
    2520.  00:5234  CD B6 52            	call	load_softwarevoice
    2521.  00:5237                      	
    2522.  00:5237                      .noVoice:
    2523.  00:5237                      	;------------------------------------------
    2524.  00:5237                      	;---- Update the tone and drum registers
    2525.  00:5237                      	;------------------------------------------
    2526.  00:5237  21 78 C1            	ld 	hl,FM_Registers
    2527.  00:523A  11 8A C0            	ld	de,TRACK_Chan3+17+TRACK_Flags
    2528.  00:523D  3E 10               	ld	a,$10		; Register $10
    2529.  00:523F  06 09               	ld	b,9		; 6(tone)+3(drum) channels to update
    2530.  00:5241                      
    2531.  00:5241                      .channel_loop:	
    2532.  00:5241                      	; Tone low
    2533.  00:5241  CD 96 52            	call	_route_FM_reg16_update
    2534.  00:5244  2B                  	dec	hl
    2535.  00:5245  C6 10               	add	a,$10	; Register# $20
    2536.  00:5247                      
    2537.  00:5247  08                  	ex	af,af'
    2538.  00:5248                      
    2539.  00:5248  78                  	ld	a,b	;-- Only do this check for first 6 chans. Other are drum
    2540.  00:5249  FE 04               	cp	4
    2541.  00:524B  DA 64 52            	jp	c,0f
    2542.  00:524E                      
    2543.  00:524E                      	;-- Check if we need to toggle key to start a new note
    2544.  00:524E  1A                  	ld	a,(de)
    2545.  00:524F  CB 47               	bit	0,a
    2546.  00:5251  CA 5C 52            	jp	z,99f	; no notetrigger
    2547.  00:5254                      	
    2548.  00:5254  CB 87               	res	0,a		; reset trigger
    2549.  00:5256  12                  	ld	(de),a
    2550.  00:5257  CB 67               	bit	4,a
    2551.  00:5259  C4 A7 52            	call	nz,_route_FM_keyOff_update
    2552.  00:525C                      99:
    2553.  00:525C  3E 27               	ld	a,TRACK_REC_SIZE
    2554.  00:525E  83                  	add	a,e
    2555.  00:525F  5F                  	ld	e,a
    2556.  00:5260  D2 64 52            	jp	nc,99f
    2557.  00:5263  14                  	inc	d
    2558.  00:5264                      99:	
    2559.  00:5264                      0:
    2560.  00:5264  08                  	ex	af,af'
    2561.  00:5265                      	
    2562.  00:5265                      	; Tone High + key & sustain
    2563.  00:5265  CD 96 52            	call	_route_FM_reg16_update
    2564.  00:5268  23                  	inc	hl
    2565.  00:5269  C6 10               	add	a,$10	; Register# $30
    2566.  00:526B                      	
    2567.  00:526B                      	; Volume + voice
    2568.  00:526B  CD 91 52            	call	_route_FM_reg8_update
    2569.  00:526E  23                  	inc	hl
    2570.  00:526F  C6 E1               	add	a,-$1F	; Register# = channel + $10
    2571.  00:5271  10 CE               	djnz	.channel_loop
    2572.  00:5273                      
    2573.  00:5273                      	;------------------------------------------
    2574.  00:5273                      	;---- Process Drum macro
    2575.  00:5273                      	;------------------------------------------
    2576.  00:5273                      _route_FM_drum_update:
    2577.  00:5273  3A AE C1            	ld	a,(FM_DRUM)
    2578.  00:5276  E6 1F               	and	00011111b		; erase bit 5
    2579.  00:5278  C8                  	ret	z			; no drums to play
    2580.  00:5279                      	
    2581.  00:5279  47                  	ld	b,a
    2582.  00:527A  3E 0E               	ld	a,0x0e
    2583.  00:527C                      	;-- load the new values
    2584.  00:527C  D3 7C               	out	(FM_WRITE),a	; Select rythm register
    2585.  00:527E                      	
    2586.  00:527E  78                  	ld	a,b			; 5 cycles
    2587.  00:527F  78                  	ld	a,b			; 5 cycles	; dummy code for delay
    2588.  00:5280  D3 7D               	out	(FM_DATA),a		
    2589.  00:5282                      
    2590.  00:5282  DD E5               	push	ix			; 17 cycles	dummy code to implement delay
    2591.  00:5284  DD E1               	pop	ix			; 17 cycles
    2592.  00:5286  47                  	ld	b,a
    2593.  00:5287  AF                  	xor	a
    2594.  00:5288  32 AE C1            	ld	(FM_DRUM),a
    2595.  00:528B  78                  	ld	a,b
    2596.  00:528C                      
    2597.  00:528C  F6 20               	or	100000b		; set the percussion bit
    2598.  00:528E  D3 7D               	out	(FM_DATA),a
    2599.  00:5290  C9                  	ret
    2600.  00:5291                      	
    2601.  00:5291                      
    2602.  00:5291                      ;------- Writes safe to the FM chip
    2603.  00:5291                      ; in :
    2604.  00:5291                      ;	[a]	Register# to write
    2605.  00:5291                      ;	[HL]	point to register (previous value is next in RAM)
    2606.  00:5291                      ;
    2607.  00:5291                      ; out:
    2608.  00:5291                      ;	[HL] points to previous value
    2609.  00:5291                      ;	[A]	contains register# written
    2610.  00:5291                      ;-----------
    2611.  00:5291                      _route_FM_reg8_update:
    2612.  00:5291  08                  	ex	af,af'
    2613.  00:5292  7E                  	ld	a,(hl)
    2614.  00:5293  C3 99 52            	jp	_rfr_cont
    2615.  00:5296                      	
    2616.  00:5296                      	
    2617.  00:5296                      ;------- Writes safe to the FM chip
    2618.  00:5296                      ; in :
    2619.  00:5296                      ;	[a]	Register# to write
    2620.  00:5296                      ;	[HL]	point to register (previous value is next in RAM)
    2621.  00:5296                      ;
    2622.  00:5296                      ; out:
    2623.  00:5296                      ;	[HL] points to previous value
    2624.  00:5296                      ;	[A]	contains register# written
    2625.  00:5296                      ;-----------
    2626.  00:5296                      _route_FM_reg16_update:
    2627.  00:5296  08                  	ex	af,af'
    2628.  00:5297  7E                  	ld	a,(hl)
    2629.  00:5298  23                  	inc	hl
    2630.  00:5299                      _rfr_cont:
    2631.  00:5299  23                  	inc	hl
    2632.  00:529A  BE                  	cp	(hl)	
    2633.  00:529B  CA A5 52            	jp	z,99f		; no change in tone low value
    2634.  00:529E  08                  	ex	af,af'	
    2635.  00:529F  D3 7C               	out	(FM_WRITE),a
    2636.  00:52A1  08                  	ex	af,af'
    2637.  00:52A2  77                  	ld	(hl),a
    2638.  00:52A3  D3 7D               	out	(FM_DATA),a	
    2639.  00:52A5  08                  99:	ex	af,af'
    2640.  00:52A6                      ;	dec	hl	
    2641.  00:52A6  C9                  	ret
    2642.  00:52A7                      	
    2643.  00:52A7                      ;------- Writes a keyoff to the existing tone high register 
    2644.  00:52A7                      ; in :
    2645.  00:52A7                      ;	[A']	register# to write
    2646.  00:52A7                      ;	[HL]	point to register (previous value is next in RAM)
    2647.  00:52A7                      ;
    2648.  00:52A7                      ; out:
    2649.  00:52A7                      ;	[HL] points to same location
    2650.  00:52A7                      ;	[A']	contains register# written
    2651.  00:52A7                      ;-----------
    2652.  00:52A7                      _route_FM_keyOff_update:
    2653.  00:52A7  08                  	ex	af,af'
    2654.  00:52A8  D3 7C               	out	(FM_WRITE),a
    2655.  00:52AA  08                  	ex	af,af'		; 4 cycles	 '
    2656.  00:52AB  7E                  	ld	a,(hl)
    2657.  00:52AC  E6 EF               	and	11101111b	; erase keyON bit.
    2658.  00:52AE  D3 7D               	out	(FM_DATA),a	
    2659.  00:52B0  23                  	inc	hl
    2660.  00:52B1  23                  	inc	hl
    2661.  00:52B2  77                  	ld	(hl),a		; make sure to change old value to trigger update
    2662.  00:52B3  2B                  	dec	hl
    2663.  00:52B4  2B                  	dec	hl
    2664.  00:52B5  C9                  	ret
    2665.  00:52B6                      
    2666.  00:52B6                      
    2667.  00:52B6                      
    2668.  00:52B6                      load_softwarevoice:
    2669.  00:52B6                      	;-- Set the software voice data address
    2670.  00:52B6  2A 07 C0            	ld 	hl,(replay_voicebase)
    2671.  00:52B9  5F                  	ld	e,a
    2672.  00:52BA  16 00               	ld	d,0
    2673.  00:52BC  19                  	add	hl,de
    2674.  00:52BD  19                  	add	hl,de
    2675.  00:52BE  AF                  	xor	a		; set reg# 0
    2676.  00:52BF                      
    2677.  00:52BF                      
    2678.  00:52BF                      
    2679.  00:52BF                      .voiceupd_loop:
    2680.  00:52BF                      
    2681.  00:52BF  D3 7C               	out	(FM_WRITE),a
    2682.  00:52C1  08                  	ex	af,af'		; 4 cycles	 '
    2683.  00:52C2  7E                  	ld	a,(hl)		; 4 cycles 	
    2684.  00:52C3  23                  	inc	hl			; 6 cycles
    2685.  00:52C4  D3 7D               	out	(FM_DATA),a	
    2686.  00:52C6                      
    2687.  00:52C6  08                  	ex	af,af' 		; 4 cycles	'
    2688.  00:52C7  3C                  	inc	a			; 4 cycles
    2689.  00:52C8                      	
    2690.  00:52C8  FE 08               	cp	8 			; 7 cycles
    2691.  00:52CA                      	;--- delay
    2692.  00:52CA  DD E5               	push 	ix			; 15 cycles
    2693.  00:52CC  DD E1               	pop	ix			; 14 cycles
    2694.  00:52CE  DD E5               	push 	ix			; 15 cycles
    2695.  00:52D0  DD E1               	pop	ix			; 14 cycles
    2696.  00:52D2                      		
    2697.  00:52D2  DA BF 52            	jp	c,.voiceupd_loop 	; 10 cycles
    2698.  00:52D5  C9                  	ret
    2699.  00:52D6                      
    2700.  00:52D6                      	
    2701.  00:52D6                      
    2702.  00:52D6                      	
    2703.  00:52D6                      
    2704.  00:52D6                      
     560   00:52D6                      	include	"..\code\ttreplaySMSDAT.asm"
       1.  00:52D6                      
       2.  00:52D6                      
       3.  00:52D6                      	; Balance setting space volume max - 8
       4.  00:52D6  1E (128)            	ds 8*16, $1E
       5.  00:5356                      _VOLUME_TABLE
       6.  00:5356                      	; Combined volume table PSG/FM
       7.  00:5356                      ;	db	 $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F, $0F
       8.  00:5356                      ;	db	 $0F, $0F, $0F, $0F, $0F, $0F, $0F, $1F, $1F, $1F, $1F, $1F, $1F, $1F, $1F, $1E
       9.  00:5356                      ;	db	 $0F, $0F, $0F, $0F, $1F, $1F, $1F, $1F, $1F, $1F, $1F, $1F, $2F, $2F, $2E, $2D
      10.  00:5356                      ;	db	 $0F, $0F, $0F, $1F, $1F, $1F, $1F, $1F, $2F, $2F, $2F, $2F, $2F, $3E, $3D, $3C
      11.  00:5356                      ;	db	 $0F, $0F, $1F, $1F, $1F, $1F, $2F, $2F, $2F, $2F, $3F, $3F, $3E, $3D, $4C, $4B
      12.  00:5356                      ;	db	 $0F, $0F, $1F, $1F, $1F, $2F, $2F, $2F, $3F, $3F, $3F, $4E, $4D, $4C, $5B, $5A
      13.  00:5356                      ;	db	 $0F, $0F, $1F, $1F, $2F, $2F, $2F, $3F, $3F, $4F, $4E, $4D, $5C, $5B, $6A, $69
      14.  00:5356                      ;	db	 $0F, $0F, $1F, $1F, $2F, $2F, $3F, $3F, $4F, $4E, $5D, $5C, $6B, $6A, $79, $78
      15.  00:5356                      ;	db	 $0F, $1F, $1F, $2F, $2F, $3F, $3F, $4F, $4E, $5D, $5C, $6B, $6A, $79, $78, $87
      16.  00:5356                      ;	db	 $0F, $1F, $1F, $2F, $2F, $3F, $4F, $4E, $5D, $5C, $6B, $7A, $79, $88, $87, $96
      17.  00:5356                      ;	db	 $0F, $1F, $1F, $2F, $3F, $3F, $4E, $5D, $5C, $6B, $7A, $79, $88, $97, $96, $A5
      18.  00:5356                      ;	db	 $0F, $1F, $1F, $2F, $3F, $4E, $4D, $5C, $6B, $7A, $79, $88, $97, $A6, $A5, $B4
      19.  00:5356                      ;	db	 $0F, $1F, $2F, $2F, $3E, $4D, $5C, $6B, $6A, $79, $88, $97, $A6, $A5, $B4, $C3
      20.  00:5356                      ;	db	 $0F, $1F, $2F, $3E, $3D, $4C, $5B, $6A, $79, $88, $97, $A6, $A5, $B4, $C3, $D2
      21.  00:5356                      ;	db	 $0F, $1F, $2E, $3D, $4C, $5B, $6A, $79, $78, $87, $96, $A5, $B4, $C3, $D2, $E1
      22.  00:5356                      ;	db	 $0F, $1E, $2D, $3C, $4B, $5A, $69, $78, $87, $96, $A5, $B4, $C3, $D2, $E1, $F0
      23.  00:5356                      
      24.  00:5356                      	; Tail mode on (psg 1/ FM E)	
      25.  00:5356                      	db	 $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E
      25.  00:5356  1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 
      26.  00:5366                      	db	 $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E
      26.  00:5366  1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 
      27.  00:5376                      	db	 $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $2E, $2E, $2E, $2D
      27.  00:5376  1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 1E 2E 2E 2E 2D 
      28.  00:5386                      	db	 $1E, $1E, $1E, $1E, $1E, $1E, $1E, $1E, $2E, $2E, $2E, $2E, $2E, $3E, $3D, $3C
      28.  00:5386  1E 1E 1E 1E 1E 1E 1E 1E 2E 2E 2E 2E 2E 3E 3D 3C 
      29.  00:5396                      	db	 $1E, $1E, $1E, $1E, $1E, $1E, $2E, $2E, $2E, $2E, $3E, $3E, $3E, $3D, $4C, $4B
      29.  00:5396  1E 1E 1E 1E 1E 1E 2E 2E 2E 2E 3E 3E 3E 3D 4C 4B 
      30.  00:53A6                      	db	 $1E, $1E, $1E, $1E, $1E, $2E, $2E, $2E, $3E, $3E, $3E, $4E, $4D, $4C, $5B, $5A
      30.  00:53A6  1E 1E 1E 1E 1E 2E 2E 2E 3E 3E 3E 4E 4D 4C 5B 5A 
      31.  00:53B6                      	db	 $1E, $1E, $1E, $1E, $2E, $2E, $2E, $3E, $3E, $4E, $4E, $4D, $5C, $5B, $6A, $69
      31.  00:53B6  1E 1E 1E 1E 2E 2E 2E 3E 3E 4E 4E 4D 5C 5B 6A 69 
      32.  00:53C6                      	db	 $1E, $1E, $1E, $1E, $2E, $2E, $3E, $3E, $4E, $4E, $5D, $5C, $6B, $6A, $79, $78
      32.  00:53C6  1E 1E 1E 1E 2E 2E 3E 3E 4E 4E 5D 5C 6B 6A 79 78 
      33.  00:53D6                      	db	 $1E, $1E, $1E, $2E, $2E, $3E, $3E, $4E, $4E, $5D, $5C, $6B, $6A, $79, $78, $87
      33.  00:53D6  1E 1E 1E 2E 2E 3E 3E 4E 4E 5D 5C 6B 6A 79 78 87 
      34.  00:53E6                      	db	 $1E, $1E, $1E, $2E, $2E, $3E, $4E, $4E, $5D, $5C, $6B, $7A, $79, $88, $87, $96
      34.  00:53E6  1E 1E 1E 2E 2E 3E 4E 4E 5D 5C 6B 7A 79 88 87 96 
      35.  00:53F6                      	db	 $1E, $1E, $1E, $2E, $3E, $3E, $4E, $5D, $5C, $6B, $7A, $79, $88, $97, $96, $A5
      35.  00:53F6  1E 1E 1E 2E 3E 3E 4E 5D 5C 6B 7A 79 88 97 96 A5 
      36.  00:5406                      	db	 $1E, $1E, $1E, $2E, $3E, $4E, $4D, $5C, $6B, $7A, $79, $88, $97, $A6, $A5, $B4
      36.  00:5406  1E 1E 1E 2E 3E 4E 4D 5C 6B 7A 79 88 97 A6 A5 B4 
      37.  00:5416                      	db	 $1E, $1E, $2E, $2E, $3E, $4D, $5C, $6B, $6A, $79, $88, $97, $A6, $A5, $B4, $C3
      37.  00:5416  1E 1E 2E 2E 3E 4D 5C 6B 6A 79 88 97 A6 A5 B4 C3 
      38.  00:5426                      	db	 $1E, $1E, $2E, $3E, $3D, $4C, $5B, $6A, $79, $88, $97, $A6, $A5, $B4, $C3, $D2
      38.  00:5426  1E 1E 2E 3E 3D 4C 5B 6A 79 88 97 A6 A5 B4 C3 D2 
      39.  00:5436                      	db	 $1E, $1E, $2E, $3D, $4C, $5B, $6A, $79, $78, $87, $96, $A5, $B4, $C3, $D2, $E1
      39.  00:5436  1E 1E 2E 3D 4C 5B 6A 79 78 87 96 A5 B4 C3 D2 E1 
      40.  00:5446                      	db	 $1E, $1E, $2D, $3C, $4B, $5A, $69, $78, $87, $96, $A5, $B4, $C3, $D2, $E1, $F0
      40.  00:5446  1E 1E 2D 3C 4B 5A 69 78 87 96 A5 B4 C3 D2 E1 F0 
      41.  00:5456                      
      42.  00:5456                      TRACK_ToneTable_PSG:	
      43.  00:5456  01 00               	dw $0001	     ; C1			
      44.  00:5458  01 00               	dw $0001	     ; C#1			
      45.  00:545A  01 00               	dw $0001	     ; D1			
      46.  00:545C  01 00               	dw $0001	     ; D#1			
      47.  00:545E  01 00               	dw $0001	     ; E1			
      48.  00:5460  01 00               	dw $0001	     ; F1			
      49.  00:5462  01 00               	dw $0001	     ; F#1			
      50.  00:5464  01 00               	dw $0001	     ; G1
      51.  00:5466  01 00               	dw $0001	     ; G#1	
      52.  00:5468  01 00               	dw $0001         ; A1
      53.  00:546A  01 00               	dw $0001         ;A#1/Bb1
      54.  00:546C  01 00               	dw $0001         ; B1	
      55.  00:546E  01 00               	dw $0001	     ; C2			
      56.  00:5470  01 00               	dw $0001	     ; C#2			
      57.  00:5472  01 00               	dw $0001	     ; D2			
      58.  00:5474  01 00               	dw $0001	     ; D#2			
      59.  00:5476  01 00               	dw $0001	     ; E2			
      60.  00:5478  01 00               	dw $0001	     ; F2			
      61.  00:547A  01 00               	dw $0001	     ; F#2			
      62.  00:547C  01 00               	dw $0001	     ; G2
      63.  00:547E  01 00               	dw $0001	     ; G#2			
      64.  00:5480                         
      65.  00:5480  F9 03               	dw $03F9      ;A2
      66.  00:5482  C0 03               	dw $03C0      ;A#2/Bb2
      67.  00:5484  8A 03               	dw $038A      ;B2
      68.  00:5486  57 03               	dw $0357      ;C3
      69.  00:5488  27 03               	dw $0327      ;C#3/Db3
      70.  00:548A  FA 02               	dw $02FA      ;D3
      71.  00:548C  CF 02               	dw $02CF      ;D#3/Eb3
      72.  00:548E  A7 02               	dw $02A7      ;E3
      73.  00:5490  81 02               	dw $0281      ;F3
      74.  00:5492  5D 02               	dw $025D      ;F#3/Gb3
      75.  00:5494  3B 02               	dw $023B      ;G3
      76.  00:5496  1B 02               	dw $021B      ;G#3/Ab3
      77.  00:5498  FC 01               	dw $01FC      ;A3
      78.  00:549A  E0 01               	dw $01E0      ;A#3/Bb3
      79.  00:549C  C5 01               	dw $01C5      ;B3
      80.  00:549E  AC 01               	dw $01AC      ;C4
      81.  00:54A0  94 01               	dw $0194      ;C#4/Db4
      82.  00:54A2  7D 01               	dw $017D      ;D4
      83.  00:54A4  68 01               	dw $0168      ;D#4/Eb4
      84.  00:54A6  53 01               	dw $0153      ;E4
      85.  00:54A8  40 01               	dw $0140      ;F4
      86.  00:54AA  2E 01               	dw $012E      ;F#4/Gb4
      87.  00:54AC  1D 01               	dw $011D      ;G4
      88.  00:54AE  0D 01               	dw $010D      ;G#4/Ab4
      89.  00:54B0  FE 00               	dw $00FE      ;A4
      90.  00:54B2  F0 00               	dw $00F0      ;A#4/Bb4
      91.  00:54B4  E2 00               	dw $00E2      ;B4
      92.  00:54B6  D6 00               	dw $00D6      ;C5
      93.  00:54B8  CA 00               	dw $00CA      ;C#5/Db5
      94.  00:54BA  BE 00               	dw $00BE      ;D5
      95.  00:54BC  B4 00               	dw $00B4      ;D#5/Eb5
      96.  00:54BE  AA 00               	dw $00AA      ;E5
      97.  00:54C0  A0 00               	dw $00A0      ;F5
      98.  00:54C2  97 00               	dw $0097      ;F#5/Gb5
      99.  00:54C4  8F 00               	dw $008F      ;G5
     100.  00:54C6  87 00               	dw $0087      ;G#5/Ab5
     101.  00:54C8  7F 00               	dw $007F      ;A5
     102.  00:54CA  78 00               	dw $0078      ;A#5/Bb5
     103.  00:54CC  71 00               	dw $0071      ;B5
     104.  00:54CE  6B 00               	dw $006B      ;C6
     105.  00:54D0  65 00               	dw $0065      ;C#6/Db6
     106.  00:54D2  5F 00               	dw $005F      ;D6
     107.  00:54D4  5A 00               	dw $005A      ;D#6/Eb6
     108.  00:54D6  55 00               	dw $0055      ;E6
     109.  00:54D8  50 00               	dw $0050      ;F6
     110.  00:54DA  4C 00               	dw $004C      ;F#6/Gb6
     111.  00:54DC  47 00               	dw $0047      ;G6
     112.  00:54DE  43 00               	dw $0043      ;G#6/Ab6
     113.  00:54E0  40 00               	dw $0040      ;A6
     114.  00:54E2  3C 00               	dw $003C      ;A#6/Bb6
     115.  00:54E4  39 00               	dw $0039      ;B6
     116.  00:54E6  35 00               	dw $0035      ;C7
     117.  00:54E8  32 00               	dw $0032      ;C#7/Db7
     118.  00:54EA  30 00               	dw $0030      ;D7
     119.  00:54EC  2D 00               	dw $002D      ;D#7/Eb7
     120.  00:54EE  2A 00               	dw $002A      ;E7
     121.  00:54F0  28 00               	dw $0028      ;F7
     122.  00:54F2  26 00               	dw $0026      ;F#7/Gb7
     123.  00:54F4  24 00               	dw $0024      ;G7
     124.  00:54F6  22 00               	dw $0022      ;G#7/Ab7
     125.  00:54F8  20 00               	dw $0020      ;A7
     126.  00:54FA  1E 00               	dw $001E      ;A#7/Bb7
     127.  00:54FC  1C 00               	dw $001C      ;B7
     128.  00:54FE  1B 00               	dw $001B      ;C8
     129.  00:5500  19 00               	dw $0019      ;C#8/Db8
     130.  00:5502  18 00               	dw $0018      ;D8
     131.  00:5504  16 00               	dw $0016      ;D#8/Eb8
     132.  00:5506  15 00               	dw $0015      ;E8
     133.  00:5508  14 00               	dw $0014      ;F8
     134.  00:550A  13 00               	dw $0013      ;F#8/Gb8
     135.  00:550C  12 00               	dw $0012      ;G8
     136.  00:550E  11 00               	dw $0011      ;G#8/Ab8
     137.  00:5510  10 00               	dw $0010      ;A8
     138.  00:5512  0F 00               	dw $000F      ;A#8/Bb8
     139.  00:5514  0E 00               	dw $000E      ;B8
     140.  00:5516                      TRACK_ToneTable_FM:
     141.  00:5516                      ;	db   	0,0
     142.  00:5516                      	db	0adh,000h,0b7h,000h,0c2h,000h,0cdh,000h,0d9h,000h,0e6h,000h
     142.  00:5516  AD 00 B7 00 C2 00 CD 00 D9 00 E6 00 
     143.  00:5522                            db	0f4h,000h,003h,001h,012h,001h,022h,001h,034h,001h,046h,001h
     143.  00:5522  F4 00 03 01 12 01 22 01 34 01 46 01 
     144.  00:552E                            db    0adh,002h,0b7h,002h,0c2h,002h,0cdh,002h,0d9h,002h,0e6h,002h
     144.  00:552E  AD 02 B7 02 C2 02 CD 02 D9 02 E6 02 
     145.  00:553A                            db    0f4h,002h,003h,003h,012h,003h,022h,003h,034h,003h,046h,003h
     145.  00:553A  F4 02 03 03 12 03 22 03 34 03 46 03 
     146.  00:5546                            db    0adh,004h,0b7h,004h,0c2h,004h,0cdh,004h,0d9h,004h,0e6h,004h
     146.  00:5546  AD 04 B7 04 C2 04 CD 04 D9 04 E6 04 
     147.  00:5552                            db    0f4h,004h,003h,005h,012h,005h,022h,005h,034h,005h,046h,005h
     147.  00:5552  F4 04 03 05 12 05 22 05 34 05 46 05 
     148.  00:555E                            db    0adh,006h,0b7h,006h,0c2h,006h,0cdh,006h,0d9h,006h,0e6h,006h
     148.  00:555E  AD 06 B7 06 C2 06 CD 06 D9 06 E6 06 
     149.  00:556A                            db    0f4h,006h,003h,007h,012h,007h,022h,007h,034h,007h,046h,007h
     149.  00:556A  F4 06 03 07 12 07 22 07 34 07 46 07 
     150.  00:5576                            db    0adh,008h,0b7h,008h,0c2h,008h,0cdh,008h,0d9h,008h,0e6h,008h
     150.  00:5576  AD 08 B7 08 C2 08 CD 08 D9 08 E6 08 
     151.  00:5582                            db    0f4h,008h,003h,009h,012h,009h,022h,009h,034h,009h,046h,009h
     151.  00:5582  F4 08 03 09 12 09 22 09 34 09 46 09 
     152.  00:558E                            db    0adh,00ah,0b7h,00ah,0c2h,00ah,0cdh,00ah,0d9h,00ah,0e6h,00ah
     152.  00:558E  AD 0A B7 0A C2 0A CD 0A D9 0A E6 0A 
     153.  00:559A                            db    0f4h,00ah,003h,00bh,012h,00bh,022h,00bh,034h,00bh,046h,00bh
     153.  00:559A  F4 0A 03 0B 12 0B 22 0B 34 0B 46 0B 
     154.  00:55A6                            db    0adh,00ch,0b7h,00ch,0c2h,00ch,0cdh,00ch,0d9h,00ch,0e6h,00ch
     154.  00:55A6  AD 0C B7 0C C2 0C CD 0C D9 0C E6 0C 
     155.  00:55B2                            db    0f4h,00ch,003h,00dh,012h,00dh,022h,00dh,034h,00dh,046h,00dh
     155.  00:55B2  F4 0C 03 0D 12 0D 22 0D 34 0D 46 0D 
     156.  00:55BE                            db    0adh,00eh,0b7h,00eh,0c2h,00eh,0cdh,00eh,0d9h,00eh,0e6h,00eh
     156.  00:55BE  AD 0E B7 0E C2 0E CD 0E D9 0E E6 0E 
     157.  00:55CA                            db    0f4h,00eh,003h,00fh,012h,00fh,022h,00fh,034h,00fh,046h,00fh
     157.  00:55CA  F4 0E 03 0F 12 0F 22 0F 34 0F 46 0F 
     158.  00:55D6                      
     159.  00:55D6                      
     160.  00:55D6                      TRACK_Vibrato_sine:	; Sine table used for tremelo and vibrato
     161.  00:55D6                            db 	$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$01,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00		      ; depth 	1
     161.  00:55D6  00 00 00 00 00 00 00 00 00 00 01 01 01 01 01 01 
     161.  00:55E6  01 01 01 01 01 01 00 00 00 00 00 00 00 00 00 00 
     162.  00:55F6                            db 	$00,$00,$00,$00,$00,$00,$00,$01,$01,$01,$01,$01,$01,$02,$02,$02,$02,$02,$02,$01,$01,$01,$01,$01,$01,$00,$00,$00,$00,$00,$00,$00		      ; depth 	2
     162.  00:55F6  00 00 00 00 00 00 00 01 01 01 01 01 01 02 02 02 
     162.  00:5606  02 02 02 01 01 01 01 01 01 00 00 00 00 00 00 00 
     163.  00:5616                            db 	$00,$00,$00,$00,$00,$01,$01,$01,$01,$01,$02,$02,$02,$02,$03,$03,$03,$03,$02,$02,$02,$02,$01,$01,$01,$01,$01,$00,$00,$00,$00,$00		      ; depth 	3
     163.  00:5616  00 00 00 00 00 01 01 01 01 01 02 02 02 02 03 03 
     163.  00:5626  03 03 02 02 02 02 01 01 01 01 01 00 00 00 00 00 
     164.  00:5636                            db 	$00,$00,$00,$00,$00,$01,$01,$01,$01,$02,$02,$02,$03,$03,$04,$04,$04,$04,$03,$03,$02,$02,$02,$01,$01,$01,$01,$00,$00,$00,$00,$00		      ; depth 	4
     164.  00:5636  00 00 00 00 00 01 01 01 01 02 02 02 03 03 04 04 
     164.  00:5646  04 04 03 03 02 02 02 01 01 01 01 00 00 00 00 00 
     165.  00:5656                            db 	$00,$00,$00,$00,$01,$01,$01,$01,$02,$02,$03,$03,$04,$04,$05,$05,$05,$05,$04,$04,$03,$03,$02,$02,$01,$01,$01,$01,$00,$00,$00,$00		      ; depth 	5
     165.  00:5656  00 00 00 00 01 01 01 01 02 02 03 03 04 04 05 05 
     165.  00:5666  05 05 04 04 03 03 02 02 01 01 01 01 00 00 00 00 
     166.  00:5676                            db 	$00,$00,$00,$00,$01,$01,$01,$02,$02,$03,$03,$04,$04,$05,$05,$06,$06,$05,$05,$04,$04,$03,$03,$02,$02,$01,$01,$01,$00,$00,$00,$00		      ; depth 	6
     166.  00:5676  00 00 00 00 01 01 01 02 02 03 03 04 04 05 05 06 
     166.  00:5686  06 05 05 04 04 03 03 02 02 01 01 01 00 00 00 00 
     167.  00:5696                            db 	$00,$00,$00,$01,$01,$01,$02,$02,$03,$04,$04,$05,$06,$06,$07,$08,$08,$07,$06,$06,$05,$04,$04,$03,$02,$02,$01,$01,$01,$00,$00,$00		      ; depth 	7
     167.  00:5696  00 00 00 01 01 01 02 02 03 04 04 05 06 06 07 08 
     167.  00:56A6  08 07 06 06 05 04 04 03 02 02 01 01 01 00 00 00 
     168.  00:56B6                            db 	$00,$00,$01,$01,$01,$02,$03,$04,$05,$06,$07,$08,$09,$0A,$0C,$0D,$0D,$0C,$0A,$09,$08,$07,$06,$05,$04,$03,$02,$01,$01,$01,$00,$00		      ; depth 	8
     168.  00:56B6  00 00 01 01 01 02 03 04 05 06 07 08 09 0A 0C 0D 
     168.  00:56C6  0D 0C 0A 09 08 07 06 05 04 03 02 01 01 01 00 00 
     169.  00:56D6                            db 	$00,$00,$01,$02,$02,$04,$05,$06,$08,$09,$0B,$0D,$0F,$11,$13,$15,$15,$13,$11,$0F,$0D,$0B,$09,$08,$06,$05,$04,$02,$02,$01,$00,$00		      ; depth 	9
     169.  00:56D6  00 00 01 02 02 04 05 06 08 09 0B 0D 0F 11 13 15 
     169.  00:56E6  15 13 11 0F 0D 0B 09 08 06 05 04 02 02 01 00 00 
     170.  00:56F6                            db 	$00,$01,$01,$02,$04,$05,$07,$09,$0B,$0E,$10,$13,$16,$19,$1C,$1F,$1F,$1C,$19,$16,$13,$10,$0E,$0B,$09,$07,$05,$04,$02,$01,$01,$00		      ; depth 	A
     170.  00:56F6  00 01 01 02 04 05 07 09 0B 0E 10 13 16 19 1C 1F 
     170.  00:5706  1F 1C 19 16 13 10 0E 0B 09 07 05 04 02 01 01 00 
     171.  00:5716                            db 	$00,$01,$02,$03,$05,$08,$0B,$0E,$11,$15,$19,$1D,$21,$26,$2B,$2F,$2F,$2B,$26,$21,$1D,$19,$15,$11,$0E,$0B,$08,$05,$03,$02,$01,$00		      ; depth 	B
     171.  00:5716  00 01 02 03 05 08 0B 0E 11 15 19 1D 21 26 2B 2F 
     171.  00:5726  2F 2B 26 21 1D 19 15 11 0E 0B 08 05 03 02 01 00 
     172.  00:5736                            db 	$01,$01,$03,$05,$07,$0B,$0E,$12,$17,$1C,$21,$27,$2D,$33,$39,$3F,$3F,$39,$33,$2D,$27,$21,$1C,$17,$12,$0E,$0B,$07,$05,$03,$01,$01		      ; depth 	C
     172.  00:5736  01 01 03 05 07 0B 0E 12 17 1C 21 27 2D 33 39 3F 
     172.  00:5746  3F 39 33 2D 27 21 1C 17 12 0E 0B 07 05 03 01 01 
     561   00:5756                      ;	include	"..\ttsfxplay\ttsfxplay.asm"
     562   00:5756                      
     563   00:5756                      	
     564   00:5756                      demo_song:
     565   00:5756                      	include	".\tttest.asm"
       1.  00:5756                      ; Song: TT -TRIPLETS-SCC Converted to FM
       2.  00:5756                      ; By:   Gryzor87 (c)2021                
       3.  00:5756                      
       4.  00:5756                      ; [ Song start data ]
       5.  00:5756  06                  	db $06					; Initial song speed.
       6.  00:5757  C9 57               	dw .customvoice_start-8			; Start of the custom voices data.
       7.  00:5759  E1 57               	dw .drummacro_start				; Start of the drum macro data.
       8.  00:575B  08 58               	dw .instrument_start			; Start of the instrument data.
       9.  00:575D                      
      10.  00:575D                      ; [ Song order pointer list ]
      11.  00:575D                      .restart:
      12.  00:575D                      	dw .track_000, .track_000, .track_002, .track_002, .track_004, .track_005, .track_000, .track_000	; Step:001 Pattern:000
      12.  00:575D  3E 59 3E 59 41 59 41 59 43 59 97 59 3E 59 3E 59 
      13.  00:576D                      	dw .track_008, .track_009, .track_010, .track_011, .track_012, .track_013, .track_014, .track_015	; Step:002 Pattern:001
      13.  00:576D  E5 59 36 5A 5C 5A 5E 5A 86 5A AD 5A CC 5A EB 5A 
      14.  00:577D                      	dw .track_008, .track_009, .track_010, .track_011, .track_012, .track_013, .track_014, .track_015	; Step:003 Pattern:001
      14.  00:577D  E5 59 36 5A 5C 5A 5E 5A 86 5A AD 5A CC 5A EB 5A 
      15.  00:578D                      	dw .track_016, .track_009, .track_010, .track_011, .track_012, .track_021, .track_022, .track_023	; Step:004 Pattern:002
      15.  00:578D  12 5B 36 5A 5C 5A 5E 5A 86 5A 6F 5B 92 5B EB 5B 
      16.  00:579D                      	dw .track_016, .track_009, .track_010, .track_011, .track_012, .track_021, .track_022, .track_023	; Step:005 Pattern:002
      16.  00:579D  12 5B 36 5A 5C 5A 5E 5A 86 5A 6F 5B 92 5B EB 5B 
      17.  00:57AD                      	dw .track_008, .track_009, .track_010, .track_011, .track_012, .track_013, .track_014, .track_015	; Step:006 Pattern:001
      17.  00:57AD  E5 59 36 5A 5C 5A 5E 5A 86 5A AD 5A CC 5A EB 5A 
      18.  00:57BD                      	dw .track_024, .track_025, .track_026, .track_027, .track_028, .track_029, .track_030, .track_031	; Step:007 Pattern:003
      18.  00:57BD  3D 5C 4A 5C 55 5C 59 5C 67 5C 72 5C 7D 5C 88 5C 
      19.  00:57CD  00 00 5D 57         	dw 0x0000, .restart				; End of sequence delimiter + restart address.
      20.  00:57D1                      
      21.  00:57D1                      ; [ Custom FM voices ]
      22.  00:57D1                      .customvoice_start:
      23.  00:57D1                      	db $10,$14,$00,$04,$f1,$f1,$f1,$11 		; Custom voice:61
      23.  00:57D1  10 14 00 04 F1 F1 F1 11 
      24.  00:57D9                      	db $61,$62,$0e,$06,$f5,$f2,$0f,$fe 		; Custom voice:182
      24.  00:57D9  61 62 0E 06 F5 F2 0F FE 
      25.  00:57E1                      
      26.  00:57E1                      ; [ SCC Waveforms ]
      27.  00:57E1                      .waveform_start:
      28.  00:57E1                      
      29.  00:57E1                      ; [ FM Drum macros]
      30.  00:57E1                      .drummacro_start:
      31.  00:57E1  E7 57               	dw .drum_00
      32.  00:57E3  EA 57               	dw .drum_02
      33.  00:57E5  00 58               	dw .drum_04
      34.  00:57E7                      
      35.  00:57E7                      .drum_00:						; Drum 0. 
      36.  00:57E7  1E 10               	db $1e, $10							; Percussion
      37.  00:57E9  02                  	db $02							; STOP - End of Drum macro
      38.  00:57EA                      
      39.  00:57EA                      .drum_02:						; Drum 1. 
      40.  00:57EA  1E 18               	db $1e, $18							; Percussion
      41.  00:57EC  08 05               	db $08, $05							; volume HiHat
      42.  00:57EE  16 AD 02            	db $16, $ad, $02						; note Snare 
      43.  00:57F1  00                  	db $00							; END  - End of row
      44.  00:57F2  16 AD 00            	db $16, $ad, $00						; note Snare 
      45.  00:57F5  00                  	db $00							; END  - End of row
      46.  00:57F6  00                  	db $00							; END  - End of row
      47.  00:57F7  1E 08               	db $1e, $08							; Percussion
      48.  00:57F9  08 09               	db $08, $09							; volume HiHat
      49.  00:57FB  16 AD 00            	db $16, $ad, $00						; note Snare 
      50.  00:57FE  00                  	db $00							; END  - End of row
      51.  00:57FF  02                  	db $02							; STOP - End of Drum macro
      52.  00:5800                      
      53.  00:5800                      .drum_04:						; Drum 4. 
      54.  00:5800  1E 02               	db $1e, $02							; Percussion
      55.  00:5802  0E 02               	db $0e, $02							; volume Tom
      56.  00:5804  1A AD 04            	db $1a, $ad, $04						; note Cymbal 
      57.  00:5807  02                  	db $02							; STOP - End of Drum macro
      58.  00:5808                      
      59.  00:5808                      ; [ Instruments]
      60.  00:5808                      .instrument_start:
      61.  00:5808  20 58               	dw .instrument_00				; SD A3           
      62.  00:580A  4B 58               	dw .instrument_01				; HH CL A8        
      63.  00:580C  60 58               	dw .instrument_02				; TOM             
      64.  00:580E  95 58               	dw .instrument_03				; GTR CHORDS      
      65.  00:5810  9B 58               	dw .instrument_04				; SC String solo  
      66.  00:5812  A1 58               	dw .instrument_05				; SC Bass         
      67.  00:5814  B1 58               	dw .instrument_06				; SC Brass Satan  
      68.  00:5816  B7 58               	dw .instrument_07				; ARP SQ          
      69.  00:5818  C6 58               	dw .instrument_08				; Clarinet low    
      70.  00:581A  CB 58               	dw .instrument_09				; Response BELL   
      71.  00:581C  E3 58               	dw .instrument_10				; HH OP A8        
      72.  00:581E  13 59               	dw .instrument_11				; SD-MAIN         
      73.  00:5820                      
      74.  00:5820                      .instrument_00:					; SD A3           
      75.  00:5820  10                  	db $10					; FM Hardware Voice 1
      76.  00:5821  28                  	db $28			; Info byte: 00101000
      77.  00:5822  0F                  	db $0f			; Volume _
      78.  00:5823  E8                  	db $e8			; Info byte: 11101000
      79.  00:5824  08                  	db $08			; Volume _
      80.  00:5825  05                  	db $05			; Noise
      81.  00:5826  0F                  	db $0f			; Noise volume
      82.  00:5827  C8                  	db $c8			; Info byte: 11001000
      83.  00:5828  00                  	db $00			; Volume _
      84.  00:5829  04                  	db $04			; Noise
      85.  00:582A  0E                  	db $0e			; Noise volume
      86.  00:582B  C8                  	db $c8			; Info byte: 11001000
      87.  00:582C  00                  	db $00			; Volume _
      88.  00:582D  04                  	db $04			; Noise
      89.  00:582E  0D                  	db $0d			; Noise volume
      90.  00:582F  C8                  	db $c8			; Info byte: 11001000
      91.  00:5830  00                  	db $00			; Volume _
      92.  00:5831  04                  	db $04			; Noise
      93.  00:5832  0C                  	db $0c			; Noise volume
      94.  00:5833  C8                  	db $c8			; Info byte: 11001000
      95.  00:5834  00                  	db $00			; Volume _
      96.  00:5835  04                  	db $04			; Noise
      97.  00:5836  0A                  	db $0a			; Noise volume
      98.  00:5837  C8                  	db $c8			; Info byte: 11001000
      99.  00:5838  00                  	db $00			; Volume _
     100.  00:5839  04                  	db $04			; Noise
     101.  00:583A  08                  	db $08			; Noise volume
     102.  00:583B  C8                  	db $c8			; Info byte: 11001000
     103.  00:583C  00                  	db $00			; Volume _
     104.  00:583D  04                  	db $04			; Noise
     105.  00:583E  06                  	db $06			; Noise volume
     106.  00:583F  C8                  	db $c8			; Info byte: 11001000
     107.  00:5840  00                  	db $00			; Volume _
     108.  00:5841  04                  	db $04			; Noise
     109.  00:5842  04                  	db $04			; Noise volume
     110.  00:5843  C8                  	db $c8			; Info byte: 11001000
     111.  00:5844  00                  	db $00			; Volume _
     112.  00:5845  04                  	db $04			; Noise
     113.  00:5846  02                  	db $02			; Noise volume
     114.  00:5847                      .rst_i00:
     115.  00:5847  09                  	db $09			; Info byte: 00001001
     116.  00:5848  00                  	db $00			; Volume _
     117.  00:5849  47 58               	dw .rst_i00						; Loop address
     118.  00:584B                      .instrument_01:					; HH CL A8        
     119.  00:584B  70                  	db $70					; FM Hardware Voice 7
     120.  00:584C  C8                  	db $c8			; Info byte: 11001000
     121.  00:584D  00                  	db $00			; Volume _
     122.  00:584E  05                  	db $05			; Noise
     123.  00:584F  0A                  	db $0a			; Noise volume
     124.  00:5850  C8                  	db $c8			; Info byte: 11001000
     125.  00:5851  00                  	db $00			; Volume _
     126.  00:5852  04                  	db $04			; Noise
     127.  00:5853  0C                  	db $0c			; Noise volume
     128.  00:5854  C8                  	db $c8			; Info byte: 11001000
     129.  00:5855  00                  	db $00			; Volume _
     130.  00:5856  04                  	db $04			; Noise
     131.  00:5857  06                  	db $06			; Noise volume
     132.  00:5858  C8                  	db $c8			; Info byte: 11001000
     133.  00:5859  00                  	db $00			; Volume _
     134.  00:585A  04                  	db $04			; Noise
     135.  00:585B  02                  	db $02			; Noise volume
     136.  00:585C                      .rst_i01:
     137.  00:585C  09                  	db $09			; Info byte: 00001001
     138.  00:585D  00                  	db $00			; Volume _
     139.  00:585E  5C 58               	dw .rst_i01						; Loop address
     140.  00:5860                      .instrument_02:					; TOM             
     141.  00:5860  10                  	db $10					; FM Hardware Voice 1
     142.  00:5861  38                  	db $38			; Info byte: 00111000
     143.  00:5862  0F                  	db $0f			; Volume _
     144.  00:5863  20 00               	dw $0020			; Tone
     145.  00:5865  38                  	db $38			; Info byte: 00111000
     146.  00:5866  0D                  	db $0d			; Volume _
     147.  00:5867  20 00               	dw $0020			; Tone
     148.  00:5869  3C                  	db $3c			; Info byte: 00111100
     149.  00:586A  FF                  	db $ff			; Volume -
     150.  00:586B  20 00               	dw $0020			; Tone
     151.  00:586D  30                  	db $30			; Info byte: 00110000
     152.  00:586E  20 00               	dw $0020			; Tone
     153.  00:5870  3C                  	db $3c			; Info byte: 00111100
     154.  00:5871  FF                  	db $ff			; Volume -
     155.  00:5872  20 00               	dw $0020			; Tone
     156.  00:5874  30                  	db $30			; Info byte: 00110000
     157.  00:5875  20 00               	dw $0020			; Tone
     158.  00:5877  3C                  	db $3c			; Info byte: 00111100
     159.  00:5878  FF                  	db $ff			; Volume -
     160.  00:5879  20 00               	dw $0020			; Tone
     161.  00:587B  30                  	db $30			; Info byte: 00110000
     162.  00:587C  20 00               	dw $0020			; Tone
     163.  00:587E  30                  	db $30			; Info byte: 00110000
     164.  00:587F  20 00               	dw $0020			; Tone
     165.  00:5881  3C                  	db $3c			; Info byte: 00111100
     166.  00:5882  FF                  	db $ff			; Volume -
     167.  00:5883  20 00               	dw $0020			; Tone
     168.  00:5885  3C                  	db $3c			; Info byte: 00111100
     169.  00:5886  FF                  	db $ff			; Volume -
     170.  00:5887  20 00               	dw $0020			; Tone
     171.  00:5889  3C                  	db $3c			; Info byte: 00111100
     172.  00:588A  FF                  	db $ff			; Volume -
     173.  00:588B  20 00               	dw $0020			; Tone
     174.  00:588D  3C                  	db $3c			; Info byte: 00111100
     175.  00:588E  FF                  	db $ff			; Volume -
     176.  00:588F  20 00               	dw $0020			; Tone
     177.  00:5891                      .rst_i02:
     178.  00:5891  09                  	db $09			; Info byte: 00001001
     179.  00:5892  00                  	db $00			; Volume _
     180.  00:5893  91 58               	dw .rst_i02						; Loop address
     181.  00:5895                      .instrument_03:					; GTR CHORDS      
     182.  00:5895  00 04               	db $00,$04					; FM Software Voice 0
     183.  00:5897                      .rst_i03:
     184.  00:5897  29                  	db $29			; Info byte: 00101001
     185.  00:5898  0F                  	db $0f			; Volume _
     186.  00:5899  97 58               	dw .rst_i03						; Loop address
     187.  00:589B                      .instrument_04:					; SC String solo  
     188.  00:589B  00 08               	db $00,$08					; FM Software Voice 1
     189.  00:589D                      .rst_i04:
     190.  00:589D  29                  	db $29			; Info byte: 00101001
     191.  00:589E  0F                  	db $0f			; Volume _
     192.  00:589F  9D 58               	dw .rst_i04						; Loop address
     193.  00:58A1                      .instrument_05:					; SC Bass         
     194.  00:58A1  E0                  	db $e0					; FM Hardware Voice 14
     195.  00:58A2  28                  	db $28			; Info byte: 00101000
     196.  00:58A3  0F                  	db $0f			; Volume _
     197.  00:58A4  28                  	db $28			; Info byte: 00101000
     198.  00:58A5  0F                  	db $0f			; Volume _
     199.  00:58A6  28                  	db $28			; Info byte: 00101000
     200.  00:58A7  0F                  	db $0f			; Volume _
     201.  00:58A8  28                  	db $28			; Info byte: 00101000
     202.  00:58A9  0F                  	db $0f			; Volume _
     203.  00:58AA                      .rst_i05:
     204.  00:58AA  2C                  	db $2c			; Info byte: 00101100
     205.  00:58AB  FF                  	db $ff			; Volume -
     206.  00:58AC  20                  	db $20			; Info byte: 00100000
     207.  00:58AD  20                  	db $20			; Info byte: 00100000
     208.  00:58AE  21                  	db $21			; Info byte: 00100001
     209.  00:58AF  AA 58               	dw .rst_i05						; Loop address
     210.  00:58B1                      .instrument_06:					; SC Brass Satan  
     211.  00:58B1  00 04               	db $00,$04					; FM Software Voice 0
     212.  00:58B3                      .rst_i06:
     213.  00:58B3  29                  	db $29			; Info byte: 00101001
     214.  00:58B4  0F                  	db $0f			; Volume _
     215.  00:58B5  B3 58               	dw .rst_i06						; Loop address
     216.  00:58B7                      .instrument_07:					; ARP SQ          
     217.  00:58B7  C0                  	db $c0					; FM Hardware Voice 12
     218.  00:58B8  28                  	db $28			; Info byte: 00101000
     219.  00:58B9  0E                  	db $0e			; Volume _
     220.  00:58BA  28                  	db $28			; Info byte: 00101000
     221.  00:58BB  0E                  	db $0e			; Volume _
     222.  00:58BC  28                  	db $28			; Info byte: 00101000
     223.  00:58BD  0E                  	db $0e			; Volume _
     224.  00:58BE  28                  	db $28			; Info byte: 00101000
     225.  00:58BF  0E                  	db $0e			; Volume _
     226.  00:58C0  28                  	db $28			; Info byte: 00101000
     227.  00:58C1  0E                  	db $0e			; Volume _
     228.  00:58C2                      .rst_i07:
     229.  00:58C2  09                  	db $09			; Info byte: 00001001
     230.  00:58C3  00                  	db $00			; Volume _
     231.  00:58C4  C2 58               	dw .rst_i07						; Loop address
     232.  00:58C6                      .instrument_08:					; Clarinet low    
     233.  00:58C6  50                  	db $50					; FM Hardware Voice 5
     234.  00:58C7                      .rst_i08:
     235.  00:58C7  29                  	db $29			; Info byte: 00101001
     236.  00:58C8  0D                  	db $0d			; Volume _
     237.  00:58C9  C7 58               	dw .rst_i08						; Loop address
     238.  00:58CB                      .instrument_09:					; Response BELL   
     239.  00:58CB  D0                  	db $d0					; FM Hardware Voice 13
     240.  00:58CC  28                  	db $28			; Info byte: 00101000
     241.  00:58CD  0D                  	db $0d			; Volume _
     242.  00:58CE  28                  	db $28			; Info byte: 00101000
     243.  00:58CF  0B                  	db $0b			; Volume _
     244.  00:58D0  28                  	db $28			; Info byte: 00101000
     245.  00:58D1  0A                  	db $0a			; Volume _
     246.  00:58D2                      .rst_i09:
     247.  00:58D2  2C                  	db $2c			; Info byte: 00101100
     248.  00:58D3  FF                  	db $ff			; Volume -
     249.  00:58D4  20                  	db $20			; Info byte: 00100000
     250.  00:58D5  20                  	db $20			; Info byte: 00100000
     251.  00:58D6  20                  	db $20			; Info byte: 00100000
     252.  00:58D7  20                  	db $20			; Info byte: 00100000
     253.  00:58D8  20                  	db $20			; Info byte: 00100000
     254.  00:58D9  2C                  	db $2c			; Info byte: 00101100
     255.  00:58DA  01                  	db $01			; Volume +
     256.  00:58DB  20                  	db $20			; Info byte: 00100000
     257.  00:58DC  20                  	db $20			; Info byte: 00100000
     258.  00:58DD  20                  	db $20			; Info byte: 00100000
     259.  00:58DE  20                  	db $20			; Info byte: 00100000
     260.  00:58DF  2D                  	db $2d			; Info byte: 00101101
     261.  00:58E0  FF                  	db $ff			; Volume -
     262.  00:58E1  D2 58               	dw .rst_i09						; Loop address
     263.  00:58E3                      .instrument_10:					; HH OP A8        
     264.  00:58E3  01                  	db $01					; FM Hardware Voice was not set
     265.  00:58E4  C8                  	db $c8			; Info byte: 11001000
     266.  00:58E5  0E                  	db $0e			; Volume _
     267.  00:58E6  04                  	db $04			; Noise
     268.  00:58E7  08                  	db $08			; Noise volume
     269.  00:58E8  CC                  	db $cc			; Info byte: 11001100
     270.  00:58E9  FF                  	db $ff			; Volume -
     271.  00:58EA  04                  	db $04			; Noise
     272.  00:58EB  08                  	db $08			; Noise volume
     273.  00:58EC  C0                  	db $c0			; Info byte: 11000000
     274.  00:58ED  04                  	db $04			; Noise
     275.  00:58EE  07                  	db $07			; Noise volume
     276.  00:58EF  C0                  	db $c0			; Info byte: 11000000
     277.  00:58F0  04                  	db $04			; Noise
     278.  00:58F1  07                  	db $07			; Noise volume
     279.  00:58F2  C0                  	db $c0			; Info byte: 11000000
     280.  00:58F3  04                  	db $04			; Noise
     281.  00:58F4  06                  	db $06			; Noise volume
     282.  00:58F5  C8                  	db $c8			; Info byte: 11001000
     283.  00:58F6  00                  	db $00			; Volume _
     284.  00:58F7  04                  	db $04			; Noise
     285.  00:58F8  06                  	db $06			; Noise volume
     286.  00:58F9  C8                  	db $c8			; Info byte: 11001000
     287.  00:58FA  00                  	db $00			; Volume _
     288.  00:58FB  04                  	db $04			; Noise
     289.  00:58FC  05                  	db $05			; Noise volume
     290.  00:58FD  C8                  	db $c8			; Info byte: 11001000
     291.  00:58FE  00                  	db $00			; Volume _
     292.  00:58FF  04                  	db $04			; Noise
     293.  00:5900  05                  	db $05			; Noise volume
     294.  00:5901  C8                  	db $c8			; Info byte: 11001000
     295.  00:5902  00                  	db $00			; Volume _
     296.  00:5903  04                  	db $04			; Noise
     297.  00:5904  04                  	db $04			; Noise volume
     298.  00:5905  C8                  	db $c8			; Info byte: 11001000
     299.  00:5906  00                  	db $00			; Volume _
     300.  00:5907  04                  	db $04			; Noise
     301.  00:5908  04                  	db $04			; Noise volume
     302.  00:5909  C8                  	db $c8			; Info byte: 11001000
     303.  00:590A  00                  	db $00			; Volume _
     304.  00:590B  04                  	db $04			; Noise
     305.  00:590C  03                  	db $03			; Noise volume
     306.  00:590D                      .rst_i10:
     307.  00:590D  C9                  	db $c9			; Info byte: 11001001
     308.  00:590E  00                  	db $00			; Volume _
     309.  00:590F  04                  	db $04			; Noise
     310.  00:5910  03                  	db $03			; Noise volume
     311.  00:5911  0D 59               	dw .rst_i10						; Loop address
     312.  00:5913                      .instrument_11:					; SD-MAIN         
     313.  00:5913  10                  	db $10					; FM Hardware Voice 1
     314.  00:5914  28                  	db $28			; Info byte: 00101000
     315.  00:5915  0E                  	db $0e			; Volume _
     316.  00:5916  C8                  	db $c8			; Info byte: 11001000
     317.  00:5917  0C                  	db $0c			; Volume _
     318.  00:5918  06                  	db $06			; Noise
     319.  00:5919  0C                  	db $0c			; Noise volume
     320.  00:591A  C8                  	db $c8			; Info byte: 11001000
     321.  00:591B  0A                  	db $0a			; Volume _
     322.  00:591C  05                  	db $05			; Noise
     323.  00:591D  0A                  	db $0a			; Noise volume
     324.  00:591E  C8                  	db $c8			; Info byte: 11001000
     325.  00:591F  0A                  	db $0a			; Volume _
     326.  00:5920  05                  	db $05			; Noise
     327.  00:5921  0A                  	db $0a			; Noise volume
     328.  00:5922  C8                  	db $c8			; Info byte: 11001000
     329.  00:5923  09                  	db $09			; Volume _
     330.  00:5924  05                  	db $05			; Noise
     331.  00:5925  09                  	db $09			; Noise volume
     332.  00:5926  C8                  	db $c8			; Info byte: 11001000
     333.  00:5927  09                  	db $09			; Volume _
     334.  00:5928  05                  	db $05			; Noise
     335.  00:5929  08                  	db $08			; Noise volume
     336.  00:592A  C8                  	db $c8			; Info byte: 11001000
     337.  00:592B  08                  	db $08			; Volume _
     338.  00:592C  04                  	db $04			; Noise
     339.  00:592D  07                  	db $07			; Noise volume
     340.  00:592E  C8                  	db $c8			; Info byte: 11001000
     341.  00:592F  08                  	db $08			; Volume _
     342.  00:5930  04                  	db $04			; Noise
     343.  00:5931  06                  	db $06			; Noise volume
     344.  00:5932  C8                  	db $c8			; Info byte: 11001000
     345.  00:5933  07                  	db $07			; Volume _
     346.  00:5934  04                  	db $04			; Noise
     347.  00:5935  05                  	db $05			; Noise volume
     348.  00:5936  C8                  	db $c8			; Info byte: 11001000
     349.  00:5937  07                  	db $07			; Volume _
     350.  00:5938  04                  	db $04			; Noise
     351.  00:5939  04                  	db $04			; Noise volume
     352.  00:593A                      .rst_i11:
     353.  00:593A  09                  	db $09			; Info byte: 00001001
     354.  00:593B  00                  	db $00			; Volume _
     355.  00:593C  3A 59               	dw .rst_i11						; Loop address
     356.  00:593E                      
     357.  00:593E                      ; [ Song track data ]
     358.  00:593E                      .track_000:
     359.  00:593E  60                  	db $60			;Release 96
     360.  00:593F  DF                  	db $df			;Wait 32
     361.  00:5940  BF                  	db $bf			;[End-Of-Track]
     362.  00:5941                      .track_002:
     363.  00:5941  DF                  	db $df			;Wait 32
     364.  00:5942  BF                  	db $bf			;[End-Of-Track]
     365.  00:5943                      .track_004:
     366.  00:5943  52                  	db $52			;Note A#7
     367.  00:5944  6F                  	db $6f			;Volume 14
     368.  00:5945  78                  	db $78			;Instrument 7
     369.  00:5946  C0                  	db $c0			;Wait 1
     370.  00:5947  4F                  	db $4f			;Note G-7
     371.  00:5948  9A 02               	db $9a,$02			;CMD Note delay
     372.  00:594A                      					;Wait Repeat 1
     373.  00:594A  4D                  	db $4d			;Note F-7
     374.  00:594B  9A 03               	db $9a,$03			;CMD Note delay
     375.  00:594D  C1                  	db $c1			;Wait 2
     376.  00:594E  4A                  	db $4a			;Note D-7
     377.  00:594F  C0                  	db $c0			;Wait 1
     378.  00:5950  46                  	db $46			;Note A#6
     379.  00:5951  9A 02               	db $9a,$02			;CMD Note delay
     380.  00:5953                      					;Wait Repeat 1
     381.  00:5953  43                  	db $43			;Note G-6
     382.  00:5954  9A 03               	db $9a,$03			;CMD Note delay
     383.  00:5956  C1                  	db $c1			;Wait 2
     384.  00:5957  52                  	db $52			;Note A#7
     385.  00:5958  6B                  	db $6b			;Volume 10
     386.  00:5959  A1 08               	db $a1,$08			;CMD Track detune
     387.  00:595B  C0                  	db $c0			;Wait 1
     388.  00:595C  4F                  	db $4f			;Note G-7
     389.  00:595D  9A 02               	db $9a,$02			;CMD Note delay
     390.  00:595F                      					;Wait Repeat 1
     391.  00:595F  4D                  	db $4d			;Note F-7
     392.  00:5960  9A 03               	db $9a,$03			;CMD Note delay
     393.  00:5962  C1                  	db $c1			;Wait 2
     394.  00:5963  4A                  	db $4a			;Note D-7
     395.  00:5964  C0                  	db $c0			;Wait 1
     396.  00:5965  46                  	db $46			;Note A#6
     397.  00:5966  9A 02               	db $9a,$02			;CMD Note delay
     398.  00:5968                      					;Wait Repeat 1
     399.  00:5968  43                  	db $43			;Note G-6
     400.  00:5969  9A 03               	db $9a,$03			;CMD Note delay
     401.  00:596B  C1                  	db $c1			;Wait 2
     402.  00:596C  52                  	db $52			;Note A#7
     403.  00:596D  6B                  	db $6b			;Volume 10
     404.  00:596E  A6 50               	db $a6,$50			;CMD Channel setup
     405.  00:5970  C0                  	db $c0			;Wait 1
     406.  00:5971  4F                  	db $4f			;Note G-7
     407.  00:5972  9A 02               	db $9a,$02			;CMD Note delay
     408.  00:5974                      					;Wait Repeat 1
     409.  00:5974  4D                  	db $4d			;Note F-7
     410.  00:5975  9A 03               	db $9a,$03			;CMD Note delay
     411.  00:5977  C1                  	db $c1			;Wait 2
     412.  00:5978  4A                  	db $4a			;Note D-7
     413.  00:5979  C0                  	db $c0			;Wait 1
     414.  00:597A  46                  	db $46			;Note A#6
     415.  00:597B  9A 02               	db $9a,$02			;CMD Note delay
     416.  00:597D                      					;Wait Repeat 1
     417.  00:597D  43                  	db $43			;Note G-6
     418.  00:597E  9A 03               	db $9a,$03			;CMD Note delay
     419.  00:5980  C1                  	db $c1			;Wait 2
     420.  00:5981  52                  	db $52			;Note A#7
     421.  00:5982  67                  	db $67			;Volume 6
     422.  00:5983  A1 08               	db $a1,$08			;CMD Track detune
     423.  00:5985  C0                  	db $c0			;Wait 1
     424.  00:5986  4F                  	db $4f			;Note G-7
     425.  00:5987  9A 02               	db $9a,$02			;CMD Note delay
     426.  00:5989                      					;Wait Repeat 1
     427.  00:5989  4D                  	db $4d			;Note F-7
     428.  00:598A  9A 03               	db $9a,$03			;CMD Note delay
     429.  00:598C  C1                  	db $c1			;Wait 2
     430.  00:598D  4A                  	db $4a			;Note D-7
     431.  00:598E  C0                  	db $c0			;Wait 1
     432.  00:598F  46                  	db $46			;Note A#6
     433.  00:5990  9A 02               	db $9a,$02			;CMD Note delay
     434.  00:5992                      					;Wait Repeat 1
     435.  00:5992  43                  	db $43			;Note G-6
     436.  00:5993  9A 03               	db $9a,$03			;CMD Note delay
     437.  00:5995  C1                  	db $c1			;Wait 2
     438.  00:5996  BF                  	db $bf			;[End-Of-Track]
     439.  00:5997                      .track_005:
     440.  00:5997  60                  	db $60			;Release 96
     441.  00:5998  C2                  	db $c2			;Wait 3
     442.  00:5999  52                  	db $52			;Note A#7
     443.  00:599A  67                  	db $67			;Volume 6
     444.  00:599B  78                  	db $78			;Instrument 7
     445.  00:599C  C0                  	db $c0			;Wait 1
     446.  00:599D  4F                  	db $4f			;Note G-7
     447.  00:599E  9A 02               	db $9a,$02			;CMD Note delay
     448.  00:59A0                      					;Wait Repeat 1
     449.  00:59A0  4D                  	db $4d			;Note F-7
     450.  00:59A1  9A 03               	db $9a,$03			;CMD Note delay
     451.  00:59A3  C1                  	db $c1			;Wait 2
     452.  00:59A4  4A                  	db $4a			;Note D-7
     453.  00:59A5  C0                  	db $c0			;Wait 1
     454.  00:59A6  46                  	db $46			;Note A#6
     455.  00:59A7  9A 02               	db $9a,$02			;CMD Note delay
     456.  00:59A9                      					;Wait Repeat 1
     457.  00:59A9  43                  	db $43			;Note G-6
     458.  00:59AA  9A 03               	db $9a,$03			;CMD Note delay
     459.  00:59AC  C1                  	db $c1			;Wait 2
     460.  00:59AD  52                  	db $52			;Note A#7
     461.  00:59AE  66                  	db $66			;Volume 5
     462.  00:59AF  A1 08               	db $a1,$08			;CMD Track detune
     463.  00:59B1  C0                  	db $c0			;Wait 1
     464.  00:59B2  4F                  	db $4f			;Note G-7
     465.  00:59B3  9A 02               	db $9a,$02			;CMD Note delay
     466.  00:59B5                      					;Wait Repeat 1
     467.  00:59B5  4D                  	db $4d			;Note F-7
     468.  00:59B6  9A 03               	db $9a,$03			;CMD Note delay
     469.  00:59B8  C1                  	db $c1			;Wait 2
     470.  00:59B9  4A                  	db $4a			;Note D-7
     471.  00:59BA  C0                  	db $c0			;Wait 1
     472.  00:59BB  46                  	db $46			;Note A#6
     473.  00:59BC  9A 02               	db $9a,$02			;CMD Note delay
     474.  00:59BE                      					;Wait Repeat 1
     475.  00:59BE  43                  	db $43			;Note G-6
     476.  00:59BF  9A 03               	db $9a,$03			;CMD Note delay
     477.  00:59C1  C1                  	db $c1			;Wait 2
     478.  00:59C2  52                  	db $52			;Note A#7
     479.  00:59C3  65                  	db $65			;Volume 4
     480.  00:59C4  A6 50               	db $a6,$50			;CMD Channel setup
     481.  00:59C6  C0                  	db $c0			;Wait 1
     482.  00:59C7  4F                  	db $4f			;Note G-7
     483.  00:59C8  9A 02               	db $9a,$02			;CMD Note delay
     484.  00:59CA                      					;Wait Repeat 1
     485.  00:59CA  4D                  	db $4d			;Note F-7
     486.  00:59CB  9A 03               	db $9a,$03			;CMD Note delay
     487.  00:59CD  C1                  	db $c1			;Wait 2
     488.  00:59CE  4A                  	db $4a			;Note D-7
     489.  00:59CF  C0                  	db $c0			;Wait 1
     490.  00:59D0  46                  	db $46			;Note A#6
     491.  00:59D1  9A 02               	db $9a,$02			;CMD Note delay
     492.  00:59D3                      					;Wait Repeat 1
     493.  00:59D3  43                  	db $43			;Note G-6
     494.  00:59D4  9A 03               	db $9a,$03			;CMD Note delay
     495.  00:59D6  C1                  	db $c1			;Wait 2
     496.  00:59D7  52                  	db $52			;Note A#7
     497.  00:59D8  64                  	db $64			;Volume 3
     498.  00:59D9  A1 08               	db $a1,$08			;CMD Track detune
     499.  00:59DB  C0                  	db $c0			;Wait 1
     500.  00:59DC  4F                  	db $4f			;Note G-7
     501.  00:59DD  9A 02               	db $9a,$02			;CMD Note delay
     502.  00:59DF                      					;Wait Repeat 1
     503.  00:59DF  4D                  	db $4d			;Note F-7
     504.  00:59E0  9A 03               	db $9a,$03			;CMD Note delay
     505.  00:59E2  C1                  	db $c1			;Wait 2
     506.  00:59E3  4A                  	db $4a			;Note D-7
     507.  00:59E4  BF                  	db $bf			;[End-Of-Track]
     508.  00:59E5                      .track_008:
     509.  00:59E5  9C 00               	db $9c,$00			;CMD Drum $01
     510.  00:59E7  C3                  	db $c3			;Wait 4
     511.  00:59E8  5D                  	db $5d			;Note A-8
     512.  00:59E9  6D                  	db $6d			;Volume 12
     513.  00:59EA  72                  	db $72			;Instrument 1
     514.  00:59EB  C1                  	db $c1			;Wait 2
     515.  00:59EC  9C 00               	db $9c,$00			;CMD Drum $01
     516.  00:59EE                      					;Wait Repeat 2
     517.  00:59EE  21                  	db $21			;Note A-3
     518.  00:59EF  70                  	db $70			;Volume 15
     519.  00:59F0  7C                  	db $7c			;Instrument 11
     520.  00:59F1  9C 02               	db $9c,$02			;CMD Drum $02
     521.  00:59F3                      					;Wait Repeat 2
     522.  00:59F3  5D                  	db $5d			;Note A-8
     523.  00:59F4  6D                  	db $6d			;Volume 12
     524.  00:59F5  72                  	db $72			;Instrument 1
     525.  00:59F6  C1                  	db $c1			;Wait 2
     526.  00:59F7  9C 00               	db $9c,$00			;CMD Drum $01
     527.  00:59F9  C3                  	db $c3			;Wait 4
     528.  00:59FA  2F                  	db $2f			;Note B-4
     529.  00:59FB  6E                  	db $6e			;Volume 13
     530.  00:59FC  73                  	db $73			;Instrument 2
     531.  00:59FD  C0                  	db $c0			;Wait 1
     532.  00:59FE  2F                  	db $2f			;Note B-4
     533.  00:59FF  C3                  	db $c3			;Wait 4
     534.  00:5A00  29                  	db $29			;Note F-4
     535.  00:5A01  9A 03               	db $9a,$03			;CMD Note delay
     536.  00:5A03  C4                  	db $c4			;Wait 5
     537.  00:5A04  26                  	db $26			;Note D-4
     538.  00:5A05  9A 05               	db $9a,$05			;CMD Note delay
     539.  00:5A07  C5                  	db $c5			;Wait 6
     540.  00:5A08  9C 00               	db $9c,$00			;CMD Drum $01
     541.  00:5A0A  C3                  	db $c3			;Wait 4
     542.  00:5A0B  5D                  	db $5d			;Note A-8
     543.  00:5A0C  6D                  	db $6d			;Volume 12
     544.  00:5A0D  72                  	db $72			;Instrument 1
     545.  00:5A0E  C1                  	db $c1			;Wait 2
     546.  00:5A0F  9C 00               	db $9c,$00			;CMD Drum $01
     547.  00:5A11                      					;Wait Repeat 2
     548.  00:5A11  21                  	db $21			;Note A-3
     549.  00:5A12  70                  	db $70			;Volume 15
     550.  00:5A13  7C                  	db $7c			;Instrument 11
     551.  00:5A14  9C 02               	db $9c,$02			;CMD Drum $02
     552.  00:5A16                      					;Wait Repeat 2
     553.  00:5A16  5D                  	db $5d			;Note A-8
     554.  00:5A17  6D                  	db $6d			;Volume 12
     555.  00:5A18  72                  	db $72			;Instrument 1
     556.  00:5A19  C1                  	db $c1			;Wait 2
     557.  00:5A1A  9C 00               	db $9c,$00			;CMD Drum $01
     558.  00:5A1C  C3                  	db $c3			;Wait 4
     559.  00:5A1D  5D                  	db $5d			;Note A-8
     560.  00:5A1E  6D                  	db $6d			;Volume 12
     561.  00:5A1F  C3                  	db $c3			;Wait 4
     562.  00:5A20  9C 00               	db $9c,$00			;CMD Drum $01
     563.  00:5A22                      					;Wait Repeat 4
     564.  00:5A22  21                  	db $21			;Note A-3
     565.  00:5A23  70                  	db $70			;Volume 15
     566.  00:5A24  7C                  	db $7c			;Instrument 11
     567.  00:5A25  9C 02               	db $9c,$02			;CMD Drum $02
     568.  00:5A27  C1                  	db $c1			;Wait 2
     569.  00:5A28  5D                  	db $5d			;Note A-8
     570.  00:5A29  6D                  	db $6d			;Volume 12
     571.  00:5A2A  72                  	db $72			;Instrument 1
     572.  00:5A2B  C1                  	db $c1			;Wait 2
     573.  00:5A2C  5D                  	db $5d			;Note A-8
     574.  00:5A2D  6F                  	db $6f			;Volume 14
     575.  00:5A2E  7B                  	db $7b			;Instrument 10
     576.  00:5A2F  9C 04               	db $9c,$04			;CMD Drum $05
     577.  00:5A31                      					;Wait Repeat 2
     578.  00:5A31  21                  	db $21			;Note A-3
     579.  00:5A32  6D                  	db $6d			;Volume 12
     580.  00:5A33  71                  	db $71			;Instrument 0
     581.  00:5A34  C1                  	db $c1			;Wait 2
     582.  00:5A35  BF                  	db $bf			;[End-Of-Track]
     583.  00:5A36                      .track_009:
     584.  00:5A36                      			;CMD 8 Unused [WARNING]
     585.  00:5A36  C2                  	db $c2			;Wait 3
     586.  00:5A37  47                  	db $47			;Note B-6
     587.  00:5A38  66                  	db $66			;Volume 5
     588.  00:5A39  7A                  	db $7a			;Instrument 9
     589.  00:5A3A  A1 08               	db $a1,$08			;CMD Track detune
     590.  00:5A3C  C1                  	db $c1			;Wait 2
     591.  00:5A3D  42                  	db $42			;Note F#6
     592.  00:5A3E                      					;Wait Repeat 2
     593.  00:5A3E  3B                  	db $3b			;Note B-5
     594.  00:5A3F                      					;Wait Repeat 2
     595.  00:5A3F  42                  	db $42			;Note F#6
     596.  00:5A40                      					;Wait Repeat 2
     597.  00:5A40  47                  	db $47			;Note B-6
     598.  00:5A41                      					;Wait Repeat 2
     599.  00:5A41  42                  	db $42			;Note F#6
     600.  00:5A42                      					;Wait Repeat 2
     601.  00:5A42  47                  	db $47			;Note B-6
     602.  00:5A43                      					;Wait Repeat 2
     603.  00:5A43  42                  	db $42			;Note F#6
     604.  00:5A44                      					;Wait Repeat 2
     605.  00:5A44  3B                  	db $3b			;Note B-5
     606.  00:5A45                      					;Wait Repeat 2
     607.  00:5A45  42                  	db $42			;Note F#6
     608.  00:5A46                      					;Wait Repeat 2
     609.  00:5A46  47                  	db $47			;Note B-6
     610.  00:5A47                      					;Wait Repeat 2
     611.  00:5A47  42                  	db $42			;Note F#6
     612.  00:5A48                      					;Wait Repeat 2
     613.  00:5A48  47                  	db $47			;Note B-6
     614.  00:5A49                      					;Wait Repeat 2
     615.  00:5A49  42                  	db $42			;Note F#6
     616.  00:5A4A                      					;Wait Repeat 2
     617.  00:5A4A  3B                  	db $3b			;Note B-5
     618.  00:5A4B                      					;Wait Repeat 2
     619.  00:5A4B  42                  	db $42			;Note F#6
     620.  00:5A4C                      					;Wait Repeat 2
     621.  00:5A4C  47                  	db $47			;Note B-6
     622.  00:5A4D                      					;Wait Repeat 2
     623.  00:5A4D  42                  	db $42			;Note F#6
     624.  00:5A4E                      					;Wait Repeat 2
     625.  00:5A4E  3B                  	db $3b			;Note B-5
     626.  00:5A4F                      					;Wait Repeat 2
     627.  00:5A4F  42                  	db $42			;Note F#6
     628.  00:5A50                      					;Wait Repeat 2
     629.  00:5A50  47                  	db $47			;Note B-6
     630.  00:5A51                      					;Wait Repeat 2
     631.  00:5A51  42                  	db $42			;Note F#6
     632.  00:5A52                      					;Wait Repeat 2
     633.  00:5A52  47                  	db $47			;Note B-6
     634.  00:5A53                      					;Wait Repeat 2
     635.  00:5A53  42                  	db $42			;Note F#6
     636.  00:5A54                      					;Wait Repeat 2
     637.  00:5A54  3B                  	db $3b			;Note B-5
     638.  00:5A55                      					;Wait Repeat 2
     639.  00:5A55  42                  	db $42			;Note F#6
     640.  00:5A56                      					;Wait Repeat 2
     641.  00:5A56  47                  	db $47			;Note B-6
     642.  00:5A57                      					;Wait Repeat 2
     643.  00:5A57  42                  	db $42			;Note F#6
     644.  00:5A58                      					;Wait Repeat 2
     645.  00:5A58  47                  	db $47			;Note B-6
     646.  00:5A59                      					;Wait Repeat 2
     647.  00:5A59  42                  	db $42			;Note F#6
     648.  00:5A5A                      					;Wait Repeat 2
     649.  00:5A5A  3B                  	db $3b			;Note B-5
     650.  00:5A5B  BF                  	db $bf			;[End-Of-Track]
     651.  00:5A5C                      .track_010:
     652.  00:5A5C  FF                  	db $ff			;Wait 64
     653.  00:5A5D  BF                  	db $bf			;[End-Of-Track]
     654.  00:5A5E                      .track_011:
     655.  00:5A5E  53                  	db $53			;Note B-7
     656.  00:5A5F  6E                  	db $6e			;Volume 13
     657.  00:5A60  78                  	db $78			;Instrument 7
     658.  00:5A61  A1 08               	db $a1,$08			;CMD Track detune
     659.  00:5A63  C1                  	db $c1			;Wait 2
     660.  00:5A64  4E                  	db $4e			;Note F#7
     661.  00:5A65  6D                  	db $6d			;Volume 12
     662.  00:5A66                      					;Wait Repeat 2
     663.  00:5A66  47                  	db $47			;Note B-6
     664.  00:5A67                      					;Wait Repeat 2
     665.  00:5A67  4E                  	db $4e			;Note F#7
     666.  00:5A68                      					;Wait Repeat 2
     667.  00:5A68  53                  	db $53			;Note B-7
     668.  00:5A69                      					;Wait Repeat 2
     669.  00:5A69  4E                  	db $4e			;Note F#7
     670.  00:5A6A                      					;Wait Repeat 2
     671.  00:5A6A  53                  	db $53			;Note B-7
     672.  00:5A6B                      					;Wait Repeat 2
     673.  00:5A6B  4E                  	db $4e			;Note F#7
     674.  00:5A6C                      					;Wait Repeat 2
     675.  00:5A6C  47                  	db $47			;Note B-6
     676.  00:5A6D                      					;Wait Repeat 2
     677.  00:5A6D  4E                  	db $4e			;Note F#7
     678.  00:5A6E                      					;Wait Repeat 2
     679.  00:5A6E  53                  	db $53			;Note B-7
     680.  00:5A6F                      					;Wait Repeat 2
     681.  00:5A6F  4E                  	db $4e			;Note F#7
     682.  00:5A70                      					;Wait Repeat 2
     683.  00:5A70  53                  	db $53			;Note B-7
     684.  00:5A71                      					;Wait Repeat 2
     685.  00:5A71  4E                  	db $4e			;Note F#7
     686.  00:5A72                      					;Wait Repeat 2
     687.  00:5A72  47                  	db $47			;Note B-6
     688.  00:5A73                      					;Wait Repeat 2
     689.  00:5A73  4E                  	db $4e			;Note F#7
     690.  00:5A74                      					;Wait Repeat 2
     691.  00:5A74  53                  	db $53			;Note B-7
     692.  00:5A75                      					;Wait Repeat 2
     693.  00:5A75  4E                  	db $4e			;Note F#7
     694.  00:5A76                      					;Wait Repeat 2
     695.  00:5A76  47                  	db $47			;Note B-6
     696.  00:5A77                      					;Wait Repeat 2
     697.  00:5A77  4E                  	db $4e			;Note F#7
     698.  00:5A78                      					;Wait Repeat 2
     699.  00:5A78  53                  	db $53			;Note B-7
     700.  00:5A79                      					;Wait Repeat 2
     701.  00:5A79  4E                  	db $4e			;Note F#7
     702.  00:5A7A                      					;Wait Repeat 2
     703.  00:5A7A  53                  	db $53			;Note B-7
     704.  00:5A7B                      					;Wait Repeat 2
     705.  00:5A7B  4E                  	db $4e			;Note F#7
     706.  00:5A7C                      					;Wait Repeat 2
     707.  00:5A7C  47                  	db $47			;Note B-6
     708.  00:5A7D                      					;Wait Repeat 2
     709.  00:5A7D  4E                  	db $4e			;Note F#7
     710.  00:5A7E                      					;Wait Repeat 2
     711.  00:5A7E  53                  	db $53			;Note B-7
     712.  00:5A7F                      					;Wait Repeat 2
     713.  00:5A7F  4E                  	db $4e			;Note F#7
     714.  00:5A80                      					;Wait Repeat 2
     715.  00:5A80  53                  	db $53			;Note B-7
     716.  00:5A81                      					;Wait Repeat 2
     717.  00:5A81  4E                  	db $4e			;Note F#7
     718.  00:5A82                      					;Wait Repeat 2
     719.  00:5A82  47                  	db $47			;Note B-6
     720.  00:5A83                      					;Wait Repeat 2
     721.  00:5A83  4E                  	db $4e			;Note F#7
     722.  00:5A84  C1                  	db $c1			;Wait 2
     723.  00:5A85  BF                  	db $bf			;[End-Of-Track]
     724.  00:5A86                      .track_012:
     725.  00:5A86  17                  	db $17			;Note B-2
     726.  00:5A87  6E                  	db $6e			;Volume 13
     727.  00:5A88  76                  	db $76			;Instrument 5
     728.  00:5A89  C3                  	db $c3			;Wait 4
     729.  00:5A8A  17                  	db $17			;Note B-2
     730.  00:5A8B  C1                  	db $c1			;Wait 2
     731.  00:5A8C  17                  	db $17			;Note B-2
     732.  00:5A8D                      					;Wait Repeat 2
     733.  00:5A8D  23                  	db $23			;Note B-3
     734.  00:5A8E  C3                  	db $c3			;Wait 4
     735.  00:5A8F  17                  	db $17			;Note B-2
     736.  00:5A90  C1                  	db $c1			;Wait 2
     737.  00:5A91  17                  	db $17			;Note B-2
     738.  00:5A92                      					;Wait Repeat 2
     739.  00:5A92  19                  	db $19			;Note C#3
     740.  00:5A93  C4                  	db $c4			;Wait 5
     741.  00:5A94  21                  	db $21			;Note A-3
     742.  00:5A95  9A 02               	db $9a,$02			;CMD Note delay
     743.  00:5A97                      					;Wait Repeat 5
     744.  00:5A97  25                  	db $25			;Note C#4
     745.  00:5A98  9A 05               	db $9a,$05			;CMD Note delay
     746.  00:5A9A  C5                  	db $c5			;Wait 6
     747.  00:5A9B  1A                  	db $1a			;Note D-3
     748.  00:5A9C  C3                  	db $c3			;Wait 4
     749.  00:5A9D  1A                  	db $1a			;Note D-3
     750.  00:5A9E  C1                  	db $c1			;Wait 2
     751.  00:5A9F  1A                  	db $1a			;Note D-3
     752.  00:5AA0                      					;Wait Repeat 2
     753.  00:5AA0  26                  	db $26			;Note D-4
     754.  00:5AA1  C3                  	db $c3			;Wait 4
     755.  00:5AA2  1A                  	db $1a			;Note D-3
     756.  00:5AA3  C1                  	db $c1			;Wait 2
     757.  00:5AA4  1A                  	db $1a			;Note D-3
     758.  00:5AA5                      					;Wait Repeat 2
     759.  00:5AA5  19                  	db $19			;Note C#3
     760.  00:5AA6  C3                  	db $c3			;Wait 4
     761.  00:5AA7  19                  	db $19			;Note C#3
     762.  00:5AA8  C1                  	db $c1			;Wait 2
     763.  00:5AA9  19                  	db $19			;Note C#3
     764.  00:5AAA                      					;Wait Repeat 2
     765.  00:5AAA  25                  	db $25			;Note C#4
     766.  00:5AAB  C7                  	db $c7			;Wait 8
     767.  00:5AAC  BF                  	db $bf			;[End-Of-Track]
     768.  00:5AAD                      .track_013:
     769.  00:5AAD  39                  	db $39			;Note A-5
     770.  00:5AAE  6C                  	db $6c			;Volume 11
     771.  00:5AAF  77                  	db $77			;Instrument 6
     772.  00:5AB0  CB                  	db $cb			;Wait 12
     773.  00:5AB1  39                  	db $39			;Note A-5
     774.  00:5AB2  C1                  	db $c1			;Wait 2
     775.  00:5AB3  39                  	db $39			;Note A-5
     776.  00:5AB4                      					;Wait Repeat 2
     777.  00:5AB4  3B                  	db $3b			;Note B-5
     778.  00:5AB5  C4                  	db $c4			;Wait 5
     779.  00:5AB6  3B                  	db $3b			;Note B-5
     780.  00:5AB7  9A 03               	db $9a,$03			;CMD Note delay
     781.  00:5AB9                      					;Wait Repeat 5
     782.  00:5AB9  3B                  	db $3b			;Note B-5
     783.  00:5ABA  9A 05               	db $9a,$05			;CMD Note delay
     784.  00:5ABC  C5                  	db $c5			;Wait 6
     785.  00:5ABD  3D                  	db $3d			;Note C#6
     786.  00:5ABE  CB                  	db $cb			;Wait 12
     787.  00:5ABF  3D                  	db $3d			;Note C#6
     788.  00:5AC0  C1                  	db $c1			;Wait 2
     789.  00:5AC1  3D                  	db $3d			;Note C#6
     790.  00:5AC2                      					;Wait Repeat 2
     791.  00:5AC2  3B                  	db $3b			;Note B-5
     792.  00:5AC3  C4                  	db $c4			;Wait 5
     793.  00:5AC4  3B                  	db $3b			;Note B-5
     794.  00:5AC5  9A 03               	db $9a,$03			;CMD Note delay
     795.  00:5AC7                      					;Wait Repeat 5
     796.  00:5AC7  38                  	db $38			;Note G#5
     797.  00:5AC8  9A 05               	db $9a,$05			;CMD Note delay
     798.  00:5ACA  C5                  	db $c5			;Wait 6
     799.  00:5ACB  BF                  	db $bf			;[End-Of-Track]
     800.  00:5ACC                      .track_014:
     801.  00:5ACC  3E                  	db $3e			;Note D-6
     802.  00:5ACD  6C                  	db $6c			;Volume 11
     803.  00:5ACE  77                  	db $77			;Instrument 6
     804.  00:5ACF  CB                  	db $cb			;Wait 12
     805.  00:5AD0  3E                  	db $3e			;Note D-6
     806.  00:5AD1  C1                  	db $c1			;Wait 2
     807.  00:5AD2  3E                  	db $3e			;Note D-6
     808.  00:5AD3                      					;Wait Repeat 2
     809.  00:5AD3  40                  	db $40			;Note E-6
     810.  00:5AD4  C4                  	db $c4			;Wait 5
     811.  00:5AD5  40                  	db $40			;Note E-6
     812.  00:5AD6  9A 03               	db $9a,$03			;CMD Note delay
     813.  00:5AD8                      					;Wait Repeat 5
     814.  00:5AD8  40                  	db $40			;Note E-6
     815.  00:5AD9  9A 05               	db $9a,$05			;CMD Note delay
     816.  00:5ADB  C5                  	db $c5			;Wait 6
     817.  00:5ADC  42                  	db $42			;Note F#6
     818.  00:5ADD  CB                  	db $cb			;Wait 12
     819.  00:5ADE  42                  	db $42			;Note F#6
     820.  00:5ADF  C1                  	db $c1			;Wait 2
     821.  00:5AE0  42                  	db $42			;Note F#6
     822.  00:5AE1                      					;Wait Repeat 2
     823.  00:5AE1  40                  	db $40			;Note E-6
     824.  00:5AE2  C4                  	db $c4			;Wait 5
     825.  00:5AE3  40                  	db $40			;Note E-6
     826.  00:5AE4  9A 03               	db $9a,$03			;CMD Note delay
     827.  00:5AE6                      					;Wait Repeat 5
     828.  00:5AE6  3B                  	db $3b			;Note B-5
     829.  00:5AE7  9A 05               	db $9a,$05			;CMD Note delay
     830.  00:5AE9  C5                  	db $c5			;Wait 6
     831.  00:5AEA  BF                  	db $bf			;[End-Of-Track]
     832.  00:5AEB                      .track_015:
     833.  00:5AEB  42                  	db $42			;Note F#6
     834.  00:5AEC  6C                  	db $6c			;Volume 11
     835.  00:5AED  77                  	db $77			;Instrument 6
     836.  00:5AEE  C2                  	db $c2			;Wait 3
     837.  00:5AEF  94 66               	db $94,$66		;CMD Vibrato
     838.  00:5AF1  C8                  	db $c8			;Wait 9
     839.  00:5AF2  42                  	db $42			;Note F#6
     840.  00:5AF3  9B                  	db $9b			;CMD End 
     841.  00:5AF4  C1                  	db $c1			;Wait 2
     842.  00:5AF5  42                  	db $42			;Note F#6
     843.  00:5AF6                      					;Wait Repeat 2
     844.  00:5AF6  44                  	db $44			;Note G#6
     845.  00:5AF7  C4                  	db $c4			;Wait 5
     846.  00:5AF8  45                  	db $45			;Note A-6
     847.  00:5AF9  9A 03               	db $9a,$03			;CMD Note delay
     848.  00:5AFB                      					;Wait Repeat 5
     849.  00:5AFB  47                  	db $47			;Note B-6
     850.  00:5AFC  9A 05               	db $9a,$05			;CMD Note delay
     851.  00:5AFE  C5                  	db $c5			;Wait 6
     852.  00:5AFF  45                  	db $45			;Note A-6
     853.  00:5B00  C3                  	db $c3			;Wait 4
     854.  00:5B01  94 66               	db $94,$66		;CMD Vibrato
     855.  00:5B03  C7                  	db $c7			;Wait 8
     856.  00:5B04  45                  	db $45			;Note A-6
     857.  00:5B05  9B                  	db $9b			;CMD End 
     858.  00:5B06  C1                  	db $c1			;Wait 2
     859.  00:5B07  45                  	db $45			;Note A-6
     860.  00:5B08                      					;Wait Repeat 2
     861.  00:5B08  44                  	db $44			;Note G#6
     862.  00:5B09  C4                  	db $c4			;Wait 5
     863.  00:5B0A  42                  	db $42			;Note F#6
     864.  00:5B0B  9A 03               	db $9a,$03			;CMD Note delay
     865.  00:5B0D                      					;Wait Repeat 5
     866.  00:5B0D  40                  	db $40			;Note E-6
     867.  00:5B0E  9A 05               	db $9a,$05			;CMD Note delay
     868.  00:5B10  C5                  	db $c5			;Wait 6
     869.  00:5B11  BF                  	db $bf			;[End-Of-Track]
     870.  00:5B12                      .track_016:
     871.  00:5B12  9C 00               	db $9c,$00			;CMD Drum $01
     872.  00:5B14  C3                  	db $c3			;Wait 4
     873.  00:5B15  5D                  	db $5d			;Note A-8
     874.  00:5B16  6D                  	db $6d			;Volume 12
     875.  00:5B17  72                  	db $72			;Instrument 1
     876.  00:5B18  C1                  	db $c1			;Wait 2
     877.  00:5B19  9C 00               	db $9c,$00			;CMD Drum $01
     878.  00:5B1B                      					;Wait Repeat 2
     879.  00:5B1B  21                  	db $21			;Note A-3
     880.  00:5B1C  70                  	db $70			;Volume 15
     881.  00:5B1D  7C                  	db $7c			;Instrument 11
     882.  00:5B1E  9C 02               	db $9c,$02			;CMD Drum $02
     883.  00:5B20                      					;Wait Repeat 2
     884.  00:5B20  5D                  	db $5d			;Note A-8
     885.  00:5B21  6D                  	db $6d			;Volume 12
     886.  00:5B22  72                  	db $72			;Instrument 1
     887.  00:5B23  C1                  	db $c1			;Wait 2
     888.  00:5B24  9C 00               	db $9c,$00			;CMD Drum $01
     889.  00:5B26  C3                  	db $c3			;Wait 4
     890.  00:5B27  5D                  	db $5d			;Note A-8
     891.  00:5B28  6D                  	db $6d			;Volume 12
     892.  00:5B29  C3                  	db $c3			;Wait 4
     893.  00:5B2A  9C 00               	db $9c,$00			;CMD Drum $01
     894.  00:5B2C                      					;Wait Repeat 4
     895.  00:5B2C  21                  	db $21			;Note A-3
     896.  00:5B2D  70                  	db $70			;Volume 15
     897.  00:5B2E  7C                  	db $7c			;Instrument 11
     898.  00:5B2F  9C 02               	db $9c,$02			;CMD Drum $02
     899.  00:5B31  C1                  	db $c1			;Wait 2
     900.  00:5B32  5D                  	db $5d			;Note A-8
     901.  00:5B33  6D                  	db $6d			;Volume 12
     902.  00:5B34  72                  	db $72			;Instrument 1
     903.  00:5B35                      					;Wait Repeat 2
     904.  00:5B35  5D                  	db $5d			;Note A-8
     905.  00:5B36  6F                  	db $6f			;Volume 14
     906.  00:5B37  7B                  	db $7b			;Instrument 10
     907.  00:5B38                      					;Wait Repeat 2
     908.  00:5B38  21                  	db $21			;Note A-3
     909.  00:5B39  6D                  	db $6d			;Volume 12
     910.  00:5B3A  71                  	db $71			;Instrument 0
     911.  00:5B3B  C1                  	db $c1			;Wait 2
     912.  00:5B3C  9C 00               	db $9c,$00			;CMD Drum $01
     913.  00:5B3E  C3                  	db $c3			;Wait 4
     914.  00:5B3F  5D                  	db $5d			;Note A-8
     915.  00:5B40  6D                  	db $6d			;Volume 12
     916.  00:5B41  72                  	db $72			;Instrument 1
     917.  00:5B42  C1                  	db $c1			;Wait 2
     918.  00:5B43  9C 00               	db $9c,$00			;CMD Drum $01
     919.  00:5B45                      					;Wait Repeat 2
     920.  00:5B45  21                  	db $21			;Note A-3
     921.  00:5B46  70                  	db $70			;Volume 15
     922.  00:5B47  7C                  	db $7c			;Instrument 11
     923.  00:5B48  9C 02               	db $9c,$02			;CMD Drum $02
     924.  00:5B4A                      					;Wait Repeat 2
     925.  00:5B4A  5D                  	db $5d			;Note A-8
     926.  00:5B4B  6D                  	db $6d			;Volume 12
     927.  00:5B4C  72                  	db $72			;Instrument 1
     928.  00:5B4D  C1                  	db $c1			;Wait 2
     929.  00:5B4E  9C 00               	db $9c,$00			;CMD Drum $01
     930.  00:5B50  C3                  	db $c3			;Wait 4
     931.  00:5B51  5D                  	db $5d			;Note A-8
     932.  00:5B52  6D                  	db $6d			;Volume 12
     933.  00:5B53  C1                  	db $c1			;Wait 2
     934.  00:5B54  5D                  	db $5d			;Note A-8
     935.  00:5B55  6D                  	db $6d			;Volume 12
     936.  00:5B56  C1                  	db $c1			;Wait 2
     937.  00:5B57  5D                  	db $5d			;Note A-8
     938.  00:5B58  6E                  	db $6e			;Volume 13
     939.  00:5B59  7B                  	db $7b			;Instrument 10
     940.  00:5B5A  9C 04               	db $9c,$04			;CMD Drum $05
     941.  00:5B5C                      					;Wait Repeat 2
     942.  00:5B5C  9C 00               	db $9c,$00			;CMD Drum $01
     943.  00:5B5E                      					;Wait Repeat 2
     944.  00:5B5E  21                  	db $21			;Note A-3
     945.  00:5B5F  70                  	db $70			;Volume 15
     946.  00:5B60  7C                  	db $7c			;Instrument 11
     947.  00:5B61  9C 02               	db $9c,$02			;CMD Drum $02
     948.  00:5B63  C3                  	db $c3			;Wait 4
     949.  00:5B64  5D                  	db $5d			;Note A-8
     950.  00:5B65  6F                  	db $6f			;Volume 14
     951.  00:5B66  7B                  	db $7b			;Instrument 10
     952.  00:5B67  9C 04               	db $9c,$04			;CMD Drum $05
     953.  00:5B69  C1                  	db $c1			;Wait 2
     954.  00:5B6A  21                  	db $21			;Note A-3
     955.  00:5B6B  6D                  	db $6d			;Volume 12
     956.  00:5B6C  71                  	db $71			;Instrument 0
     957.  00:5B6D  C1                  	db $c1			;Wait 2
     958.  00:5B6E  BF                  	db $bf			;[End-Of-Track]
     959.  00:5B6F                      .track_021:
     960.  00:5B6F  32                  	db $32			;Note D-5
     961.  00:5B70  6C                  	db $6c			;Volume 11
     962.  00:5B71  74                  	db $74			;Instrument 3
     963.  00:5B72  C1                  	db $c1			;Wait 2
     964.  00:5B73  32                  	db $32			;Note D-5
     965.  00:5B74                      					;Wait Repeat 2
     966.  00:5B74  32                  	db $32			;Note D-5
     967.  00:5B75                      					;Wait Repeat 2
     968.  00:5B75  32                  	db $32			;Note D-5
     969.  00:5B76  C5                  	db $c5			;Wait 6
     970.  00:5B77  32                  	db $32			;Note D-5
     971.  00:5B78  C1                  	db $c1			;Wait 2
     972.  00:5B79  32                  	db $32			;Note D-5
     973.  00:5B7A                      					;Wait Repeat 2
     974.  00:5B7A  34                  	db $34			;Note E-5
     975.  00:5B7B                      					;Wait Repeat 2
     976.  00:5B7B  34                  	db $34			;Note E-5
     977.  00:5B7C  C5                  	db $c5			;Wait 6
     978.  00:5B7D  34                  	db $34			;Note E-5
     979.  00:5B7E  C1                  	db $c1			;Wait 2
     980.  00:5B7F  34                  	db $34			;Note E-5
     981.  00:5B80  C5                  	db $c5			;Wait 6
     982.  00:5B81  36                  	db $36			;Note F#5
     983.  00:5B82  C1                  	db $c1			;Wait 2
     984.  00:5B83  36                  	db $36			;Note F#5
     985.  00:5B84                      					;Wait Repeat 2
     986.  00:5B84  36                  	db $36			;Note F#5
     987.  00:5B85                      					;Wait Repeat 2
     988.  00:5B85  36                  	db $36			;Note F#5
     989.  00:5B86  C5                  	db $c5			;Wait 6
     990.  00:5B87  36                  	db $36			;Note F#5
     991.  00:5B88  C1                  	db $c1			;Wait 2
     992.  00:5B89  36                  	db $36			;Note F#5
     993.  00:5B8A  C1                  	db $c1			;Wait 2
     994.  00:5B8B  34                  	db $34			;Note E-5
     995.  00:5B8C  6E                  	db $6e			;Volume 13
     996.  00:5B8D  75                  	db $75			;Instrument 4
     997.  00:5B8E  C7                  	db $c7			;Wait 8
     998.  00:5B8F  2C                  	db $2c			;Note G#4
     999.  00:5B90  C7                  	db $c7			;Wait 8
    1000.  00:5B91  BF                  	db $bf			;[End-Of-Track]
    1001.  00:5B92                      .track_022:
    1002.  00:5B92  34                  	db $34			;Note E-5
    1003.  00:5B93  70                  	db $70			;Volume 15
    1004.  00:5B94  79                  	db $79			;Instrument 8
    1005.  00:5B95  A1 08               	db $a1,$08			;CMD Track detune
    1006.  00:5B97  C0                  	db $c0			;Wait 1
    1007.  00:5B98  36                  	db $36			;Note F#5
    1008.  00:5B99  90 0A               	db $90,$0a			;CMD Portamento tone
    1009.  00:5B9B  C3                  	db $c3			;Wait 4
    1010.  00:5B9C  94 26               	db $94,$26		;CMD Vibrato
    1011.  00:5B9E  C4                  	db $c4			;Wait 5
    1012.  00:5B9F  34                  	db $34			;Note E-5
    1013.  00:5BA0  9B                  	db $9b			;CMD End 
    1014.  00:5BA1  C1                  	db $c1			;Wait 2
    1015.  00:5BA2  32                  	db $32			;Note D-5
    1016.  00:5BA3                      					;Wait Repeat 2
    1017.  00:5BA3  36                  	db $36			;Note F#5
    1018.  00:5BA4                      					;Wait Repeat 2
    1019.  00:5BA4  38                  	db $38			;Note G#5
    1020.  00:5BA5  C1                  	db $c1			;Wait 2
    1021.  00:5BA6  34                  	db $34			;Note E-5
    1022.  00:5BA7  9A 03               	db $9a,$03			;CMD Note delay
    1023.  00:5BA9  C2                  	db $c2			;Wait 3
    1024.  00:5BAA  2F                  	db $2f			;Note B-4
    1025.  00:5BAB  9A 02               	db $9a,$02			;CMD Note delay
    1026.  00:5BAD                      					;Wait Repeat 3
    1027.  00:5BAD  34                  	db $34			;Note E-5
    1028.  00:5BAE  C1                  	db $c1			;Wait 2
    1029.  00:5BAF  38                  	db $38			;Note G#5
    1030.  00:5BB0  9A 03               	db $9a,$03			;CMD Note delay
    1031.  00:5BB2  C2                  	db $c2			;Wait 3
    1032.  00:5BB3  3B                  	db $3b			;Note B-5
    1033.  00:5BB4  9A 02               	db $9a,$02			;CMD Note delay
    1034.  00:5BB6                      					;Wait Repeat 3
    1035.  00:5BB6  38                  	db $38			;Note G#5
    1036.  00:5BB7  C0                  	db $c0			;Wait 1
    1037.  00:5BB8  39                  	db $39			;Note A-5
    1038.  00:5BB9  90 04               	db $90,$04			;CMD Portamento tone
    1039.  00:5BBB  C3                  	db $c3			;Wait 4
    1040.  00:5BBC  94 36               	db $94,$36		;CMD Vibrato
    1041.  00:5BBE                      					;Wait Repeat 4
    1042.  00:5BBE  9B                  	db $9b			;CMD End 
    1043.  00:5BBF  C0                  	db $c0			;Wait 1
    1044.  00:5BC0  38                  	db $38			;Note G#5
    1045.  00:5BC1  C1                  	db $c1			;Wait 2
    1046.  00:5BC2  39                  	db $39			;Note A-5
    1047.  00:5BC3                      					;Wait Repeat 2
    1048.  00:5BC3  3B                  	db $3b			;Note B-5
    1049.  00:5BC4                      					;Wait Repeat 2
    1050.  00:5BC4  3E                  	db $3e			;Note D-6
    1051.  00:5BC5  C0                  	db $c0			;Wait 1
    1052.  00:5BC6  3D                  	db $3d			;Note C#6
    1053.  00:5BC7  9A 02               	db $9a,$02			;CMD Note delay
    1054.  00:5BC9                      					;Wait Repeat 1
    1055.  00:5BC9  3B                  	db $3b			;Note B-5
    1056.  00:5BCA  9A 03               	db $9a,$03			;CMD Note delay
    1057.  00:5BCC  C1                  	db $c1			;Wait 2
    1058.  00:5BCD  39                  	db $39			;Note A-5
    1059.  00:5BCE  C0                  	db $c0			;Wait 1
    1060.  00:5BCF  38                  	db $38			;Note G#5
    1061.  00:5BD0  9A 02               	db $9a,$02			;CMD Note delay
    1062.  00:5BD2                      					;Wait Repeat 1
    1063.  00:5BD2  36                  	db $36			;Note F#5
    1064.  00:5BD3  9A 03               	db $9a,$03			;CMD Note delay
    1065.  00:5BD5  C1                  	db $c1			;Wait 2
    1066.  00:5BD6  34                  	db $34			;Note E-5
    1067.  00:5BD7  A1 08               	db $a1,$08			;CMD Track detune
    1068.  00:5BD9  C0                  	db $c0			;Wait 1
    1069.  00:5BDA  36                  	db $36			;Note F#5
    1070.  00:5BDB  9A 02               	db $9a,$02			;CMD Note delay
    1071.  00:5BDD                      					;Wait Repeat 1
    1072.  00:5BDD  38                  	db $38			;Note G#5
    1073.  00:5BDE  9A 03               	db $9a,$03			;CMD Note delay
    1074.  00:5BE0  C1                  	db $c1			;Wait 2
    1075.  00:5BE1  39                  	db $39			;Note A-5
    1076.  00:5BE2  C0                  	db $c0			;Wait 1
    1077.  00:5BE3  34                  	db $34			;Note E-5
    1078.  00:5BE4  9A 02               	db $9a,$02			;CMD Note delay
    1079.  00:5BE6                      					;Wait Repeat 1
    1080.  00:5BE6  31                  	db $31			;Note C#5
    1081.  00:5BE7  9A 03               	db $9a,$03			;CMD Note delay
    1082.  00:5BE9  C1                  	db $c1			;Wait 2
    1083.  00:5BEA  BF                  	db $bf			;[End-Of-Track]
    1084.  00:5BEB                      .track_023:
    1085.  00:5BEB  C2                  	db $c2			;Wait 3
    1086.  00:5BEC  34                  	db $34			;Note E-5
    1087.  00:5BED  6D                  	db $6d			;Volume 12
    1088.  00:5BEE  79                  	db $79			;Instrument 8
    1089.  00:5BEF  A1 09               	db $a1,$09			;CMD Track detune
    1090.  00:5BF1  C0                  	db $c0			;Wait 1
    1091.  00:5BF2  36                  	db $36			;Note F#5
    1092.  00:5BF3  90 0A               	db $90,$0a			;CMD Portamento tone
    1093.  00:5BF5  C3                  	db $c3			;Wait 4
    1094.  00:5BF6  94 26               	db $94,$26		;CMD Vibrato
    1095.  00:5BF8  C4                  	db $c4			;Wait 5
    1096.  00:5BF9  34                  	db $34			;Note E-5
    1097.  00:5BFA  9B                  	db $9b			;CMD End 
    1098.  00:5BFB  C1                  	db $c1			;Wait 2
    1099.  00:5BFC  32                  	db $32			;Note D-5
    1100.  00:5BFD                      					;Wait Repeat 2
    1101.  00:5BFD  36                  	db $36			;Note F#5
    1102.  00:5BFE                      					;Wait Repeat 2
    1103.  00:5BFE  38                  	db $38			;Note G#5
    1104.  00:5BFF  C1                  	db $c1			;Wait 2
    1105.  00:5C00  34                  	db $34			;Note E-5
    1106.  00:5C01  9A 03               	db $9a,$03			;CMD Note delay
    1107.  00:5C03  C2                  	db $c2			;Wait 3
    1108.  00:5C04  2F                  	db $2f			;Note B-4
    1109.  00:5C05  9A 02               	db $9a,$02			;CMD Note delay
    1110.  00:5C07                      					;Wait Repeat 3
    1111.  00:5C07  34                  	db $34			;Note E-5
    1112.  00:5C08  C1                  	db $c1			;Wait 2
    1113.  00:5C09  38                  	db $38			;Note G#5
    1114.  00:5C0A  9A 03               	db $9a,$03			;CMD Note delay
    1115.  00:5C0C  C2                  	db $c2			;Wait 3
    1116.  00:5C0D  3B                  	db $3b			;Note B-5
    1117.  00:5C0E  9A 02               	db $9a,$02			;CMD Note delay
    1118.  00:5C10                      					;Wait Repeat 3
    1119.  00:5C10  38                  	db $38			;Note G#5
    1120.  00:5C11  C0                  	db $c0			;Wait 1
    1121.  00:5C12  39                  	db $39			;Note A-5
    1122.  00:5C13  90 04               	db $90,$04			;CMD Portamento tone
    1123.  00:5C15  C3                  	db $c3			;Wait 4
    1124.  00:5C16  94 36               	db $94,$36		;CMD Vibrato
    1125.  00:5C18                      					;Wait Repeat 4
    1126.  00:5C18  9B                  	db $9b			;CMD End 
    1127.  00:5C19  C0                  	db $c0			;Wait 1
    1128.  00:5C1A  38                  	db $38			;Note G#5
    1129.  00:5C1B  C1                  	db $c1			;Wait 2
    1130.  00:5C1C  39                  	db $39			;Note A-5
    1131.  00:5C1D                      					;Wait Repeat 2
    1132.  00:5C1D  3B                  	db $3b			;Note B-5
    1133.  00:5C1E                      					;Wait Repeat 2
    1134.  00:5C1E  3E                  	db $3e			;Note D-6
    1135.  00:5C1F  C0                  	db $c0			;Wait 1
    1136.  00:5C20  3D                  	db $3d			;Note C#6
    1137.  00:5C21  9A 02               	db $9a,$02			;CMD Note delay
    1138.  00:5C23                      					;Wait Repeat 1
    1139.  00:5C23  3B                  	db $3b			;Note B-5
    1140.  00:5C24  9A 03               	db $9a,$03			;CMD Note delay
    1141.  00:5C26  C1                  	db $c1			;Wait 2
    1142.  00:5C27  39                  	db $39			;Note A-5
    1143.  00:5C28  C0                  	db $c0			;Wait 1
    1144.  00:5C29  38                  	db $38			;Note G#5
    1145.  00:5C2A  9A 02               	db $9a,$02			;CMD Note delay
    1146.  00:5C2C                      					;Wait Repeat 1
    1147.  00:5C2C  36                  	db $36			;Note F#5
    1148.  00:5C2D  9A 03               	db $9a,$03			;CMD Note delay
    1149.  00:5C2F  C1                  	db $c1			;Wait 2
    1150.  00:5C30  34                  	db $34			;Note E-5
    1151.  00:5C31  A1 08               	db $a1,$08			;CMD Track detune
    1152.  00:5C33  C0                  	db $c0			;Wait 1
    1153.  00:5C34  36                  	db $36			;Note F#5
    1154.  00:5C35  9A 02               	db $9a,$02			;CMD Note delay
    1155.  00:5C37                      					;Wait Repeat 1
    1156.  00:5C37  38                  	db $38			;Note G#5
    1157.  00:5C38  9A 03               	db $9a,$03			;CMD Note delay
    1158.  00:5C3A  C1                  	db $c1			;Wait 2
    1159.  00:5C3B  39                  	db $39			;Note A-5
    1160.  00:5C3C  BF                  	db $bf			;[End-Of-Track]
    1161.  00:5C3D                      .track_024:
    1162.  00:5C3D  9C 00               	db $9c,$00			;CMD Drum $01
    1163.  00:5C3F  C0                  	db $c0			;Wait 1
    1164.  00:5C40  97 8A               	db $97,$8a			;CMD Volume slide up
    1165.  00:5C42  C6                  	db $c6			;Wait 7
    1166.  00:5C43  60                  	db $60			;Release 96
    1167.  00:5C44  C5                  	db $c5			;Wait 6
    1168.  00:5C45  9B                  	db $9b			;CMD End 
    1169.  00:5C46  C0                  	db $c0			;Wait 1
    1170.  00:5C47  60                  	db $60			;Release 96
    1171.  00:5C48  F0                  	db $f0			;Wait 49
    1172.  00:5C49  BF                  	db $bf			;[End-Of-Track]
    1173.  00:5C4A                      .track_025:
    1174.  00:5C4A                      			;CMD 8 Unused [WARNING]
    1175.  00:5C4A  C0                  	db $c0			;Wait 1
    1176.  00:5C4B  97 8A               	db $97,$8a			;CMD Volume slide up
    1177.  00:5C4D  C6                  	db $c6			;Wait 7
    1178.  00:5C4E  60                  	db $60			;Release 96
    1179.  00:5C4F  C5                  	db $c5			;Wait 6
    1180.  00:5C50  9B                  	db $9b			;CMD End 
    1181.  00:5C51  C0                  	db $c0			;Wait 1
    1182.  00:5C52  60                  	db $60			;Release 96
    1183.  00:5C53  F0                  	db $f0			;Wait 49
    1184.  00:5C54  BF                  	db $bf			;[End-Of-Track]
    1185.  00:5C55                      .track_026:
    1186.  00:5C55  CE                  	db $ce			;Wait 15
    1187.  00:5C56  60                  	db $60			;Release 96
    1188.  00:5C57  F0                  	db $f0			;Wait 49
    1189.  00:5C58  BF                  	db $bf			;[End-Of-Track]
    1190.  00:5C59                      .track_027:
    1191.  00:5C59  53                  	db $53			;Note B-7
    1192.  00:5C5A  6E                  	db $6e			;Volume 13
    1193.  00:5C5B  78                  	db $78			;Instrument 7
    1194.  00:5C5C  A1 08               	db $a1,$08			;CMD Track detune
    1195.  00:5C5E  C0                  	db $c0			;Wait 1
    1196.  00:5C5F  97 8A               	db $97,$8a			;CMD Volume slide up
    1197.  00:5C61  CC                  	db $cc			;Wait 13
    1198.  00:5C62  9B                  	db $9b			;CMD End 
    1199.  00:5C63  C0                  	db $c0			;Wait 1
    1200.  00:5C64  60                  	db $60			;Release 96
    1201.  00:5C65  F0                  	db $f0			;Wait 49
    1202.  00:5C66  BF                  	db $bf			;[End-Of-Track]
    1203.  00:5C67                      .track_028:
    1204.  00:5C67  17                  	db $17			;Note B-2
    1205.  00:5C68  6E                  	db $6e			;Volume 13
    1206.  00:5C69  76                  	db $76			;Instrument 5
    1207.  00:5C6A  97 88               	db $97,$88			;CMD Volume slide up
    1208.  00:5C6C  CD                  	db $cd			;Wait 14
    1209.  00:5C6D  9B                  	db $9b			;CMD End 
    1210.  00:5C6E  C0                  	db $c0			;Wait 1
    1211.  00:5C6F  60                  	db $60			;Release 96
    1212.  00:5C70  F0                  	db $f0			;Wait 49
    1213.  00:5C71  BF                  	db $bf			;[End-Of-Track]
    1214.  00:5C72                      .track_029:
    1215.  00:5C72  2D                  	db $2d			;Note A-4
    1216.  00:5C73  6C                  	db $6c			;Volume 11
    1217.  00:5C74  77                  	db $77			;Instrument 6
    1218.  00:5C75  97 84               	db $97,$84			;CMD Volume slide up
    1219.  00:5C77  CD                  	db $cd			;Wait 14
    1220.  00:5C78  9B                  	db $9b			;CMD End 
    1221.  00:5C79  C0                  	db $c0			;Wait 1
    1222.  00:5C7A  60                  	db $60			;Release 96
    1223.  00:5C7B  F0                  	db $f0			;Wait 49
    1224.  00:5C7C  BF                  	db $bf			;[End-Of-Track]
    1225.  00:5C7D                      .track_030:
    1226.  00:5C7D  32                  	db $32			;Note D-5
    1227.  00:5C7E  6C                  	db $6c			;Volume 11
    1228.  00:5C7F  77                  	db $77			;Instrument 6
    1229.  00:5C80  97 84               	db $97,$84			;CMD Volume slide up
    1230.  00:5C82  CD                  	db $cd			;Wait 14
    1231.  00:5C83  9B                  	db $9b			;CMD End 
    1232.  00:5C84  C0                  	db $c0			;Wait 1
    1233.  00:5C85  60                  	db $60			;Release 96
    1234.  00:5C86  F0                  	db $f0			;Wait 49
    1235.  00:5C87  BF                  	db $bf			;[End-Of-Track]
    1236.  00:5C88                      .track_031:
    1237.  00:5C88  36                  	db $36			;Note F#5
    1238.  00:5C89  6C                  	db $6c			;Volume 11
    1239.  00:5C8A  77                  	db $77			;Instrument 6
    1240.  00:5C8B  97 84               	db $97,$84			;CMD Volume slide up
    1241.  00:5C8D  CD                  	db $cd			;Wait 14
    1242.  00:5C8E  9B                  	db $9b			;CMD End 
    1243.  00:5C8F  C0                  	db $c0			;Wait 1
    1244.  00:5C90  60                  	db $60			;Release 96
    1245.  00:5C91  F0                  	db $f0			;Wait 49
    1246.  00:5C92  BF                  	db $bf			;[End-Of-Track]
    1247.  00:5C93                      
     566   00:5C93                      	
     567   00:5C93                      TEXT_Title:
     568   00:5C93                      	db	"TriloTracker FM Re-player Debug info",0	
     568   00:5C93  54 72 69 6C 6F 54 72 61 63 6B 65 72 20 46 4D 20 
     568   00:5CA3  52 65 2D 70 6C 61 79 65 72 20 44 65 62 75 67 20 
     568   00:5CB3  69 6E 66 6F 00 
     569   00:5CB8                      TEXT_Step:
     570   00:5CB8  53 74 65 70 3A 00   	db	"Step:",0	
     571   00:5CBE                      TEXT_Header_Data:
     572   00:5CBE                      	db	"C# Nt In FM Vl Cm Flags",0
     572   00:5CBE  43 23 20 4E 74 20 49 6E 20 46 4D 20 56 6C 20 43 
     572   00:5CCE  6D 20 46 6C 61 67 73 00 
     573   00:5CD6                      TEXT_Register_Header:
     574   00:5CD6                      	db 	"Tone Vl  Tone Vl  Nois Mx  Env  Sh",0
     574   00:5CD6  54 6F 6E 65 20 56 6C 20 20 54 6F 6E 65 20 56 6C 
     574   00:5CE6  20 20 4E 6F 69 73 20 4D 78 20 20 45 6E 76 20 20 
     574   00:5CF6  53 68 00 
     575   00:5CF9                      TEXT_Register_Drum:
     576   00:5CF9                      	db 	"Macr Drm Tone Vl",0	
     576   00:5CF9  4D 61 63 72 20 44 72 6D 20 54 6F 6E 65 20 56 6C 
     576   00:5D09  00 
     577   00:5D0A                      TEXT_Legend_Data:
     578   00:5D0A                      	db	"Legend: Psg, Fm, Voice, Env, Keyon, Command, Active(note)",0
     578   00:5D0A  4C 65 67 65 6E 64 3A 20 50 73 67 2C 20 46 6D 2C 
     578   00:5D1A  20 56 6F 69 63 65 2C 20 45 6E 76 2C 20 4B 65 79 
     578   00:5D2A  6F 6E 2C 20 43 6F 6D 6D 61 6E 64 2C 20 41 63 74 
     578   00:5D3A  69 76 65 28 6E 6F 74 65 29 00 
     579   00:5D44                      
     580   00:5D44                      	
     581   00:5D44                      	
     582   00:5D44                      font_data:
     583   00:5D44  (0800)              	incbin	".\fontpat.bin"
     584   00:6544                      
     585   00:6544                      ;	include ".\sfx.asm"
     586   00:6544                      	
     587   00:6544                      ;sfx_PSG_STREAMS:
     588   00:6544                      ;sfx_SCC_STREAMS:
     589   00:6544                      ;	dw	sfx1
     590   00:6544                      ;	dw	sfx2
     591   00:6544                      ;	dw	sfx3
     592   00:6544                      ;	dw	sfx4
     593   00:6544                      ;	dw	sfx5
     594   00:6544                      ;
     595   00:6544                      ;
     596   00:6544                      ;
     597   00:6544                      ;sfx1:
     598   00:6544                      ;	db	1,4*8
     599   00:6544                      ;	incbin	"..\ttsfxplay\sfx\menu1.afx"
     600   00:6544                      ;sfx2:
     601   00:6544                      ;	db	1,2*8
     602   00:6544                      ;	incbin	"..\ttsfxplay\sfx\menu2.afx"	
     603   00:6544                      ;sfx3:
     604   00:6544                      ;	db	1,3*8
     605   00:6544                      ;	incbin	"..\ttsfxplay\sfx\menu3.afx"
     606   00:6544                      ;sfx4:
     607   00:6544                      ;	db	1,5*8
     608   00:6544                      ;	incbin	"..\ttsfxplay\sfx\menu4.afx"
     609   00:6544                      ;sfx5:
     610   00:6544                      ;	db	1,6*8
     611   00:6544                      ;	incbin	"..\ttsfxplay\sfx\menu5.afx"
     612   00:6544                      ;
     613   00:6544                      	
     614   00:6544                      	
     615   00:6544  (C000)              	map	0xc000
     616   00:6544                      	include	"..\code\ttreplaySMSRAM.asm"
       1.  00:6544                      ;================================
       2.  00:6544                      ; The new replayer.
       3.  00:6544                      ;
       4.  00:6544                      ; Persistent RAM unswappable
       5.  00:6544                      ;
       6.  00:6544                      ;================================
       7.  00:6544                      
       8.  00:6544  (00:FFFFFFEF)       TRACK_Instrument		equ 0-17
       9.  00:6544  (00:FFFFFFF0)       TRACK_Command			equ 1-17
      10.  00:6544  (00:FFFFFFF1)       TRACK_MacroPointer		equ 2-17
      11.  00:6544  (00:FFFFFFF3)       TRACK_MacroStart		equ 4-17
      12.  00:6544  (00:FFFFFFF5)       TRACK_MacroRestart 		equ 6-17		; no longer needed
      13.  00:6544  (00:FFFFFFF6)       TRACK_Note				equ 7-17
      14.  00:6544  (00:FFFFFFF7)       TRACK_Volume			equ 8-17
      15.  00:6544  (00:FFFFFFF8)       TRACK_Voice				equ 9-17
      16.  00:6544  (00:FFFFFFF9)       TRACK_Flags				equ 10-17
      17.  00:6544                      	; 0 = note trigger
      18.  00:6544                      	; 1 = note active
      19.  00:6544                      	; 4 = morph active		;-< for SCC when 1 then waveform is following morph buffer
      20.  00:6544                      	; 3 = command trigger
      21.  00:6544                      	; 2 = envelope trigger
      22.  00:6544                      	; 5 = instrument trigger
      23.  00:6544                      	; 6 = waveform trigger
      24.  00:6544                      	; 7 = PSG/SCC
      25.  00:6544  (00:FFFFFFFA)       TRACK_empty				equ 11-17		; needed for pushing 0 at note start
      26.  00:6544  (00:FFFFFFFB)       TRACK_ToneAdd			equ 12-17		; reset after note set
      27.  00:6544  (00:FFFFFFFD)       TRACK_VolumeAdd			equ 14-17		; reset after note set
      28.  00:6544  (00:FFFFFFFE)       TRACK_Noise				equ 15-17	;[OBSOLETE]	; reset after note set
      29.  00:6544  (00:FFFFFFFF)       TRACK_cmd_VolumeAdd		equ 16-17		; reset after note set
      30.  00:6544  (00:0000)           TRACK_cmd_ToneSlideAdd		equ 17-17		; reset after note set
      31.  00:6544  (00:0002)           TRACK_cmd_ToneAdd			equ 19-17		; reset after note set
      32.  00:6544  (00:0004)           TRACK_cmd_detune			equ 21-17
      33.  00:6544  (00:0006)           TRACK_cmd_0				equ 23-17
      34.  00:6544  (00:0007)           TRACK_cmd_1				equ 24-17
      35.  00:6544  (00:0008)           TRACK_cmd_2				equ 25-17
      36.  00:6544  (00:0009)           TRACK_cmd_3				equ 26-17
      37.  00:6544  (00:000A)           TRACK_cmd_4_depth			equ 27-17
      38.  00:6544  (00:000C)           TRACK_cmd_4_step			equ 29-17
      39.  00:6544  (00:000D)           TRACK_cmd_NoteAdd			equ 30-17		;x reset after note set
      40.  00:6544  (00:000E)           TRACK_cmd_A				equ 31-17		
      41.  00:6544  (00:000F)           TRACK_cmd_B				equ 32-17		
      42.  00:6544  (00:0010)           TRACK_cmd_E				equ 33-17
      43.  00:6544  (00:0011)           TRACK_Timer				equ 34-17		; used for timing by all cmd's
      44.  00:6544  (00:0012)           TRACK_Step				equ 35-17		; only for VIBRATO???
      45.  00:6544  (00:0013)           TRACK_Delay				equ 36-17		; rows to wait till next data
      46.  00:6544                      ;TRACK_Retrig			equ 35-17		; rows to retrigger command
      47.  00:6544  (00:0014)           TRACK_prevDelay			equ 37-17
      48.  00:6544  (00:0015)           TRACK_cmd_A_add			equ 38-17		;<< Still in use???
      49.  00:6544                      
      50.  00:6544  (00:0027)           TRACK_REC_SIZE			equ 39
      51.  00:6544                      
      52.  00:6544                      
      53.  00:6544  (00:0000)           B_TRGNOT				equ 0			; note trigger
      54.  00:6544  (00:0001)           B_ACTNOT				equ 1			; note active
      55.  00:6544  (00:0002)           B_TRGENV				equ 2			; envelope trigger
      56.  00:6544  (00:0003)           B_TRGCMD				equ 3			; command active
      57.  00:6544  (00:0004)           B_KEYON				equ 4			; for fm note trigger
      58.  00:6544  (00:0005)           B_SUST				equ 5			; for fm note sustain
      59.  00:6544  (00:0006)           B_TRGVOI				equ 6			; custom voice trigger	
      60.  00:6544  (00:0007)           B_PSGFM				equ 7			; chip type (PSG or FM)	
      61.  00:6544                      
      62.  00:6544                      ;B_ACTMOR			equ 4			; morph active
      63.  00:6544                      ;B_TRGINS			equ 5			; instrument trigger
      64.  00:6544                      ;B_TRGWAV			equ 6			; waveform trigger
      65.  00:6544                      
      66.  00:6544                      
      67.  00:6544  (00:C000)           _SP_Storage				#2			; to store the SP
      68.  00:6544                      
      69.  00:6544  (00:C002)           replay_trigger			#1			; trigger byte.
      70.  00:6544  (00:C003)           replay_mainPSGvol		#2			; volume mixer for PSG SCC balance
      71.  00:6544  (00:C005)           replay_mainSCCvol		#2			; volume mixer for PSG SCC balance
      72.  00:6544                      ;replay_songbase:		#2			; pointer to song data
      73.  00:6544                      
      74.  00:6544                      ; Do not move these
      75.  00:6544  (00:C007)           replay_voicebase:		#2			; pointer to custom voice data
      76.  00:6544  (00:C009)           replay_drumbase:		#2			; pointer to drum macro data
      77.  00:6544  (00:C00B)           replay_insbase:			#2			; pointer to instrument data
      78.  00:6544  (00:C00D)           TRACK_pointer1			#2
      79.  00:6544  (00:C00F)           TRACK_pointer2			#2
      80.  00:6544  (00:C011)           TRACK_pointer3			#2
      81.  00:6544  (00:C013)           TRACK_pointer4			#2
      82.  00:6544  (00:C015)           TRACK_pointer5			#2
      83.  00:6544  (00:C017)           TRACK_pointer6			#2
      84.  00:6544  (00:C019)           TRACK_pointer7			#2
      85.  00:6544  (00:C01B)           TRACK_pointer8			#2
      86.  00:6544                      ; / Do not move above
      87.  00:6544                      
      88.  00:6544                      
      89.  00:6544                      
      90.  00:6544  (00:C01D)           replay_orderpointer:	#2			; pointer to the order track list pointers
      91.  00:6544                      
      92.  00:6544  (00:C01F)           replay_speed 			#1			; speed to replay (get from song)
      93.  00:6544  (00:C020)           replay_speed_subtimer 	#1			; counter for finer speed
      94.  00:6544  (00:C021)           replay_speed_timer 		#1 			; counter for speed
      95.  00:6544  (00:C022)           replay_mode 			#1			; Replayer status
      96.  00:6544                      ; mode 0  = no sound output
      97.  00:6544                      ; mode 1  = replay song 
      98.  00:6544  (00:C023)           replay_chan_setup		#1			; 0 = 2 psg+ 6 fm, 1 = 3psg + 5 fm
      99.  00:6544  (00:C024)           replay_arp_speed		#1			; arpeggio speed ( 0 = fast, $f = slowest)
     100.  00:6544  (00:C025)           replay_fade				#1			; Fade active (value = fade speed)
     101.  00:6544  (00:C026)           replay_fade_timer		#1			; Timer for fade
     102.  00:6544  (00:C027)           replay_fade_vol			#1			; fade volume to lower the channel volume.
     103.  00:6544                      
     104.  00:6544  (00:C028)           replay_previous_note	#1			; previous note played
     105.  00:6544  (00:C029)           replay_mainvol			#2			; the volume correction.
     106.  00:6544                      
     107.  00:6544  (00:C02B)           replay_vib_table		#2			; pointer to the vibrato table
     108.  00:6544                      ;replay_tonetable_PSG	#2			; ToneTable (affected by transpose);
     109.  00:6544                      ;replay_tonetable_FM	#2			; ToneTable (affected by transpose);
     110.  00:6544  (00:C02D)           replay_tonetable		#2			; Current tonetable to read from
     111.  00:6544                      
     112.  00:6544  (00:C02F)           equalization_freq:		#1	; vdp type for correct playback on 60hz 0=50Hx, >0=60Hz
     113.  00:6544  (00:C030)           equalization_cnt:		#1	; counter for correct playback on 60hz
     114.  00:6544  (00:C031)           equalization_flag:		#1	; flag indicating if only instruments need to be processed.
     115.  00:6544                      
     116.  00:6544                      
     117.  00:6544                      
     118.  00:6544  (00:C032)           TRACK_Chan1				#TRACK_REC_SIZE
     119.  00:6544  (00:C059)           TRACK_Chan2				#TRACK_REC_SIZE
     120.  00:6544  (00:C080)           TRACK_Chan3				#TRACK_REC_SIZE
     121.  00:6544  (00:C0A7)           TRACK_Chan4				#TRACK_REC_SIZE
     122.  00:6544  (00:C0CE)           TRACK_Chan5				#TRACK_REC_SIZE
     123.  00:6544  (00:C0F5)           TRACK_Chan6				#TRACK_REC_SIZE
     124.  00:6544  (00:C11C)           TRACK_Chan7				#TRACK_REC_SIZE
     125.  00:6544  (00:C143)           TRACK_Chan8				#TRACK_REC_SIZE
     126.  00:6544                      
     127.  00:6544                      
     128.  00:6544                      
     129.  00:6544                      ;--- AY SPECIFIC
     130.  00:6544  (00:C16A)           PSG_registers			#0 
     131.  00:6544  (00:C16A)           PSG_regToneA 			#2	; Tone A freq low (8bit)
     132.  00:6544                      						; Tone A freq high (4bit)
     133.  00:6544  (00:C16C)           PSG_regToneB 			#2	; Tone B freq low
     134.  00:6544                      						; Tone B freq high
     135.  00:6544  (00:C16E)           PSG_regToneC 			#2	; Tone C freq low
     136.  00:6544                      						; Tone C freq high
     137.  00:6544  (00:C170)           PSG_regNOISE 			#1	; Noise freq (5bit)
     138.  00:6544  (00:C171)           PSG_regMIXER 			#1	;0x38	;x3f	; Mixer control (1 = off, 0 = on)
     139.  00:6544  (00:C172)           PSG_regVOLA 			#1	; Chan A volume
     140.  00:6544  (00:C173)           PSG_regVOLB 			#1	; Chan B volume
     141.  00:6544  (00:C174)           PSG_regVOLC  			#1	; Chan C volume
     142.  00:6544  (00:C175)           PSG_regVOLN				#1
     143.  00:6544  (00:C176)           PSG_regNOISEold			#1
     144.  00:6544  (00:C177)           GG_panning				#1
     145.  00:6544                      ;PSG_regEnvL 			#1	; Volume Env Freq low (8bit)	
     146.  00:6544                      ;PSG_regEnvH 			#1	; Volume Env Freq high (4bit)
     147.  00:6544                      ;PSG_regEnvShape 		#1	; Volume Env Shape (4bit)
     148.  00:6544                      
     149.  00:6544                      ;--- SCC SPECIFIC
     150.  00:6544                      ;
     151.  00:6544                      ;_0x9800:	#32			; Waveform data
     152.  00:6544                      ;_0x9820:	#32
     153.  00:6544                      ;_0x9840:	#32
     154.  00:6544                      ;_0x9860:	#32
     155.  00:6544                      
     156.  00:6544  (00:C178)           FM_Registers: 	#0	; contains the registers values to write and value previously written
     157.  00:6544  (00:C178)           FM_regToneA 	#2	; Tone A freq low (8bit)			; Tone A freq high (1bit)
     158.  00:6544  (00:C17A)           FM_regToneAb 	#2	; Tone A freq low (8bit)			; Tone A freq high (1bit)
     159.  00:6544  (00:C17C)           FM_regVOLA		#1	; Chan A volume
     160.  00:6544  (00:C17D)           FM_regVOLAb		#1	; Chan A volume
     161.  00:6544  (00:C17E)           FM_regToneB 	#2	; Tone B freq low					; Tone B freq high
     162.  00:6544  (00:C180)           FM_regToneBb 	#2	; Tone B freq low					; Tone B freq high
     163.  00:6544  (00:C182)           FM_regVOLB		#1	; Chan B volume
     164.  00:6544  (00:C183)           FM_regVOLBb		#1	; Chan B volume
     165.  00:6544  (00:C184)           FM_regToneC 	#2	; Tone C freq low					; Tone C freq high
     166.  00:6544  (00:C186)           FM_regToneCb 	#2	; Tone C freq low					; Tone C freq high
     167.  00:6544  (00:C188)           FM_regVOLC	 	#1	; Chan C volume
     168.  00:6544  (00:C189)           FM_regVOLCb	 	#1	; Chan C volume
     169.  00:6544  (00:C18A)           FM_regToneD 	#2	; Tone D freq low					; Tone D freq high
     170.  00:6544  (00:C18C)           FM_regToneDb 	#2	; Tone D freq low					; Tone D freq high
     171.  00:6544  (00:C18E)           FM_regVOLD		#1	; Chan D volume
     172.  00:6544  (00:C18F)           FM_regVOLDb		#1	; Chan D volume
     173.  00:6544  (00:C190)           FM_regToneE 	#2	; Tone E freq low					; Tone E freq high
     174.  00:6544  (00:C192)           FM_regToneEb 	#2	; Tone E freq low					; Tone E freq high
     175.  00:6544  (00:C194)           FM_regVOLE	  	#1	; Chan E volume
     176.  00:6544  (00:C195)           FM_regVOLEb	  	#1	; Chan E volume
     177.  00:6544  (00:C196)           FM_regToneF 	#2	; Tone F freq low					; Tone F freq high
     178.  00:6544  (00:C198)           FM_regToneFb 	#2	; Tone F freq low					; Tone F freq high
     179.  00:6544  (00:C19A)           FM_regVOLF	  	#1	; Chan F volume
     180.  00:6544  (00:C19B)           FM_regVOLFb	  	#1	; Chan F volume
     181.  00:6544                      
     182.  00:6544  (00:C19C)           DRUM_regToneBD	#2
     183.  00:6544  (00:C19E)           DRUM_regToneBDb	#2
     184.  00:6544  (00:C1A0)           DRUM_regVolBD	#1
     185.  00:6544  (00:C1A1)           DRUM_regVolBDb	#1
     186.  00:6544  (00:C1A2)           DRUM_regToneSH	#2
     187.  00:6544  (00:C1A4)           DRUM_regToneSHb	#2
     188.  00:6544  (00:C1A6)           DRUM_regVolSH	#1
     189.  00:6544  (00:C1A7)           DRUM_regVolSHb	#1
     190.  00:6544  (00:C1A8)           DRUM_regToneCT	#2
     191.  00:6544  (00:C1AA)           DRUM_regToneCTb	#2
     192.  00:6544  (00:C1AC)           DRUM_regVolCT	#1
     193.  00:6544  (00:C1AD)           DRUM_regVolCTb	#1
     194.  00:6544  (00:C1AE)           FM_DRUM		#1	; Percussion bits
     195.  00:6544  (00:C1AF)           FM_DRUMb		#1
     196.  00:6544                      
     197.  00:6544                      
     198.  00:6544                      ;FM_DRUM_Flags		#1	; 7, percusion, 6,4,2 = tone update, 5,3,1 = vol update
     199.  00:6544                      ;FM_freqreg1			#2	; Base drum
     200.  00:6544                      ;FM_volreg1			#1	; Drum (low)
     201.  00:6544                      ;FM_freqreg2			#2	; Snare + HiHat
     202.  00:6544                      ;FM_volreg2			#1	; Snare(low) Hihat(High)
     203.  00:6544                      ;FM_freqreg3			#2	; Cymbal + TomTom
     204.  00:6544                      ;FM_volreg3			#1	; Cymbal(low) TomTom (High)
     205.  00:6544                      
     206.  00:6544                      ;FM_DRUM_LEN			#1	; Length of drum macro
     207.  00:6544  (00:C1B0)           FM_DRUM_ACTIVE		#1	; Is a drum active?
     208.  00:6544  (00:C1B1)           FM_DRUM_MACRO		#2	; Pointer to drum macro data
     209.  00:6544                      
     210.  00:6544  (00:C1B3)           FM_softvoice_req		#1	; Software voice requested
     211.  00:6544                      
     212.  00:6544                      
     213.  00:6544                      ; DEze lijkt niet meer nodig
     214.  00:6544  (00:C1B4)           FM_regMIXER 		#1	; x3f	; Mixer control (1 = off, 0 = on)
     215.  00:6544                      
     216.  00:6544                      
     217.  00:6544                      
     218.  00:6544                      
     219.  00:6544                      ;/// see to remove this.
     220.  00:6544                      ;-- SCC registers
     221.  00:6544                      ;oldregs:	#(32*4)+(3*5)+1		; a way to int the SCC
     222.  00:6544                      
     223.  00:6544                      
     617   00:6544                      	
     618   00:6544                      
     619   00:6544  (00:C1B5)           debug_pointer1:	#2
     620   00:6544  (00:C1B7)           debug_pointer2:	#2	
     621   00:6544  (00:C1B9)           debug_pnt:		#8*80
     622   00:6544  (00:C439)           TEXT_Chan		#40
     623   00:6544                      
     624   00:6544                      	
     625   00:6544                      ;	include	"..\ttsfxplay\ttsfxplay_RAM.asm"
     626   00:6544  (00:C461)           pattern	#1
     627   00:6544                      

    LABELS
-------------------------------------------------
00:00004010   initmain
00:000040B2   infinite
00:000040D2   isr
00:000040F6   write_debug
00:00004103   _wd_loop
00:0000410C   clear_debug
00:0000411A   debuginfo
00:00004123   debuginfo.loop
00:00004165   step_debug
00:00004190   register_debug
00:000041CA   register_debug_loop
00:000041F1   REG_list
00:0000422D   clear_TEXT
00:00004239   debug_flags
00:000042A4   init_vdp
00:00000082   _UPLEFT
00:00000081   _HORIZONTAL
00:00000083   _UPRIGHT
00:00000080   _VERTICAL
00:00000087 X _VERTICAL_SMALL
00:00000086 X _VERTICAL_DOUBLE
00:0000008B X _VERTICAL_STEP
00:000000B0 X _ARROWLEFT
00:000000B1 X _ARROWRIGHT
00:000000AE X _LOOPSIGN
00:000000F1 X _TONE_OFF_SIGN
00:000000F2 X _TONE_ON_SIGN
00:000000F3 X _NOISE_OFF_SIGN
00:000000F4 X _NOISE_ON_SIGN
00:000000F5 X _ENV_OFF_SIGN
00:000000F6 X _ENV_ON_SIGN
00:000000BF X _CMD_SIGN
00:000000FE X _CURSOR
00:000000FC X MOUSE_CHR
00:00002000   _PNT
00:00002A00   _CNT
00:000042F0   clear_screen
00:00004305 X clear_cnt
00:0000431C X clear_files
00:00004337   draw_label
00:0000433F   draw_label_loop
00:00004349   draw_label_end
00:0000434B   draw_label_fast
00:0000435C X draw_fake_hex_sp
00:00004372 X draw_fake_hex_sp_small
00:0000437D X draw_hex_sp_small
00:00004385   draw_hex
00:00004387 X draw_fakehex
00:00004390   draw_hex_small
00:00004395   draw_hex2
00:000043A4 X conv_decimal
00:000043A5   draw_decimal
00:000043B2   _dd_Num1
00:000043B4   _dd_Num2
00:000043BC   draw_decimal3
00:000043C4 X draw_box
00:000043CE   draw_box_loop1
00:000043CF   draw_box_loop0
00:00004408   draw_box_end
00:0000440A X draw_colorbox
00:00004417   _dc_maskleft_loop
00:00004432   _dc_maskright_loop
00:00004455   _dc_start_loop
00:00004474   _cb_copyloop_main
00:00004499   _cb_copyloop
00:000044BA   _cp_clip_copy
00:000044DC X erase_colorbox
00:000044E9   _ecb_maskleft_loop
00:00004506   _ecb_maskright_loop
00:0000452B   _ecb_start_loop
00:0000454A   _ecb_copyloop_main
00:0000456F   _ecb_copyloop
00:00004590   _ecb_clip_copy
00:000045B2   set_vdpwrite
00:000045CF   set_vdpread
00:00000000   cb_maskleft
00:00000001   cb_maskright
00:00000002   cb_fullbytes
00:00000003 X cb_status
00:000045EA   init_font
00:000045F9   _fontloop
00:0000007C   FM_WRITE
00:0000007D   FM_DATA
00:00000060   _REL
00:00000061   _SUS
00:00000062   _VOL
00:00000071   _INS
00:00000090   _CMD
00:000000B8 X _SPC
00:000000BF   _EOT
00:000000C0   _WAIT
00:00004602   replay_init
00:0000461E   replay_pause
00:00004625 X _r_pause_enable
00:0000462B   _r_pause_disable
00:00004647   _r_pause_loop
00:0000464C X replay_fade_out
00:00004657   replay_set_FM_balance
00:0000465E   replay_set_PSG_balance
00:00004665   _getnewbalancebase
00:00004673   replay_loadsong
00:0000471E   replay_play
00:00004729 X replay_play.NTSC
00:0000473D   replay_play.PAL
00:00004754 X decode_data
00:0000475A X decode_data.decode1
00:0000477B   decode_data.decode2
00:000047A2   decode_data.decode3
00:000047C3   decode_data.decode4
00:000047E4   decode_data.decode5
00:00004805   decode_data.decode6
00:00004826   decode_data.decode7
00:00004847   decode_data.decode8
00:00004868   decode_data.decode_end
00:00004868   process_data
00:000048BB X _rdd_3psg_5fm
00:000048EE   _rdd_2psg_6fm
00:00004923   _rdd_cont
00:000049D1   _rdd_cont.cont_fadeing
00:000049D7   _rdd_cont.no_new_step
00:000049EB   _rdd_cont.calc_vol
00:000049F1   _rdd_cont.no_carry
00:000049F6   _replay_check_patternend
00:00004A1A   _replay_check_patternend.no_restart
00:00004A28   decode_data_chan
00:00004A3C   _rdn2
00:00004A41   _rdv2
00:00004A46   _rdi2
00:00004A4E   _rdn
00:00004A56   _rdi
00:00004A5E   _rdv
00:00004A66   _rdc
00:00004A67   _rdc_noinc
00:00004A70   _rd_delay
00:00004A79   _rd_eot
00:00004A80   _replay_decode_delay
00:00004A8C   _replay_decode_trigger_porttone_check
00:00004AA4   _replay_decode_note
00:00004AB0   _replay_decode_release
00:00004ABB   _replay_decode_sustain
00:00004AC4   _replay_decode_ins
00:00004AD9   _replay_decode_ins.skip
00:00004AE9   _replay_decode_ins.skip_soft
00:00004AF8   _replay_decode_ins.skip_ins
00:00004AFD   _replay_decode_vol
00:00004B12   _replaydecode_cmd
00:00004B26   _replaydecode_cmd.skip
00:00004B2D   DECODE_CMDLIST
00:00004B5B   decode_cmd0_arpeggio
00:00004B6E   decode_cmd1_port_up
00:00004B79   decode_cmd2_port_down
00:00004B84   decode_cmd3_port_tone
00:00004BA1   decode_cmd3_port_tone_new_note
00:00004BB2   decode_cmd3_port_tone_new_note.skip
00:00004BCA   decode_cmd3_port_tone_new_note.skip2
00:00004BE5   decode_cmd8_tremolo
00:00004BE5   decode_cmd4_vibrato
00:00004BF6   decode_cmd4_vibrato.depth
00:00004C10   decode_cmd4_vibrato.end
00:00004C15   decode_cmd5_vibrato_port_tone
00:00004C2C   decode_cmd6_vibrato_vol
00:00004C2C   decode_cmd7_vol_slide
00:00004C3C   decode_cmd9_note_cut
00:00004C47   decode_cmd10_note_delay
00:00004C65   decode_cmd11_command_end
00:00004C6A   decode_cmd12_drum
00:00004C82   decode_cmd13_arp_speed
00:00004C88   decode_cmd14_fine_up
00:00004C92   decode_cmd15_fine_down
00:00004C9D   decode_cmd16_notelink
00:00004CA4   decode_cmd17_track_detune
00:00004CB9   decode_cmd17_track_detune.pos
00:00004CC3   decode_cmd18_trigger
00:00004CC9   decode_cmd19_speed
00:00004CDC   decode_cmd20_tone_panning
00:00004CDF   decode_cmd21_noise_panning
00:00004CE2   decode_cmd22_chan_setup
00:00004CE5   process_data_chan
00:00004D01   process_data_chan.skip
00:00004D06   process_commandEND
00:00004D06   process_note
00:00004D0B X process_triggerNote
00:00004D34   process_noNoteTrigger
00:00004D4C   _vol_change
00:00004D53 X _vol_rel
00:00004D65   _vol_rel.skip
00:00004D66   _vol_base
00:00004D69   _noVolumeChange
00:00004D7C   _tone_on
00:00004D8A   _tone_on.skip2
00:00004D8A X _Vadd
00:00004D94   _Vadd.skip
00:00004D9E   _Vadd.skip2
00:00004DA0   _tone_off
00:00004DA3 X _noVolume
00:00004DB2   _noNoise
00:00004DCE   _noNoise.skip2
00:00004DCE X _NVadd
00:00004DD8   _NVadd.skip
00:00004DDD X _NVadd.skip2
00:00004DF2   _NVadd.skip3
00:00004DF9   _noNoiseVol
00:00004E07   _noLink
00:00004E1D   _noLink.skip
00:00004E24   process_noToneAdd
00:00004E2D   process_noToneAdd.noend
00:00004E3A   process_noToneBit
00:00004E50   process_noToneBit.skip
00:00004E73 X _wrap_highcheck
00:00004E9A   _wrap_lowcheck
00:00004EBD   _wrap_skip
00:00004ECD   process_noNoteActive
00:00004EE0   PROCESS_CMDLIST
00:00004EF6   process_cmd0_arpeggio
00:00004F1A   process_cmd0_arpeggio.nextNote
00:00004F67   process_cmd1_port_up
00:00004F7B   process_cmd2_port_down
00:00004F8F   process_cmd3_port_tone
00:00004F9D X process_cmd3_add
00:00004FA5   process_cmd3_add.skip
00:00004FB0   process_cmd3_sub
00:00004FC5   process_cmd3_stop
00:00004FD0   process_cmd8_tremolo
00:00004FF6   process_cmd4_vibrato
00:0000500C X process_cmd4_vibrato.neg
00:00005024   process_cmd4_vibrato.pos
00:0000502B   process_cmd4_vibrato.zero
00:00005035   process_cmd5_vibrato_port_tone
00:0000503B   process_cmd6_vibrato_vol
00:00005041   process_cmd7_vol_slide
00:00005047   process_cmdasub
00:0000505C X process_cmda_dec
00:00005064   process_cmda_inc
00:0000506D   process_cmd9_note_cut
00:0000507A   process_cmd10_note_delay
00:0000508D X _process_drum_none
00:00005091   process_drum
00:0000509A   _process_drum_loop
00:000050AE   _process_drum_loop.end
00:000050B3   DRUM_MACRO_LIST
00:000050D1   _drum_stop
00:000050D6   _drum_vol_bd
00:000050DE   _drum_vol_sn
00:000050ED   _drum_vol_hh
00:000050FC   _drum_vol_snhh
00:00005104   _drum_vol_cy
00:00005113   _drum_vol_tt
00:00005122   _drum_vol_cytt
00:0000512A   _drum_note_bd
00:00005137   _drum_tone_bd
00:00005144   _drum_note_snhh
00:00005151   _drum_tone_snhh
00:00005161   _drum_note_cytt
00:0000516E   _drum_tone_cytt
00:0000517E   _drum_percussion
00:00005186   replay_route
00:00005186 X route_SN
00:00005227 X route_gg
00:0000522A X route_FM
00:00005237   route_FM.noVoice
00:00005241   route_FM.channel_loop
00:00005273 X _route_FM_drum_update
00:00005291   _route_FM_reg8_update
00:00005296   _route_FM_reg16_update
00:00005299   _rfr_cont
00:000052A7   _route_FM_keyOff_update
00:000052B6   load_softwarevoice
00:000052BF   load_softwarevoice.voiceupd_loop
00:00005356   _VOLUME_TABLE
00:00005456   TRACK_ToneTable_PSG
00:00005516   TRACK_ToneTable_FM
00:000055D6   TRACK_Vibrato_sine
00:00005756   demo_song
00:0000575D   demo_song.restart
00:000057D1   demo_song.customvoice_start
00:000057E1 X demo_song.waveform_start
00:000057E1   demo_song.drummacro_start
00:000057E7   demo_song.drum_00
00:000057EA   demo_song.drum_02
00:00005800   demo_song.drum_04
00:00005808   demo_song.instrument_start
00:00005820   demo_song.instrument_00
00:00005847   demo_song.rst_i00
00:0000584B   demo_song.instrument_01
00:0000585C   demo_song.rst_i01
00:00005860   demo_song.instrument_02
00:00005891   demo_song.rst_i02
00:00005895   demo_song.instrument_03
00:00005897   demo_song.rst_i03
00:0000589B   demo_song.instrument_04
00:0000589D   demo_song.rst_i04
00:000058A1   demo_song.instrument_05
00:000058AA   demo_song.rst_i05
00:000058B1   demo_song.instrument_06
00:000058B3   demo_song.rst_i06
00:000058B7   demo_song.instrument_07
00:000058C2   demo_song.rst_i07
00:000058C6   demo_song.instrument_08
00:000058C7   demo_song.rst_i08
00:000058CB   demo_song.instrument_09
00:000058D2   demo_song.rst_i09
00:000058E3   demo_song.instrument_10
00:0000590D   demo_song.rst_i10
00:00005913   demo_song.instrument_11
00:0000593A   demo_song.rst_i11
00:0000593E   demo_song.track_000
00:00005941   demo_song.track_002
00:00005943   demo_song.track_004
00:00005997   demo_song.track_005
00:000059E5   demo_song.track_008
00:00005A36   demo_song.track_009
00:00005A5C   demo_song.track_010
00:00005A5E   demo_song.track_011
00:00005A86   demo_song.track_012
00:00005AAD   demo_song.track_013
00:00005ACC   demo_song.track_014
00:00005AEB   demo_song.track_015
00:00005B12   demo_song.track_016
00:00005B6F   demo_song.track_021
00:00005B92   demo_song.track_022
00:00005BEB   demo_song.track_023
00:00005C3D   demo_song.track_024
00:00005C4A   demo_song.track_025
00:00005C55   demo_song.track_026
00:00005C59   demo_song.track_027
00:00005C67   demo_song.track_028
00:00005C72   demo_song.track_029
00:00005C7D   demo_song.track_030
00:00005C88   demo_song.track_031
00:00005C93   TEXT_Title
00:00005CB8   TEXT_Step
00:00005CBE   TEXT_Header_Data
00:00005CD6   TEXT_Register_Header
00:00005CF9   TEXT_Register_Drum
00:00005D0A   TEXT_Legend_Data
00:00005D44   font_data
00:FFFFFFEF   TRACK_Instrument
00:FFFFFFF0   TRACK_Command
00:FFFFFFF1   TRACK_MacroPointer
00:FFFFFFF3   TRACK_MacroStart
00:FFFFFFF5 X TRACK_MacroRestart
00:FFFFFFF6   TRACK_Note
00:FFFFFFF7   TRACK_Volume
00:FFFFFFF8   TRACK_Voice
00:FFFFFFF9   TRACK_Flags
00:FFFFFFFA X TRACK_empty
00:FFFFFFFB   TRACK_ToneAdd
00:FFFFFFFD   TRACK_VolumeAdd
00:FFFFFFFE X TRACK_Noise
00:FFFFFFFF   TRACK_cmd_VolumeAdd
00:00000000   TRACK_cmd_ToneSlideAdd
00:00000002   TRACK_cmd_ToneAdd
00:00000004   TRACK_cmd_detune
00:00000006   TRACK_cmd_0
00:00000007   TRACK_cmd_1
00:00000008   TRACK_cmd_2
00:00000009   TRACK_cmd_3
00:0000000A   TRACK_cmd_4_depth
00:0000000C   TRACK_cmd_4_step
00:0000000D   TRACK_cmd_NoteAdd
00:0000000E   TRACK_cmd_A
00:0000000F X TRACK_cmd_B
00:00000010   TRACK_cmd_E
00:00000011   TRACK_Timer
00:00000012   TRACK_Step
00:00000013   TRACK_Delay
00:00000014   TRACK_prevDelay
00:00000015 X TRACK_cmd_A_add
00:00000027   TRACK_REC_SIZE
00:00000000   B_TRGNOT
00:00000001   B_ACTNOT
00:00000002 X B_TRGENV
00:00000003   B_TRGCMD
00:00000004   B_KEYON
00:00000005   B_SUST
00:00000006   B_TRGVOI
00:00000007   B_PSGFM
00:0000C000   _SP_Storage
00:0000C002   replay_trigger
00:0000C003   replay_mainPSGvol
00:0000C005   replay_mainSCCvol
00:0000C007   replay_voicebase
00:0000C009   replay_drumbase
00:0000C00B   replay_insbase
00:0000C00D   TRACK_pointer1
00:0000C00F   TRACK_pointer2
00:0000C011   TRACK_pointer3
00:0000C013   TRACK_pointer4
00:0000C015   TRACK_pointer5
00:0000C017   TRACK_pointer6
00:0000C019   TRACK_pointer7
00:0000C01B   TRACK_pointer8
00:0000C01D   replay_orderpointer
00:0000C01F   replay_speed
00:0000C020   replay_speed_subtimer
00:0000C021   replay_speed_timer
00:0000C022   replay_mode
00:0000C023   replay_chan_setup
00:0000C024   replay_arp_speed
00:0000C025   replay_fade
00:0000C026   replay_fade_timer
00:0000C027   replay_fade_vol
00:0000C028   replay_previous_note
00:0000C029   replay_mainvol
00:0000C02B X replay_vib_table
00:0000C02D   replay_tonetable
00:0000C02F   equalization_freq
00:0000C030   equalization_cnt
00:0000C031   equalization_flag
00:0000C032   TRACK_Chan1
00:0000C059   TRACK_Chan2
00:0000C080   TRACK_Chan3
00:0000C0A7   TRACK_Chan4
00:0000C0CE   TRACK_Chan5
00:0000C0F5   TRACK_Chan6
00:0000C11C   TRACK_Chan7
00:0000C143   TRACK_Chan8
00:0000C16A X PSG_registers
00:0000C16A   PSG_regToneA
00:0000C16C   PSG_regToneB
00:0000C16E   PSG_regToneC
00:0000C170   PSG_regNOISE
00:0000C171   PSG_regMIXER
00:0000C172   PSG_regVOLA
00:0000C173   PSG_regVOLB
00:0000C174   PSG_regVOLC
00:0000C175   PSG_regVOLN
00:0000C176   PSG_regNOISEold
00:0000C177   GG_panning
00:0000C178   FM_Registers
00:0000C178   FM_regToneA
00:0000C17A X FM_regToneAb
00:0000C17C   FM_regVOLA
00:0000C17D X FM_regVOLAb
00:0000C17E   FM_regToneB
00:0000C180 X FM_regToneBb
00:0000C182   FM_regVOLB
00:0000C183 X FM_regVOLBb
00:0000C184   FM_regToneC
00:0000C186 X FM_regToneCb
00:0000C188   FM_regVOLC
00:0000C189 X FM_regVOLCb
00:0000C18A   FM_regToneD
00:0000C18C X FM_regToneDb
00:0000C18E   FM_regVOLD
00:0000C18F X FM_regVOLDb
00:0000C190   FM_regToneE
00:0000C192 X FM_regToneEb
00:0000C194   FM_regVOLE
00:0000C195 X FM_regVOLEb
00:0000C196   FM_regToneF
00:0000C198 X FM_regToneFb
00:0000C19A   FM_regVOLF
00:0000C19B X FM_regVOLFb
00:0000C19C   DRUM_regToneBD
00:0000C19E X DRUM_regToneBDb
00:0000C1A0   DRUM_regVolBD
00:0000C1A1 X DRUM_regVolBDb
00:0000C1A2   DRUM_regToneSH
00:0000C1A4 X DRUM_regToneSHb
00:0000C1A6   DRUM_regVolSH
00:0000C1A7 X DRUM_regVolSHb
00:0000C1A8   DRUM_regToneCT
00:0000C1AA X DRUM_regToneCTb
00:0000C1AC   DRUM_regVolCT
00:0000C1AD X DRUM_regVolCTb
00:0000C1AE   FM_DRUM
00:0000C1AF X FM_DRUMb
00:0000C1B0   FM_DRUM_ACTIVE
00:0000C1B1   FM_DRUM_MACRO
00:0000C1B3   FM_softvoice_req
00:0000C1B4   FM_regMIXER
00:0000C1B5   debug_pointer1
00:0000C1B7 X debug_pointer2
00:0000C1B9   debug_pnt
00:0000C439   TEXT_Chan
00:0000C461   pattern


 Output: main.rom
-------------------------------------------------

 Page: 00
  Org: 00004000  Size: 00008000  Used: 00002544

   Address   Length Align   Label
   00004000    9540         initmain
   00006544   23228       <empty>
